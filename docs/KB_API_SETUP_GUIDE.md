# KB국민은행 기업 API 무료 연동 가이드

## 왜 KB 기업 API인가?

### 비용 비교
| 항목 | 오픈뱅킹 | KB 기업 API |
|------|----------|-------------|
| 가입비 | 무료 | **무료** |
| 월 기본료 | 50,000원 | **0원** |
| 거래 수수료 | 20원/건 | **0원** (시스템 무료) |
| 이체 수수료 | 별도 | KB→KB: **무료**, KB→타행: 500원 |
| 월 100건 비용 | 52,000원 | **0원** (타행이면 50,000원) |

**결론: KB 계좌끼리 송금하면 완전 무료!**

---

## 신청 방법

### 1단계: KB국민은행 방문
가까운 KB국민은행 지점을 방문하세요.

### 2단계: 기업 인터넷뱅킹 가입
```
필요 서류:
- 사업자등록증 원본
- 대표자 신분증
- 법인인감증명서 (법인인 경우)
- 통장 또는 사본
```

### 3단계: API 서비스 신청
1. 영업점 직원에게 "**기업 API 서비스**" 신청 요청
2. API 이용 신청서 작성
3. 용도: "자사 시스템 연동용 자동 송금"

### 4단계: 공인인증서 발급
- 기업용 공인인증서 발급
- 범용 인증서 권장 (타행 이체 시 필요)
- 비용: 약 110,000원/년

### 5단계: API Key 발급 (3-5일 소요)
- KB에서 검토 후 발급
- 이메일 또는 문자로 수신
- Client ID, Client Secret 제공

---

## 환경 변수 설정

`.env` 파일에 추가:

```env
# KB국민은행 기업 API
KB_API_URL=https://api.kbstar.com
KB_CLIENT_ID=발급받은_Client_ID
KB_CLIENT_SECRET=발급받은_Client_Secret

# KB 회사 계좌
KB_COMPANY_ACCOUNT=발급받은_계좌번호
KB_COMPANY_ACCOUNT_HOLDER=회사명

# 공인인증서 (옵션)
KB_CERT_PATH=/path/to/certificate.pfx
KB_CERT_PASSWORD=인증서_비밀번호
```

---

## 실제 사용 예시

### 시나리오 1: KB → KB 송금 (무료!)
```
출금: KB국민은행 123-456-789012
입금: KB국민은행 987-654-321098
금액: 1,000,000원
수수료: 0원 ✨
```

### 시나리오 2: KB → 신한 송금
```
출금: KB국민은행 123-456-789012
입금: 신한은행 110-123-456789
금액: 500,000원
수수료: 500원
```

### 월 100건 송금 시 비용
- 전부 KB 계좌: **0원**
- 전부 타행 계좌: **50,000원** (500원 × 100건)
- 반반 (KB 50건, 타행 50건): **25,000원**

**오픈뱅킹 대비 저렴!** (오픈뱅킹은 52,000원)

---

## 테스트 방법

### 1. 로컬 테스트
```bash
# 서버 실행
npm run dev

# 테스트 송금 (소액 권장)
curl -X POST http://localhost:3000/api/banking/kb-transfer \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "paymentId": 1,
    "bankCode": "004",
    "accountNumber": "12345678901",
    "accountHolder": "홍길동",
    "amount": 1000,
    "purpose": "테스트 송금"
  }'
```

### 2. 잔액 확인
KB 인터넷뱅킹 또는 스타뱅킹 앱에서 즉시 확인 가능

### 3. 프론트엔드 테스트
1. 결제 요청 생성
2. [즉시송금] 버튼 클릭
3. 확인 팝업에서 수수료 확인
4. 송금 실행
5. "송금이 완료되었습니다 (수수료 무료)" 메시지 확인

---

## 주의사항

### 보안
1. **.env 파일 절대 GitHub에 업로드 금지**
2. Client Secret은 암호화 보관
3. HTTPS 필수 (Railway는 자동 제공)

### 한도 설정
1. KB 인터넷뱅킹에서 한도 설정 가능
2. 추천 한도:
   - 1회 한도: 5,000,000원
   - 1일 한도: 20,000,000원

### 이체 가능 시간
- 평일: 09:00 ~ 23:30
- 토요일: 09:00 ~ 15:00
- 일요일/공휴일: 일부 제한

### 타행 이체 시간
- 즉시 이체 가능 (24시간)
- 다만 수취 은행 점검 시간 제외

---

## 문제 해결

### "인증 실패"
- Client ID/Secret 확인
- 유효 기간 확인 (1년마다 갱신)

### "잔액 부족"
- 회사 계좌 잔액 확인
- 한도 초과 여부 확인

### "계좌번호 오류"
- 계좌번호 하이픈 제거 확인
- 예금주명 일치 확인

### "시스템 점검"
- KB 점검 시간 확인
- 평일 23:30 ~ 00:30 점검 가능

---

## API 갱신

### 1년 후 갱신 필요
1. KB 영업점 방문
2. API 이용 연장 신청
3. 새로운 Client Secret 발급
4. 환경 변수 업데이트
5. 서버 재시작

---

## KB 고객센터

### 기업뱅킹 문의
- 전화: 1588-9999 → 0번 (상담원 연결)
- 운영시간: 평일 09:00-18:00

### API 기술 지원
- 이메일: openapi@kbstar.com
- 응답 시간: 1-2 영업일

---

## 실제 구현 완료!

✅ KB Bank API 서비스 구현 완료
✅ 자동 송금 라우트 추가
✅ 수수료 자동 계산 (KB→KB: 무료, 타행: 500원)
✅ 프론트엔드 즉시송금 버튼
✅ 거래 내역 자동 저장

**이제 KB 영업점에 방문해서 신청하시면 바로 사용 가능합니다!**

---

## 다음 단계

1. ✅ KB 국민은행 영업점 방문 예약
2. ✅ 기업 인터넷뱅킹 + API 서비스 신청
3. ✅ Client ID/Secret 수령 (3-5일)
4. ✅ Railway 환경 변수에 추가
5. ✅ 소액 테스트 송금
6. ✅ 본격 사용 시작!

**완전 무료로 자동 송금 시스템을 사용하세요!** 🎉
