import{q as ne,o as ae,m as Z,a as _,n as We,w as re,T as E,p as fe,d as Ae,g as ye,t as Ze,b as Je,v as Ee,x as Be,y as he,z as Ge,h as I,i as P,j as Qe,k as et,A as N,l as a}from"./index-C3cpvoiK.js";import{r as m}from"./vendor-react-DN7YJcfR.js";import{p as y}from"./vendor-date-DbWJ9m7c.js";import{r as _e,s as Ue,P as tt,T as He,t as st,U as Me,u as nt,X as at}from"./vendor-ui-D8A9iq7X.js";import"./vendor-data-DrLf5NIQ.js";import"./vendor-calendar-DjAQlTCo.js";const U="site_logs",$=n=>{const o=n.data();return{_id:n.id,project:o.project||"",date:o.date instanceof E?o.date.toDate().toISOString():o.date||"",images:o.images||[],notes:o.notes||"",createdBy:o.createdBy||"",createdAt:o.createdAt instanceof E?o.createdAt.toDate().toISOString():o.createdAt||"",updatedAt:o.updatedAt instanceof E?o.updatedAt.toDate().toISOString():o.updatedAt||""}},H={getAllLogs:async()=>{const n=ne(Z(_,U),ae("date","desc"));return(await fe(n)).docs.map($)},getProjectLogs:async n=>{const o=ne(Z(_,U),re("project","==",n),ae("date","desc"));return(await fe(o)).docs.map($)},createLog:async n=>{const o=E.now(),g={project:n.project,date:n.date instanceof Date?E.fromDate(n.date):n.date,images:[],notes:n.notes||"",createdBy:n.createdBy,createdAt:o,updatedAt:o},f=await Ge(Z(_,U),g);let L=[];n.images&&n.images.length>0&&(n.images.some(d=>Ee(d))?(L=await Be("site_logs",f.id,n.images),await he(f,{images:L})):(L=n.images,await he(f,{images:L})));const x=await ye(f);return $(x)},updateLog:async(n,o)=>{const g=Ae(_,U,n),f={updatedAt:E.now()};o.project!==void 0&&(f.project=o.project),o.date!==void 0&&(f.date=o.date instanceof Date?E.fromDate(o.date):o.date),o.notes!==void 0&&(f.notes=o.notes),o.images!==void 0&&(o.images.some(B=>Ee(B))?f.images=await Be("site_logs",n,o.images):f.images=o.images),await he(g,f);const L=await ye(g);return $(L)},deleteLog:async n=>{const o=Ae(_,U,n),g=await ye(o);if(g.exists()){const f=g.data();f.images&&f.images.length>0&&await Ze(f.images)}await Je(o)},getLogsByDateRange:async(n,o,g)=>{const f=ne(Z(_,U),re("project","==",n),re("date",">=",E.fromDate(o)),re("date","<=",E.fromDate(g)),ae("date","desc"));return(await fe(f)).docs.map($)},subscribeToLogs:n=>{const o=ne(Z(_,U),ae("date","desc"));return We(o,g=>{const f=g.docs.map($);n(f)})}},R={async getProjectLogs(n){try{return(await P.get(`/site-logs/project/${encodeURIComponent(n)}`)).data}catch(o){return console.error("Failed to get project logs:",o),[]}},async getAllLogs(){try{return(await P.get("/site-logs")).data}catch(n){return console.error("Failed to get all logs:",n),[]}},async createLog(n){try{return(await P.post("/site-logs",n)).data}catch(o){throw console.error("Failed to create log:",o),o}},async updateLog(n,o){try{return(await P.put(`/site-logs/${n}`,o)).data}catch(g){throw console.error("Failed to update log:",g),g}},async deleteLog(n){try{return(await P.delete(`/site-logs/${n}`)).data}catch(o){throw console.error("Failed to delete log:",o),o}},async getLogsByDateRange(n,o,g){try{return(await P.get("/site-logs/range",{params:{project:n,startDate:o.toISOString(),endDate:g.toISOString()}})).data}catch(f){return console.error("Failed to get logs by date range:",f),[]}}},S={async getProjectLogs(n){return I()?(console.log("[siteLogService] Using Firestore"),H.getProjectLogs(n)):(console.log("[siteLogService] Using Railway API"),R.getProjectLogs(n))},async getAllLogs(){return I()?H.getAllLogs():R.getAllLogs()},async createLog(n){return I()?H.createLog(n):R.createLog(n)},async updateLog(n,o){return I()?H.updateLog(n,o):R.updateLog(n,o)},async deleteLog(n){return I()?H.deleteLog(n):R.deleteLog(n)},async getLogsByDateRange(n,o,g){return I()?H.getLogsByDateRange(n,o,g):R.getLogsByDateRange(n,o,g)},subscribeToLogs:H.subscribeToLogs},yt=()=>{const{user:n}=Qe(),o=et(),[g,f]=m.useState(()=>localStorage.getItem("siteLog_includeCompleted")==="true"),L=g?o:o.filter(e=>e.status!=="completed"),[x,B]=m.useState([]),[d,J]=m.useState(""),F=m.useRef(null),[b,Te]=m.useState(new Date),[Ie,oe]=m.useState(!1),[h,Y]=m.useState({show:!1,url:null}),[rt,Ne]=m.useState(!1),[ie,xe]=m.useState(0),[X,Pe]=m.useState(new Date),[v,V]=m.useState(1),[C,w]=m.useState({x:0,y:0}),[me,le]=m.useState(!1),[G,ce]=m.useState({x:0,y:0}),[de,O]=m.useState(null),[ue,z]=m.useState(null),[Q,q]=m.useState(!1),[$e,be]=m.useState(0),[ge,ke]=m.useState(null),[K,ee]=m.useState({notes:"",images:[]}),[te,De]=m.useState(()=>{const e=localStorage.getItem("siteLogNotes");return e?JSON.parse(e):{}});m.useRef(null);const[ot,Re]=m.useState(null);m.useRef(null);const[it,mt]=m.useState(!1),[lt,Fe]=m.useState("saved"),Le=m.useRef([]);m.useEffect(()=>{Le.current=x},[x]),m.useEffect(()=>{localStorage.setItem("siteLogNotes",JSON.stringify(te))},[te]),m.useEffect(()=>{localStorage.setItem("siteLog_includeCompleted",String(g))},[g]),m.useEffect(()=>{if(L.length>0&&!d){const e=`siteLog_lastProject_${(n==null?void 0:n.id)||(n==null?void 0:n.name)}`,t=localStorage.getItem(e);t&&L.find(s=>s.name===t)?J(t):J(L[0].name)}},[L,n]),m.useEffect(()=>{if(d&&n){const e=`siteLog_lastProject_${n.id||n.name}`;localStorage.setItem(e,d)}},[d,n]),m.useEffect(()=>()=>{F.current&&clearTimeout(F.current)},[]),m.useEffect(()=>{M()},[d]),m.useEffect(()=>{const e=y(b,"yyyy-MM-dd"),t=`${d}_${e}`,s=te[t];ee(s!==void 0?r=>({...r,notes:s}):r=>({...r,notes:""})),Fe("saved")},[b,d]),m.useEffect(()=>{if(x.length===0)return;const e=y(b,"yyyy-MM-dd"),t=`${d}_${e}`;if(te[t]!==void 0)return;const s=x.find(r=>{try{const i=r.date?new Date(r.date):null;return i&&!isNaN(i.getTime())&&y(i,"yyyy-MM-dd")===e&&r.project===d}catch{return!1}});s&&s.notes&&(ee(r=>({...r,notes:s.notes||""})),De(r=>({...r,[t]:s.notes||""})))},[x,b,d]);const M=async()=>{if(d)try{const e=await S.getProjectLogs(d);B(e.map(t=>({...t,id:t._id||t.id,date:t.date?new Date(t.date):new Date,createdAt:t.created_at?new Date(t.created_at):new Date})))}catch(e){console.error("Failed to load site logs:",e),B([])}},Ye=(e,t=1920,s=1080,r=.8)=>new Promise((i,l)=>{const c=new FileReader;c.onload=D=>{var p;const u=new Image;u.onload=()=>{const k=document.createElement("canvas");let A=u.width,j=u.height;if(A>t||j>s){const W=Math.min(t/A,s/j);A*=W,j*=W}k.width=A,k.height=j;const je=k.getContext("2d");if(!je){l(new Error("Canvas context not available"));return}je.drawImage(u,0,0,A,j),k.toBlob(W=>{if(!W){l(new Error("Failed to compress image"));return}const pe=new FileReader;pe.onload=()=>i(pe.result),pe.readAsDataURL(W)},e.type,r)},u.src=(p=D.target)==null?void 0:p.result},c.readAsDataURL(e)}),T=m.useCallback(async e=>{const s=Array.from(e).filter(i=>i.type.startsWith("image/"));if(s.length===0){N.error("이미지 파일만 업로드 가능합니다");return}if(s.length>100){N.error("한번에 최대 100장까지 업로드 가능합니다");return}if(!d){N.error("프로젝트를 선택하세요");return}Ne(!0),N.loading(`${s.length}개의 이미지를 처리중...`);const r=s.map(i=>Ye(i));try{const i=await Promise.all(r),l=y(b,"yyyy-MM-dd"),c=x.find(p=>{try{const k=p.date?new Date(p.date):null;return k&&!isNaN(k.getTime())&&y(k,"yyyy-MM-dd")===l&&p.project===d}catch{return!1}}),D=20,u=[];for(let p=0;p<i.length;p+=D)u.push(i.slice(p,p+D));if(N.dismiss(),c){let p=[...c.images];for(let k=0;k<u.length;k++)N.loading(`이미지 업로드 중... (${k+1}/${u.length})`),p=[...p,...u[k]],await S.updateLog(c.id,{project:c.project,date:c.date,images:p,notes:c.notes||""}),N.dismiss();N.success(`${i.length}개의 사진이 추가되었습니다`)}else{N.loading(`이미지 업로드 중... (1/${u.length})`);const p={project:d,date:b,images:u[0],notes:"",createdBy:(n==null?void 0:n.name)||""},k=await S.createLog(p);if(N.dismiss(),u.length>1){let A=[...u[0]];for(let j=1;j<u.length;j++)N.loading(`이미지 업로드 중... (${j+1}/${u.length})`),A=[...A,...u[j]],await S.updateLog(k._id||k.id,{project:d,date:b,images:A,notes:""}),N.dismiss()}N.success(`${i.length}개의 사진이 저장되었습니다`)}await M()}catch(i){console.error("Failed to save images:",i),N.error("사진 저장에 실패했습니다")}finally{Ne(!1)}},[d,b,n,x,M]),Xe=m.useCallback(e=>{e.preventDefault(),T(e.dataTransfer.files)},[T]);m.useEffect(()=>{const e=t=>{var l;const s=(l=t.clipboardData)==null?void 0:l.items;if(!s)return;const r=Array.from(s).filter(c=>c.type.startsWith("image/"));if(r.length===0)return;t.preventDefault();const i=r.map(c=>c.getAsFile()).filter(Boolean);T(i)};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[T]),m.useCallback(async e=>{if(!(!d||!e))try{const t=y(b,"yyyy-MM-dd"),s=x.find(r=>{try{const i=r.date?new Date(r.date):null;return i&&!isNaN(i.getTime())&&y(i,"yyyy-MM-dd")===t&&r.project===d}catch{return!1}});if(s)await S.updateLog(s.id,{project:s.project,date:s.date,images:s.images,notes:e});else{const r={project:d,date:b,images:K.images,notes:e,createdBy:(n==null?void 0:n.name)||""};await S.createLog(r)}await M()}catch(t){console.error("Failed to auto-save site log:",t)}},[d,b,x,K.images,n,M]);const ve=async e=>{if(window.confirm("이 현장일지를 삭제하시겠습니까?"))try{await S.deleteLog(e),N.success("현장일지가 삭제되었습니다"),await M()}catch(t){console.error("Failed to delete site log:",t),N.error("현장일지 삭제에 실패했습니다")}},Oe=async(e,t)=>{if(!window.confirm("이 사진을 삭제하시겠습니까?"))return;const s=x.find(r=>r.id===e);if(s)try{const r=s.images.filter((i,l)=>l!==t);r.length===0&&!s.notes?await ve(e):(await S.updateLog(e,{project:s.project,date:s.date,images:r,notes:s.notes}),B(i=>i.map(l=>l.id===e?{...l,images:r}:l)),N.success("사진이 삭제되었습니다"))}catch(r){console.error("Failed to delete image:",r),N.error("사진 삭제에 실패했습니다")}},ze=()=>{const e=X.getFullYear(),t=X.getMonth(),s=new Date(e,t,1),r=new Date(s);r.setDate(r.getDate()-s.getDay());const i=[],l=new Date(r);for(let c=0;c<42;c++){const D=x.filter(u=>{try{const p=u.date?new Date(u.date):null;return p&&!isNaN(p.getTime())&&y(p,"yyyy-MM-dd")===y(l,"yyyy-MM-dd")}catch{return!1}});i.push({date:new Date(l),logs:D,hasImages:D.some(u=>u.images&&u.images.length>0)}),l.setDate(l.getDate()+1)}return i},we=e=>{const t=new Date(X);t.setMonth(t.getMonth()+e),Pe(t)},qe=x.reduce((e,t)=>{try{const s=t.date?new Date(t.date):null;if(s&&!isNaN(s.getTime())){const r=y(s,"yyyy-MM-dd");e[r]||(e[r]=[]),e[r].push(t)}}catch{}return e},{});Object.keys(qe).sort((e,t)=>t.localeCompare(e));const Ve=(e,t)=>{const s=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(s*s+r*r)},Se=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),Ce=(e,t=0)=>{Y({show:!0,url:e[t],images:e}),xe(t),V(1),w({x:0,y:0}),O(null),z(null),q(!1)},se=e=>{if(!h.images)return;const t=(ie+e+h.images.length)%h.images.length;xe(t),Y(s=>({...s,url:h.images[t]}))},Ke=async(e,t)=>{const s=x.find(r=>r.id===e);if(s)try{const r={...s,images:[...s.images,...t]};await S.updateLog(e,{project:s.project,date:s.date,images:r.images,notes:s.notes}),B(i=>i.map(l=>l.id===e?r:l)),N.success(`${t.length}개의 사진이 추가되었습니다`),Re(null)}catch(r){console.error("Failed to add images to log:",r),N.error("사진 추가에 실패했습니다")}};return m.useCallback((e,t)=>{const r=Array.from(t).filter(l=>l.type.startsWith("image/"));if(r.length===0){N.error("이미지 파일만 업로드 가능합니다");return}const i=r.map(l=>new Promise(c=>{const D=new FileReader;D.onload=u=>{var p;c((p=u.target)==null?void 0:p.result)},D.readAsDataURL(l)}));Promise.all(i).then(l=>{Ke(e,l)})},[x]),m.useEffect(()=>{const e=t=>{if(h.show)switch(t.key){case"ArrowLeft":t.preventDefault(),h.images&&h.images.length>1&&se(-1);break;case"ArrowRight":t.preventDefault(),h.images&&h.images.length>1&&se(1);break;case"Escape":t.preventDefault(),Y({show:!1,url:null});break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h.show,h.images,ie]),a.jsxDEV("div",{className:"site-log-container desktop:grid desktop:grid-cols-12 desktop:gap-4 desktop:h-[calc(100vh-140px)] space-y-3 desktop:space-y-0",children:[a.jsxDEV("div",{className:"desktop:hidden flex justify-end items-center gap-2 mb-2",children:[a.jsxDEV("label",{className:"flex items-center gap-1 text-[10px] text-gray-500",children:[a.jsxDEV("input",{type:"checkbox",checked:g,onChange:e=>f(e.target.checked),className:"w-3 h-3 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:715,columnNumber:11},void 0),"완료포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:714,columnNumber:9},void 0),a.jsxDEV("select",{value:d,onChange:e=>J(e.target.value),className:"px-3 py-1.5 bg-white text-gray-700 rounded-lg text-xs font-medium focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300",style:{appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.25rem",paddingRight:"2.5rem"},children:L.map(e=>a.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:737,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:723,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:713,columnNumber:7},void 0),a.jsxDEV("div",{className:"site-log-left desktop:col-span-4 desktop:flex desktop:flex-col desktop:gap-4 desktop:h-full space-y-3 desktop:space-y-0",children:[a.jsxDEV("div",{className:"site-log-calendar desktop:flex-shrink-0",children:a.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[32vh] desktop:max-h-full overflow-y-auto",children:[a.jsxDEV("div",{className:"mb-4 hidden desktop:block",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:a.jsxDEV("select",{value:d,onChange:e=>J(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:L.map(e=>a.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:759,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:753,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:752,columnNumber:15},void 0),a.jsxDEV("label",{className:"flex items-center gap-1.5 mt-2 text-xs text-gray-500 cursor-pointer",children:[a.jsxDEV("input",{type:"checkbox",checked:g,onChange:e=>f(e.target.checked),className:"w-3.5 h-3.5 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:766,columnNumber:17},void 0),"공사완료 현장 포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:765,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:751,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[a.jsxDEV("button",{onClick:()=>we(-1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:a.jsxDEV(_e,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:782,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:778,columnNumber:15},void 0),a.jsxDEV("h3",{className:"text-sm font-semibold",children:y(X,"yyyy년 M월")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:784,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>we(1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:a.jsxDEV(Ue,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:791,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:787,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:777,columnNumber:13},void 0),a.jsxDEV("div",{className:"grid grid-cols-7 gap-0.5",children:[["일","월","화","수","목","금","토"].map(e=>a.jsxDEV("div",{className:"text-center text-xs font-medium text-gray-600 py-1",children:e},e,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:798,columnNumber:17},void 0)),ze().map((e,t)=>{const s=e.date.getMonth()===X.getMonth(),r=y(e.date,"yyyy-MM-dd")===y(new Date,"yyyy-MM-dd"),i=y(e.date,"yyyy-MM-dd")===y(b,"yyyy-MM-dd");return a.jsxDEV("div",{onClick:()=>Te(e.date),className:`text-center p-1.5 desktop:p-2 text-xs cursor-pointer rounded transition-colors min-h-[36px] desktop:min-h-[48px] flex flex-col items-center justify-center ${s?"text-gray-700":"text-gray-300"} ${r?"bg-blue-100":""} ${i?"bg-gray-900 text-white":"hover:bg-gray-100"} ${e.hasImages?"font-bold":""}`,children:[a.jsxDEV("span",{children:y(e.date,"d")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:817,columnNumber:21},void 0),e.hasImages&&a.jsxDEV("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-0.5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:819,columnNumber:23},void 0)]},t,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:808,columnNumber:19},void 0)})]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:796,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:749,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:747,columnNumber:9},void 0),a.jsxDEV("div",{className:"site-log-notes desktop:flex-1 desktop:min-h-0",children:a.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[30vh] desktop:h-full desktop:flex desktop:flex-col overflow-hidden",children:[a.jsxDEV("h2",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:[y(b,"M월 d일")," 일지 작성"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:831,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex-1 min-h-0 flex flex-col",children:a.jsxDEV("textarea",{value:K.notes,onChange:e=>{const t=e.target.value,s=y(b,"yyyy-MM-dd"),r=`${d}_${s}`;ee(i=>({...i,notes:t})),De(i=>({...i,[r]:t})),F.current&&clearTimeout(F.current),F.current=setTimeout(async()=>{if(d)try{const i=Le.current.find(l=>{try{const c=l.date?new Date(l.date):null;return c&&!isNaN(c.getTime())&&y(c,"yyyy-MM-dd")===s&&l.project===d}catch{return!1}});if(i)await S.updateLog(i.id,{project:i.project,date:i.date,images:i.images,notes:t});else if(t.trim()){const l=await S.createLog({project:d,date:b,images:K.images,notes:t,createdBy:(n==null?void 0:n.name)||""});l&&B(c=>[...c,{id:l._id||l.id,project:d,date:b,images:K.images,notes:t,createdBy:(n==null?void 0:n.name)||"",createdAt:new Date}])}}catch(i){console.error("서버 저장 실패:",i)}},500)},rows:4,className:"site-log-textarea w-full h-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none desktop:min-h-[200px]",placeholder:"오늘 진행한 작업 내용을 입력하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:837,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:835,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:830,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:829,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:745,columnNumber:7},void 0),a.jsxDEV("div",{className:"site-log-photos desktop:col-span-8 desktop:h-full",children:a.jsxDEV("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 transition-all desktop:h-full desktop:flex desktop:flex-col ${Ie?"ring-2 ring-blue-400 bg-blue-50":""}`,onDragOver:e=>{e.preventDefault(),oe(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||oe(!1)},onDrop:e=>{e.preventDefault(),oe(!1),Xe(e)},children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-4 desktop:flex-shrink-0",children:[a.jsxDEV("h2",{className:"text-lg font-semibold flex items-center gap-4",children:a.jsxDEV("span",{className:"text-sm font-normal text-gray-600",children:["작성자: ",(n==null?void 0:n.name)||"알 수 없음"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:937,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:936,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*",e.onchange=t=>{const s=t.target;s.files&&T(s.files)},e.click()},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"사진 추가",children:a.jsxDEV(tt,{className:"h-5 w-5 text-gray-600"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:957,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:940,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>{const e=y(b,"yyyy-MM-dd"),t=x.filter(s=>{try{const r=s.date?new Date(s.date):null;return r&&!isNaN(r.getTime())&&y(r,"yyyy-MM-dd")===e}catch{return!1}});t.length>0&&window.confirm(`${y(b,"M월 d일")}의 모든 현장일지를 삭제하시겠습니까?`)&&t.forEach(s=>ve(s.id))},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"일지 삭제",children:a.jsxDEV(He,{className:"h-5 w-5 text-red-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:978,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:959,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:939,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:935,columnNumber:11},void 0),a.jsxDEV("div",{className:"space-y-6 max-h-[990px] desktop:max-h-full desktop:flex-1 desktop:min-h-0 overflow-y-auto",children:(()=>{const e=y(b,"yyyy-MM-dd"),t=x.filter(s=>{try{const r=s.date?new Date(s.date):null;return r&&!isNaN(r.getTime())&&y(r,"yyyy-MM-dd")===e}catch{return!1}});return t.length>0?a.jsxDEV("div",{className:"space-y-4",children:t.map(s=>a.jsxDEV("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[s.notes&&a.jsxDEV("div",{className:"mb-3",children:a.jsxDEV("p",{className:"text-sm text-gray-700",children:s.notes},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1006,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1005,columnNumber:27},void 0),a.jsxDEV("div",{className:"min-h-[600px] desktop:min-h-0",children:s.images&&s.images.length>0?a.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-3 desktop:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3",children:s.images.map((r,i)=>a.jsxDEV("div",{className:"relative group",children:[a.jsxDEV("img",{src:r,alt:`현장사진 ${i+1}`,className:"w-full aspect-[4/3] object-cover rounded-lg cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>Ce(s.images,i)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1016,columnNumber:35},void 0),a.jsxDEV("button",{onClick:()=>Ce(s.images,i),className:"absolute top-2 right-2 p-1.5 bg-black bg-opacity-50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsxDEV(st,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1026,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1022,columnNumber:35},void 0),a.jsxDEV("button",{onClick:l=>{l.stopPropagation(),Oe(s.id,i)},className:"absolute top-2 left-2 p-1.5 bg-red-600 bg-opacity-80 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-opacity-100",children:a.jsxDEV(He,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1035,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1028,columnNumber:35},void 0),a.jsxDEV("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:[i+1," / ",s.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1037,columnNumber:35},void 0)]},i,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1015,columnNumber:33},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1013,columnNumber:29},void 0):a.jsxDEV("div",{className:"flex items-center justify-center h-[600px]",children:a.jsxDEV("div",{className:"text-center",children:[a.jsxDEV(Me,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1046,columnNumber:33},void 0),a.jsxDEV("p",{className:"text-sm text-gray-400",children:"사진을 드래그하거나 + 버튼을 클릭하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1047,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1045,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1044,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1011,columnNumber:25},void 0)]},s.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1e3,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:998,columnNumber:19},void 0):a.jsxDEV("div",{children:a.jsxDEV("div",{className:"rounded-lg p-4 pt-2 desktop:p-12 text-center",children:[a.jsxDEV(nt,{className:"mx-auto h-12 w-12 desktop:h-16 desktop:w-16 text-gray-400 mb-2 desktop:mb-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1063,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-sm desktop:text-lg font-medium text-gray-700 mb-2",children:"현장 사진을 업로드하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1064,columnNumber:23},void 0),a.jsxDEV("p",{className:"hidden desktop:block text-sm text-gray-600 mb-4",children:"이미지를 이곳에 드래그하거나 클릭하여 선택"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1067,columnNumber:23},void 0),a.jsxDEV("p",{className:"hidden desktop:block text-xs text-gray-500 mb-4",children:"Ctrl+V로 클립보드 이미지 붙여넣기도 가능합니다"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1070,columnNumber:23},void 0),a.jsxDEV("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>s.target.files&&T(s.target.files),className:"hidden",id:"main-image-upload"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1073,columnNumber:23},void 0),a.jsxDEV("label",{htmlFor:"main-image-upload",className:"inline-flex items-center px-3 py-1.5 desktop:px-4 desktop:py-2 border border-gray-300 rounded-lg text-xs desktop:text-sm text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[a.jsxDEV(Me,{className:"h-3 w-3 desktop:h-4 desktop:w-4 mr-1.5 desktop:mr-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1085,columnNumber:25},void 0),"파일 선택"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1081,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1060,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1058,columnNumber:19},void 0)})()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:983,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:915,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:914,columnNumber:7},void 0),h.show&&h.url&&a.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center overflow-hidden",onClick:()=>{Y({show:!1,url:null}),V(1),w({x:0,y:0})},onWheel:e=>{e.preventDefault();const t=e.deltaY>0?-.1:.1;V(s=>Math.max(.5,Math.min(5,s+t)))},children:a.jsxDEV("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[a.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Y({show:!1,url:null}),V(1),w({x:0,y:0})},className:"absolute top-4 right-4 p-2 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30 z-10",children:a.jsxDEV(at,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1123,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1114,columnNumber:13},void 0),v!==1&&a.jsxDEV("div",{className:"absolute top-4 left-4 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm backdrop-blur",children:[Math.round(v*100),"%"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1128,columnNumber:15},void 0),h.images&&h.images.length>1&&a.jsxDEV("button",{onClick:e=>{e.stopPropagation(),se(-1),V(1),w({x:0,y:0})},className:"absolute left-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:a.jsxDEV(_e,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1144,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1135,columnNumber:15},void 0),a.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",onMouseDown:e=>{v>1&&(le(!0),ce({x:e.clientX-C.x,y:e.clientY-C.y}))},onMouseMove:e=>{me&&v>1&&w({x:e.clientX-G.x,y:e.clientY-G.y})},onMouseUp:()=>le(!1),onMouseLeave:()=>le(!1),onTouchStart:e=>{if(e.touches.length===2){e.preventDefault(),q(!0);const t=Ve(e.touches[0],e.touches[1]),s=Se(e.touches[0],e.touches[1]);O(t),z(s)}else if(e.touches.length===1&&v>1&&!Q){const t=e.touches[0];ce({x:t.clientX-C.x,y:t.clientY-C.y})}},onTouchMove:e=>{if(e.touches.length===2){e.preventDefault(),q(!0);const t=Ve(e.touches[0],e.touches[1]),s=Se(e.touches[0],e.touches[1]);if(de&&ue){const r=t/de,i=Math.max(.5,Math.min(5,v*r)),l=s.x-ue.x,c=s.y-ue.y,D=i/v,u=C.x*D+l,p=C.y*D+c;V(i),w({x:u,y:p})}O(t),z(s)}else if(e.touches.length===1&&v>1&&!Q){e.preventDefault();const t=e.touches[0];w({x:t.clientX-G.x,y:t.clientY-G.y})}},onTouchEnd:e=>{if(e.touches.length===0){const t=Date.now(),s=e.changedTouches[0],r={x:s.clientX,y:s.clientY};if(t-$e<300&&ge&&Math.abs(r.x-ge.x)<30&&Math.abs(r.y-ge.y)<30&&!Q){if(v===1){const c=e.currentTarget.getBoundingClientRect(),D=r.x-c.left-c.width/2,u=r.y-c.top-c.height/2;V(2.5),w({x:-D*1.5,y:-u*1.5})}else V(1),w({x:0,y:0});be(0),ke(null)}else be(t),ke(r);O(null),z(null),q(!1)}else if(e.touches.length===1&&Q){O(null),z(null),q(!1);const t=e.touches[0];ce({x:t.clientX-C.x,y:t.clientY-C.y})}},onDoubleClick:e=>{e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,r=e.clientY-t.top-t.height/2;v===1?(V(2.5),w({x:-s*1.5,y:-r*1.5})):(V(1),w({x:0,y:0}))},children:a.jsxDEV("img",{src:h.url,alt:"확대 이미지",style:{transform:`scale(${v}) translate(${C.x/v}px, ${C.y/v}px)`,transformOrigin:"center center",transition:me||de!==null?"none":"transform 0.25s cubic-bezier(0.2, 0, 0, 1)",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",cursor:v>1?me?"grabbing":"grab":"pointer",userSelect:"none",touchAction:"none"},draggable:!1,onClick:e=>e.stopPropagation()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1287,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1149,columnNumber:13},void 0),h.images&&h.images.length>1&&a.jsxDEV("button",{onClick:e=>{e.stopPropagation(),se(1),V(1),w({x:0,y:0})},className:"absolute right-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:a.jsxDEV(Ue,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1317,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1308,columnNumber:15},void 0),h.images&&h.images.length>1&&a.jsxDEV("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full",children:[ie+1," / ",h.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1323,columnNumber:15},void 0),a.jsxDEV("div",{className:"absolute bottom-4 right-4 bg-white bg-opacity-10 text-white px-3 py-2 rounded-lg text-xs text-center backdrop-blur",children:"마우스 휠 또는 두 손가락으로 확대/축소"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1329,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1112,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1099,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:711,columnNumber:5},void 0)};export{yt as default};
