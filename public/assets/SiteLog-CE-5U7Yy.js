import{q as ne,o as ae,m as Z,a as B,n as ze,w as re,T as E,p as fe,d as Ce,b as qe,t as Ke,g as je,v as We,h as T,i as I,j as Ze,k as Je,z as h,l as n}from"./index-BMdouOHW.js";import{r as m}from"./vendor-react-DN7YJcfR.js";import{p as f}from"./vendor-date-DbWJ9m7c.js";import{r as Ae,s as Ee,P as Ge,T as Be,t as Qe,U as _e,u as et,X as tt}from"./vendor-ui-D8A9iq7X.js";import"./vendor-data-DrLf5NIQ.js";import"./vendor-calendar-DjAQlTCo.js";const _="site_logs",P=a=>{const o=a.data();return{_id:a.id,project:o.project||"",date:o.date instanceof E?o.date.toDate().toISOString():o.date||"",images:o.images||[],notes:o.notes||"",createdBy:o.createdBy||"",createdAt:o.createdAt instanceof E?o.createdAt.toDate().toISOString():o.createdAt||"",updatedAt:o.updatedAt instanceof E?o.updatedAt.toDate().toISOString():o.updatedAt||""}},U={getAllLogs:async()=>{const a=ne(Z(B,_),ae("date","desc"));return(await fe(a)).docs.map(P)},getProjectLogs:async a=>{const o=ne(Z(B,_),re("project","==",a),ae("date","desc"));return(await fe(o)).docs.map(P)},createLog:async a=>{const o=E.now(),p={project:a.project,date:a.date instanceof Date?E.fromDate(a.date):a.date,images:a.images||[],notes:a.notes||"",createdBy:a.createdBy,createdAt:o,updatedAt:o},x=await We(Z(B,_),p),w=await je(x);return P(w)},updateLog:async(a,o)=>{const p=Ce(B,_,a),x={updatedAt:E.now()};o.project!==void 0&&(x.project=o.project),o.date!==void 0&&(x.date=o.date instanceof Date?E.fromDate(o.date):o.date),o.images!==void 0&&(x.images=o.images),o.notes!==void 0&&(x.notes=o.notes),await Ke(p,x);const w=await je(p);return P(w)},deleteLog:async a=>{const o=Ce(B,_,a);await qe(o)},getLogsByDateRange:async(a,o,p)=>{const x=ne(Z(B,_),re("project","==",a),re("date",">=",E.fromDate(o)),re("date","<=",E.fromDate(p)),ae("date","desc"));return(await fe(x)).docs.map(P)},subscribeToLogs:a=>{const o=ne(Z(B,_),ae("date","desc"));return ze(o,p=>{const x=p.docs.map(P);a(x)})}},$={async getProjectLogs(a){try{return(await I.get(`/site-logs/project/${encodeURIComponent(a)}`)).data}catch(o){return console.error("Failed to get project logs:",o),[]}},async getAllLogs(){try{return(await I.get("/site-logs")).data}catch(a){return console.error("Failed to get all logs:",a),[]}},async createLog(a){try{return(await I.post("/site-logs",a)).data}catch(o){throw console.error("Failed to create log:",o),o}},async updateLog(a,o){try{return(await I.put(`/site-logs/${a}`,o)).data}catch(p){throw console.error("Failed to update log:",p),p}},async deleteLog(a){try{return(await I.delete(`/site-logs/${a}`)).data}catch(o){throw console.error("Failed to delete log:",o),o}},async getLogsByDateRange(a,o,p){try{return(await I.get("/site-logs/range",{params:{project:a,startDate:o.toISOString(),endDate:p.toISOString()}})).data}catch(x){return console.error("Failed to get logs by date range:",x),[]}}},S={async getProjectLogs(a){return T()?(console.log("[siteLogService] Using Firestore"),U.getProjectLogs(a)):(console.log("[siteLogService] Using Railway API"),$.getProjectLogs(a))},async getAllLogs(){return T()?U.getAllLogs():$.getAllLogs()},async createLog(a){return T()?U.createLog(a):$.createLog(a)},async updateLog(a,o){return T()?U.updateLog(a,o):$.updateLog(a,o)},async deleteLog(a){return T()?U.deleteLog(a):$.deleteLog(a)},async getLogsByDateRange(a,o,p){return T()?U.getLogsByDateRange(a,o,p):$.getLogsByDateRange(a,o,p)},subscribeToLogs:U.subscribeToLogs},gt=()=>{const{user:a}=Ze(),o=Je(),[p,x]=m.useState(()=>localStorage.getItem("siteLog_includeCompleted")==="true"),w=p?o:o.filter(e=>e.status!=="completed"),[b,R]=m.useState([]),[u,J]=m.useState(""),F=m.useRef(null),[N,Ue]=m.useState(new Date),[He,oe]=m.useState(!1),[y,Y]=m.useState({show:!1,url:null}),[st,ye]=m.useState(!1),[ie,he]=m.useState(0),[X,Me]=m.useState(new Date),[L,V]=m.useState(1),[C,v]=m.useState({x:0,y:0}),[me,le]=m.useState(!1),[G,ce]=m.useState({x:0,y:0}),[de,O]=m.useState(null),[ue,z]=m.useState(null),[Q,q]=m.useState(!1),[Te,Ne]=m.useState(0),[ge,xe]=m.useState(null),[K,ee]=m.useState({notes:"",images:[]}),[te,be]=m.useState(()=>{const e=localStorage.getItem("siteLogNotes");return e?JSON.parse(e):{}});m.useRef(null);const[nt,Ie]=m.useState(null);m.useRef(null);const[at,rt]=m.useState(!1),[ot,Pe]=m.useState("saved"),ke=m.useRef([]);m.useEffect(()=>{ke.current=b},[b]),m.useEffect(()=>{localStorage.setItem("siteLogNotes",JSON.stringify(te))},[te]),m.useEffect(()=>{localStorage.setItem("siteLog_includeCompleted",String(p))},[p]),m.useEffect(()=>{if(w.length>0&&!u){const e=`siteLog_lastProject_${(a==null?void 0:a.id)||(a==null?void 0:a.name)}`,t=localStorage.getItem(e);t&&w.find(s=>s.name===t)?J(t):J(w[0].name)}},[w,a]),m.useEffect(()=>{if(u&&a){const e=`siteLog_lastProject_${a.id||a.name}`;localStorage.setItem(e,u)}},[u,a]),m.useEffect(()=>()=>{F.current&&clearTimeout(F.current)},[]),m.useEffect(()=>{H()},[u]),m.useEffect(()=>{const e=f(N,"yyyy-MM-dd"),t=`${u}_${e}`,s=te[t];ee(s!==void 0?r=>({...r,notes:s}):r=>({...r,notes:""})),Pe("saved")},[N,u]),m.useEffect(()=>{if(b.length===0)return;const e=f(N,"yyyy-MM-dd"),t=`${u}_${e}`;if(te[t]!==void 0)return;const s=b.find(r=>{try{const i=r.date?new Date(r.date):null;return i&&!isNaN(i.getTime())&&f(i,"yyyy-MM-dd")===e&&r.project===u}catch{return!1}});s&&s.notes&&(ee(r=>({...r,notes:s.notes||""})),be(r=>({...r,[t]:s.notes||""})))},[b,N,u]);const H=async()=>{if(u)try{const e=await S.getProjectLogs(u);R(e.map(t=>({...t,id:t._id||t.id,date:t.date?new Date(t.date):new Date,createdAt:t.created_at?new Date(t.created_at):new Date})))}catch(e){console.error("Failed to load site logs:",e),R([])}},$e=(e,t=1920,s=1080,r=.8)=>new Promise((i,l)=>{const c=new FileReader;c.onload=D=>{var g;const d=new Image;d.onload=()=>{const k=document.createElement("canvas");let A=d.width,j=d.height;if(A>t||j>s){const W=Math.min(t/A,s/j);A*=W,j*=W}k.width=A,k.height=j;const Se=k.getContext("2d");if(!Se){l(new Error("Canvas context not available"));return}Se.drawImage(d,0,0,A,j),k.toBlob(W=>{if(!W){l(new Error("Failed to compress image"));return}const pe=new FileReader;pe.onload=()=>i(pe.result),pe.readAsDataURL(W)},e.type,r)},d.src=(g=D.target)==null?void 0:g.result},c.readAsDataURL(e)}),M=m.useCallback(async e=>{const s=Array.from(e).filter(i=>i.type.startsWith("image/"));if(s.length===0){h.error("이미지 파일만 업로드 가능합니다");return}if(s.length>100){h.error("한번에 최대 100장까지 업로드 가능합니다");return}if(!u){h.error("프로젝트를 선택하세요");return}ye(!0),h.loading(`${s.length}개의 이미지를 처리중...`);const r=s.map(i=>$e(i));try{const i=await Promise.all(r),l=f(N,"yyyy-MM-dd"),c=b.find(g=>{try{const k=g.date?new Date(g.date):null;return k&&!isNaN(k.getTime())&&f(k,"yyyy-MM-dd")===l&&g.project===u}catch{return!1}}),D=20,d=[];for(let g=0;g<i.length;g+=D)d.push(i.slice(g,g+D));if(h.dismiss(),c){let g=[...c.images];for(let k=0;k<d.length;k++)h.loading(`이미지 업로드 중... (${k+1}/${d.length})`),g=[...g,...d[k]],await S.updateLog(c.id,{project:c.project,date:c.date,images:g,notes:c.notes||""}),h.dismiss();h.success(`${i.length}개의 사진이 추가되었습니다`)}else{h.loading(`이미지 업로드 중... (1/${d.length})`);const g={project:u,date:N,images:d[0],notes:"",createdBy:(a==null?void 0:a.name)||""},k=await S.createLog(g);if(h.dismiss(),d.length>1){let A=[...d[0]];for(let j=1;j<d.length;j++)h.loading(`이미지 업로드 중... (${j+1}/${d.length})`),A=[...A,...d[j]],await S.updateLog(k._id||k.id,{project:u,date:N,images:A,notes:""}),h.dismiss()}h.success(`${i.length}개의 사진이 저장되었습니다`)}await H()}catch(i){console.error("Failed to save images:",i),h.error("사진 저장에 실패했습니다")}finally{ye(!1)}},[u,N,a,b,H]),Re=m.useCallback(e=>{e.preventDefault(),M(e.dataTransfer.files)},[M]);m.useEffect(()=>{const e=t=>{var l;const s=(l=t.clipboardData)==null?void 0:l.items;if(!s)return;const r=Array.from(s).filter(c=>c.type.startsWith("image/"));if(r.length===0)return;t.preventDefault();const i=r.map(c=>c.getAsFile()).filter(Boolean);M(i)};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[M]),m.useCallback(async e=>{if(!(!u||!e))try{const t=f(N,"yyyy-MM-dd"),s=b.find(r=>{try{const i=r.date?new Date(r.date):null;return i&&!isNaN(i.getTime())&&f(i,"yyyy-MM-dd")===t&&r.project===u}catch{return!1}});if(s)await S.updateLog(s.id,{project:s.project,date:s.date,images:s.images,notes:e});else{const r={project:u,date:N,images:K.images,notes:e,createdBy:(a==null?void 0:a.name)||""};await S.createLog(r)}await H()}catch(t){console.error("Failed to auto-save site log:",t)}},[u,N,b,K.images,a,H]);const De=async e=>{if(window.confirm("이 현장일지를 삭제하시겠습니까?"))try{await S.deleteLog(e),h.success("현장일지가 삭제되었습니다"),await H()}catch(t){console.error("Failed to delete site log:",t),h.error("현장일지 삭제에 실패했습니다")}},Fe=async(e,t)=>{if(!window.confirm("이 사진을 삭제하시겠습니까?"))return;const s=b.find(r=>r.id===e);if(s)try{const r=s.images.filter((i,l)=>l!==t);r.length===0&&!s.notes?await De(e):(await S.updateLog(e,{project:s.project,date:s.date,images:r,notes:s.notes}),R(i=>i.map(l=>l.id===e?{...l,images:r}:l)),h.success("사진이 삭제되었습니다"))}catch(r){console.error("Failed to delete image:",r),h.error("사진 삭제에 실패했습니다")}},Ye=()=>{const e=X.getFullYear(),t=X.getMonth(),s=new Date(e,t,1),r=new Date(s);r.setDate(r.getDate()-s.getDay());const i=[],l=new Date(r);for(let c=0;c<42;c++){const D=b.filter(d=>{try{const g=d.date?new Date(d.date):null;return g&&!isNaN(g.getTime())&&f(g,"yyyy-MM-dd")===f(l,"yyyy-MM-dd")}catch{return!1}});i.push({date:new Date(l),logs:D,hasImages:D.some(d=>d.images&&d.images.length>0)}),l.setDate(l.getDate()+1)}return i},Le=e=>{const t=new Date(X);t.setMonth(t.getMonth()+e),Me(t)},Xe=b.reduce((e,t)=>{try{const s=t.date?new Date(t.date):null;if(s&&!isNaN(s.getTime())){const r=f(s,"yyyy-MM-dd");e[r]||(e[r]=[]),e[r].push(t)}}catch{}return e},{});Object.keys(Xe).sort((e,t)=>t.localeCompare(e));const ve=(e,t)=>{const s=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(s*s+r*r)},we=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),Ve=(e,t=0)=>{Y({show:!0,url:e[t],images:e}),he(t),V(1),v({x:0,y:0}),O(null),z(null),q(!1)},se=e=>{if(!y.images)return;const t=(ie+e+y.images.length)%y.images.length;he(t),Y(s=>({...s,url:y.images[t]}))},Oe=async(e,t)=>{const s=b.find(r=>r.id===e);if(s)try{const r={...s,images:[...s.images,...t]};await S.updateLog(e,{project:s.project,date:s.date,images:r.images,notes:s.notes}),R(i=>i.map(l=>l.id===e?r:l)),h.success(`${t.length}개의 사진이 추가되었습니다`),Ie(null)}catch(r){console.error("Failed to add images to log:",r),h.error("사진 추가에 실패했습니다")}};return m.useCallback((e,t)=>{const r=Array.from(t).filter(l=>l.type.startsWith("image/"));if(r.length===0){h.error("이미지 파일만 업로드 가능합니다");return}const i=r.map(l=>new Promise(c=>{const D=new FileReader;D.onload=d=>{var g;c((g=d.target)==null?void 0:g.result)},D.readAsDataURL(l)}));Promise.all(i).then(l=>{Oe(e,l)})},[b]),m.useEffect(()=>{const e=t=>{if(y.show)switch(t.key){case"ArrowLeft":t.preventDefault(),y.images&&y.images.length>1&&se(-1);break;case"ArrowRight":t.preventDefault(),y.images&&y.images.length>1&&se(1);break;case"Escape":t.preventDefault(),Y({show:!1,url:null});break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y.show,y.images,ie]),n.jsxDEV("div",{className:"site-log-container desktop:grid desktop:grid-cols-12 desktop:gap-4 desktop:h-[calc(100vh-140px)] space-y-3 desktop:space-y-0",children:[n.jsxDEV("div",{className:"desktop:hidden flex justify-end items-center gap-2 mb-2",children:[n.jsxDEV("label",{className:"flex items-center gap-1 text-[10px] text-gray-500",children:[n.jsxDEV("input",{type:"checkbox",checked:p,onChange:e=>x(e.target.checked),className:"w-3 h-3 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:715,columnNumber:11},void 0),"완료포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:714,columnNumber:9},void 0),n.jsxDEV("select",{value:u,onChange:e=>J(e.target.value),className:"px-3 py-1.5 bg-white text-gray-700 rounded-lg text-xs font-medium focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300",style:{appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.25rem",paddingRight:"2.5rem"},children:w.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:737,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:723,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:713,columnNumber:7},void 0),n.jsxDEV("div",{className:"site-log-left desktop:col-span-4 desktop:flex desktop:flex-col desktop:gap-4 desktop:h-full space-y-3 desktop:space-y-0",children:[n.jsxDEV("div",{className:"site-log-calendar desktop:flex-shrink-0",children:n.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[32vh] desktop:max-h-full overflow-y-auto",children:[n.jsxDEV("div",{className:"mb-4 hidden desktop:block",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:n.jsxDEV("select",{value:u,onChange:e=>J(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:w.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:759,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:753,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:752,columnNumber:15},void 0),n.jsxDEV("label",{className:"flex items-center gap-1.5 mt-2 text-xs text-gray-500 cursor-pointer",children:[n.jsxDEV("input",{type:"checkbox",checked:p,onChange:e=>x(e.target.checked),className:"w-3.5 h-3.5 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:766,columnNumber:17},void 0),"공사완료 현장 포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:765,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:751,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[n.jsxDEV("button",{onClick:()=>Le(-1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:n.jsxDEV(Ae,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:782,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:778,columnNumber:15},void 0),n.jsxDEV("h3",{className:"text-sm font-semibold",children:f(X,"yyyy년 M월")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:784,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>Le(1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:n.jsxDEV(Ee,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:791,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:787,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:777,columnNumber:13},void 0),n.jsxDEV("div",{className:"grid grid-cols-7 gap-0.5",children:[["일","월","화","수","목","금","토"].map(e=>n.jsxDEV("div",{className:"text-center text-xs font-medium text-gray-600 py-1",children:e},e,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:798,columnNumber:17},void 0)),Ye().map((e,t)=>{const s=e.date.getMonth()===X.getMonth(),r=f(e.date,"yyyy-MM-dd")===f(new Date,"yyyy-MM-dd"),i=f(e.date,"yyyy-MM-dd")===f(N,"yyyy-MM-dd");return n.jsxDEV("div",{onClick:()=>Ue(e.date),className:`text-center p-1.5 desktop:p-2 text-xs cursor-pointer rounded transition-colors min-h-[36px] desktop:min-h-[48px] flex flex-col items-center justify-center ${s?"text-gray-700":"text-gray-300"} ${r?"bg-blue-100":""} ${i?"bg-gray-900 text-white":"hover:bg-gray-100"} ${e.hasImages?"font-bold":""}`,children:[n.jsxDEV("span",{children:f(e.date,"d")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:817,columnNumber:21},void 0),e.hasImages&&n.jsxDEV("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-0.5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:819,columnNumber:23},void 0)]},t,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:808,columnNumber:19},void 0)})]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:796,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:749,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:747,columnNumber:9},void 0),n.jsxDEV("div",{className:"site-log-notes desktop:flex-1 desktop:min-h-0",children:n.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[30vh] desktop:h-full desktop:flex desktop:flex-col overflow-hidden",children:[n.jsxDEV("h2",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:[f(N,"M월 d일")," 일지 작성"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:831,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex-1 min-h-0 flex flex-col",children:n.jsxDEV("textarea",{value:K.notes,onChange:e=>{const t=e.target.value,s=f(N,"yyyy-MM-dd"),r=`${u}_${s}`;ee(i=>({...i,notes:t})),be(i=>({...i,[r]:t})),F.current&&clearTimeout(F.current),F.current=setTimeout(async()=>{if(u)try{const i=ke.current.find(l=>{try{const c=l.date?new Date(l.date):null;return c&&!isNaN(c.getTime())&&f(c,"yyyy-MM-dd")===s&&l.project===u}catch{return!1}});if(i)await S.updateLog(i.id,{project:i.project,date:i.date,images:i.images,notes:t});else if(t.trim()){const l=await S.createLog({project:u,date:N,images:K.images,notes:t,createdBy:(a==null?void 0:a.name)||""});l&&R(c=>[...c,{id:l._id||l.id,project:u,date:N,images:K.images,notes:t,createdBy:(a==null?void 0:a.name)||"",createdAt:new Date}])}}catch(i){console.error("서버 저장 실패:",i)}},500)},rows:4,className:"site-log-textarea w-full h-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none desktop:min-h-[200px]",placeholder:"오늘 진행한 작업 내용을 입력하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:837,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:835,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:830,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:829,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:745,columnNumber:7},void 0),n.jsxDEV("div",{className:"site-log-photos desktop:col-span-8 desktop:h-full",children:n.jsxDEV("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 transition-all desktop:h-full desktop:flex desktop:flex-col ${He?"ring-2 ring-blue-400 bg-blue-50":""}`,onDragOver:e=>{e.preventDefault(),oe(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||oe(!1)},onDrop:e=>{e.preventDefault(),oe(!1),Re(e)},children:[n.jsxDEV("div",{className:"flex items-center justify-between mb-4 desktop:flex-shrink-0",children:[n.jsxDEV("h2",{className:"text-lg font-semibold flex items-center gap-4",children:n.jsxDEV("span",{className:"text-sm font-normal text-gray-600",children:["작성자: ",(a==null?void 0:a.name)||"알 수 없음"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:937,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:936,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*",e.onchange=t=>{const s=t.target;s.files&&M(s.files)},e.click()},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"사진 추가",children:n.jsxDEV(Ge,{className:"h-5 w-5 text-gray-600"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:957,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:940,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>{const e=f(N,"yyyy-MM-dd"),t=b.filter(s=>{try{const r=s.date?new Date(s.date):null;return r&&!isNaN(r.getTime())&&f(r,"yyyy-MM-dd")===e}catch{return!1}});t.length>0&&window.confirm(`${f(N,"M월 d일")}의 모든 현장일지를 삭제하시겠습니까?`)&&t.forEach(s=>De(s.id))},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"일지 삭제",children:n.jsxDEV(Be,{className:"h-5 w-5 text-red-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:978,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:959,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:939,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:935,columnNumber:11},void 0),n.jsxDEV("div",{className:"space-y-6 max-h-[990px] desktop:max-h-full desktop:flex-1 desktop:min-h-0 overflow-y-auto",children:(()=>{const e=f(N,"yyyy-MM-dd"),t=b.filter(s=>{try{const r=s.date?new Date(s.date):null;return r&&!isNaN(r.getTime())&&f(r,"yyyy-MM-dd")===e}catch{return!1}});return t.length>0?n.jsxDEV("div",{className:"space-y-4",children:t.map(s=>n.jsxDEV("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[s.notes&&n.jsxDEV("div",{className:"mb-3",children:n.jsxDEV("p",{className:"text-sm text-gray-700",children:s.notes},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1006,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1005,columnNumber:27},void 0),n.jsxDEV("div",{className:"min-h-[600px] desktop:min-h-0",children:s.images&&s.images.length>0?n.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-3 desktop:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3",children:s.images.map((r,i)=>n.jsxDEV("div",{className:"relative group",children:[n.jsxDEV("img",{src:r,alt:`현장사진 ${i+1}`,className:"w-full aspect-[4/3] object-cover rounded-lg cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>Ve(s.images,i)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1016,columnNumber:35},void 0),n.jsxDEV("button",{onClick:()=>Ve(s.images,i),className:"absolute top-2 right-2 p-1.5 bg-black bg-opacity-50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsxDEV(Qe,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1026,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1022,columnNumber:35},void 0),n.jsxDEV("button",{onClick:l=>{l.stopPropagation(),Fe(s.id,i)},className:"absolute top-2 left-2 p-1.5 bg-red-600 bg-opacity-80 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-opacity-100",children:n.jsxDEV(Be,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1035,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1028,columnNumber:35},void 0),n.jsxDEV("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:[i+1," / ",s.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1037,columnNumber:35},void 0)]},i,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1015,columnNumber:33},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1013,columnNumber:29},void 0):n.jsxDEV("div",{className:"flex items-center justify-center h-[600px]",children:n.jsxDEV("div",{className:"text-center",children:[n.jsxDEV(_e,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1046,columnNumber:33},void 0),n.jsxDEV("p",{className:"text-sm text-gray-400",children:"사진을 드래그하거나 + 버튼을 클릭하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1047,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1045,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1044,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1011,columnNumber:25},void 0)]},s.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1e3,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:998,columnNumber:19},void 0):n.jsxDEV("div",{children:n.jsxDEV("div",{className:"rounded-lg p-4 pt-2 desktop:p-12 text-center",children:[n.jsxDEV(et,{className:"mx-auto h-12 w-12 desktop:h-16 desktop:w-16 text-gray-400 mb-2 desktop:mb-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1063,columnNumber:23},void 0),n.jsxDEV("p",{className:"text-sm desktop:text-lg font-medium text-gray-700 mb-2",children:"현장 사진을 업로드하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1064,columnNumber:23},void 0),n.jsxDEV("p",{className:"hidden desktop:block text-sm text-gray-600 mb-4",children:"이미지를 이곳에 드래그하거나 클릭하여 선택"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1067,columnNumber:23},void 0),n.jsxDEV("p",{className:"hidden desktop:block text-xs text-gray-500 mb-4",children:"Ctrl+V로 클립보드 이미지 붙여넣기도 가능합니다"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1070,columnNumber:23},void 0),n.jsxDEV("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>s.target.files&&M(s.target.files),className:"hidden",id:"main-image-upload"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1073,columnNumber:23},void 0),n.jsxDEV("label",{htmlFor:"main-image-upload",className:"inline-flex items-center px-3 py-1.5 desktop:px-4 desktop:py-2 border border-gray-300 rounded-lg text-xs desktop:text-sm text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[n.jsxDEV(_e,{className:"h-3 w-3 desktop:h-4 desktop:w-4 mr-1.5 desktop:mr-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1085,columnNumber:25},void 0),"파일 선택"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1081,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1060,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1058,columnNumber:19},void 0)})()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:983,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:915,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:914,columnNumber:7},void 0),y.show&&y.url&&n.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center overflow-hidden",onClick:()=>{Y({show:!1,url:null}),V(1),v({x:0,y:0})},onWheel:e=>{e.preventDefault();const t=e.deltaY>0?-.1:.1;V(s=>Math.max(.5,Math.min(5,s+t)))},children:n.jsxDEV("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Y({show:!1,url:null}),V(1),v({x:0,y:0})},className:"absolute top-4 right-4 p-2 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30 z-10",children:n.jsxDEV(tt,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1123,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1114,columnNumber:13},void 0),L!==1&&n.jsxDEV("div",{className:"absolute top-4 left-4 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm backdrop-blur",children:[Math.round(L*100),"%"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1128,columnNumber:15},void 0),y.images&&y.images.length>1&&n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),se(-1),V(1),v({x:0,y:0})},className:"absolute left-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:n.jsxDEV(Ae,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1144,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1135,columnNumber:15},void 0),n.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",onMouseDown:e=>{L>1&&(le(!0),ce({x:e.clientX-C.x,y:e.clientY-C.y}))},onMouseMove:e=>{me&&L>1&&v({x:e.clientX-G.x,y:e.clientY-G.y})},onMouseUp:()=>le(!1),onMouseLeave:()=>le(!1),onTouchStart:e=>{if(e.touches.length===2){e.preventDefault(),q(!0);const t=ve(e.touches[0],e.touches[1]),s=we(e.touches[0],e.touches[1]);O(t),z(s)}else if(e.touches.length===1&&L>1&&!Q){const t=e.touches[0];ce({x:t.clientX-C.x,y:t.clientY-C.y})}},onTouchMove:e=>{if(e.touches.length===2){e.preventDefault(),q(!0);const t=ve(e.touches[0],e.touches[1]),s=we(e.touches[0],e.touches[1]);if(de&&ue){const r=t/de,i=Math.max(.5,Math.min(5,L*r)),l=s.x-ue.x,c=s.y-ue.y,D=i/L,d=C.x*D+l,g=C.y*D+c;V(i),v({x:d,y:g})}O(t),z(s)}else if(e.touches.length===1&&L>1&&!Q){e.preventDefault();const t=e.touches[0];v({x:t.clientX-G.x,y:t.clientY-G.y})}},onTouchEnd:e=>{if(e.touches.length===0){const t=Date.now(),s=e.changedTouches[0],r={x:s.clientX,y:s.clientY};if(t-Te<300&&ge&&Math.abs(r.x-ge.x)<30&&Math.abs(r.y-ge.y)<30&&!Q){if(L===1){const c=e.currentTarget.getBoundingClientRect(),D=r.x-c.left-c.width/2,d=r.y-c.top-c.height/2;V(2.5),v({x:-D*1.5,y:-d*1.5})}else V(1),v({x:0,y:0});Ne(0),xe(null)}else Ne(t),xe(r);O(null),z(null),q(!1)}else if(e.touches.length===1&&Q){O(null),z(null),q(!1);const t=e.touches[0];ce({x:t.clientX-C.x,y:t.clientY-C.y})}},onDoubleClick:e=>{e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,r=e.clientY-t.top-t.height/2;L===1?(V(2.5),v({x:-s*1.5,y:-r*1.5})):(V(1),v({x:0,y:0}))},children:n.jsxDEV("img",{src:y.url,alt:"확대 이미지",style:{transform:`scale(${L}) translate(${C.x/L}px, ${C.y/L}px)`,transformOrigin:"center center",transition:me||de!==null?"none":"transform 0.25s cubic-bezier(0.2, 0, 0, 1)",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",cursor:L>1?me?"grabbing":"grab":"pointer",userSelect:"none",touchAction:"none"},draggable:!1,onClick:e=>e.stopPropagation()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1287,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1149,columnNumber:13},void 0),y.images&&y.images.length>1&&n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),se(1),V(1),v({x:0,y:0})},className:"absolute right-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:n.jsxDEV(Ee,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1317,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1308,columnNumber:15},void 0),y.images&&y.images.length>1&&n.jsxDEV("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full",children:[ie+1," / ",y.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1323,columnNumber:15},void 0),n.jsxDEV("div",{className:"absolute bottom-4 right-4 bg-white bg-opacity-10 text-white px-3 py-2 rounded-lg text-xs text-center backdrop-blur",children:"마우스 휠 또는 두 손가락으로 확대/축소"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1329,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1112,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1099,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:711,columnNumber:5},void 0)};export{gt as default};
