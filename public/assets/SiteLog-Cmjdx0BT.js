import{a as _,u as _e,z as f,j as n}from"./index-C8ug4F3j.js";import{r as o}from"./vendor-react-B9Yt5e0k.js";import{u as Be}from"./useFilteredProjects-DCGAwhAB.js";import{p as g}from"./vendor-date-9Cl9d1sr.js";import{k as ye,l as Ne,P as Ue,T as he,M as He,U as xe,m as Me,X as Te}from"./vendor-ui-CcgAtStV.js";import"./vendor-data-BwGxWJIh.js";import"./dataStore-z1NP4npX.js";const V={async getProjectLogs(i){try{return(await _.get(`/site-logs/project/${encodeURIComponent(i)}`)).data}catch(N){return console.error("Failed to get project logs:",N),[]}},async getAllLogs(){try{return(await _.get("/site-logs")).data}catch(i){return console.error("Failed to get all logs:",i),[]}},async createLog(i){try{return(await _.post("/site-logs",i)).data}catch(N){throw console.error("Failed to create log:",N),N}},async updateLog(i,N){try{return(await _.put(`/site-logs/${i}`,N)).data}catch(L){throw console.error("Failed to update log:",L),L}},async deleteLog(i){try{return(await _.delete(`/site-logs/${i}`)).data}catch(N){throw console.error("Failed to delete log:",N),N}},async getLogsByDateRange(i,N,L){try{return(await _.get("/site-logs/range",{params:{project:i,startDate:N.toISOString(),endDate:L.toISOString()}})).data}catch(B){return console.error("Failed to get logs by date range:",B),[]}}},Je=()=>{const{user:i}=_e(),N=Be(),[L,B]=o.useState(()=>localStorage.getItem("siteLog_includeCompleted")==="true"),j=L?N:N.filter(e=>e.status!=="completed"),[h,U]=o.useState([]),[d,Y]=o.useState(""),H=o.useRef(null),[y,be]=o.useState(new Date),[ke,Z]=o.useState(!1),[p,M]=o.useState({show:!1,url:null}),[Ie,ae]=o.useState(!1),[J,re]=o.useState(0),[T,De]=o.useState(new Date),[k,v]=o.useState(1),[w,D]=o.useState({x:0,y:0}),[q,G]=o.useState(!1),[X,Q]=o.useState({x:0,y:0}),[ee,I]=o.useState(null),[te,P]=o.useState(null),[z,$]=o.useState(!1),[Le,oe]=o.useState(0),[se,ie]=o.useState(null),[F,K]=o.useState({notes:"",images:[]}),[O,me]=o.useState(()=>{const e=localStorage.getItem("siteLogNotes");return e?JSON.parse(e):{}});o.useRef(null);const[Pe,ve]=o.useState(null);o.useRef(null);const[$e,Fe]=o.useState(!1),[Re,Ve]=o.useState("saved"),le=o.useRef([]);o.useEffect(()=>{le.current=h},[h]),o.useEffect(()=>{localStorage.setItem("siteLogNotes",JSON.stringify(O))},[O]),o.useEffect(()=>{localStorage.setItem("siteLog_includeCompleted",String(L))},[L]),o.useEffect(()=>{if(j.length>0&&!d){const e=`siteLog_lastProject_${(i==null?void 0:i.id)||(i==null?void 0:i.name)}`,t=localStorage.getItem(e);t&&j.find(s=>s.name===t)?Y(t):Y(j[0].name)}},[j,i]),o.useEffect(()=>{if(d&&i){const e=`siteLog_lastProject_${i.id||i.name}`;localStorage.setItem(e,d)}},[d,i]),o.useEffect(()=>()=>{H.current&&clearTimeout(H.current)},[]),o.useEffect(()=>{E()},[d]),o.useEffect(()=>{const e=g(y,"yyyy-MM-dd"),t=`${d}_${e}`,s=O[t];K(s!==void 0?a=>({...a,notes:s}):a=>({...a,notes:""})),Ve("saved")},[y,d]),o.useEffect(()=>{if(h.length===0)return;const e=g(y,"yyyy-MM-dd"),t=`${d}_${e}`;if(O[t]!==void 0)return;const s=h.find(a=>{try{const r=a.date?new Date(a.date):null;return r&&!isNaN(r.getTime())&&g(r,"yyyy-MM-dd")===e&&a.project===d}catch{return!1}});s&&s.notes&&(K(a=>({...a,notes:s.notes||""})),me(a=>({...a,[t]:s.notes||""})))},[h,y,d]);const E=async()=>{if(d)try{const e=await V.getProjectLogs(d);U(e.map(t=>({...t,id:t._id||t.id,date:t.date?new Date(t.date):new Date,createdAt:t.created_at?new Date(t.created_at):new Date})))}catch(e){console.error("Failed to load site logs:",e),U([])}},we=(e,t=1920,s=1080,a=.8)=>new Promise((r,m)=>{const l=new FileReader;l.onload=b=>{var u;const c=new Image;c.onload=()=>{const x=document.createElement("canvas");let C=c.width,S=c.height;if(C>t||S>s){const R=Math.min(t/C,s/S);C*=R,S*=R}x.width=C,x.height=S;const fe=x.getContext("2d");if(!fe){m(new Error("Canvas context not available"));return}fe.drawImage(c,0,0,C,S),x.toBlob(R=>{if(!R){m(new Error("Failed to compress image"));return}const ne=new FileReader;ne.onload=()=>r(ne.result),ne.readAsDataURL(R)},e.type,a)},c.src=(u=b.target)==null?void 0:u.result},l.readAsDataURL(e)}),A=o.useCallback(async e=>{const s=Array.from(e).filter(r=>r.type.startsWith("image/"));if(s.length===0){f.error("이미지 파일만 업로드 가능합니다");return}if(s.length>100){f.error("한번에 최대 100장까지 업로드 가능합니다");return}if(!d){f.error("프로젝트를 선택하세요");return}ae(!0),f.loading(`${s.length}개의 이미지를 처리중...`);const a=s.map(r=>we(r));try{const r=await Promise.all(a),m=g(y,"yyyy-MM-dd"),l=h.find(u=>{try{const x=u.date?new Date(u.date):null;return x&&!isNaN(x.getTime())&&g(x,"yyyy-MM-dd")===m&&u.project===d}catch{return!1}}),b=20,c=[];for(let u=0;u<r.length;u+=b)c.push(r.slice(u,u+b));if(f.dismiss(),l){let u=[...l.images];for(let x=0;x<c.length;x++)f.loading(`이미지 업로드 중... (${x+1}/${c.length})`),u=[...u,...c[x]],await V.updateLog(l.id,{project:l.project,date:l.date,images:u,notes:l.notes||""}),f.dismiss();f.success(`${r.length}개의 사진이 추가되었습니다`)}else{f.loading(`이미지 업로드 중... (1/${c.length})`);const u={project:d,date:y,images:c[0],notes:"",createdBy:(i==null?void 0:i.name)||""},x=await V.createLog(u);if(f.dismiss(),c.length>1){let C=[...c[0]];for(let S=1;S<c.length;S++)f.loading(`이미지 업로드 중... (${S+1}/${c.length})`),C=[...C,...c[S]],await V.updateLog(x._id||x.id,{project:d,date:y,images:C,notes:""}),f.dismiss()}f.success(`${r.length}개의 사진이 저장되었습니다`)}await E()}catch(r){console.error("Failed to save images:",r),f.error("사진 저장에 실패했습니다")}finally{ae(!1)}},[d,y,i,h,E]),Se=o.useCallback(e=>{e.preventDefault(),A(e.dataTransfer.files)},[A]);o.useEffect(()=>{const e=t=>{var m;const s=(m=t.clipboardData)==null?void 0:m.items;if(!s)return;const a=Array.from(s).filter(l=>l.type.startsWith("image/"));if(a.length===0)return;t.preventDefault();const r=a.map(l=>l.getAsFile()).filter(Boolean);A(r)};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[A]),o.useCallback(async e=>{if(!(!d||!e))try{const t=g(y,"yyyy-MM-dd"),s=h.find(a=>{try{const r=a.date?new Date(a.date):null;return r&&!isNaN(r.getTime())&&g(r,"yyyy-MM-dd")===t&&a.project===d}catch{return!1}});if(s)await V.updateLog(s.id,{project:s.project,date:s.date,images:s.images,notes:e});else{const a={project:d,date:y,images:F.images,notes:e,createdBy:(i==null?void 0:i.name)||""};await V.createLog(a)}await E()}catch(t){console.error("Failed to auto-save site log:",t)}},[d,y,h,F.images,i,E]);const ce=async e=>{if(window.confirm("이 현장일지를 삭제하시겠습니까?"))try{await V.deleteLog(e),f.success("현장일지가 삭제되었습니다"),await E()}catch(t){console.error("Failed to delete site log:",t),f.error("현장일지 삭제에 실패했습니다")}},Ce=async(e,t)=>{if(!window.confirm("이 사진을 삭제하시겠습니까?"))return;const s=h.find(a=>a.id===e);if(s)try{const a=s.images.filter((r,m)=>m!==t);a.length===0&&!s.notes?await ce(e):(await V.updateLog(e,{project:s.project,date:s.date,images:a,notes:s.notes}),U(r=>r.map(m=>m.id===e?{...m,images:a}:m)),f.success("사진이 삭제되었습니다"))}catch(a){console.error("Failed to delete image:",a),f.error("사진 삭제에 실패했습니다")}},je=()=>{const e=T.getFullYear(),t=T.getMonth(),s=new Date(e,t,1),a=new Date(s);a.setDate(a.getDate()-s.getDay());const r=[],m=new Date(a);for(let l=0;l<42;l++){const b=h.filter(c=>{try{const u=c.date?new Date(c.date):null;return u&&!isNaN(u.getTime())&&g(u,"yyyy-MM-dd")===g(m,"yyyy-MM-dd")}catch{return!1}});r.push({date:new Date(m),logs:b,hasImages:b.some(c=>c.images&&c.images.length>0)}),m.setDate(m.getDate()+1)}return r},de=e=>{const t=new Date(T);t.setMonth(t.getMonth()+e),De(t)},Ee=h.reduce((e,t)=>{try{const s=t.date?new Date(t.date):null;if(s&&!isNaN(s.getTime())){const a=g(s,"yyyy-MM-dd");e[a]||(e[a]=[]),e[a].push(t)}}catch{}return e},{});Object.keys(Ee).sort((e,t)=>t.localeCompare(e));const ue=(e,t)=>{const s=e.clientX-t.clientX,a=e.clientY-t.clientY;return Math.sqrt(s*s+a*a)},ge=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),pe=(e,t=0)=>{M({show:!0,url:e[t],images:e}),re(t),v(1),D({x:0,y:0}),I(null),P(null),$(!1)},W=e=>{if(!p.images)return;const t=(J+e+p.images.length)%p.images.length;re(t),M(s=>({...s,url:p.images[t]}))},Ae=async(e,t)=>{const s=h.find(a=>a.id===e);if(s)try{const a={...s,images:[...s.images,...t]};await V.updateLog(e,{project:s.project,date:s.date,images:a.images,notes:s.notes}),U(r=>r.map(m=>m.id===e?a:m)),f.success(`${t.length}개의 사진이 추가되었습니다`),ve(null)}catch(a){console.error("Failed to add images to log:",a),f.error("사진 추가에 실패했습니다")}};return o.useCallback((e,t)=>{const a=Array.from(t).filter(m=>m.type.startsWith("image/"));if(a.length===0){f.error("이미지 파일만 업로드 가능합니다");return}const r=a.map(m=>new Promise(l=>{const b=new FileReader;b.onload=c=>{var u;l((u=c.target)==null?void 0:u.result)},b.readAsDataURL(m)}));Promise.all(r).then(m=>{Ae(e,m)})},[h]),o.useEffect(()=>{const e=t=>{if(p.show)switch(t.key){case"ArrowLeft":t.preventDefault(),p.images&&p.images.length>1&&W(-1);break;case"ArrowRight":t.preventDefault(),p.images&&p.images.length>1&&W(1);break;case"Escape":t.preventDefault(),M({show:!1,url:null});break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p.show,p.images,J]),n.jsxDEV("div",{className:"site-log-container desktop:grid desktop:grid-cols-12 desktop:gap-4 desktop:h-[calc(100vh-140px)] space-y-3 desktop:space-y-0",children:[n.jsxDEV("div",{className:"desktop:hidden flex justify-end items-center gap-2 mb-2",children:[n.jsxDEV("label",{className:"flex items-center gap-1 text-[10px] text-gray-500",children:[n.jsxDEV("input",{type:"checkbox",checked:L,onChange:e=>B(e.target.checked),className:"w-3 h-3 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:715,columnNumber:11},void 0),"완료포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:714,columnNumber:9},void 0),n.jsxDEV("select",{value:d,onChange:e=>Y(e.target.value),className:"px-3 py-1.5 bg-white text-gray-700 rounded-lg text-xs font-medium focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300",style:{appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.25rem",paddingRight:"2.5rem"},children:j.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:737,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:723,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:713,columnNumber:7},void 0),n.jsxDEV("div",{className:"site-log-left desktop:col-span-4 desktop:flex desktop:flex-col desktop:gap-4 desktop:h-full space-y-3 desktop:space-y-0",children:[n.jsxDEV("div",{className:"site-log-calendar desktop:flex-shrink-0",children:n.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[32vh] desktop:max-h-full overflow-y-auto",children:[n.jsxDEV("div",{className:"mb-4 hidden desktop:block",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:n.jsxDEV("select",{value:d,onChange:e=>Y(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:j.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:759,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:753,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:752,columnNumber:15},void 0),n.jsxDEV("label",{className:"flex items-center gap-1.5 mt-2 text-xs text-gray-500 cursor-pointer",children:[n.jsxDEV("input",{type:"checkbox",checked:L,onChange:e=>B(e.target.checked),className:"w-3.5 h-3.5 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:766,columnNumber:17},void 0),"공사완료 현장 포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:765,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:751,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[n.jsxDEV("button",{onClick:()=>de(-1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:n.jsxDEV(ye,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:782,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:778,columnNumber:15},void 0),n.jsxDEV("h3",{className:"text-sm font-semibold",children:g(T,"yyyy년 M월")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:784,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>de(1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:n.jsxDEV(Ne,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:791,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:787,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:777,columnNumber:13},void 0),n.jsxDEV("div",{className:"grid grid-cols-7 gap-0.5",children:[["일","월","화","수","목","금","토"].map(e=>n.jsxDEV("div",{className:"text-center text-xs font-medium text-gray-600 py-1",children:e},e,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:798,columnNumber:17},void 0)),je().map((e,t)=>{const s=e.date.getMonth()===T.getMonth(),a=g(e.date,"yyyy-MM-dd")===g(new Date,"yyyy-MM-dd"),r=g(e.date,"yyyy-MM-dd")===g(y,"yyyy-MM-dd");return n.jsxDEV("div",{onClick:()=>be(e.date),className:`text-center p-1.5 desktop:p-2 text-xs cursor-pointer rounded transition-colors min-h-[36px] desktop:min-h-[48px] flex flex-col items-center justify-center ${s?"text-gray-700":"text-gray-300"} ${a?"bg-blue-100":""} ${r?"bg-gray-900 text-white":"hover:bg-gray-100"} ${e.hasImages?"font-bold":""}`,children:[n.jsxDEV("span",{children:g(e.date,"d")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:817,columnNumber:21},void 0),e.hasImages&&n.jsxDEV("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-0.5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:819,columnNumber:23},void 0)]},t,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:808,columnNumber:19},void 0)})]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:796,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:749,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:747,columnNumber:9},void 0),n.jsxDEV("div",{className:"site-log-notes desktop:flex-1 desktop:min-h-0",children:n.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[30vh] desktop:h-full desktop:flex desktop:flex-col overflow-hidden",children:[n.jsxDEV("h2",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:[g(y,"M월 d일")," 일지 작성"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:831,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex-1 min-h-0 flex flex-col",children:n.jsxDEV("textarea",{value:F.notes,onChange:e=>{const t=e.target.value,s=g(y,"yyyy-MM-dd"),a=`${d}_${s}`;K(r=>({...r,notes:t})),me(r=>({...r,[a]:t})),H.current&&clearTimeout(H.current),H.current=setTimeout(async()=>{if(d)try{const r=le.current.find(m=>{try{const l=m.date?new Date(m.date):null;return l&&!isNaN(l.getTime())&&g(l,"yyyy-MM-dd")===s&&m.project===d}catch{return!1}});if(r)await V.updateLog(r.id,{project:r.project,date:r.date,images:r.images,notes:t});else if(t.trim()){const m=await V.createLog({project:d,date:y,images:F.images,notes:t,createdBy:(i==null?void 0:i.name)||""});m&&U(l=>[...l,{id:m._id||m.id,project:d,date:y,images:F.images,notes:t,createdBy:(i==null?void 0:i.name)||"",createdAt:new Date}])}}catch(r){console.error("서버 저장 실패:",r)}},500)},rows:4,className:"site-log-textarea w-full h-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none desktop:min-h-[200px]",placeholder:"오늘 진행한 작업 내용을 입력하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:837,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:835,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:830,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:829,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:745,columnNumber:7},void 0),n.jsxDEV("div",{className:"site-log-photos desktop:col-span-8 desktop:h-full",children:n.jsxDEV("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 transition-all desktop:h-full desktop:flex desktop:flex-col ${ke?"ring-2 ring-blue-400 bg-blue-50":""}`,onDragOver:e=>{e.preventDefault(),Z(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||Z(!1)},onDrop:e=>{e.preventDefault(),Z(!1),Se(e)},children:[n.jsxDEV("div",{className:"flex items-center justify-between mb-4 desktop:flex-shrink-0",children:[n.jsxDEV("h2",{className:"text-lg font-semibold flex items-center gap-4",children:n.jsxDEV("span",{className:"text-sm font-normal text-gray-600",children:["작성자: ",(i==null?void 0:i.name)||"알 수 없음"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:937,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:936,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*",e.onchange=t=>{const s=t.target;s.files&&A(s.files)},e.click()},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"사진 추가",children:n.jsxDEV(Ue,{className:"h-5 w-5 text-gray-600"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:957,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:940,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>{const e=g(y,"yyyy-MM-dd"),t=h.filter(s=>{try{const a=s.date?new Date(s.date):null;return a&&!isNaN(a.getTime())&&g(a,"yyyy-MM-dd")===e}catch{return!1}});t.length>0&&window.confirm(`${g(y,"M월 d일")}의 모든 현장일지를 삭제하시겠습니까?`)&&t.forEach(s=>ce(s.id))},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"일지 삭제",children:n.jsxDEV(he,{className:"h-5 w-5 text-red-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:978,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:959,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:939,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:935,columnNumber:11},void 0),n.jsxDEV("div",{className:"space-y-6 max-h-[990px] desktop:max-h-full desktop:flex-1 desktop:min-h-0 overflow-y-auto",children:(()=>{const e=g(y,"yyyy-MM-dd"),t=h.filter(s=>{try{const a=s.date?new Date(s.date):null;return a&&!isNaN(a.getTime())&&g(a,"yyyy-MM-dd")===e}catch{return!1}});return t.length>0?n.jsxDEV("div",{className:"space-y-4",children:t.map(s=>n.jsxDEV("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[s.notes&&n.jsxDEV("div",{className:"mb-3",children:n.jsxDEV("p",{className:"text-sm text-gray-700",children:s.notes},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1006,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1005,columnNumber:27},void 0),n.jsxDEV("div",{className:"min-h-[600px] desktop:min-h-0",children:s.images&&s.images.length>0?n.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-3 desktop:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3",children:s.images.map((a,r)=>n.jsxDEV("div",{className:"relative group",children:[n.jsxDEV("img",{src:a,alt:`현장사진 ${r+1}`,className:"w-full aspect-[4/3] object-cover rounded-lg cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>pe(s.images,r)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1016,columnNumber:35},void 0),n.jsxDEV("button",{onClick:()=>pe(s.images,r),className:"absolute top-2 right-2 p-1.5 bg-black bg-opacity-50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsxDEV(He,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1026,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1022,columnNumber:35},void 0),n.jsxDEV("button",{onClick:m=>{m.stopPropagation(),Ce(s.id,r)},className:"absolute top-2 left-2 p-1.5 bg-red-600 bg-opacity-80 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-opacity-100",children:n.jsxDEV(he,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1035,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1028,columnNumber:35},void 0),n.jsxDEV("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:[r+1," / ",s.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1037,columnNumber:35},void 0)]},r,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1015,columnNumber:33},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1013,columnNumber:29},void 0):n.jsxDEV("div",{className:"flex items-center justify-center h-[600px]",children:n.jsxDEV("div",{className:"text-center",children:[n.jsxDEV(xe,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1046,columnNumber:33},void 0),n.jsxDEV("p",{className:"text-sm text-gray-400",children:"사진을 드래그하거나 + 버튼을 클릭하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1047,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1045,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1044,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1011,columnNumber:25},void 0)]},s.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1e3,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:998,columnNumber:19},void 0):n.jsxDEV("div",{children:n.jsxDEV("div",{className:"rounded-lg p-4 pt-2 desktop:p-12 text-center",children:[n.jsxDEV(Me,{className:"mx-auto h-12 w-12 desktop:h-16 desktop:w-16 text-gray-400 mb-2 desktop:mb-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1063,columnNumber:23},void 0),n.jsxDEV("p",{className:"text-sm desktop:text-lg font-medium text-gray-700 mb-2",children:"현장 사진을 업로드하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1064,columnNumber:23},void 0),n.jsxDEV("p",{className:"hidden desktop:block text-sm text-gray-600 mb-4",children:"이미지를 이곳에 드래그하거나 클릭하여 선택"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1067,columnNumber:23},void 0),n.jsxDEV("p",{className:"hidden desktop:block text-xs text-gray-500 mb-4",children:"Ctrl+V로 클립보드 이미지 붙여넣기도 가능합니다"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1070,columnNumber:23},void 0),n.jsxDEV("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>s.target.files&&A(s.target.files),className:"hidden",id:"main-image-upload"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1073,columnNumber:23},void 0),n.jsxDEV("label",{htmlFor:"main-image-upload",className:"inline-flex items-center px-3 py-1.5 desktop:px-4 desktop:py-2 border border-gray-300 rounded-lg text-xs desktop:text-sm text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[n.jsxDEV(xe,{className:"h-3 w-3 desktop:h-4 desktop:w-4 mr-1.5 desktop:mr-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1085,columnNumber:25},void 0),"파일 선택"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1081,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1060,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1058,columnNumber:19},void 0)})()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:983,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:915,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:914,columnNumber:7},void 0),p.show&&p.url&&n.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center overflow-hidden",onClick:()=>{M({show:!1,url:null}),v(1),D({x:0,y:0})},onWheel:e=>{e.preventDefault();const t=e.deltaY>0?-.1:.1;v(s=>Math.max(.5,Math.min(5,s+t)))},children:n.jsxDEV("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),M({show:!1,url:null}),v(1),D({x:0,y:0})},className:"absolute top-4 right-4 p-2 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30 z-10",children:n.jsxDEV(Te,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1123,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1114,columnNumber:13},void 0),k!==1&&n.jsxDEV("div",{className:"absolute top-4 left-4 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm backdrop-blur",children:[Math.round(k*100),"%"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1128,columnNumber:15},void 0),p.images&&p.images.length>1&&n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),W(-1),v(1),D({x:0,y:0})},className:"absolute left-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:n.jsxDEV(ye,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1144,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1135,columnNumber:15},void 0),n.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",onMouseDown:e=>{k>1&&(G(!0),Q({x:e.clientX-w.x,y:e.clientY-w.y}))},onMouseMove:e=>{q&&k>1&&D({x:e.clientX-X.x,y:e.clientY-X.y})},onMouseUp:()=>G(!1),onMouseLeave:()=>G(!1),onTouchStart:e=>{if(e.touches.length===2){e.preventDefault(),$(!0);const t=ue(e.touches[0],e.touches[1]),s=ge(e.touches[0],e.touches[1]);I(t),P(s)}else if(e.touches.length===1&&k>1&&!z){const t=e.touches[0];Q({x:t.clientX-w.x,y:t.clientY-w.y})}},onTouchMove:e=>{if(e.touches.length===2){e.preventDefault(),$(!0);const t=ue(e.touches[0],e.touches[1]),s=ge(e.touches[0],e.touches[1]);if(ee&&te){const a=t/ee,r=Math.max(.5,Math.min(5,k*a)),m=s.x-te.x,l=s.y-te.y,b=r/k,c=w.x*b+m,u=w.y*b+l;v(r),D({x:c,y:u})}I(t),P(s)}else if(e.touches.length===1&&k>1&&!z){e.preventDefault();const t=e.touches[0];D({x:t.clientX-X.x,y:t.clientY-X.y})}},onTouchEnd:e=>{if(e.touches.length===0){const t=Date.now(),s=e.changedTouches[0],a={x:s.clientX,y:s.clientY};if(t-Le<300&&se&&Math.abs(a.x-se.x)<30&&Math.abs(a.y-se.y)<30&&!z){if(k===1){const l=e.currentTarget.getBoundingClientRect(),b=a.x-l.left-l.width/2,c=a.y-l.top-l.height/2;v(2.5),D({x:-b*1.5,y:-c*1.5})}else v(1),D({x:0,y:0});oe(0),ie(null)}else oe(t),ie(a);I(null),P(null),$(!1)}else if(e.touches.length===1&&z){I(null),P(null),$(!1);const t=e.touches[0];Q({x:t.clientX-w.x,y:t.clientY-w.y})}},onDoubleClick:e=>{e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,a=e.clientY-t.top-t.height/2;k===1?(v(2.5),D({x:-s*1.5,y:-a*1.5})):(v(1),D({x:0,y:0}))},children:n.jsxDEV("img",{src:p.url,alt:"확대 이미지",style:{transform:`scale(${k}) translate(${w.x/k}px, ${w.y/k}px)`,transformOrigin:"center center",transition:q||ee!==null?"none":"transform 0.25s cubic-bezier(0.2, 0, 0, 1)",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",cursor:k>1?q?"grabbing":"grab":"pointer",userSelect:"none",touchAction:"none"},draggable:!1,onClick:e=>e.stopPropagation()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1287,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1149,columnNumber:13},void 0),p.images&&p.images.length>1&&n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),W(1),v(1),D({x:0,y:0})},className:"absolute right-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:n.jsxDEV(Ne,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1317,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1308,columnNumber:15},void 0),p.images&&p.images.length>1&&n.jsxDEV("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full",children:[J+1," / ",p.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1323,columnNumber:15},void 0),n.jsxDEV("div",{className:"absolute bottom-4 right-4 bg-white bg-opacity-10 text-white px-3 py-2 rounded-lg text-xs text-center backdrop-blur",children:"마우스 휠 또는 두 손가락으로 확대/축소"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1329,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1112,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1099,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:711,columnNumber:5},void 0)};export{Je as default};
