import{j as a}from"./vendor-data-DG_4MGb7.js";import{r}from"./vendor-react-D-r2Cqeg.js";import{u as Ee}from"./useFilteredProjects-4XYld7On.js";import{a as E,u as Pe,z as p}from"./index-HUdyR-Tx.js";import{p as m}from"./vendor-date-9Cl9d1sr.js";import{k as ye,l as fe,P as $e,T as xe,M as Fe,U as be,m as Re,X as Ae}from"./vendor-ui-DTwhhNuH.js";import"./dataStore-ByVzUXWH.js";const D={async getProjectLogs(c){try{return(await E.get(`/site-logs/project/${encodeURIComponent(c)}`)).data}catch(f){return console.error("Failed to get project logs:",f),[]}},async getAllLogs(){try{return(await E.get("/site-logs")).data}catch(c){return console.error("Failed to get all logs:",c),[]}},async createLog(c){try{return(await E.post("/site-logs",c)).data}catch(f){throw console.error("Failed to create log:",f),f}},async updateLog(c,f){try{return(await E.put(`/site-logs/${c}`,f)).data}catch(k){throw console.error("Failed to update log:",k),k}},async deleteLog(c){try{return(await E.delete(`/site-logs/${c}`)).data}catch(f){throw console.error("Failed to delete log:",f),f}},async getLogsByDateRange(c,f,k){try{return(await E.get("/site-logs/range",{params:{project:c,startDate:f.toISOString(),endDate:k.toISOString()}})).data}catch(P){return console.error("Failed to get logs by date range:",P),[]}}},Ge=()=>{const{user:c}=Pe(),f=Ee(),[k,P]=r.useState(()=>localStorage.getItem("siteLog_includeCompleted")==="true"),C=k?f:f.filter(e=>e.status!=="completed"),[x,$]=r.useState([]),[g,U]=r.useState(""),F=r.useRef(null),[y,we]=r.useState(new Date),[je,q]=r.useState(!1),[h,R]=r.useState({show:!1,url:null}),[Ye,oe]=r.useState(!1),[G,ne]=r.useState(0),[A,ve]=r.useState(new Date),[j,N]=r.useState(1),[M,v]=r.useState({x:0,y:0}),[V,H]=r.useState(!1),[K,Q]=r.useState({x:0,y:0}),[ee,Y]=r.useState(null),[te,X]=r.useState(null),[O,_]=r.useState(!1),[ke,re]=r.useState(0),[se,ce]=r.useState(null),[z,W]=r.useState({notes:"",images:[]}),[Z,ie]=r.useState(()=>{const e=localStorage.getItem("siteLogNotes");return e?JSON.parse(e):{}});r.useRef(null);const[Xe,Ne]=r.useState(null);r.useRef(null);const[_e,ze]=r.useState(!1),[Be,De]=r.useState("saved"),le=r.useRef([]);r.useEffect(()=>{le.current=x},[x]),r.useEffect(()=>{localStorage.setItem("siteLogNotes",JSON.stringify(Z))},[Z]),r.useEffect(()=>{localStorage.setItem("siteLog_includeCompleted",String(k))},[k]),r.useEffect(()=>{if(C.length>0&&!g){const e=`siteLog_lastProject_${(c==null?void 0:c.id)||(c==null?void 0:c.name)}`,t=localStorage.getItem(e);t&&C.find(s=>s.name===t)?U(t):U(C[0].name)}},[C,c]),r.useEffect(()=>{if(g&&c){const e=`siteLog_lastProject_${c.id||c.name}`;localStorage.setItem(e,g)}},[g,c]),r.useEffect(()=>()=>{F.current&&clearTimeout(F.current)},[]),r.useEffect(()=>{T()},[g]),r.useEffect(()=>{const e=m(y,"yyyy-MM-dd"),t=`${g}_${e}`,s=Z[t];W(s!==void 0?o=>({...o,notes:s}):o=>({...o,notes:""})),De("saved")},[y,g]),r.useEffect(()=>{if(x.length===0)return;const e=m(y,"yyyy-MM-dd"),t=`${g}_${e}`;if(Z[t]!==void 0)return;const s=x.find(o=>{try{const n=o.date?new Date(o.date):null;return n&&!isNaN(n.getTime())&&m(n,"yyyy-MM-dd")===e&&o.project===g}catch{return!1}});s&&s.notes&&(W(o=>({...o,notes:s.notes||""})),ie(o=>({...o,[t]:s.notes||""})))},[x,y,g]);const T=async()=>{if(g)try{const e=await D.getProjectLogs(g);$(e.map(t=>({...t,id:t._id||t.id,date:t.date?new Date(t.date):new Date,createdAt:t.created_at?new Date(t.created_at):new Date})))}catch(e){console.error("Failed to load site logs:",e),$([])}},Me=(e,t=1920,s=1080,o=.8)=>new Promise((n,i)=>{const l=new FileReader;l.onload=w=>{var u;const d=new Image;d.onload=()=>{const b=document.createElement("canvas");let L=d.width,S=d.height;if(L>t||S>s){const B=Math.min(t/L,s/S);L*=B,S*=B}b.width=L,b.height=S;const pe=b.getContext("2d");if(!pe){i(new Error("Canvas context not available"));return}pe.drawImage(d,0,0,L,S),b.toBlob(B=>{if(!B){i(new Error("Failed to compress image"));return}const ae=new FileReader;ae.onload=()=>n(ae.result),ae.readAsDataURL(B)},e.type,o)},d.src=(u=w.target)==null?void 0:u.result},l.readAsDataURL(e)}),I=r.useCallback(async e=>{const s=Array.from(e).filter(n=>n.type.startsWith("image/"));if(s.length===0){p.error("이미지 파일만 업로드 가능합니다");return}if(s.length>100){p.error("한번에 최대 100장까지 업로드 가능합니다");return}if(!g){p.error("프로젝트를 선택하세요");return}oe(!0),p.loading(`${s.length}개의 이미지를 처리중...`);const o=s.map(n=>Me(n));try{const n=await Promise.all(o),i=m(y,"yyyy-MM-dd"),l=x.find(u=>{try{const b=u.date?new Date(u.date):null;return b&&!isNaN(b.getTime())&&m(b,"yyyy-MM-dd")===i&&u.project===g}catch{return!1}}),w=20,d=[];for(let u=0;u<n.length;u+=w)d.push(n.slice(u,u+w));if(p.dismiss(),l){let u=[...l.images];for(let b=0;b<d.length;b++)p.loading(`이미지 업로드 중... (${b+1}/${d.length})`),u=[...u,...d[b]],await D.updateLog(l.id,{project:l.project,date:l.date,images:u,notes:l.notes||""}),p.dismiss();p.success(`${n.length}개의 사진이 추가되었습니다`)}else{p.loading(`이미지 업로드 중... (1/${d.length})`);const u={project:g,date:y,images:d[0],notes:"",createdBy:(c==null?void 0:c.name)||""},b=await D.createLog(u);if(p.dismiss(),d.length>1){let L=[...d[0]];for(let S=1;S<d.length;S++)p.loading(`이미지 업로드 중... (${S+1}/${d.length})`),L=[...L,...d[S]],await D.updateLog(b._id||b.id,{project:g,date:y,images:L,notes:""}),p.dismiss()}p.success(`${n.length}개의 사진이 저장되었습니다`)}await T()}catch(n){console.error("Failed to save images:",n),p.error("사진 저장에 실패했습니다")}finally{oe(!1)}},[g,y,c,x,T]),Se=r.useCallback(e=>{e.preventDefault(),I(e.dataTransfer.files)},[I]);r.useEffect(()=>{const e=t=>{var i;const s=(i=t.clipboardData)==null?void 0:i.items;if(!s)return;const o=Array.from(s).filter(l=>l.type.startsWith("image/"));if(o.length===0)return;t.preventDefault();const n=o.map(l=>l.getAsFile()).filter(Boolean);I(n)};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[I]),r.useCallback(async e=>{if(!(!g||!e))try{const t=m(y,"yyyy-MM-dd"),s=x.find(o=>{try{const n=o.date?new Date(o.date):null;return n&&!isNaN(n.getTime())&&m(n,"yyyy-MM-dd")===t&&o.project===g}catch{return!1}});if(s)await D.updateLog(s.id,{project:s.project,date:s.date,images:s.images,notes:e});else{const o={project:g,date:y,images:z.images,notes:e,createdBy:(c==null?void 0:c.name)||""};await D.createLog(o)}await T()}catch(t){console.error("Failed to auto-save site log:",t)}},[g,y,x,z.images,c,T]);const de=async e=>{if(window.confirm("이 현장일지를 삭제하시겠습니까?"))try{await D.deleteLog(e),p.success("현장일지가 삭제되었습니다"),await T()}catch(t){console.error("Failed to delete site log:",t),p.error("현장일지 삭제에 실패했습니다")}},Le=async(e,t)=>{if(!window.confirm("이 사진을 삭제하시겠습니까?"))return;const s=x.find(o=>o.id===e);if(s)try{const o=s.images.filter((n,i)=>i!==t);o.length===0&&!s.notes?await de(e):(await D.updateLog(e,{project:s.project,date:s.date,images:o,notes:s.notes}),$(n=>n.map(i=>i.id===e?{...i,images:o}:i)),p.success("사진이 삭제되었습니다"))}catch(o){console.error("Failed to delete image:",o),p.error("사진 삭제에 실패했습니다")}},Ce=()=>{const e=A.getFullYear(),t=A.getMonth(),s=new Date(e,t,1),o=new Date(s);o.setDate(o.getDate()-s.getDay());const n=[],i=new Date(o);for(let l=0;l<42;l++){const w=x.filter(d=>{try{const u=d.date?new Date(d.date):null;return u&&!isNaN(u.getTime())&&m(u,"yyyy-MM-dd")===m(i,"yyyy-MM-dd")}catch{return!1}});n.push({date:new Date(i),logs:w,hasImages:w.some(d=>d.images&&d.images.length>0)}),i.setDate(i.getDate()+1)}return n},ge=e=>{const t=new Date(A);t.setMonth(t.getMonth()+e),ve(t)},Te=x.reduce((e,t)=>{try{const s=t.date?new Date(t.date):null;if(s&&!isNaN(s.getTime())){const o=m(s,"yyyy-MM-dd");e[o]||(e[o]=[]),e[o].push(t)}}catch{}return e},{});Object.keys(Te).sort((e,t)=>t.localeCompare(e));const ue=(e,t)=>{const s=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(s*s+o*o)},me=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),he=(e,t=0)=>{R({show:!0,url:e[t],images:e}),ne(t),N(1),v({x:0,y:0}),Y(null),X(null),_(!1)},J=e=>{if(!h.images)return;const t=(G+e+h.images.length)%h.images.length;ne(t),R(s=>({...s,url:h.images[t]}))},Ie=async(e,t)=>{const s=x.find(o=>o.id===e);if(s)try{const o={...s,images:[...s.images,...t]};await D.updateLog(e,{project:s.project,date:s.date,images:o.images,notes:s.notes}),$(n=>n.map(i=>i.id===e?o:i)),p.success(`${t.length}개의 사진이 추가되었습니다`),Ne(null)}catch(o){console.error("Failed to add images to log:",o),p.error("사진 추가에 실패했습니다")}};return r.useCallback((e,t)=>{const o=Array.from(t).filter(i=>i.type.startsWith("image/"));if(o.length===0){p.error("이미지 파일만 업로드 가능합니다");return}const n=o.map(i=>new Promise(l=>{const w=new FileReader;w.onload=d=>{var u;l((u=d.target)==null?void 0:u.result)},w.readAsDataURL(i)}));Promise.all(n).then(i=>{Ie(e,i)})},[x]),r.useEffect(()=>{const e=t=>{if(h.show)switch(t.key){case"ArrowLeft":t.preventDefault(),h.images&&h.images.length>1&&J(-1);break;case"ArrowRight":t.preventDefault(),h.images&&h.images.length>1&&J(1);break;case"Escape":t.preventDefault(),R({show:!1,url:null});break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h.show,h.images,G]),a.jsxs("div",{className:"site-log-container desktop:grid desktop:grid-cols-12 desktop:gap-4 desktop:h-[calc(100vh-140px)] space-y-3 desktop:space-y-0",children:[a.jsxs("div",{className:"desktop:hidden flex justify-end items-center gap-2 mb-2",children:[a.jsxs("label",{className:"flex items-center gap-1 text-[10px] text-gray-500",children:[a.jsx("input",{type:"checkbox",checked:k,onChange:e=>P(e.target.checked),className:"w-3 h-3 rounded border-gray-300"}),"완료포함"]}),a.jsx("select",{value:g,onChange:e=>U(e.target.value),className:"px-3 py-1.5 bg-white text-gray-700 rounded-lg text-xs font-medium focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300",style:{appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.25rem",paddingRight:"2.5rem"},children:C.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))})]}),a.jsxs("div",{className:"site-log-left desktop:col-span-4 desktop:flex desktop:flex-col desktop:gap-4 desktop:h-full space-y-3 desktop:space-y-0",children:[a.jsx("div",{className:"site-log-calendar desktop:flex-shrink-0",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[32vh] desktop:max-h-full overflow-y-auto",children:[a.jsxs("div",{className:"mb-4 hidden desktop:block",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("select",{value:g,onChange:e=>U(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:C.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))})}),a.jsxs("label",{className:"flex items-center gap-1.5 mt-2 text-xs text-gray-500 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:k,onChange:e=>P(e.target.checked),className:"w-3.5 h-3.5 rounded border-gray-300"}),"공사완료 현장 포함"]})]}),a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("button",{onClick:()=>ge(-1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:a.jsx(ye,{className:"h-4 w-4"})}),a.jsx("h3",{className:"text-sm font-semibold",children:m(A,"yyyy년 M월")}),a.jsx("button",{onClick:()=>ge(1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:a.jsx(fe,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"grid grid-cols-7 gap-0.5",children:[["일","월","화","수","목","금","토"].map(e=>a.jsx("div",{className:"text-center text-xs font-medium text-gray-600 py-1",children:e},e)),Ce().map((e,t)=>{const s=e.date.getMonth()===A.getMonth(),o=m(e.date,"yyyy-MM-dd")===m(new Date,"yyyy-MM-dd"),n=m(e.date,"yyyy-MM-dd")===m(y,"yyyy-MM-dd");return a.jsxs("div",{onClick:()=>we(e.date),className:`text-center p-1.5 desktop:p-2 text-xs cursor-pointer rounded transition-colors min-h-[36px] desktop:min-h-[48px] flex flex-col items-center justify-center ${s?"text-gray-700":"text-gray-300"} ${o?"bg-blue-100":""} ${n?"bg-gray-900 text-white":"hover:bg-gray-100"} ${e.hasImages?"font-bold":""}`,children:[a.jsx("span",{children:m(e.date,"d")}),e.hasImages&&a.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-0.5"})]},t)})]})]})}),a.jsx("div",{className:"site-log-notes desktop:flex-1 desktop:min-h-0",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[30vh] desktop:h-full desktop:flex desktop:flex-col overflow-hidden",children:[a.jsxs("h2",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:[m(y,"M월 d일")," 일지 작성"]}),a.jsx("div",{className:"flex-1 min-h-0 flex flex-col",children:a.jsx("textarea",{value:z.notes,onChange:e=>{const t=e.target.value,s=m(y,"yyyy-MM-dd"),o=`${g}_${s}`;W(n=>({...n,notes:t})),ie(n=>({...n,[o]:t})),F.current&&clearTimeout(F.current),F.current=setTimeout(async()=>{if(g)try{const n=le.current.find(i=>{try{const l=i.date?new Date(i.date):null;return l&&!isNaN(l.getTime())&&m(l,"yyyy-MM-dd")===s&&i.project===g}catch{return!1}});if(n)await D.updateLog(n.id,{project:n.project,date:n.date,images:n.images,notes:t});else if(t.trim()){const i=await D.createLog({project:g,date:y,images:z.images,notes:t,createdBy:(c==null?void 0:c.name)||""});i&&$(l=>[...l,{id:i._id||i.id,project:g,date:y,images:z.images,notes:t,createdBy:(c==null?void 0:c.name)||"",createdAt:new Date}])}}catch(n){console.error("서버 저장 실패:",n)}},500)},rows:4,className:"site-log-textarea w-full h-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none desktop:min-h-[200px]",placeholder:"오늘 진행한 작업 내용을 입력하세요"})})]})})]}),a.jsx("div",{className:"site-log-photos desktop:col-span-8 desktop:h-full",children:a.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 transition-all desktop:h-full desktop:flex desktop:flex-col ${je?"ring-2 ring-blue-400 bg-blue-50":""}`,onDragOver:e=>{e.preventDefault(),q(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||q(!1)},onDrop:e=>{e.preventDefault(),q(!1),Se(e)},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 desktop:flex-shrink-0",children:[a.jsx("h2",{className:"text-lg font-semibold flex items-center gap-4",children:a.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["작성자: ",(c==null?void 0:c.name)||"알 수 없음"]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*",e.onchange=t=>{const s=t.target;s.files&&I(s.files)},e.click()},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"사진 추가",children:a.jsx($e,{className:"h-5 w-5 text-gray-600"})}),a.jsx("button",{onClick:()=>{const e=m(y,"yyyy-MM-dd"),t=x.filter(s=>{try{const o=s.date?new Date(s.date):null;return o&&!isNaN(o.getTime())&&m(o,"yyyy-MM-dd")===e}catch{return!1}});t.length>0&&window.confirm(`${m(y,"M월 d일")}의 모든 현장일지를 삭제하시겠습니까?`)&&t.forEach(s=>de(s.id))},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"일지 삭제",children:a.jsx(xe,{className:"h-5 w-5 text-red-500"})})]})]}),a.jsx("div",{className:"space-y-6 max-h-[990px] desktop:max-h-full desktop:flex-1 desktop:min-h-0 overflow-y-auto",children:(()=>{const e=m(y,"yyyy-MM-dd"),t=x.filter(s=>{try{const o=s.date?new Date(s.date):null;return o&&!isNaN(o.getTime())&&m(o,"yyyy-MM-dd")===e}catch{return!1}});return t.length>0?a.jsx("div",{className:"space-y-4",children:t.map(s=>a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[s.notes&&a.jsx("div",{className:"mb-3",children:a.jsx("p",{className:"text-sm text-gray-700",children:s.notes})}),a.jsx("div",{className:"min-h-[600px] desktop:min-h-0",children:s.images&&s.images.length>0?a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 desktop:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3",children:s.images.map((o,n)=>a.jsxs("div",{className:"relative group",children:[a.jsx("img",{src:o,alt:`현장사진 ${n+1}`,className:"w-full aspect-[4/3] object-cover rounded-lg cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>he(s.images,n)}),a.jsx("button",{onClick:()=>he(s.images,n),className:"absolute top-2 right-2 p-1.5 bg-black bg-opacity-50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(Fe,{className:"h-4 w-4"})}),a.jsx("button",{onClick:i=>{i.stopPropagation(),Le(s.id,n)},className:"absolute top-2 left-2 p-1.5 bg-red-600 bg-opacity-80 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-opacity-100",children:a.jsx(xe,{className:"h-4 w-4"})}),a.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:[n+1," / ",s.images.length]})]},n))}):a.jsx("div",{className:"flex items-center justify-center h-[600px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(be,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-400",children:"사진을 드래그하거나 + 버튼을 클릭하세요"})]})})})]},s.id))}):a.jsx("div",{children:a.jsxs("div",{className:"rounded-lg p-4 pt-2 desktop:p-12 text-center",children:[a.jsx(Re,{className:"mx-auto h-12 w-12 desktop:h-16 desktop:w-16 text-gray-400 mb-2 desktop:mb-4"}),a.jsx("p",{className:"text-sm desktop:text-lg font-medium text-gray-700 mb-2",children:"현장 사진을 업로드하세요"}),a.jsx("p",{className:"hidden desktop:block text-sm text-gray-600 mb-4",children:"이미지를 이곳에 드래그하거나 클릭하여 선택"}),a.jsx("p",{className:"hidden desktop:block text-xs text-gray-500 mb-4",children:"Ctrl+V로 클립보드 이미지 붙여넣기도 가능합니다"}),a.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>s.target.files&&I(s.target.files),className:"hidden",id:"main-image-upload"}),a.jsxs("label",{htmlFor:"main-image-upload",className:"inline-flex items-center px-3 py-1.5 desktop:px-4 desktop:py-2 border border-gray-300 rounded-lg text-xs desktop:text-sm text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[a.jsx(be,{className:"h-3 w-3 desktop:h-4 desktop:w-4 mr-1.5 desktop:mr-2"}),"파일 선택"]})]})})})()})]})}),h.show&&h.url&&a.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center overflow-hidden",onClick:()=>{R({show:!1,url:null}),N(1),v({x:0,y:0})},onWheel:e=>{e.preventDefault();const t=e.deltaY>0?-.1:.1;N(s=>Math.max(.5,Math.min(5,s+t)))},children:a.jsxs("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[a.jsx("button",{onClick:e=>{e.stopPropagation(),R({show:!1,url:null}),N(1),v({x:0,y:0})},className:"absolute top-4 right-4 p-2 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30 z-10",children:a.jsx(Ae,{className:"h-6 w-6 text-white"})}),j!==1&&a.jsxs("div",{className:"absolute top-4 left-4 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm backdrop-blur",children:[Math.round(j*100),"%"]}),h.images&&h.images.length>1&&a.jsx("button",{onClick:e=>{e.stopPropagation(),J(-1),N(1),v({x:0,y:0})},className:"absolute left-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:a.jsx(ye,{className:"h-6 w-6 text-white"})}),a.jsx("div",{className:"w-full h-full flex items-center justify-center",onMouseDown:e=>{j>1&&(H(!0),Q({x:e.clientX-M.x,y:e.clientY-M.y}))},onMouseMove:e=>{V&&j>1&&v({x:e.clientX-K.x,y:e.clientY-K.y})},onMouseUp:()=>H(!1),onMouseLeave:()=>H(!1),onTouchStart:e=>{if(e.touches.length===2){e.preventDefault(),_(!0);const t=ue(e.touches[0],e.touches[1]),s=me(e.touches[0],e.touches[1]);Y(t),X(s)}else if(e.touches.length===1&&j>1&&!O){const t=e.touches[0];Q({x:t.clientX-M.x,y:t.clientY-M.y})}},onTouchMove:e=>{if(e.touches.length===2){e.preventDefault(),_(!0);const t=ue(e.touches[0],e.touches[1]),s=me(e.touches[0],e.touches[1]);if(ee&&te){const o=t/ee,n=Math.max(.5,Math.min(5,j*o)),i=s.x-te.x,l=s.y-te.y,w=n/j,d=M.x*w+i,u=M.y*w+l;N(n),v({x:d,y:u})}Y(t),X(s)}else if(e.touches.length===1&&j>1&&!O){e.preventDefault();const t=e.touches[0];v({x:t.clientX-K.x,y:t.clientY-K.y})}},onTouchEnd:e=>{if(e.touches.length===0){const t=Date.now(),s=e.changedTouches[0],o={x:s.clientX,y:s.clientY};if(t-ke<300&&se&&Math.abs(o.x-se.x)<30&&Math.abs(o.y-se.y)<30&&!O){if(j===1){const l=e.currentTarget.getBoundingClientRect(),w=o.x-l.left-l.width/2,d=o.y-l.top-l.height/2;N(2.5),v({x:-w*1.5,y:-d*1.5})}else N(1),v({x:0,y:0});re(0),ce(null)}else re(t),ce(o);Y(null),X(null),_(!1)}else if(e.touches.length===1&&O){Y(null),X(null),_(!1);const t=e.touches[0];Q({x:t.clientX-M.x,y:t.clientY-M.y})}},onDoubleClick:e=>{e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,o=e.clientY-t.top-t.height/2;j===1?(N(2.5),v({x:-s*1.5,y:-o*1.5})):(N(1),v({x:0,y:0}))},children:a.jsx("img",{src:h.url,alt:"확대 이미지",style:{transform:`scale(${j}) translate(${M.x/j}px, ${M.y/j}px)`,transformOrigin:"center center",transition:V||ee!==null?"none":"transform 0.25s cubic-bezier(0.2, 0, 0, 1)",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",cursor:j>1?V?"grabbing":"grab":"pointer",userSelect:"none",touchAction:"none"},draggable:!1,onClick:e=>e.stopPropagation()})}),h.images&&h.images.length>1&&a.jsx("button",{onClick:e=>{e.stopPropagation(),J(1),N(1),v({x:0,y:0})},className:"absolute right-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:a.jsx(fe,{className:"h-6 w-6 text-white"})}),h.images&&h.images.length>1&&a.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full",children:[G+1," / ",h.images.length]}),a.jsx("div",{className:"absolute bottom-4 right-4 bg-white bg-opacity-10 text-white px-3 py-2 rounded-lg text-xs text-center backdrop-blur",children:"마우스 휠 또는 두 손가락으로 확대/축소"})]})})]})};export{Ge as default};
