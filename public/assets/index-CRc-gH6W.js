const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Drawings-DkAfJJBY.js","assets/vendor-react-DN7YJcfR.js","assets/vendor-ui-D8A9iq7X.js","assets/vendor-data-DrLf5NIQ.js","assets/vendor-date-DbWJ9m7c.js","assets/vendor-calendar-DjAQlTCo.js","assets/SiteLog-B9L5fjNM.js","assets/AfterService-OHMUd5vW.js","assets/AdditionalWork-BCzVs6Cs.js","assets/additionalWorkService-NmSEHgUM.js","assets/ConstructionPayment-N_POUJ9q.js","assets/WorkRequest-DNvJElc6.js","assets/Specbook-DPpady9m.js","assets/EstimatePreview-DNcct48S.js","assets/ExecutionHistory-B2fZ26Jt.js"])))=>i.map(i=>d[i]);
var Fv=Object.defineProperty;var Ov=(n,e,t)=>e in n?Fv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var $p=(n,e,t)=>Ov(n,typeof e!="symbol"?e+"":e,t);import{r as E,b as qv,u as wy,d as $v,N as Vy,e as hm,O as zv,R as mt,f as wl,B as Wv,h as Kv,i as jn}from"./vendor-react-DN7YJcfR.js";import{a as Gv,c as zd,Q as Qv,b as Yv}from"./vendor-data-DrLf5NIQ.js";import{B as gm,X as Cn,C as Cy,T as ji,a as Xv,b as Iy,W as Jv,c as Zv,d as Ls,P as So,R as e_,e as t_,S as Sy,f as n_,g as s_,h as Ty,i as r_,U as zm,I as Ha,j as Wm,k as zp,l as Wp,m as Kp,n as i_,M as o_,o as a_,p as l_,L as c_}from"./vendor-ui-D8A9iq7X.js";import{k as ym,l as ba,m as Na,n as u_,o as m_,p as $t,q as d_,r as Gp,s as f_,t as ct}from"./vendor-date-DbWJ9m7c.js";import{c as p_,p as Py,l as _u,s as js,i as h_,h as g_,q as Wd,a as Kd,m as Gd,b as y_,d as Du,o as $c,e as b_,f as zc,r as Qd,g as Yd,j as Xd,k as Jd,n as Zd,t as Ly,u as jy,v as Ry,w as By,x as Uy,y as Hy,z as My,A as Fy,B as Oy,C as qy,D as $y,E as zy,F as N_,G as x_,H as v_,I as __,J as D_,K as k_,L as E_}from"./vendor-calendar-DjAQlTCo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Wy={exports:{}},Km={};/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var n=E,e=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),C=Symbol.iterator,v="@@iterator";function w(x){if(x===null||typeof x!="object")return null;var L=C&&x[C]||x[v];return typeof L=="function"?L:null}var R=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function I(x){{for(var L=arguments.length,U=new Array(L>1?L-1:0),X=1;X<L;X++)U[X-1]=arguments[X];F("error",x,U)}}function F(x,L,U){{var X=R.ReactDebugCurrentFrame,Q=X.getStackAddendum();Q!==""&&(L+="%s",U=U.concat([Q]));var Z=U.map(function(ie){return String(ie)});Z.unshift("Warning: "+L),Function.prototype.apply.call(console[x],console,Z)}}var re=!1,ee=!1,M=!1,A=!1,N=!1,V;V=Symbol.for("react.module.reference");function j(x){return!!(typeof x=="string"||typeof x=="function"||x===s||x===i||N||x===r||x===m||x===d||A||x===y||re||ee||M||typeof x=="object"&&x!==null&&(x.$$typeof===p||x.$$typeof===f||x.$$typeof===o||x.$$typeof===l||x.$$typeof===u||x.$$typeof===V||x.getModuleId!==void 0))}function T(x,L,U){var X=x.displayName;if(X)return X;var Q=L.displayName||L.name||"";return Q!==""?U+"("+Q+")":U}function S(x){return x.displayName||"Context"}function k(x){if(x==null)return null;if(typeof x.tag=="number"&&I("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case s:return"Fragment";case t:return"Portal";case i:return"Profiler";case r:return"StrictMode";case m:return"Suspense";case d:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case l:var L=x;return S(L)+".Consumer";case o:var U=x;return S(U._context)+".Provider";case u:return T(x,x.render,"ForwardRef");case f:var X=x.displayName||null;return X!==null?X:k(x.type)||"Memo";case p:{var Q=x,Z=Q._payload,ie=Q._init;try{return k(ie(Z))}catch{return null}}}return null}var Ee=Object.assign,$e=0,ge,He,ht,Kt,qt,le,ze;function de(){}de.__reactDisabledLog=!0;function Be(){{if($e===0){ge=console.log,He=console.info,ht=console.warn,Kt=console.error,qt=console.group,le=console.groupCollapsed,ze=console.groupEnd;var x={configurable:!0,enumerable:!0,value:de,writable:!0};Object.defineProperties(console,{info:x,log:x,warn:x,error:x,group:x,groupCollapsed:x,groupEnd:x})}$e++}}function Xe(){{if($e--,$e===0){var x={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Ee({},x,{value:ge}),info:Ee({},x,{value:He}),warn:Ee({},x,{value:ht}),error:Ee({},x,{value:Kt}),group:Ee({},x,{value:qt}),groupCollapsed:Ee({},x,{value:le}),groupEnd:Ee({},x,{value:ze})})}$e<0&&I("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var vt=R.ReactCurrentDispatcher,lt;function St(x,L,U){{if(lt===void 0)try{throw Error()}catch(Q){var X=Q.stack.trim().match(/\n( *(at )?)/);lt=X&&X[1]||""}return`
`+lt+x}}var at=!1,ft;{var Nn=typeof WeakMap=="function"?WeakMap:Map;ft=new Nn}function K(x,L){if(!x||at)return"";{var U=ft.get(x);if(U!==void 0)return U}var X;at=!0;var Q=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var Z;Z=vt.current,vt.current=null,Be();try{if(L){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(Mt){X=Mt}Reflect.construct(x,[],ie)}else{try{ie.call()}catch(Mt){X=Mt}x.call(ie.prototype)}}else{try{throw Error()}catch(Mt){X=Mt}x()}}catch(Mt){if(Mt&&X&&typeof Mt.stack=="string"){for(var Ce=Mt.stack.split(`
`),et=X.stack.split(`
`),Oe=Ce.length-1,he=et.length-1;Oe>=1&&he>=0&&Ce[Oe]!==et[he];)he--;for(;Oe>=1&&he>=0;Oe--,he--)if(Ce[Oe]!==et[he]){if(Oe!==1||he!==1)do if(Oe--,he--,he<0||Ce[Oe]!==et[he]){var Qe=`
`+Ce[Oe].replace(" at new "," at ");return x.displayName&&Qe.includes("<anonymous>")&&(Qe=Qe.replace("<anonymous>",x.displayName)),typeof x=="function"&&ft.set(x,Qe),Qe}while(Oe>=1&&he>=0);break}}}finally{at=!1,vt.current=Z,Xe(),Error.prepareStackTrace=Q}var fn=x?x.displayName||x.name:"",Qt=fn?St(fn):"";return typeof x=="function"&&ft.set(x,Qt),Qt}function Le(x,L,U){return K(x,!1)}function Fe(x){var L=x.prototype;return!!(L&&L.isReactComponent)}function Se(x,L,U){if(x==null)return"";if(typeof x=="function")return K(x,Fe(x));if(typeof x=="string")return St(x);switch(x){case m:return St("Suspense");case d:return St("SuspenseList")}if(typeof x=="object")switch(x.$$typeof){case u:return Le(x.render);case f:return Se(x.type,L,U);case p:{var X=x,Q=X._payload,Z=X._init;try{return Se(Z(Q),L,U)}catch{}}}return""}var Je=Object.prototype.hasOwnProperty,Tt={},Gt=R.ReactDebugCurrentFrame;function dt(x){if(x){var L=x._owner,U=Se(x.type,x._source,L?L.type:null);Gt.setExtraStackFrame(U)}else Gt.setExtraStackFrame(null)}function P(x,L,U,X,Q){{var Z=Function.call.bind(Je);for(var ie in x)if(Z(x,ie)){var Ce=void 0;try{if(typeof x[ie]!="function"){var et=Error((X||"React class")+": "+U+" type `"+ie+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof x[ie]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw et.name="Invariant Violation",et}Ce=x[ie](L,ie,X,U,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Oe){Ce=Oe}Ce&&!(Ce instanceof Error)&&(dt(Q),I("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",X||"React class",U,ie,typeof Ce),dt(null)),Ce instanceof Error&&!(Ce.message in Tt)&&(Tt[Ce.message]=!0,dt(Q),I("Failed %s type: %s",U,Ce.message),dt(null))}}}var q=Array.isArray;function te(x){return q(x)}function ve(x){{var L=typeof Symbol=="function"&&Symbol.toStringTag,U=L&&x[Symbol.toStringTag]||x.constructor.name||"Object";return U}}function ue(x){try{return fe(x),!1}catch{return!0}}function fe(x){return""+x}function Ie(x){if(ue(x))return I("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ve(x)),fe(x)}var We=R.ReactCurrentOwner,st={key:!0,ref:!0,__self:!0,__source:!0},we,$n,Ht;Ht={};function ne(x){if(Je.call(x,"ref")){var L=Object.getOwnPropertyDescriptor(x,"ref").get;if(L&&L.isReactWarning)return!1}return x.ref!==void 0}function Ze(x){if(Je.call(x,"key")){var L=Object.getOwnPropertyDescriptor(x,"key").get;if(L&&L.isReactWarning)return!1}return x.key!==void 0}function O(x,L){if(typeof x.ref=="string"&&We.current&&L&&We.current.stateNode!==L){var U=k(We.current.type);Ht[U]||(I('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',k(We.current.type),x.ref),Ht[U]=!0)}}function _e(x,L){{var U=function(){we||(we=!0,I("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",L))};U.isReactWarning=!0,Object.defineProperty(x,"key",{get:U,configurable:!0})}}function ke(x,L){{var U=function(){$n||($n=!0,I("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",L))};U.isReactWarning=!0,Object.defineProperty(x,"ref",{get:U,configurable:!0})}}var je=function(x,L,U,X,Q,Z,ie){var Ce={$$typeof:e,type:x,key:L,ref:U,props:ie,_owner:Z};return Ce._store={},Object.defineProperty(Ce._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Ce,"_self",{configurable:!1,enumerable:!1,writable:!1,value:X}),Object.defineProperty(Ce,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Q}),Object.freeze&&(Object.freeze(Ce.props),Object.freeze(Ce)),Ce};function me(x,L,U,X,Q){{var Z,ie={},Ce=null,et=null;U!==void 0&&(Ie(U),Ce=""+U),Ze(L)&&(Ie(L.key),Ce=""+L.key),ne(L)&&(et=L.ref,O(L,Q));for(Z in L)Je.call(L,Z)&&!st.hasOwnProperty(Z)&&(ie[Z]=L[Z]);if(x&&x.defaultProps){var Oe=x.defaultProps;for(Z in Oe)ie[Z]===void 0&&(ie[Z]=Oe[Z])}if(Ce||et){var he=typeof x=="function"?x.displayName||x.name||"Unknown":x;Ce&&_e(ie,he),et&&ke(ie,he)}return je(x,Ce,et,Q,X,We.current,ie)}}var kt=R.ReactCurrentOwner,xt=R.ReactDebugCurrentFrame;function tn(x){if(x){var L=x._owner,U=Se(x.type,x._source,L?L.type:null);xt.setExtraStackFrame(U)}else xt.setExtraStackFrame(null)}var At;At=!1;function xn(x){return typeof x=="object"&&x!==null&&x.$$typeof===e}function cn(){{if(kt.current){var x=k(kt.current.type);if(x)return`

Check the render method of \``+x+"`."}return""}}function Hn(x){{if(x!==void 0){var L=x.fileName.replace(/^.*[\\\/]/,""),U=x.lineNumber;return`

Check your code at `+L+":"+U+"."}return""}}var Ds={};function ss(x){{var L=cn();if(!L){var U=typeof x=="string"?x:x.displayName||x.name;U&&(L=`

Check the top-level render call using <`+U+">.")}return L}}function ks(x,L){{if(!x._store||x._store.validated||x.key!=null)return;x._store.validated=!0;var U=ss(L);if(Ds[U])return;Ds[U]=!0;var X="";x&&x._owner&&x._owner!==kt.current&&(X=" It was passed a child from "+k(x._owner.type)+"."),tn(x),I('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',U,X),tn(null)}}function fi(x,L){{if(typeof x!="object")return;if(te(x))for(var U=0;U<x.length;U++){var X=x[U];xn(X)&&ks(X,L)}else if(xn(x))x._store&&(x._store.validated=!0);else if(x){var Q=w(x);if(typeof Q=="function"&&Q!==x.entries)for(var Z=Q.call(x),ie;!(ie=Z.next()).done;)xn(ie.value)&&ks(ie.value,L)}}}function Fs(x){{var L=x.type;if(L==null||typeof L=="string")return;var U;if(typeof L=="function")U=L.propTypes;else if(typeof L=="object"&&(L.$$typeof===u||L.$$typeof===f))U=L.propTypes;else return;if(U){var X=k(L);P(U,x.props,"prop",X,x)}else if(L.PropTypes!==void 0&&!At){At=!0;var Q=k(L);I("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Q||"Unknown")}typeof L.getDefaultProps=="function"&&!L.getDefaultProps.isReactClassApproved&&I("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function as(x){{for(var L=Object.keys(x.props),U=0;U<L.length;U++){var X=L[U];if(X!=="children"&&X!=="key"){tn(x),I("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",X),tn(null);break}}x.ref!==null&&(tn(x),I("Invalid attribute `ref` supplied to `React.Fragment`."),tn(null))}}var _={};function G(x,L,U,X,Q,Z){{var ie=j(x);if(!ie){var Ce="";(x===void 0||typeof x=="object"&&x!==null&&Object.keys(x).length===0)&&(Ce+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var et=Hn(Q);et?Ce+=et:Ce+=cn();var Oe;x===null?Oe="null":te(x)?Oe="array":x!==void 0&&x.$$typeof===e?(Oe="<"+(k(x.type)||"Unknown")+" />",Ce=" Did you accidentally export a JSX literal instead of a component?"):Oe=typeof x,I("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Oe,Ce)}var he=me(x,L,U,Q,Z);if(he==null)return he;if(ie){var Qe=L.children;if(Qe!==void 0)if(X)if(te(Qe)){for(var fn=0;fn<Qe.length;fn++)fi(Qe[fn],x);Object.freeze&&Object.freeze(Qe)}else I("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else fi(Qe,x)}if(Je.call(L,"key")){var Qt=k(x),Mt=Object.keys(L).filter(function(Qn){return Qn!=="key"}),Bt=Mt.length>0?"{key: someKey, "+Mt.join(": ..., ")+": ...}":"{key: someKey}";if(!_[Qt+Bt]){var zn=Mt.length>0?"{"+Mt.join(": ..., ")+": ...}":"{}";I(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Bt,Qt,zn,Qt),_[Qt+Bt]=!0}}return x===s?as(he):Fs(he),he}}var B=G;Km.Fragment=s,Km.jsxDEV=B})();Wy.exports=Km;var a=Wy.exports,Ky,Qp=qv;{var Yp=Qp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;Ky=function(n,e){Yp.usingClientEntryPoint=!0;try{return Qp.createRoot(n,e)}finally{Yp.usingClientEntryPoint=!1}}}const A_="modulepreload",w_=function(n){return"/"+n},Xp={},ir=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(t.map(u=>{if(u=w_(u),u in Xp)return;Xp[u]=!0;const m=u.endsWith(".css"),d=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":A_,m||(f.as="script"),f.crossOrigin="",f.href=u,l&&f.setAttribute("nonce",l),document.head.appendChild(f),m)return new Promise((p,y)=>{f.addEventListener("load",p),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};let V_={data:""},C_=n=>{if(typeof window=="object"){let e=(n?n.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(n||document.head).appendChild(e),e.firstChild}return n||V_},I_=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,S_=/\/\*[^]*?\*\/|  +/g,Jp=/\n+/g,Br=(n,e)=>{let t="",s="",r="";for(let i in n){let o=n[i];i[0]=="@"?i[1]=="i"?t=i+" "+o+";":s+=i[1]=="f"?Br(o,i):i+"{"+Br(o,i[1]=="k"?"":e)+"}":typeof o=="object"?s+=Br(o,e?e.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,u=>/&/.test(u)?u.replace(/&/g,l):l?l+" "+u:u)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),r+=Br.p?Br.p(i,o):i+":"+o+";")}return t+(e&&r?e+"{"+r+"}":r)+s},or={},Gy=n=>{if(typeof n=="object"){let e="";for(let t in n)e+=t+Gy(n[t]);return e}return n},T_=(n,e,t,s,r)=>{let i=Gy(n),o=or[i]||(or[i]=(u=>{let m=0,d=11;for(;m<u.length;)d=101*d+u.charCodeAt(m++)>>>0;return"go"+d})(i));if(!or[o]){let u=i!==n?n:(m=>{let d,f,p=[{}];for(;d=I_.exec(m.replace(S_,""));)d[4]?p.shift():d[3]?(f=d[3].replace(Jp," ").trim(),p.unshift(p[0][f]=p[0][f]||{})):p[0][d[1]]=d[2].replace(Jp," ").trim();return p[0]})(n);or[o]=Br(r?{["@keyframes "+o]:u}:u,t?"":"."+o)}let l=t&&or.g?or.g:null;return t&&(or.g=or[o]),((u,m,d,f)=>{f?m.data=m.data.replace(f,u):m.data.indexOf(u)===-1&&(m.data=d?u+m.data:m.data+u)})(or[o],e,s,l),o},P_=(n,e,t)=>n.reduce((s,r,i)=>{let o=e[i];if(o&&o.call){let l=o(t),u=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=u?"."+u:l&&typeof l=="object"?l.props?"":Br(l,""):l===!1?"":l}return s+r+(o??"")},"");function ku(n){let e=this||{},t=n.call?n(e.p):n;return T_(t.unshift?t.raw?P_(t,[].slice.call(arguments,1),e.p):t.reduce((s,r)=>Object.assign(s,r&&r.call?r(e.p):r),{}):t,C_(e.target),e.g,e.o,e.k)}let Qy,Gm,Qm;ku.bind({g:1});let fr=ku.bind({k:1});function L_(n,e,t,s){Br.p=e,Qy=n,Gm=t,Qm=s}function ei(n,e){let t=this||{};return function(){let s=arguments;function r(i,o){let l=Object.assign({},i),u=l.className||r.className;t.p=Object.assign({theme:Gm&&Gm()},l),t.o=/ *go\d+/.test(u),l.className=ku.apply(t,s)+(u?" "+u:"");let m=n;return n[0]&&(m=l.as||n,delete l.as),Qm&&m[0]&&Qm(l),Qy(m,l)}return r}}var j_=n=>typeof n=="function",Wc=(n,e)=>j_(n)?n(e):n,R_=(()=>{let n=0;return()=>(++n).toString()})(),Yy=(()=>{let n;return()=>{if(n===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");n=!e||e.matches}return n}})(),B_=20,ef="default",Xy=(n,e)=>{let{toastLimit:t}=n.settings;switch(e.type){case 0:return{...n,toasts:[e.toast,...n.toasts].slice(0,t)};case 1:return{...n,toasts:n.toasts.map(o=>o.id===e.toast.id?{...o,...e.toast}:o)};case 2:let{toast:s}=e;return Xy(n,{type:n.toasts.find(o=>o.id===s.id)?1:0,toast:s});case 3:let{toastId:r}=e;return{...n,toasts:n.toasts.map(o=>o.id===r||r===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(o=>o.id!==e.toastId)};case 5:return{...n,pausedAt:e.time};case 6:let i=e.time-(n.pausedAt||0);return{...n,pausedAt:void 0,toasts:n.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},kc=[],Jy={toasts:[],pausedAt:void 0,settings:{toastLimit:B_}},Gs={},Zy=(n,e=ef)=>{Gs[e]=Xy(Gs[e]||Jy,n),kc.forEach(([t,s])=>{t===e&&s(Gs[e])})},eb=n=>Object.keys(Gs).forEach(e=>Zy(n,e)),U_=n=>Object.keys(Gs).find(e=>Gs[e].toasts.some(t=>t.id===n)),Eu=(n=ef)=>e=>{Zy(e,n)},H_={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},M_=(n={},e=ef)=>{let[t,s]=E.useState(Gs[e]||Jy),r=E.useRef(Gs[e]);E.useEffect(()=>(r.current!==Gs[e]&&s(Gs[e]),kc.push([e,s]),()=>{let o=kc.findIndex(([l])=>l===e);o>-1&&kc.splice(o,1)}),[e]);let i=t.toasts.map(o=>{var l,u,m;return{...n,...n[o.type],...o,removeDelay:o.removeDelay||((l=n[o.type])==null?void 0:l.removeDelay)||(n==null?void 0:n.removeDelay),duration:o.duration||((u=n[o.type])==null?void 0:u.duration)||(n==null?void 0:n.duration)||H_[o.type],style:{...n.style,...(m=n[o.type])==null?void 0:m.style,...o.style}}});return{...t,toasts:i}},F_=(n,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:n,pauseDuration:0,...t,id:(t==null?void 0:t.id)||R_()}),Vl=n=>(e,t)=>{let s=F_(e,n,t);return Eu(s.toasterId||U_(s.id))({type:2,toast:s}),s.id},Rn=(n,e)=>Vl("blank")(n,e);Rn.error=Vl("error");Rn.success=Vl("success");Rn.loading=Vl("loading");Rn.custom=Vl("custom");Rn.dismiss=(n,e)=>{let t={type:3,toastId:n};e?Eu(e)(t):eb(t)};Rn.dismissAll=n=>Rn.dismiss(void 0,n);Rn.remove=(n,e)=>{let t={type:4,toastId:n};e?Eu(e)(t):eb(t)};Rn.removeAll=n=>Rn.remove(void 0,n);Rn.promise=(n,e,t)=>{let s=Rn.loading(e.loading,{...t,...t==null?void 0:t.loading});return typeof n=="function"&&(n=n()),n.then(r=>{let i=e.success?Wc(e.success,r):void 0;return i?Rn.success(i,{id:s,...t,...t==null?void 0:t.success}):Rn.dismiss(s),r}).catch(r=>{let i=e.error?Wc(e.error,r):void 0;i?Rn.error(i,{id:s,...t,...t==null?void 0:t.error}):Rn.dismiss(s)}),n};var O_=1e3,q_=(n,e="default")=>{let{toasts:t,pausedAt:s}=M_(n,e),r=E.useRef(new Map).current,i=E.useCallback((f,p=O_)=>{if(r.has(f))return;let y=setTimeout(()=>{r.delete(f),o({type:4,toastId:f})},p);r.set(f,y)},[]);E.useEffect(()=>{if(s)return;let f=Date.now(),p=t.map(y=>{if(y.duration===1/0)return;let C=(y.duration||0)+y.pauseDuration-(f-y.createdAt);if(C<0){y.visible&&Rn.dismiss(y.id);return}return setTimeout(()=>Rn.dismiss(y.id,e),C)});return()=>{p.forEach(y=>y&&clearTimeout(y))}},[t,s,e]);let o=E.useCallback(Eu(e),[e]),l=E.useCallback(()=>{o({type:5,time:Date.now()})},[o]),u=E.useCallback((f,p)=>{o({type:1,toast:{id:f,height:p}})},[o]),m=E.useCallback(()=>{s&&o({type:6,time:Date.now()})},[s,o]),d=E.useCallback((f,p)=>{let{reverseOrder:y=!1,gutter:C=8,defaultPosition:v}=p||{},w=t.filter(F=>(F.position||v)===(f.position||v)&&F.height),R=w.findIndex(F=>F.id===f.id),I=w.filter((F,re)=>re<R&&F.visible).length;return w.filter(F=>F.visible).slice(...y?[I+1]:[0,I]).reduce((F,re)=>F+(re.height||0)+C,0)},[t]);return E.useEffect(()=>{t.forEach(f=>{if(f.dismissed)i(f.id,f.removeDelay);else{let p=r.get(f.id);p&&(clearTimeout(p),r.delete(f.id))}})},[t,i]),{toasts:t,handlers:{updateHeight:u,startPause:l,endPause:m,calculateOffset:d}}},$_=fr`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,z_=fr`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,W_=fr`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,K_=ei("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${$_} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${z_} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${n=>n.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${W_} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,G_=fr`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Q_=ei("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${n=>n.secondary||"#e0e0e0"};
  border-right-color: ${n=>n.primary||"#616161"};
  animation: ${G_} 1s linear infinite;
`,Y_=fr`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,X_=fr`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,J_=ei("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Y_} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${X_} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${n=>n.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Z_=ei("div")`
  position: absolute;
`,eD=ei("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,tD=fr`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,nD=ei("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${tD} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,sD=({toast:n})=>{let{icon:e,type:t,iconTheme:s}=n;return e!==void 0?typeof e=="string"?E.createElement(nD,null,e):e:t==="blank"?null:E.createElement(eD,null,E.createElement(Q_,{...s}),t!=="loading"&&E.createElement(Z_,null,t==="error"?E.createElement(K_,{...s}):E.createElement(J_,{...s})))},rD=n=>`
0% {transform: translate3d(0,${n*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,iD=n=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${n*-150}%,-1px) scale(.6); opacity:0;}
`,oD="0%{opacity:0;} 100%{opacity:1;}",aD="0%{opacity:1;} 100%{opacity:0;}",lD=ei("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,cD=ei("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,uD=(n,e)=>{let t=n.includes("top")?1:-1,[s,r]=Yy()?[oD,aD]:[rD(t),iD(t)];return{animation:e?`${fr(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${fr(r)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},mD=E.memo(({toast:n,position:e,style:t,children:s})=>{let r=n.height?uD(n.position||e||"top-center",n.visible):{opacity:0},i=E.createElement(sD,{toast:n}),o=E.createElement(cD,{...n.ariaProps},Wc(n.message,n));return E.createElement(lD,{className:n.className,style:{...r,...t,...n.style}},typeof s=="function"?s({icon:i,message:o}):E.createElement(E.Fragment,null,i,o))});L_(E.createElement);var dD=({id:n,className:e,style:t,onHeightUpdate:s,children:r})=>{let i=E.useCallback(o=>{if(o){let l=()=>{let u=o.getBoundingClientRect().height;s(n,u)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[n,s]);return E.createElement("div",{ref:i,className:e,style:t},r)},fD=(n,e)=>{let t=n.includes("top"),s=t?{top:0}:{bottom:0},r=n.includes("center")?{justifyContent:"center"}:n.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Yy()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...s,...r}},pD=ku`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Zl=16,hD=({reverseOrder:n,position:e="top-center",toastOptions:t,gutter:s,children:r,toasterId:i,containerStyle:o,containerClassName:l})=>{let{toasts:u,handlers:m}=q_(t,i);return E.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:Zl,left:Zl,right:Zl,bottom:Zl,pointerEvents:"none",...o},className:l,onMouseEnter:m.startPause,onMouseLeave:m.endPause},u.map(d=>{let f=d.position||e,p=m.calculateOffset(d,{reverseOrder:n,gutter:s,defaultPosition:e}),y=fD(f,p);return E.createElement(dD,{id:d.id,key:d.id,onHeightUpdate:m.updateHeight,className:d.visible?pD:"",style:y},d.type==="custom"?Wc(d.message,d):r?r(d):E.createElement(mD,{toast:d,position:f}))}))},oe=Rn;const nr=Object.create(null);nr.open="0";nr.close="1";nr.ping="2";nr.pong="3";nr.message="4";nr.upgrade="5";nr.noop="6";const Ec=Object.create(null);Object.keys(nr).forEach(n=>{Ec[nr[n]]=n});const Ym={type:"error",data:"parser error"},tb=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",nb=typeof ArrayBuffer=="function",sb=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,tf=({type:n,data:e},t,s)=>tb&&e instanceof Blob?t?s(e):Zp(e,s):nb&&(e instanceof ArrayBuffer||sb(e))?t?s(e):Zp(new Blob([e]),s):s(nr[n]+(e||"")),Zp=(n,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(n)};function eh(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let bm;function gD(n,e){if(tb&&n.data instanceof Blob)return n.data.arrayBuffer().then(eh).then(e);if(nb&&(n.data instanceof ArrayBuffer||sb(n.data)))return e(eh(n.data));tf(n,!1,t=>{bm||(bm=new TextEncoder),e(bm.encode(t))})}const th="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ma=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<th.length;n++)Ma[th.charCodeAt(n)]=n;const yD=n=>{let e=n.length*.75,t=n.length,s,r=0,i,o,l,u;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const m=new ArrayBuffer(e),d=new Uint8Array(m);for(s=0;s<t;s+=4)i=Ma[n.charCodeAt(s)],o=Ma[n.charCodeAt(s+1)],l=Ma[n.charCodeAt(s+2)],u=Ma[n.charCodeAt(s+3)],d[r++]=i<<2|o>>4,d[r++]=(o&15)<<4|l>>2,d[r++]=(l&3)<<6|u&63;return m},bD=typeof ArrayBuffer=="function",nf=(n,e)=>{if(typeof n!="string")return{type:"message",data:rb(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:ND(n.substring(1),e)}:Ec[t]?n.length>1?{type:Ec[t],data:n.substring(1)}:{type:Ec[t]}:Ym},ND=(n,e)=>{if(bD){const t=yD(n);return rb(t,e)}else return{base64:!0,data:n}},rb=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},ib="",xD=(n,e)=>{const t=n.length,s=new Array(t);let r=0;n.forEach((i,o)=>{tf(i,!1,l=>{s[o]=l,++r===t&&e(s.join(ib))})})},vD=(n,e)=>{const t=n.split(ib),s=[];for(let r=0;r<t.length;r++){const i=nf(t[r],e);if(s.push(i),i.type==="error")break}return s};function _D(){return new TransformStream({transform(n,e){gD(n,t=>{const s=t.length;let r;if(s<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,s);else if(s<65536){r=new Uint8Array(3);const i=new DataView(r.buffer);i.setUint8(0,126),i.setUint16(1,s)}else{r=new Uint8Array(9);const i=new DataView(r.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(s))}n.data&&typeof n.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(t)})}})}let Nm;function ec(n){return n.reduce((e,t)=>e+t.length,0)}function tc(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let s=0;for(let r=0;r<e;r++)t[r]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),t}function DD(n,e){Nm||(Nm=new TextDecoder);const t=[];let s=0,r=-1,i=!1;return new TransformStream({transform(o,l){for(t.push(o);;){if(s===0){if(ec(t)<1)break;const u=tc(t,1);i=(u[0]&128)===128,r=u[0]&127,r<126?s=3:r===126?s=1:s=2}else if(s===1){if(ec(t)<2)break;const u=tc(t,2);r=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),s=3}else if(s===2){if(ec(t)<8)break;const u=tc(t,8),m=new DataView(u.buffer,u.byteOffset,u.length),d=m.getUint32(0);if(d>Math.pow(2,21)-1){l.enqueue(Ym);break}r=d*Math.pow(2,32)+m.getUint32(4),s=3}else{if(ec(t)<r)break;const u=tc(t,r);l.enqueue(nf(i?u:Nm.decode(u),e)),s=0}if(r===0||r>n){l.enqueue(Ym);break}}}})}const ob=4;function In(n){if(n)return kD(n)}function kD(n){for(var e in In.prototype)n[e]=In.prototype[e];return n}In.prototype.on=In.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};In.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};In.prototype.off=In.prototype.removeListener=In.prototype.removeAllListeners=In.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,r=0;r<t.length;r++)if(s=t[r],s===e||s.fn===e){t.splice(r,1);break}return t.length===0&&delete this._callbacks["$"+n],this};In.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,r=t.length;s<r;++s)t[s].apply(this,e)}return this};In.prototype.emitReserved=In.prototype.emit;In.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};In.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Au=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),As=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),ED="arraybuffer";function ab(n,...e){return e.reduce((t,s)=>(n.hasOwnProperty(s)&&(t[s]=n[s]),t),{})}const AD=As.setTimeout,wD=As.clearTimeout;function wu(n,e){e.useNativeTimers?(n.setTimeoutFn=AD.bind(As),n.clearTimeoutFn=wD.bind(As)):(n.setTimeoutFn=As.setTimeout.bind(As),n.clearTimeoutFn=As.clearTimeout.bind(As))}const VD=1.33;function CD(n){return typeof n=="string"?ID(n):Math.ceil((n.byteLength||n.size)*VD)}function ID(n){let e=0,t=0;for(let s=0,r=n.length;s<r;s++)e=n.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function lb(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function SD(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function TD(n){let e={},t=n.split("&");for(let s=0,r=t.length;s<r;s++){let i=t[s].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class PD extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class sf extends In{constructor(e){super(),this.writable=!1,wu(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new PD(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=nf(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=SD(e);return t.length?"?"+t:""}}class LD extends sf{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};vD(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,xD(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=lb()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let cb=!1;try{cb=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const jD=cb;function RD(){}class BD extends LD{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(r,i)=>{this.onError("xhr post error",r,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}let To=class Ac extends In{constructor(e,t,s){super(),this.createRequest=e,wu(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=ab(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&s.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var r;s.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=Ac.requestsCount++,Ac.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=RD,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ac.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};To.requestsCount=0;To.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",nh);else if(typeof addEventListener=="function"){const n="onpagehide"in As?"pagehide":"unload";addEventListener(n,nh,!1)}}function nh(){for(let n in To.requests)To.requests.hasOwnProperty(n)&&To.requests[n].abort()}const UD=function(){const n=ub({xdomain:!1});return n&&n.responseType!==null}();class HD extends BD{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=UD&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new To(ub,this.uri(),e)}}function ub(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||jD))return new XMLHttpRequest}catch{}if(!e)try{return new As[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const mb=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class MD extends sf{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=mb?{}:ab(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;tf(s,this.supportsBinary,i=>{try{this.doWrite(s,i)}catch{}r&&Au(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=lb()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const xm=As.WebSocket||As.MozWebSocket;class FD extends MD{createSocket(e,t,s){return mb?new xm(e,t,s):t?new xm(e,t):new xm(e)}doWrite(e,t){this.ws.send(t)}}class OD extends sf{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=DD(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),r=_D();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const i=()=>{s.read().then(({done:l,value:u})=>{l||(this.onPacket(u),i())}).catch(l=>{})};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;this._writer.write(s).then(()=>{r&&Au(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const qD={websocket:FD,webtransport:OD,polling:HD},$D=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,zD=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Xm(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),s=n.indexOf("]");t!=-1&&s!=-1&&(n=n.substring(0,t)+n.substring(t,s).replace(/:/g,";")+n.substring(s,n.length));let r=$D.exec(n||""),i={},o=14;for(;o--;)i[zD[o]]=r[o]||"";return t!=-1&&s!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=WD(i,i.path),i.queryKey=KD(i,i.query),i}function WD(n,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function KD(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,r,i){r&&(t[r]=i)}),t}const Jm=typeof addEventListener=="function"&&typeof removeEventListener=="function",wc=[];Jm&&addEventListener("offline",()=>{wc.forEach(n=>n())},!1);class Or extends In{constructor(e,t){if(super(),this.binaryType=ED,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=Xm(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=Xm(t.host).host);wu(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const r=s.prototype.name;this.transports.push(r),this._transportsByName[r]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=TD(this.opts.query)),Jm&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},wc.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=ob,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Or.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Or.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(t+=CD(r)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Au(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,r){if(typeof t=="function"&&(r=t,t=void 0),typeof s=="function"&&(r=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const i={type:e,data:t,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(Or.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Jm&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=wc.indexOf(this._offlineEventListener);s!==-1&&wc.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Or.protocol=ob;class GD extends Or{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;Or.priorWebsocketSuccess=!1;const r=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!s)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Or.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function i(){s||(s=!0,d(),t.close(),t=null)}const o=f=>{const p=new Error("probe error: "+f);p.transport=t.name,i(),this.emitReserved("upgradeError",p)};function l(){o("transport closed")}function u(){o("socket closed")}function m(f){t&&f.name!==t.name&&i()}const d=()=>{t.removeListener("open",r),t.removeListener("error",o),t.removeListener("close",l),this.off("close",u),this.off("upgrading",m)};t.once("open",r),t.once("error",o),t.once("close",l),this.once("close",u),this.once("upgrading",m),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let QD=class extends GD{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(r=>qD[r]).filter(r=>!!r)),super(e,s)}};function YD(n,e="",t){let s=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),s=Xm(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const i=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+e,s.href=s.protocol+"://"+i+(t&&t.port===s.port?"":":"+s.port),s}const XD=typeof ArrayBuffer=="function",JD=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,db=Object.prototype.toString,ZD=typeof Blob=="function"||typeof Blob<"u"&&db.call(Blob)==="[object BlobConstructor]",ek=typeof File=="function"||typeof File<"u"&&db.call(File)==="[object FileConstructor]";function rf(n){return XD&&(n instanceof ArrayBuffer||JD(n))||ZD&&n instanceof Blob||ek&&n instanceof File}function Vc(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,s=n.length;t<s;t++)if(Vc(n[t]))return!0;return!1}if(rf(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Vc(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Vc(n[t]))return!0;return!1}function tk(n){const e=[],t=n.data,s=n;return s.data=Zm(t,e),s.attachments=e.length,{packet:s,buffers:e}}function Zm(n,e){if(!n)return n;if(rf(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let s=0;s<n.length;s++)t[s]=Zm(n[s],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=Zm(n[s],e));return t}return n}function nk(n,e){return n.data=ed(n.data,e),delete n.attachments,n}function ed(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=ed(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=ed(n[t],e));return n}const sk=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],rk=5;var Et;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Et||(Et={}));class ik{constructor(e){this.replacer=e}encode(e){return(e.type===Et.EVENT||e.type===Et.ACK)&&Vc(e)?this.encodeAsBinary({type:e.type===Et.EVENT?Et.BINARY_EVENT:Et.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Et.BINARY_EVENT||e.type===Et.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=tk(e),s=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(s),r}}function sh(n){return Object.prototype.toString.call(n)==="[object Object]"}class of extends In{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===Et.BINARY_EVENT;s||t.type===Et.BINARY_ACK?(t.type=s?Et.EVENT:Et.ACK,this.reconstructor=new ok(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(rf(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(Et[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===Et.BINARY_EVENT||s.type===Et.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(i,t)}else s.nsp="/";const r=e.charAt(t+1);if(r!==""&&Number(r)==r){const i=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(of.isPayloadValid(s.type,i))s.data=i;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case Et.CONNECT:return sh(t);case Et.DISCONNECT:return t===void 0;case Et.CONNECT_ERROR:return typeof t=="string"||sh(t);case Et.EVENT:case Et.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&sk.indexOf(t[0])===-1);case Et.ACK:case Et.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ok{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=nk(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ak=Object.freeze(Object.defineProperty({__proto__:null,Decoder:of,Encoder:ik,get PacketType(){return Et},protocol:rk},Symbol.toStringTag,{value:"Module"}));function Ts(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const lk=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class fb extends In{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ts(e,"open",this.onopen.bind(this)),Ts(e,"packet",this.onpacket.bind(this)),Ts(e,"error",this.onerror.bind(this)),Ts(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,r,i;if(lk.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:Et.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const d=this.ids++,f=t.pop();this._registerAckCallback(d,f),o.id=d}const l=(r=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||r===void 0?void 0:r.writable,u=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!l||(u?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s;const r=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(r===void 0){this.acks[e]=t;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&this.sendBuffer.splice(l,1);t.call(this,new Error("operation has timed out"))},r),o=(...l)=>{this.io.clearTimeoutFn(i),t.apply(this,l)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,r)=>{const i=(o,l)=>o?r(o):s(l);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...i)=>s!==this._queue[0]?void 0:(r!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(r)):(this._queue.shift(),t&&t(null,...i)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Et.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Et.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Et.EVENT:case Et.BINARY_EVENT:this.onevent(e);break;case Et.ACK:case Et.BINARY_ACK:this.onack(e);break;case Et.DISCONNECT:this.ondisconnect();break;case Et.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...r){s||(s=!0,t.packet({type:Et.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Et.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function na(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}na.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};na.prototype.reset=function(){this.attempts=0};na.prototype.setMin=function(n){this.ms=n};na.prototype.setMax=function(n){this.max=n};na.prototype.setJitter=function(n){this.jitter=n};class td extends In{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,wu(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new na({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||ak;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new QD(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=Ts(t,"open",function(){s.onopen(),e&&e()}),i=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},o=Ts(t,"error",i);if(this._timeout!==!1){const l=this._timeout,u=this.setTimeoutFn(()=>{r(),i(new Error("timeout")),t.close()},l);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ts(e,"ping",this.onping.bind(this)),Ts(e,"data",this.ondata.bind(this)),Ts(e,"error",this.onerror.bind(this)),Ts(e,"close",this.onclose.bind(this)),Ts(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Au(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new fb(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const xa={};function Ka(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=YD(n,e.path||"/socket.io"),s=t.source,r=t.id,i=t.path,o=xa[r]&&i in xa[r].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let u;return l?u=new td(s,e):(xa[r]||(xa[r]=new td(s,e)),u=xa[r]),t.query&&!e.query&&(e.query=t.queryKey),u.socket(t.path,e)}Object.assign(Ka,{Manager:td,Socket:fb,io:Ka,connect:Ka});function ck(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:r,onRegisteredSW:i,onRegisterError:o}=n;let l,u,m;const d=async(p=!0)=>{await u,await(m==null?void 0:m())};async function f(){if("serviceWorker"in navigator){if(l=await ir(async()=>{const{Workbox:p}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:p}},[]).then(({Workbox:p})=>new p("/sw.js",{scope:"/",type:"classic"})).catch(p=>{o==null||o(p)}),!l)return;m=async()=>{await(l==null?void 0:l.messageSkipWaiting())};{let p=!1;const y=()=>{p=!0,l==null||l.addEventListener("controlling",C=>{C.isUpdate&&window.location.reload()}),t==null||t()};l.addEventListener("installed",C=>{typeof C.isUpdate>"u"?typeof C.isExternal<"u"?C.isExternal?y():!p&&(s==null||s()):C.isExternal?window.location.reload():!p&&(s==null||s()):C.isUpdate||s==null||s()}),l.addEventListener("waiting",y),l.addEventListener("externalwaiting",y)}l.register({immediate:e}).then(p=>{i?i("/sw.js",p):r==null||r(p)}).catch(p=>{o==null||o(p)})}}return u=f(),d}const uk=()=>{if(typeof window<"u"){const n=window.location.hostname;if(n==="hvlab.app"||n.includes("hv-lab-app")||n.includes("firebaseapp.com"))return"https://asia-northeast3-hv-lab-app.cloudfunctions.net/api"}return"/api"},mk=uk(),Po=Gv.create({baseURL:mk,headers:{"Content-Type":"application/json"}});Po.interceptors.request.use(n=>{const e=localStorage.getItem("token");return e&&(n.headers.Authorization=`Bearer ${e}`),n},n=>Promise.reject(n));Po.interceptors.response.use(n=>n,n=>{var e,t,s;return((e=n.response)==null?void 0:e.status)===401&&!((s=(t=n.config)==null?void 0:t.url)!=null&&s.includes("/auth/me"))&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(n)});const dk=()=>{};var rh={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pb=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},fk=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],l=n[t++],u=((r&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(u>>10)),e[s++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},hb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,l=o?n[r+1]:0,u=r+2<n.length,m=u?n[r+2]:0,d=i>>2,f=(i&3)<<4|l>>4;let p=(l&15)<<2|m>>6,y=m&63;u||(y=64,o||(p=64)),s.push(t[d],t[f],t[p],t[y])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(pb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):fk(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],l=r<n.length?t[n.charAt(r)]:0;++r;const m=r<n.length?t[n.charAt(r)]:64;++r;const f=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||l==null||m==null||f==null)throw new pk;const p=i<<2|l>>4;if(s.push(p),m!==64){const y=l<<4&240|m>>2;if(s.push(y),f!==64){const C=m<<6&192|f;s.push(C)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class pk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hk=function(n){const e=pb(n);return hb.encodeByteArray(e,!0)},Kc=function(n){return hk(n).replace(/\./g,"")},gk=function(n){try{return hb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gb(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=()=>gb().__FIREBASE_DEFAULTS__,bk=()=>{if(typeof process>"u"||typeof rh>"u")return;const n=rh.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Nk=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&gk(n[1]);return e&&JSON.parse(e)},af=()=>{try{return dk()||yk()||bk()||Nk()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},xk=n=>{var e,t;return(t=(e=af())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},vk=n=>{const e=xk(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},yb=()=>{var n;return(n=af())==null?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cl(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function bb(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Kc(JSON.stringify(t)),Kc(JSON.stringify(o)),""].join(".")}const Ga={};function kk(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ga))Ga[e]?n.emulator.push(e):n.prod.push(e);return n}function Ek(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ih=!1;function Ak(n,e){if(typeof window>"u"||typeof document>"u"||!Cl(window.location.host)||Ga[n]===e||Ga[n]||ih)return;Ga[n]=e;function t(p){return`__firebase__banner__${p}`}const s="__firebase__banner",i=kk().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function l(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function u(p,y){p.setAttribute("width","24"),p.setAttribute("id",y),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function m(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{ih=!0,o()},p}function d(p,y){p.setAttribute("id",y),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=Ek(s),y=t("text"),C=document.getElementById(y)||document.createElement("span"),v=t("learnmore"),w=document.getElementById(v)||document.createElement("a"),R=t("preprendIcon"),I=document.getElementById(R)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const F=p.element;l(F),d(w,v);const re=m();u(I,R),F.append(I,C,w,re),document.body.appendChild(F)}i?(C.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Nb(){var e;const n=(e=af())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function xb(){return!Nb()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vb(){return!Nb()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function _b(){try{return typeof indexedDB=="object"}catch{return!1}}function wk(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk="FirebaseError";class zi extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Vk,Object.setPrototypeOf(this,zi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Db.prototype.create)}}class Db{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?Ck(i,s):"Error",l=`${this.serviceName}: ${o} (${r}).`;return new zi(r,l,s)}}function Ck(n,e){return n.replace(Ik,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Ik=/\{\$([^}]+)}/g;function Qc(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(oh(i)&&oh(o)){if(!Qc(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function oh(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gn(n){return n&&n._delegate?n._delegate:n}class jo{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ni="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new _k;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Pk(e))try{this.getOrInitializeService({instanceIdentifier:Ni})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Ni){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ni){return this.instances.has(e)}getOptions(e=Ni){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);s===l&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Tk(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ni){return this.component?this.component.multipleInstances?e:Ni:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Tk(n){return n===Ni?void 0:n}function Pk(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Sk(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ct;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ct||(Ct={}));const jk={debug:Ct.DEBUG,verbose:Ct.VERBOSE,info:Ct.INFO,warn:Ct.WARN,error:Ct.ERROR,silent:Ct.SILENT},Rk=Ct.INFO,Bk={[Ct.DEBUG]:"log",[Ct.VERBOSE]:"log",[Ct.INFO]:"info",[Ct.WARN]:"warn",[Ct.ERROR]:"error"},Uk=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=Bk[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class kb{constructor(e){this.name=e,this._logLevel=Rk,this._logHandler=Uk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ct))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ct.DEBUG,...e),this._logHandler(this,Ct.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ct.VERBOSE,...e),this._logHandler(this,Ct.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ct.INFO,...e),this._logHandler(this,Ct.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ct.WARN,...e),this._logHandler(this,Ct.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ct.ERROR,...e),this._logHandler(this,Ct.ERROR,...e)}}const Hk=(n,e)=>e.some(t=>n instanceof t);let ah,lh;function Mk(){return ah||(ah=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fk(){return lh||(lh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Eb=new WeakMap,nd=new WeakMap,Ab=new WeakMap,vm=new WeakMap,lf=new WeakMap;function Ok(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(qr(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Eb.set(t,n)}).catch(()=>{}),lf.set(e,n),e}function qk(n){if(nd.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});nd.set(n,e)}let sd={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return nd.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ab.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qr(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function $k(n){sd=n(sd)}function zk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(_m(this),e,...t);return Ab.set(s,e.sort?e.sort():[e]),qr(s)}:Fk().includes(n)?function(...e){return n.apply(_m(this),e),qr(Eb.get(this))}:function(...e){return qr(n.apply(_m(this),e))}}function Wk(n){return typeof n=="function"?zk(n):(n instanceof IDBTransaction&&qk(n),Hk(n,Mk())?new Proxy(n,sd):n)}function qr(n){if(n instanceof IDBRequest)return Ok(n);if(vm.has(n))return vm.get(n);const e=Wk(n);return e!==n&&(vm.set(n,e),lf.set(e,n)),e}const _m=n=>lf.get(n);function Kk(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),l=qr(o);return s&&o.addEventListener("upgradeneeded",u=>{s(qr(o.result),u.oldVersion,u.newVersion,qr(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),r&&u.addEventListener("versionchange",m=>r(m.oldVersion,m.newVersion,m))}).catch(()=>{}),l}const Gk=["get","getKey","getAll","getAllKeys","count"],Qk=["put","add","delete","clear"],Dm=new Map;function ch(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Dm.get(e))return Dm.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=Qk.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Gk.includes(t)))return;const i=async function(o,...l){const u=this.transaction(o,r?"readwrite":"readonly");let m=u.store;return s&&(m=m.index(l.shift())),(await Promise.all([m[t](...l),r&&u.done]))[0]};return Dm.set(e,i),i}$k(n=>({...n,get:(e,t,s)=>ch(e,t)||n.get(e,t,s),has:(e,t)=>!!ch(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Xk(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Xk(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const rd="@firebase/app",uh="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pr=new kb("@firebase/app"),Jk="@firebase/app-compat",Zk="@firebase/analytics-compat",eE="@firebase/analytics",tE="@firebase/app-check-compat",nE="@firebase/app-check",sE="@firebase/auth",rE="@firebase/auth-compat",iE="@firebase/database",oE="@firebase/data-connect",aE="@firebase/database-compat",lE="@firebase/functions",cE="@firebase/functions-compat",uE="@firebase/installations",mE="@firebase/installations-compat",dE="@firebase/messaging",fE="@firebase/messaging-compat",pE="@firebase/performance",hE="@firebase/performance-compat",gE="@firebase/remote-config",yE="@firebase/remote-config-compat",bE="@firebase/storage",NE="@firebase/storage-compat",xE="@firebase/firestore",vE="@firebase/ai",_E="@firebase/firestore-compat",DE="firebase",kE="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const id="[DEFAULT]",EE={[rd]:"fire-core",[Jk]:"fire-core-compat",[eE]:"fire-analytics",[Zk]:"fire-analytics-compat",[nE]:"fire-app-check",[tE]:"fire-app-check-compat",[sE]:"fire-auth",[rE]:"fire-auth-compat",[iE]:"fire-rtdb",[oE]:"fire-data-connect",[aE]:"fire-rtdb-compat",[lE]:"fire-fn",[cE]:"fire-fn-compat",[uE]:"fire-iid",[mE]:"fire-iid-compat",[dE]:"fire-fcm",[fE]:"fire-fcm-compat",[pE]:"fire-perf",[hE]:"fire-perf-compat",[gE]:"fire-rc",[yE]:"fire-rc-compat",[bE]:"fire-gcs",[NE]:"fire-gcs-compat",[xE]:"fire-fst",[_E]:"fire-fst-compat",[vE]:"fire-vertex","fire-js":"fire-js",[DE]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yc=new Map,AE=new Map,od=new Map;function mh(n,e){try{n.container.addComponent(e)}catch(t){pr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cl(n){const e=n.name;if(od.has(e))return pr.debug(`There were multiple attempts to register component ${e}.`),!1;od.set(e,n);for(const t of Yc.values())mh(t,n);for(const t of AE.values())mh(t,n);return!0}function wb(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Vb(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$r=new Db("app","Firebase",wE);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new jo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $r.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb=kE;function Ib(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:id,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw $r.create("bad-app-name",{appName:String(r)});if(t||(t=yb()),!t)throw $r.create("no-options");const i=Yc.get(r);if(i){if(Qc(t,i.options)&&Qc(s,i.config))return i;throw $r.create("duplicate-app",{appName:r})}const o=new Lk(r);for(const u of od.values())o.addComponent(u);const l=new VE(t,s,o);return Yc.set(r,l),l}function CE(n=id){const e=Yc.get(n);if(!e&&n===id&&yb())return Ib();if(!e)throw $r.create("no-app",{appName:n});return e}function zr(n,e,t){let s=EE[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),pr.warn(o.join(" "));return}cl(new jo(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IE="firebase-heartbeat-database",SE=1,ul="firebase-heartbeat-store";let km=null;function Sb(){return km||(km=Kk(IE,SE,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ul)}catch(t){console.warn(t)}}}}).catch(n=>{throw $r.create("idb-open",{originalErrorMessage:n.message})})),km}async function TE(n){try{const t=(await Sb()).transaction(ul),s=await t.objectStore(ul).get(Tb(n));return await t.done,s}catch(e){if(e instanceof zi)pr.warn(e.message);else{const t=$r.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});pr.warn(t.message)}}}async function dh(n,e){try{const s=(await Sb()).transaction(ul,"readwrite");await s.objectStore(ul).put(e,Tb(n)),await s.done}catch(t){if(t instanceof zi)pr.warn(t.message);else{const s=$r.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});pr.warn(s.message)}}}function Tb(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=1024,LE=30;class jE{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new BE(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=fh();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>LE){const o=UE(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){pr.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=fh(),{heartbeatsToSend:s,unsentEntries:r}=RE(this._heartbeatsCache.heartbeats),i=Kc(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return pr.warn(t),""}}}function fh(){return new Date().toISOString().substring(0,10)}function RE(n,e=PE){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),ph(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),ph(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class BE{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _b()?wk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await TE(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return dh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return dh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function ph(n){return Kc(JSON.stringify({version:2,heartbeats:n})).length}function UE(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(n){cl(new jo("platform-logger",e=>new Yk(e),"PRIVATE")),cl(new jo("heartbeat",e=>new jE(e),"PRIVATE")),zr(rd,uh,n),zr(rd,uh,"esm2020"),zr("fire-js","")}HE("");var ME="firebase",FE="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zr(ME,FE,"app");var hh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Wr,Pb;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,N){function V(){}V.prototype=N.prototype,A.F=N.prototype,A.prototype=new V,A.prototype.constructor=A,A.D=function(j,T,S){for(var k=Array(arguments.length-2),Ee=2;Ee<arguments.length;Ee++)k[Ee-2]=arguments[Ee];return N.prototype[T].apply(j,k)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(A,N,V){V||(V=0);const j=Array(16);if(typeof N=="string")for(var T=0;T<16;++T)j[T]=N.charCodeAt(V++)|N.charCodeAt(V++)<<8|N.charCodeAt(V++)<<16|N.charCodeAt(V++)<<24;else for(T=0;T<16;++T)j[T]=N[V++]|N[V++]<<8|N[V++]<<16|N[V++]<<24;N=A.g[0],V=A.g[1],T=A.g[2];let S=A.g[3],k;k=N+(S^V&(T^S))+j[0]+3614090360&4294967295,N=V+(k<<7&4294967295|k>>>25),k=S+(T^N&(V^T))+j[1]+3905402710&4294967295,S=N+(k<<12&4294967295|k>>>20),k=T+(V^S&(N^V))+j[2]+606105819&4294967295,T=S+(k<<17&4294967295|k>>>15),k=V+(N^T&(S^N))+j[3]+3250441966&4294967295,V=T+(k<<22&4294967295|k>>>10),k=N+(S^V&(T^S))+j[4]+4118548399&4294967295,N=V+(k<<7&4294967295|k>>>25),k=S+(T^N&(V^T))+j[5]+1200080426&4294967295,S=N+(k<<12&4294967295|k>>>20),k=T+(V^S&(N^V))+j[6]+2821735955&4294967295,T=S+(k<<17&4294967295|k>>>15),k=V+(N^T&(S^N))+j[7]+4249261313&4294967295,V=T+(k<<22&4294967295|k>>>10),k=N+(S^V&(T^S))+j[8]+1770035416&4294967295,N=V+(k<<7&4294967295|k>>>25),k=S+(T^N&(V^T))+j[9]+2336552879&4294967295,S=N+(k<<12&4294967295|k>>>20),k=T+(V^S&(N^V))+j[10]+4294925233&4294967295,T=S+(k<<17&4294967295|k>>>15),k=V+(N^T&(S^N))+j[11]+2304563134&4294967295,V=T+(k<<22&4294967295|k>>>10),k=N+(S^V&(T^S))+j[12]+1804603682&4294967295,N=V+(k<<7&4294967295|k>>>25),k=S+(T^N&(V^T))+j[13]+4254626195&4294967295,S=N+(k<<12&4294967295|k>>>20),k=T+(V^S&(N^V))+j[14]+2792965006&4294967295,T=S+(k<<17&4294967295|k>>>15),k=V+(N^T&(S^N))+j[15]+1236535329&4294967295,V=T+(k<<22&4294967295|k>>>10),k=N+(T^S&(V^T))+j[1]+4129170786&4294967295,N=V+(k<<5&4294967295|k>>>27),k=S+(V^T&(N^V))+j[6]+3225465664&4294967295,S=N+(k<<9&4294967295|k>>>23),k=T+(N^V&(S^N))+j[11]+643717713&4294967295,T=S+(k<<14&4294967295|k>>>18),k=V+(S^N&(T^S))+j[0]+3921069994&4294967295,V=T+(k<<20&4294967295|k>>>12),k=N+(T^S&(V^T))+j[5]+3593408605&4294967295,N=V+(k<<5&4294967295|k>>>27),k=S+(V^T&(N^V))+j[10]+38016083&4294967295,S=N+(k<<9&4294967295|k>>>23),k=T+(N^V&(S^N))+j[15]+3634488961&4294967295,T=S+(k<<14&4294967295|k>>>18),k=V+(S^N&(T^S))+j[4]+3889429448&4294967295,V=T+(k<<20&4294967295|k>>>12),k=N+(T^S&(V^T))+j[9]+568446438&4294967295,N=V+(k<<5&4294967295|k>>>27),k=S+(V^T&(N^V))+j[14]+3275163606&4294967295,S=N+(k<<9&4294967295|k>>>23),k=T+(N^V&(S^N))+j[3]+4107603335&4294967295,T=S+(k<<14&4294967295|k>>>18),k=V+(S^N&(T^S))+j[8]+1163531501&4294967295,V=T+(k<<20&4294967295|k>>>12),k=N+(T^S&(V^T))+j[13]+2850285829&4294967295,N=V+(k<<5&4294967295|k>>>27),k=S+(V^T&(N^V))+j[2]+4243563512&4294967295,S=N+(k<<9&4294967295|k>>>23),k=T+(N^V&(S^N))+j[7]+1735328473&4294967295,T=S+(k<<14&4294967295|k>>>18),k=V+(S^N&(T^S))+j[12]+2368359562&4294967295,V=T+(k<<20&4294967295|k>>>12),k=N+(V^T^S)+j[5]+4294588738&4294967295,N=V+(k<<4&4294967295|k>>>28),k=S+(N^V^T)+j[8]+2272392833&4294967295,S=N+(k<<11&4294967295|k>>>21),k=T+(S^N^V)+j[11]+1839030562&4294967295,T=S+(k<<16&4294967295|k>>>16),k=V+(T^S^N)+j[14]+4259657740&4294967295,V=T+(k<<23&4294967295|k>>>9),k=N+(V^T^S)+j[1]+2763975236&4294967295,N=V+(k<<4&4294967295|k>>>28),k=S+(N^V^T)+j[4]+1272893353&4294967295,S=N+(k<<11&4294967295|k>>>21),k=T+(S^N^V)+j[7]+4139469664&4294967295,T=S+(k<<16&4294967295|k>>>16),k=V+(T^S^N)+j[10]+3200236656&4294967295,V=T+(k<<23&4294967295|k>>>9),k=N+(V^T^S)+j[13]+681279174&4294967295,N=V+(k<<4&4294967295|k>>>28),k=S+(N^V^T)+j[0]+3936430074&4294967295,S=N+(k<<11&4294967295|k>>>21),k=T+(S^N^V)+j[3]+3572445317&4294967295,T=S+(k<<16&4294967295|k>>>16),k=V+(T^S^N)+j[6]+76029189&4294967295,V=T+(k<<23&4294967295|k>>>9),k=N+(V^T^S)+j[9]+3654602809&4294967295,N=V+(k<<4&4294967295|k>>>28),k=S+(N^V^T)+j[12]+3873151461&4294967295,S=N+(k<<11&4294967295|k>>>21),k=T+(S^N^V)+j[15]+530742520&4294967295,T=S+(k<<16&4294967295|k>>>16),k=V+(T^S^N)+j[2]+3299628645&4294967295,V=T+(k<<23&4294967295|k>>>9),k=N+(T^(V|~S))+j[0]+4096336452&4294967295,N=V+(k<<6&4294967295|k>>>26),k=S+(V^(N|~T))+j[7]+1126891415&4294967295,S=N+(k<<10&4294967295|k>>>22),k=T+(N^(S|~V))+j[14]+2878612391&4294967295,T=S+(k<<15&4294967295|k>>>17),k=V+(S^(T|~N))+j[5]+4237533241&4294967295,V=T+(k<<21&4294967295|k>>>11),k=N+(T^(V|~S))+j[12]+1700485571&4294967295,N=V+(k<<6&4294967295|k>>>26),k=S+(V^(N|~T))+j[3]+2399980690&4294967295,S=N+(k<<10&4294967295|k>>>22),k=T+(N^(S|~V))+j[10]+4293915773&4294967295,T=S+(k<<15&4294967295|k>>>17),k=V+(S^(T|~N))+j[1]+2240044497&4294967295,V=T+(k<<21&4294967295|k>>>11),k=N+(T^(V|~S))+j[8]+1873313359&4294967295,N=V+(k<<6&4294967295|k>>>26),k=S+(V^(N|~T))+j[15]+4264355552&4294967295,S=N+(k<<10&4294967295|k>>>22),k=T+(N^(S|~V))+j[6]+2734768916&4294967295,T=S+(k<<15&4294967295|k>>>17),k=V+(S^(T|~N))+j[13]+1309151649&4294967295,V=T+(k<<21&4294967295|k>>>11),k=N+(T^(V|~S))+j[4]+4149444226&4294967295,N=V+(k<<6&4294967295|k>>>26),k=S+(V^(N|~T))+j[11]+3174756917&4294967295,S=N+(k<<10&4294967295|k>>>22),k=T+(N^(S|~V))+j[2]+718787259&4294967295,T=S+(k<<15&4294967295|k>>>17),k=V+(S^(T|~N))+j[9]+3951481745&4294967295,A.g[0]=A.g[0]+N&4294967295,A.g[1]=A.g[1]+(T+(k<<21&4294967295|k>>>11))&4294967295,A.g[2]=A.g[2]+T&4294967295,A.g[3]=A.g[3]+S&4294967295}s.prototype.v=function(A,N){N===void 0&&(N=A.length);const V=N-this.blockSize,j=this.C;let T=this.h,S=0;for(;S<N;){if(T==0)for(;S<=V;)r(this,A,S),S+=this.blockSize;if(typeof A=="string"){for(;S<N;)if(j[T++]=A.charCodeAt(S++),T==this.blockSize){r(this,j),T=0;break}}else for(;S<N;)if(j[T++]=A[S++],T==this.blockSize){r(this,j),T=0;break}}this.h=T,this.o+=N},s.prototype.A=function(){var A=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);A[0]=128;for(var N=1;N<A.length-8;++N)A[N]=0;N=this.o*8;for(var V=A.length-8;V<A.length;++V)A[V]=N&255,N/=256;for(this.v(A),A=Array(16),N=0,V=0;V<4;++V)for(let j=0;j<32;j+=8)A[N++]=this.g[V]>>>j&255;return A};function i(A,N){var V=l;return Object.prototype.hasOwnProperty.call(V,A)?V[A]:V[A]=N(A)}function o(A,N){this.h=N;const V=[];let j=!0;for(let T=A.length-1;T>=0;T--){const S=A[T]|0;j&&S==N||(V[T]=S,j=!1)}this.g=V}var l={};function u(A){return-128<=A&&A<128?i(A,function(N){return new o([N|0],N<0?-1:0)}):new o([A|0],A<0?-1:0)}function m(A){if(isNaN(A)||!isFinite(A))return f;if(A<0)return w(m(-A));const N=[];let V=1;for(let j=0;A>=V;j++)N[j]=A/V|0,V*=4294967296;return new o(N,0)}function d(A,N){if(A.length==0)throw Error("number format error: empty string");if(N=N||10,N<2||36<N)throw Error("radix out of range: "+N);if(A.charAt(0)=="-")return w(d(A.substring(1),N));if(A.indexOf("-")>=0)throw Error('number format error: interior "-" character');const V=m(Math.pow(N,8));let j=f;for(let S=0;S<A.length;S+=8){var T=Math.min(8,A.length-S);const k=parseInt(A.substring(S,S+T),N);T<8?(T=m(Math.pow(N,T)),j=j.j(T).add(m(k))):(j=j.j(V),j=j.add(m(k)))}return j}var f=u(0),p=u(1),y=u(16777216);n=o.prototype,n.m=function(){if(v(this))return-w(this).m();let A=0,N=1;for(let V=0;V<this.g.length;V++){const j=this.i(V);A+=(j>=0?j:4294967296+j)*N,N*=4294967296}return A},n.toString=function(A){if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(C(this))return"0";if(v(this))return"-"+w(this).toString(A);const N=m(Math.pow(A,6));var V=this;let j="";for(;;){const T=re(V,N).g;V=R(V,T.j(N));let S=((V.g.length>0?V.g[0]:V.h)>>>0).toString(A);if(V=T,C(V))return S+j;for(;S.length<6;)S="0"+S;j=S+j}},n.i=function(A){return A<0?0:A<this.g.length?this.g[A]:this.h};function C(A){if(A.h!=0)return!1;for(let N=0;N<A.g.length;N++)if(A.g[N]!=0)return!1;return!0}function v(A){return A.h==-1}n.l=function(A){return A=R(this,A),v(A)?-1:C(A)?0:1};function w(A){const N=A.g.length,V=[];for(let j=0;j<N;j++)V[j]=~A.g[j];return new o(V,~A.h).add(p)}n.abs=function(){return v(this)?w(this):this},n.add=function(A){const N=Math.max(this.g.length,A.g.length),V=[];let j=0;for(let T=0;T<=N;T++){let S=j+(this.i(T)&65535)+(A.i(T)&65535),k=(S>>>16)+(this.i(T)>>>16)+(A.i(T)>>>16);j=k>>>16,S&=65535,k&=65535,V[T]=k<<16|S}return new o(V,V[V.length-1]&-2147483648?-1:0)};function R(A,N){return A.add(w(N))}n.j=function(A){if(C(this)||C(A))return f;if(v(this))return v(A)?w(this).j(w(A)):w(w(this).j(A));if(v(A))return w(this.j(w(A)));if(this.l(y)<0&&A.l(y)<0)return m(this.m()*A.m());const N=this.g.length+A.g.length,V=[];for(var j=0;j<2*N;j++)V[j]=0;for(j=0;j<this.g.length;j++)for(let T=0;T<A.g.length;T++){const S=this.i(j)>>>16,k=this.i(j)&65535,Ee=A.i(T)>>>16,$e=A.i(T)&65535;V[2*j+2*T]+=k*$e,I(V,2*j+2*T),V[2*j+2*T+1]+=S*$e,I(V,2*j+2*T+1),V[2*j+2*T+1]+=k*Ee,I(V,2*j+2*T+1),V[2*j+2*T+2]+=S*Ee,I(V,2*j+2*T+2)}for(A=0;A<N;A++)V[A]=V[2*A+1]<<16|V[2*A];for(A=N;A<2*N;A++)V[A]=0;return new o(V,0)};function I(A,N){for(;(A[N]&65535)!=A[N];)A[N+1]+=A[N]>>>16,A[N]&=65535,N++}function F(A,N){this.g=A,this.h=N}function re(A,N){if(C(N))throw Error("division by zero");if(C(A))return new F(f,f);if(v(A))return N=re(w(A),N),new F(w(N.g),w(N.h));if(v(N))return N=re(A,w(N)),new F(w(N.g),N.h);if(A.g.length>30){if(v(A)||v(N))throw Error("slowDivide_ only works with positive integers.");for(var V=p,j=N;j.l(A)<=0;)V=ee(V),j=ee(j);var T=M(V,1),S=M(j,1);for(j=M(j,2),V=M(V,2);!C(j);){var k=S.add(j);k.l(A)<=0&&(T=T.add(V),S=k),j=M(j,1),V=M(V,1)}return N=R(A,T.j(N)),new F(T,N)}for(T=f;A.l(N)>=0;){for(V=Math.max(1,Math.floor(A.m()/N.m())),j=Math.ceil(Math.log(V)/Math.LN2),j=j<=48?1:Math.pow(2,j-48),S=m(V),k=S.j(N);v(k)||k.l(A)>0;)V-=j,S=m(V),k=S.j(N);C(S)&&(S=p),T=T.add(S),A=R(A,k)}return new F(T,A)}n.B=function(A){return re(this,A).h},n.and=function(A){const N=Math.max(this.g.length,A.g.length),V=[];for(let j=0;j<N;j++)V[j]=this.i(j)&A.i(j);return new o(V,this.h&A.h)},n.or=function(A){const N=Math.max(this.g.length,A.g.length),V=[];for(let j=0;j<N;j++)V[j]=this.i(j)|A.i(j);return new o(V,this.h|A.h)},n.xor=function(A){const N=Math.max(this.g.length,A.g.length),V=[];for(let j=0;j<N;j++)V[j]=this.i(j)^A.i(j);return new o(V,this.h^A.h)};function ee(A){const N=A.g.length+1,V=[];for(let j=0;j<N;j++)V[j]=A.i(j)<<1|A.i(j-1)>>>31;return new o(V,A.h)}function M(A,N){const V=N>>5;N%=32;const j=A.g.length-V,T=[];for(let S=0;S<j;S++)T[S]=N>0?A.i(S+V)>>>N|A.i(S+V+1)<<32-N:A.i(S+V);return new o(T,A.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Pb=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=m,o.fromString=d,Wr=o}).apply(typeof hh<"u"?hh:typeof self<"u"?self:typeof window<"u"?window:{});var nc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Lb,Fa,jb,Cc,ad,Rb,Bb,Ub;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof nc=="object"&&nc];for(var h=0;h<c.length;++h){var g=c[h];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var s=t(this);function r(c,h){if(h)e:{var g=s;c=c.split(".");for(var D=0;D<c.length-1;D++){var z=c[D];if(!(z in g))break e;g=g[z]}c=c[c.length-1],D=g[c],h=h(D),h!=D&&h!=null&&e(g,c,{configurable:!0,writable:!0,value:h})}}r("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(c){return c||function(h){var g=[],D;for(D in h)Object.prototype.hasOwnProperty.call(h,D)&&g.push([D,h[D]]);return g}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function l(c){var h=typeof c;return h=="object"&&c!=null||h=="function"}function u(c,h,g){return c.call.apply(c.bind,arguments)}function m(c,h,g){return m=u,m.apply(null,arguments)}function d(c,h){var g=Array.prototype.slice.call(arguments,1);return function(){var D=g.slice();return D.push.apply(D,arguments),c.apply(this,D)}}function f(c,h){function g(){}g.prototype=h.prototype,c.Z=h.prototype,c.prototype=new g,c.prototype.constructor=c,c.Ob=function(D,z,J){for(var De=Array(arguments.length-2),pt=2;pt<arguments.length;pt++)De[pt-2]=arguments[pt];return h.prototype[z].apply(D,De)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function y(c){const h=c.length;if(h>0){const g=Array(h);for(let D=0;D<h;D++)g[D]=c[D];return g}return[]}function C(c,h){for(let D=1;D<arguments.length;D++){const z=arguments[D];var g=typeof z;if(g=g!="object"?g:z?Array.isArray(z)?"array":g:"null",g=="array"||g=="object"&&typeof z.length=="number"){g=c.length||0;const J=z.length||0;c.length=g+J;for(let De=0;De<J;De++)c[g+De]=z[De]}else c.push(z)}}class v{constructor(h,g){this.i=h,this.j=g,this.h=0,this.g=null}get(){let h;return this.h>0?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function w(c){o.setTimeout(()=>{throw c},0)}function R(){var c=A;let h=null;return c.g&&(h=c.g,c.g=c.g.next,c.g||(c.h=null),h.next=null),h}class I{constructor(){this.h=this.g=null}add(h,g){const D=F.get();D.set(h,g),this.h?this.h.next=D:this.g=D,this.h=D}}var F=new v(()=>new re,c=>c.reset());class re{constructor(){this.next=this.g=this.h=null}set(h,g){this.h=h,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let ee,M=!1,A=new I,N=()=>{const c=Promise.resolve(void 0);ee=()=>{c.then(V)}};function V(){for(var c;c=R();){try{c.h.call(c.g)}catch(g){w(g)}var h=F;h.j(c),h.h<100&&(h.h++,c.next=h.g,h.g=c)}M=!1}function j(){this.u=this.u,this.C=this.C}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(c,h){this.type=c,this.g=this.target=h,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,h=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const g=()=>{};o.addEventListener("test",g,h),o.removeEventListener("test",g,h)}catch{}return c}();function k(c){return/^[\s\xa0]*$/.test(c)}function Ee(c,h){T.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,h)}f(Ee,T),Ee.prototype.init=function(c,h){const g=this.type=c.type,D=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=h,h=c.relatedTarget,h||(g=="mouseover"?h=c.fromElement:g=="mouseout"&&(h=c.toElement)),this.relatedTarget=h,D?(this.clientX=D.clientX!==void 0?D.clientX:D.pageX,this.clientY=D.clientY!==void 0?D.clientY:D.pageY,this.screenX=D.screenX||0,this.screenY=D.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&Ee.Z.h.call(this)},Ee.prototype.h=function(){Ee.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var $e="closure_listenable_"+(Math.random()*1e6|0),ge=0;function He(c,h,g,D,z){this.listener=c,this.proxy=null,this.src=h,this.type=g,this.capture=!!D,this.ha=z,this.key=++ge,this.da=this.fa=!1}function ht(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Kt(c,h,g){for(const D in c)h.call(g,c[D],D,c)}function qt(c,h){for(const g in c)h.call(void 0,c[g],g,c)}function le(c){const h={};for(const g in c)h[g]=c[g];return h}const ze="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function de(c,h){let g,D;for(let z=1;z<arguments.length;z++){D=arguments[z];for(g in D)c[g]=D[g];for(let J=0;J<ze.length;J++)g=ze[J],Object.prototype.hasOwnProperty.call(D,g)&&(c[g]=D[g])}}function Be(c){this.src=c,this.g={},this.h=0}Be.prototype.add=function(c,h,g,D,z){const J=c.toString();c=this.g[J],c||(c=this.g[J]=[],this.h++);const De=vt(c,h,D,z);return De>-1?(h=c[De],g||(h.fa=!1)):(h=new He(h,this.src,J,!!D,z),h.fa=g,c.push(h)),h};function Xe(c,h){const g=h.type;if(g in c.g){var D=c.g[g],z=Array.prototype.indexOf.call(D,h,void 0),J;(J=z>=0)&&Array.prototype.splice.call(D,z,1),J&&(ht(h),c.g[g].length==0&&(delete c.g[g],c.h--))}}function vt(c,h,g,D){for(let z=0;z<c.length;++z){const J=c[z];if(!J.da&&J.listener==h&&J.capture==!!g&&J.ha==D)return z}return-1}var lt="closure_lm_"+(Math.random()*1e6|0),St={};function at(c,h,g,D,z){if(Array.isArray(h)){for(let J=0;J<h.length;J++)at(c,h[J],g,D,z);return null}return g=Gt(g),c&&c[$e]?c.J(h,g,l(D)?!!D.capture:!1,z):ft(c,h,g,!1,D,z)}function ft(c,h,g,D,z,J){if(!h)throw Error("Invalid event type");const De=l(z)?!!z.capture:!!z;let pt=Je(c);if(pt||(c[lt]=pt=new Be(c)),g=pt.add(h,g,D,De,J),g.proxy)return g;if(D=Nn(),g.proxy=D,D.src=c,D.listener=g,c.addEventListener)S||(z=De),z===void 0&&(z=!1),c.addEventListener(h.toString(),D,z);else if(c.attachEvent)c.attachEvent(Fe(h.toString()),D);else if(c.addListener&&c.removeListener)c.addListener(D);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Nn(){function c(g){return h.call(c.src,c.listener,g)}const h=Se;return c}function K(c,h,g,D,z){if(Array.isArray(h))for(var J=0;J<h.length;J++)K(c,h[J],g,D,z);else D=l(D)?!!D.capture:!!D,g=Gt(g),c&&c[$e]?(c=c.i,J=String(h).toString(),J in c.g&&(h=c.g[J],g=vt(h,g,D,z),g>-1&&(ht(h[g]),Array.prototype.splice.call(h,g,1),h.length==0&&(delete c.g[J],c.h--)))):c&&(c=Je(c))&&(h=c.g[h.toString()],c=-1,h&&(c=vt(h,g,D,z)),(g=c>-1?h[c]:null)&&Le(g))}function Le(c){if(typeof c!="number"&&c&&!c.da){var h=c.src;if(h&&h[$e])Xe(h.i,c);else{var g=c.type,D=c.proxy;h.removeEventListener?h.removeEventListener(g,D,c.capture):h.detachEvent?h.detachEvent(Fe(g),D):h.addListener&&h.removeListener&&h.removeListener(D),(g=Je(h))?(Xe(g,c),g.h==0&&(g.src=null,h[lt]=null)):ht(c)}}}function Fe(c){return c in St?St[c]:St[c]="on"+c}function Se(c,h){if(c.da)c=!0;else{h=new Ee(h,this);const g=c.listener,D=c.ha||c.src;c.fa&&Le(c),c=g.call(D,h)}return c}function Je(c){return c=c[lt],c instanceof Be?c:null}var Tt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Gt(c){return typeof c=="function"?c:(c[Tt]||(c[Tt]=function(h){return c.handleEvent(h)}),c[Tt])}function dt(){j.call(this),this.i=new Be(this),this.M=this,this.G=null}f(dt,j),dt.prototype[$e]=!0,dt.prototype.removeEventListener=function(c,h,g,D){K(this,c,h,g,D)};function P(c,h){var g,D=c.G;if(D)for(g=[];D;D=D.G)g.push(D);if(c=c.M,D=h.type||h,typeof h=="string")h=new T(h,c);else if(h instanceof T)h.target=h.target||c;else{var z=h;h=new T(D,c),de(h,z)}z=!0;let J,De;if(g)for(De=g.length-1;De>=0;De--)J=h.g=g[De],z=q(J,D,!0,h)&&z;if(J=h.g=c,z=q(J,D,!0,h)&&z,z=q(J,D,!1,h)&&z,g)for(De=0;De<g.length;De++)J=h.g=g[De],z=q(J,D,!1,h)&&z}dt.prototype.N=function(){if(dt.Z.N.call(this),this.i){var c=this.i;for(const h in c.g){const g=c.g[h];for(let D=0;D<g.length;D++)ht(g[D]);delete c.g[h],c.h--}}this.G=null},dt.prototype.J=function(c,h,g,D){return this.i.add(String(c),h,!1,g,D)},dt.prototype.K=function(c,h,g,D){return this.i.add(String(c),h,!0,g,D)};function q(c,h,g,D){if(h=c.i.g[String(h)],!h)return!0;h=h.concat();let z=!0;for(let J=0;J<h.length;++J){const De=h[J];if(De&&!De.da&&De.capture==g){const pt=De.listener,Ln=De.ha||De.src;De.fa&&Xe(c.i,De),z=pt.call(Ln,D)!==!1&&z}}return z&&!D.defaultPrevented}function te(c,h){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=m(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(h)>2147483647?-1:o.setTimeout(c,h||0)}function ve(c){c.g=te(()=>{c.g=null,c.i&&(c.i=!1,ve(c))},c.l);const h=c.h;c.h=null,c.m.apply(null,h)}class ue extends j{constructor(h,g){super(),this.m=h,this.l=g,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:ve(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fe(c){j.call(this),this.h=c,this.g={}}f(fe,j);var Ie=[];function We(c){Kt(c.g,function(h,g){this.g.hasOwnProperty(g)&&Le(h)},c),c.g={}}fe.prototype.N=function(){fe.Z.N.call(this),We(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var st=o.JSON.stringify,we=o.JSON.parse,$n=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function Ht(){}function ne(){}var Ze={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function O(){T.call(this,"d")}f(O,T);function _e(){T.call(this,"c")}f(_e,T);var ke={},je=null;function me(){return je=je||new dt}ke.Ia="serverreachability";function kt(c){T.call(this,ke.Ia,c)}f(kt,T);function xt(c){const h=me();P(h,new kt(h))}ke.STAT_EVENT="statevent";function tn(c,h){T.call(this,ke.STAT_EVENT,c),this.stat=h}f(tn,T);function At(c){const h=me();P(h,new tn(h,c))}ke.Ja="timingevent";function xn(c,h){T.call(this,ke.Ja,c),this.size=h}f(xn,T);function cn(c,h){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},h)}function Hn(){this.g=!0}Hn.prototype.ua=function(){this.g=!1};function Ds(c,h,g,D,z,J){c.info(function(){if(c.g)if(J){var De="",pt=J.split("&");for(let Zt=0;Zt<pt.length;Zt++){var Ln=pt[Zt].split("=");if(Ln.length>1){const Mn=Ln[0];Ln=Ln[1];const qs=Mn.split("_");De=qs.length>=2&&qs[1]=="type"?De+(Mn+"="+Ln+"&"):De+(Mn+"=redacted&")}}}else De=null;else De=J;return"XMLHTTP REQ ("+D+") [attempt "+z+"]: "+h+`
`+g+`
`+De})}function ss(c,h,g,D,z,J,De){c.info(function(){return"XMLHTTP RESP ("+D+") [ attempt "+z+"]: "+h+`
`+g+`
`+J+" "+De})}function ks(c,h,g,D){c.info(function(){return"XMLHTTP TEXT ("+h+"): "+Fs(c,g)+(D?" "+D:"")})}function fi(c,h){c.info(function(){return"TIMEOUT: "+h})}Hn.prototype.info=function(){};function Fs(c,h){if(!c.g)return h;if(!h)return null;try{const J=JSON.parse(h);if(J){for(c=0;c<J.length;c++)if(Array.isArray(J[c])){var g=J[c];if(!(g.length<2)){var D=g[1];if(Array.isArray(D)&&!(D.length<1)){var z=D[0];if(z!="noop"&&z!="stop"&&z!="close")for(let De=1;De<D.length;De++)D[De]=""}}}}return st(J)}catch{return h}}var as={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},_={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},G;function B(){}f(B,Ht),B.prototype.g=function(){return new XMLHttpRequest},G=new B;function x(c){return encodeURIComponent(String(c))}function L(c){var h=1;c=c.split(":");const g=[];for(;h>0&&c.length;)g.push(c.shift()),h--;return c.length&&g.push(c.join(":")),g}function U(c,h,g,D){this.j=c,this.i=h,this.l=g,this.S=D||1,this.V=new fe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new X}function X(){this.i=null,this.g="",this.h=!1}var Q={},Z={};function ie(c,h,g){c.M=1,c.A=Xi(nn(h)),c.u=g,c.R=!0,Ce(c,null)}function Ce(c,h){c.F=Date.now(),Qe(c),c.B=nn(c.A);var g=c.B,D=c.S;Array.isArray(D)||(D=[String(D)]),ce(g.i,"t",D),c.C=0,g=c.j.L,c.h=new X,c.g=Mp(c.j,g?h:null,!c.u),c.P>0&&(c.O=new ue(m(c.Y,c,c.g),c.P)),h=c.V,g=c.g,D=c.ba;var z="readystatechange";Array.isArray(z)||(z&&(Ie[0]=z.toString()),z=Ie);for(let J=0;J<z.length;J++){const De=at(g,z[J],D||h.handleEvent,!1,h.h||h);if(!De)break;h.g[De.key]=De}h=c.J?le(c.J):{},c.u?(c.v||(c.v="POST"),h["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,h)):(c.v="GET",c.g.ea(c.B,c.v,null,h)),xt(),Ds(c.i,c.v,c.B,c.l,c.S,c.u)}U.prototype.ba=function(c){c=c.target;const h=this.O;h&&Is(c)==3?h.j():this.Y(c)},U.prototype.Y=function(c){try{if(c==this.g)e:{const pt=Is(this.g),Ln=this.g.ya(),Zt=this.g.ca();if(!(pt<3)&&(pt!=3||this.g&&(this.h.h||this.g.la()||Cp(this.g)))){this.K||pt!=4||Ln==7||(Ln==8||Zt<=0?xt(3):xt(2)),Qt(this);var h=this.g.ca();this.X=h;var g=et(this);if(this.o=h==200,ss(this.i,this.v,this.B,this.l,this.S,pt,h),this.o){if(this.U&&!this.L){t:{if(this.g){var D,z=this.g;if((D=z.g?z.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(D)){var J=D;break t}}J=null}if(c=J)ks(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,zn(this,c);else{this.o=!1,this.m=3,At(12),Bt(this),Mt(this);break e}}if(this.R){c=!0;let Mn;for(;!this.K&&this.C<g.length;)if(Mn=he(this,g),Mn==Z){pt==4&&(this.m=4,At(14),c=!1),ks(this.i,this.l,null,"[Incomplete Response]");break}else if(Mn==Q){this.m=4,At(15),ks(this.i,this.l,g,"[Invalid Chunk]"),c=!1;break}else ks(this.i,this.l,Mn,null),zn(this,Mn);if(Oe(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),pt!=4||g.length!=0||this.h.h||(this.m=1,At(16),c=!1),this.o=this.o&&c,!c)ks(this.i,this.l,g,"[Invalid Chunked Response]"),Bt(this),Mt(this);else if(g.length>0&&!this.W){this.W=!0;var De=this.j;De.g==this&&De.aa&&!De.P&&(De.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),fm(De),De.P=!0,At(11))}}else ks(this.i,this.l,g,null),zn(this,g);pt==4&&Bt(this),this.o&&!this.K&&(pt==4?Rp(this.j,this):(this.o=!1,Qe(this)))}else Hv(this.g),h==400&&g.indexOf("Unknown SID")>0?(this.m=3,At(12)):(this.m=0,At(13)),Bt(this),Mt(this)}}}catch{}finally{}};function et(c){if(!Oe(c))return c.g.la();const h=Cp(c.g);if(h==="")return"";let g="";const D=h.length,z=Is(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return Bt(c),Mt(c),"";c.h.i=new o.TextDecoder}for(let J=0;J<D;J++)c.h.h=!0,g+=c.h.i.decode(h[J],{stream:!(z&&J==D-1)});return h.length=0,c.h.g+=g,c.C=0,c.h.g}function Oe(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function he(c,h){var g=c.C,D=h.indexOf(`
`,g);return D==-1?Z:(g=Number(h.substring(g,D)),isNaN(g)?Q:(D+=1,D+g>h.length?Z:(h=h.slice(D,D+g),c.C=D+g,h)))}U.prototype.cancel=function(){this.K=!0,Bt(this)};function Qe(c){c.T=Date.now()+c.H,fn(c,c.H)}function fn(c,h){if(c.D!=null)throw Error("WatchDog timer not null");c.D=cn(m(c.aa,c),h)}function Qt(c){c.D&&(o.clearTimeout(c.D),c.D=null)}U.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(fi(this.i,this.B),this.M!=2&&(xt(),At(17)),Bt(this),this.m=2,Mt(this)):fn(this,this.T-c)};function Mt(c){c.j.I==0||c.K||Rp(c.j,c)}function Bt(c){Qt(c);var h=c.O;h&&typeof h.dispose=="function"&&h.dispose(),c.O=null,We(c.V),c.g&&(h=c.g,c.g=null,h.abort(),h.dispose())}function zn(c,h){try{var g=c.j;if(g.I!=0&&(g.g==c||tt(g.h,c))){if(!c.L&&tt(g.h,c)&&g.I==3){try{var D=g.Ba.g.parse(h)}catch{D=null}if(Array.isArray(D)&&D.length==3){var z=D;if(z[0]==0){e:if(!g.v){if(g.g)if(g.g.F+3e3<c.F)Yl(g),Gl(g);else break e;dm(g),At(18)}}else g.xa=z[1],0<g.xa-g.K&&z[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=cn(m(g.Va,g),6e3));Ve(g.h)<=1&&g.ta&&(g.ta=void 0)}else pi(g,11)}else if((c.L||g.g==c)&&Yl(g),!k(h))for(z=g.Ba.g.parse(h),h=0;h<z.length;h++){let Zt=z[h];const Mn=Zt[0];if(!(Mn<=g.K))if(g.K=Mn,Zt=Zt[1],g.I==2)if(Zt[0]=="c"){g.M=Zt[1],g.ba=Zt[2];const qs=Zt[3];qs!=null&&(g.ka=qs,g.j.info("VER="+g.ka));const hi=Zt[4];hi!=null&&(g.za=hi,g.j.info("SVER="+g.za));const Er=Zt[5];Er!=null&&typeof Er=="number"&&Er>0&&(D=1.5*Er,g.O=D,g.j.info("backChannelRequestTimeoutMs_="+D)),D=g;const Ar=c.g;if(Ar){const Jl=Ar.g?Ar.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Jl){var J=D.h;J.g||Jl.indexOf("spdy")==-1&&Jl.indexOf("quic")==-1&&Jl.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(rt(J,J.h),J.h=null))}if(D.G){const pm=Ar.g?Ar.g.getResponseHeader("X-HTTP-Session-Id"):null;pm&&(D.wa=pm,Nt(D.J,D.G,pm))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-c.F,g.j.info("Handshake RTT: "+g.T+"ms")),D=g;var De=c;if(D.na=Hp(D,D.L?D.ba:null,D.W),De.L){it(D.h,De);var pt=De,Ln=D.O;Ln&&(pt.H=Ln),pt.D&&(Qt(pt),Qe(pt)),D.g=De}else Lp(D);g.i.length>0&&Ql(g)}else Zt[0]!="stop"&&Zt[0]!="close"||pi(g,7);else g.I==3&&(Zt[0]=="stop"||Zt[0]=="close"?Zt[0]=="stop"?pi(g,7):mm(g):Zt[0]!="noop"&&g.l&&g.l.qa(Zt),g.A=0)}}xt(4)}catch{}}var Qn=class{constructor(c,h){this.g=c,this.map=h}};function Yt(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ye(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Ve(c){return c.h?1:c.g?c.g.size:0}function tt(c,h){return c.h?c.h==h:c.g?c.g.has(h):!1}function rt(c,h){c.g?c.g.add(h):c.h=h}function it(c,h){c.h&&c.h==h?c.h=null:c.g&&c.g.has(h)&&c.g.delete(h)}Yt.prototype.cancel=function(){if(this.i=qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function qe(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let h=c.i;for(const g of c.g.values())h=h.concat(g.G);return h}return y(c.i)}var ot=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Pt(c,h){if(c){c=c.split("&");for(let g=0;g<c.length;g++){const D=c[g].indexOf("=");let z,J=null;D>=0?(z=c[g].substring(0,D),J=c[g].substring(D+1)):z=c[g],h(z,J?decodeURIComponent(J.replace(/\+/g," ")):"")}}}function un(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let h;c instanceof un?(this.l=c.l,Vs(this,c.j),this.o=c.o,this.g=c.g,vr(this,c.u),this.h=c.h,pa(this,Ne(c.i)),this.m=c.m):c&&(h=String(c).match(ot))?(this.l=!1,Vs(this,h[1]||"",!0),this.o=_r(h[2]||""),this.g=_r(h[3]||"",!0),vr(this,h[4]),this.h=_r(h[5]||"",!0),pa(this,h[6]||"",!0),this.m=_r(h[7]||"")):(this.l=!1,this.i=new kr(null,this.l))}un.prototype.toString=function(){const c=[];var h=this.j;h&&c.push(Dr(h,ha,!0),":");var g=this.g;return(g||h=="file")&&(c.push("//"),(h=this.o)&&c.push(Dr(h,ha,!0),"@"),c.push(x(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&c.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(Dr(g,g.charAt(0)=="/"?am:Kl,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",Dr(g,cm)),c.join("")},un.prototype.resolve=function(c){const h=nn(this);let g=!!c.j;g?Vs(h,c.j):g=!!c.o,g?h.o=c.o:g=!!c.g,g?h.g=c.g:g=c.u!=null;var D=c.h;if(g)vr(h,c.u);else if(g=!!c.h){if(D.charAt(0)!="/")if(this.g&&!this.h)D="/"+D;else{var z=h.h.lastIndexOf("/");z!=-1&&(D=h.h.slice(0,z+1)+D)}if(z=D,z==".."||z==".")D="";else if(z.indexOf("./")!=-1||z.indexOf("/.")!=-1){D=z.lastIndexOf("/",0)==0,z=z.split("/");const J=[];for(let De=0;De<z.length;){const pt=z[De++];pt=="."?D&&De==z.length&&J.push(""):pt==".."?((J.length>1||J.length==1&&J[0]!="")&&J.pop(),D&&De==z.length&&J.push("")):(J.push(pt),D=!0)}D=J.join("/")}else D=z}return g?h.h=D:g=c.i.toString()!=="",g?pa(h,Ne(c.i)):g=!!c.m,g&&(h.m=c.m),h};function nn(c){return new un(c)}function Vs(c,h,g){c.j=g?_r(h,!0):h,c.j&&(c.j=c.j.replace(/:$/,""))}function vr(c,h){if(h){if(h=Number(h),isNaN(h)||h<0)throw Error("Bad port number "+h);c.u=h}else c.u=null}function pa(c,h,g){h instanceof kr?(c.i=h,ut(c.i,c.l)):(g||(h=Dr(h,lm)),c.i=new kr(h,c.l))}function Nt(c,h,g){c.i.set(h,g)}function Xi(c){return Nt(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function _r(c,h){return c?h?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Dr(c,h,g){return typeof c=="string"?(c=encodeURI(c).replace(h,Wl),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function Wl(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var ha=/[#\/\?@]/g,Kl=/[#\?:]/g,am=/[#\?]/g,lm=/[#\?@]/g,cm=/#/g;function kr(c,h){this.h=this.g=null,this.i=c||null,this.j=!!h}function b(c){c.g||(c.g=new Map,c.h=0,c.i&&Pt(c.i,function(h,g){c.add(decodeURIComponent(h.replace(/\+/g," ")),g)}))}n=kr.prototype,n.add=function(c,h){b(this),this.i=null,c=ye(this,c);let g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(h),this.h+=1,this};function H(c,h){b(c),h=ye(c,h),c.g.has(h)&&(c.i=null,c.h-=c.g.get(h).length,c.g.delete(h))}function Y(c,h){return b(c),h=ye(c,h),c.g.has(h)}n.forEach=function(c,h){b(this),this.g.forEach(function(g,D){g.forEach(function(z){c.call(h,z,D,this)},this)},this)};function W(c,h){b(c);let g=[];if(typeof h=="string")Y(c,h)&&(g=g.concat(c.g.get(ye(c,h))));else for(c=Array.from(c.g.values()),h=0;h<c.length;h++)g=g.concat(c[h]);return g}n.set=function(c,h){return b(this),this.i=null,c=ye(this,c),Y(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[h]),this.h+=1,this},n.get=function(c,h){return c?(c=W(this,c),c.length>0?String(c[0]):h):h};function ce(c,h,g){H(c,h),g.length>0&&(c.i=null,c.g.set(ye(c,h),y(g)),c.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],h=Array.from(this.g.keys());for(let D=0;D<h.length;D++){var g=h[D];const z=x(g);g=W(this,g);for(let J=0;J<g.length;J++){let De=z;g[J]!==""&&(De+="="+x(g[J])),c.push(De)}}return this.i=c.join("&")};function Ne(c){const h=new kr;return h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),h}function ye(c,h){return h=String(h),c.j&&(h=h.toLowerCase()),h}function ut(c,h){h&&!c.j&&(b(c),c.i=null,c.g.forEach(function(g,D){const z=D.toLowerCase();D!=z&&(H(this,D),ce(this,z,g))},c)),c.j=h}function gt(c,h){const g=new Hn;if(o.Image){const D=new Image;D.onload=d(Lt,g,"TestLoadImage: loaded",!0,h,D),D.onerror=d(Lt,g,"TestLoadImage: error",!1,h,D),D.onabort=d(Lt,g,"TestLoadImage: abort",!1,h,D),D.ontimeout=d(Lt,g,"TestLoadImage: timeout",!1,h,D),o.setTimeout(function(){D.ontimeout&&D.ontimeout()},1e4),D.src=c}else h(!1)}function kn(c,h){const g=new Hn,D=new AbortController,z=setTimeout(()=>{D.abort(),Lt(g,"TestPingServer: timeout",!1,h)},1e4);fetch(c,{signal:D.signal}).then(J=>{clearTimeout(z),J.ok?Lt(g,"TestPingServer: ok",!0,h):Lt(g,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(z),Lt(g,"TestPingServer: error",!1,h)})}function Lt(c,h,g,D,z){try{z&&(z.onload=null,z.onerror=null,z.onabort=null,z.ontimeout=null),D(g)}catch{}}function jt(){this.g=new $n}function mn(c){this.i=c.Sb||null,this.h=c.ab||!1}f(mn,Ht),mn.prototype.g=function(){return new Pn(this.i,this.h)};function Pn(c,h){dt.call(this),this.H=c,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(Pn,dt),n=Pn.prototype,n.open=function(c,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=h,this.readyState=1,vn(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const h={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(h.body=c),(this.H||o).fetch(new Request(this.D,h)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,on(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,vn(this)),this.g&&(this.readyState=3,vn(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;wt(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function wt(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var h=c.value?c.value:new Uint8Array(0);(h=this.B.decode(h,{stream:!c.done}))&&(this.response=this.responseText+=h)}c.done?on(this):vn(this),this.readyState==3&&wt(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,on(this))},n.Na=function(c){this.g&&(this.response=c,on(this))},n.ga=function(){this.g&&on(this)};function on(c){c.readyState=4,c.l=null,c.j=null,c.B=null,vn(c)}n.setRequestHeader=function(c,h){this.A.append(c,h)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],h=this.h.entries();for(var g=h.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=h.next();return c.join(`\r
`)};function vn(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Pn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Xt(c){let h="";return Kt(c,function(g,D){h+=D,h+=":",h+=g,h+=`\r
`}),h}function Jt(c,h,g){e:{for(D in g){var D=!1;break e}D=!0}D||(g=Xt(g),typeof c=="string"?g!=null&&x(g):Nt(c,h,g))}function yt(c){dt.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(yt,dt);var rn=/^https?$/i,Cs=["POST","PUT"];n=yt.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,h,g,D){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);h=h?h.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():G.g(),this.g.onreadystatechange=p(m(this.Ca,this));try{this.B=!0,this.g.open(h,String(c),!0),this.B=!1}catch(J){Os(this,J);return}if(c=g||"",g=new Map(this.headers),D)if(Object.getPrototypeOf(D)===Object.prototype)for(var z in D)g.set(z,D[z]);else if(typeof D.keys=="function"&&typeof D.get=="function")for(const J of D.keys())g.set(J,D.get(J));else throw Error("Unknown input type for opt_headers: "+String(D));D=Array.from(g.keys()).find(J=>J.toLowerCase()=="content-type"),z=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(Cs,h,void 0)>=0)||D||z||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,De]of g)this.g.setRequestHeader(J,De);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(J){Os(this,J)}};function Os(c,h){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=h,c.o=5,Ji(c),Zi(c)}function Ji(c){c.A||(c.A=!0,P(c,"complete"),P(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,P(this,"complete"),P(this,"abort"),Zi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zi(this,!0)),yt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?um(this):this.Xa())},n.Xa=function(){um(this)};function um(c){if(c.h&&typeof i<"u"){if(c.v&&Is(c)==4)setTimeout(c.Ca.bind(c),0);else if(P(c,"readystatechange"),Is(c)==4){c.h=!1;try{const J=c.ca();e:switch(J){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var g;if(!(g=h)){var D;if(D=J===0){let De=String(c.D).match(ot)[1]||null;!De&&o.self&&o.self.location&&(De=o.self.location.protocol.slice(0,-1)),D=!rn.test(De?De.toLowerCase():"")}g=D}if(g)P(c,"complete"),P(c,"success");else{c.o=6;try{var z=Is(c)>2?c.g.statusText:""}catch{z=""}c.l=z+" ["+c.ca()+"]",Ji(c)}}finally{Zi(c)}}}}function Zi(c,h){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const g=c.g;c.g=null,h||P(c,"ready");try{g.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Is(c){return c.g?c.g.readyState:0}n.ca=function(){try{return Is(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var h=this.g.responseText;return c&&h.indexOf(c)==0&&(h=h.substring(c.length)),we(h)}};function Cp(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function Hv(c){const h={};c=(c.g&&Is(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let D=0;D<c.length;D++){if(k(c[D]))continue;var g=L(c[D]);const z=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const J=h[z]||[];h[z]=J,J.push(g)}qt(h,function(D){return D.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ga(c,h,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||h}function Ip(c){this.za=0,this.i=[],this.j=new Hn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ga("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ga("baseRetryDelayMs",5e3,c),this.Za=ga("retryDelaySeedMs",1e4,c),this.Ta=ga("forwardChannelMaxRetries",2,c),this.va=ga("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Yt(c&&c.concurrentRequestLimit),this.Ba=new jt,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ip.prototype,n.ka=8,n.I=1,n.connect=function(c,h,g,D){At(0),this.W=c,this.H=h||{},g&&D!==void 0&&(this.H.OSID=g,this.H.OAID=D),this.F=this.X,this.J=Hp(this,null,this.W),Ql(this)};function mm(c){if(Sp(c),c.I==3){var h=c.V++,g=nn(c.J);if(Nt(g,"SID",c.M),Nt(g,"RID",h),Nt(g,"TYPE","terminate"),ya(c,g),h=new U(c,c.j,h),h.M=2,h.A=Xi(nn(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(h.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=h.A,g=!0),g||(h.g=Mp(h.j,null),h.g.ea(h.A)),h.F=Date.now(),Qe(h)}Up(c)}function Gl(c){c.g&&(fm(c),c.g.cancel(),c.g=null)}function Sp(c){Gl(c),c.v&&(o.clearTimeout(c.v),c.v=null),Yl(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function Ql(c){if(!Ye(c.h)&&!c.m){c.m=!0;var h=c.Ea;ee||N(),M||(ee(),M=!0),A.add(h,c),c.D=0}}function Mv(c,h){return Ve(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=h.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=cn(m(c.Ea,c,h),Bp(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const z=new U(this,this.j,c);let J=this.o;if(this.U&&(J?(J=le(J),de(J,this.U)):J=this.U),this.u!==null||this.R||(z.J=J,J=null),this.S)e:{for(var h=0,g=0;g<this.i.length;g++){t:{var D=this.i[g];if("__data__"in D.map&&(D=D.map.__data__,typeof D=="string")){D=D.length;break t}D=void 0}if(D===void 0)break;if(h+=D,h>4096){h=g;break e}if(h===4096||g===this.i.length-1){h=g+1;break e}}h=1e3}else h=1e3;h=Pp(this,z,h),g=nn(this.J),Nt(g,"RID",c),Nt(g,"CVER",22),this.G&&Nt(g,"X-HTTP-Session-Id",this.G),ya(this,g),J&&(this.R?h="headers="+x(Xt(J))+"&"+h:this.u&&Jt(g,this.u,J)),rt(this.h,z),this.Ra&&Nt(g,"TYPE","init"),this.S?(Nt(g,"$req",h),Nt(g,"SID","null"),z.U=!0,ie(z,g,null)):ie(z,g,h),this.I=2}}else this.I==3&&(c?Tp(this,c):this.i.length==0||Ye(this.h)||Tp(this))};function Tp(c,h){var g;h?g=h.l:g=c.V++;const D=nn(c.J);Nt(D,"SID",c.M),Nt(D,"RID",g),Nt(D,"AID",c.K),ya(c,D),c.u&&c.o&&Jt(D,c.u,c.o),g=new U(c,c.j,g,c.D+1),c.u===null&&(g.J=c.o),h&&(c.i=h.G.concat(c.i)),h=Pp(c,g,1e3),g.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),rt(c.h,g),ie(g,D,h)}function ya(c,h){c.H&&Kt(c.H,function(g,D){Nt(h,D,g)}),c.l&&Kt({},function(g,D){Nt(h,D,g)})}function Pp(c,h,g){g=Math.min(c.i.length,g);const D=c.l?m(c.l.Ka,c.l,c):null;e:{var z=c.i;let pt=-1;for(;;){const Ln=["count="+g];pt==-1?g>0?(pt=z[0].g,Ln.push("ofs="+pt)):pt=0:Ln.push("ofs="+pt);let Zt=!0;for(let Mn=0;Mn<g;Mn++){var J=z[Mn].g;const qs=z[Mn].map;if(J-=pt,J<0)pt=Math.max(0,z[Mn].g-100),Zt=!1;else try{J="req"+J+"_"||"";try{var De=qs instanceof Map?qs:Object.entries(qs);for(const[hi,Er]of De){let Ar=Er;l(Er)&&(Ar=st(Er)),Ln.push(J+hi+"="+encodeURIComponent(Ar))}}catch(hi){throw Ln.push(J+"type="+encodeURIComponent("_badmap")),hi}}catch{D&&D(qs)}}if(Zt){De=Ln.join("&");break e}}De=void 0}return c=c.i.splice(0,g),h.G=c,De}function Lp(c){if(!c.g&&!c.v){c.Y=1;var h=c.Da;ee||N(),M||(ee(),M=!0),A.add(h,c),c.A=0}}function dm(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=cn(m(c.Da,c),Bp(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,jp(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=cn(m(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,At(10),Gl(this),jp(this))};function fm(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function jp(c){c.g=new U(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var h=nn(c.na);Nt(h,"RID","rpc"),Nt(h,"SID",c.M),Nt(h,"AID",c.K),Nt(h,"CI",c.F?"0":"1"),!c.F&&c.ia&&Nt(h,"TO",c.ia),Nt(h,"TYPE","xmlhttp"),ya(c,h),c.u&&c.o&&Jt(h,c.u,c.o),c.O&&(c.g.H=c.O);var g=c.g;c=c.ba,g.M=1,g.A=Xi(nn(h)),g.u=null,g.R=!0,Ce(g,c)}n.Va=function(){this.C!=null&&(this.C=null,Gl(this),dm(this),At(19))};function Yl(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function Rp(c,h){var g=null;if(c.g==h){Yl(c),fm(c),c.g=null;var D=2}else if(tt(c.h,h))g=h.G,it(c.h,h),D=1;else return;if(c.I!=0){if(h.o)if(D==1){g=h.u?h.u.length:0,h=Date.now()-h.F;var z=c.D;D=me(),P(D,new xn(D,g)),Ql(c)}else Lp(c);else if(z=h.m,z==3||z==0&&h.X>0||!(D==1&&Mv(c,h)||D==2&&dm(c)))switch(g&&g.length>0&&(h=c.h,h.i=h.i.concat(g)),z){case 1:pi(c,5);break;case 4:pi(c,10);break;case 3:pi(c,6);break;default:pi(c,2)}}}function Bp(c,h){let g=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(g*=2),g*h}function pi(c,h){if(c.j.info("Error code "+h),h==2){var g=m(c.bb,c),D=c.Ua;const z=!D;D=new un(D||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Vs(D,"https"),Xi(D),z?gt(D.toString(),g):kn(D.toString(),g)}else At(2);c.I=0,c.l&&c.l.pa(h),Up(c),Sp(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),At(2)):(this.j.info("Failed to ping google.com"),At(1))};function Up(c){if(c.I=0,c.ja=[],c.l){const h=qe(c.h);(h.length!=0||c.i.length!=0)&&(C(c.ja,h),C(c.ja,c.i),c.h.i.length=0,y(c.i),c.i.length=0),c.l.oa()}}function Hp(c,h,g){var D=g instanceof un?nn(g):new un(g);if(D.g!="")h&&(D.g=h+"."+D.g),vr(D,D.u);else{var z=o.location;D=z.protocol,h=h?h+"."+z.hostname:z.hostname,z=+z.port;const J=new un(null);D&&Vs(J,D),h&&(J.g=h),z&&vr(J,z),g&&(J.h=g),D=J}return g=c.G,h=c.wa,g&&h&&Nt(D,g,h),Nt(D,"VER",c.ka),ya(c,D),D}function Mp(c,h,g){if(h&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return h=c.Aa&&!c.ma?new yt(new mn({ab:g})):new yt(c.ma),h.Fa(c.L),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Fp(){}n=Fp.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Xl(){}Xl.prototype.g=function(c,h){return new ps(c,h)};function ps(c,h){dt.call(this),this.g=new Ip(h),this.l=c,this.h=h&&h.messageUrlParams||null,c=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(c?c["X-WebChannel-Content-Type"]=h.messageContentType:c={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.sa&&(c?c["X-WebChannel-Client-Profile"]=h.sa:c={"X-WebChannel-Client-Profile":h.sa}),this.g.U=c,(c=h&&h.Qb)&&!k(c)&&(this.g.u=c),this.A=h&&h.supportsCrossDomainXhr||!1,this.v=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!k(h)&&(this.g.G=h,c=this.h,c!==null&&h in c&&(c=this.h,h in c&&delete c[h])),this.j=new eo(this)}f(ps,dt),ps.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ps.prototype.close=function(){mm(this.g)},ps.prototype.o=function(c){var h=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.v&&(g={},g.__data__=st(c),c=g);h.i.push(new Qn(h.Ya++,c)),h.I==3&&Ql(h)},ps.prototype.N=function(){this.g.l=null,delete this.j,mm(this.g),delete this.g,ps.Z.N.call(this)};function Op(c){O.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var h=c.__sm__;if(h){e:{for(const g in h){c=g;break e}c=void 0}(this.i=c)&&(c=this.i,h=h!==null&&c in h?h[c]:void 0),this.data=h}else this.data=c}f(Op,O);function qp(){_e.call(this),this.status=1}f(qp,_e);function eo(c){this.g=c}f(eo,Fp),eo.prototype.ra=function(){P(this.g,"a")},eo.prototype.qa=function(c){P(this.g,new Op(c))},eo.prototype.pa=function(c){P(this.g,new qp)},eo.prototype.oa=function(){P(this.g,"b")},Xl.prototype.createWebChannel=Xl.prototype.g,ps.prototype.send=ps.prototype.o,ps.prototype.open=ps.prototype.m,ps.prototype.close=ps.prototype.close,Ub=function(){return new Xl},Bb=function(){return me()},Rb=ke,ad={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},as.NO_ERROR=0,as.TIMEOUT=8,as.HTTP_ERROR=6,Cc=as,_.COMPLETE="complete",jb=_,ne.EventType=Ze,Ze.OPEN="a",Ze.CLOSE="b",Ze.ERROR="c",Ze.MESSAGE="d",dt.prototype.listen=dt.prototype.J,Fa=ne,yt.prototype.listenOnce=yt.prototype.K,yt.prototype.getLastError=yt.prototype.Ha,yt.prototype.getLastErrorCode=yt.prototype.ya,yt.prototype.getStatus=yt.prototype.ca,yt.prototype.getResponseJson=yt.prototype.La,yt.prototype.getResponseText=yt.prototype.la,yt.prototype.send=yt.prototype.ea,yt.prototype.setWithCredentials=yt.prototype.Fa,Lb=yt}).apply(typeof nc<"u"?nc:typeof self<"u"?self:typeof window<"u"?window:{});const gh="@firebase/firestore",yh="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Jn.UNAUTHENTICATED=new Jn(null),Jn.GOOGLE_CREDENTIALS=new Jn("google-credentials-uid"),Jn.FIRST_PARTY=new Jn("first-party-uid"),Jn.MOCK_USER=new Jn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sa="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ri=new kb("@firebase/firestore");function Do(){return Ri.logLevel}function pe(n,...e){if(Ri.logLevel<=Ct.DEBUG){const t=e.map(cf);Ri.debug(`Firestore (${sa}): ${n}`,...t)}}function _n(n,...e){if(Ri.logLevel<=Ct.ERROR){const t=e.map(cf);Ri.error(`Firestore (${sa}): ${n}`,...t)}}function ml(n,...e){if(Ri.logLevel<=Ct.WARN){const t=e.map(cf);Ri.warn(`Firestore (${sa}): ${n}`,...t)}}function cf(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pe(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Hb(n,s,t)}function Hb(n,e,t){let s=`FIRESTORE (${sa}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw _n(s),new Error(s)}function Me(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||Hb(e,r,s)}function Re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const se={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xe extends zi{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Jn.UNAUTHENTICATED))}shutdown(){}}class $E{constructor(e){this.t=e,this.currentUser=Jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Me(this.o===void 0,42304);let s=this.i;const r=u=>this.i!==s?(s=this.i,t(u)):Promise.resolve();let i=new Js;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Js,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await r(this.currentUser)})},l=u=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Js)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Me(typeof s.accessToken=="string",31837,{l:s}),new OE(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Me(e===null||typeof e=="string",2055,{h:e}),new Jn(e)}}class zE{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Jn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class WE{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new zE(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Jn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class bh{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class KE{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Vb(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Me(this.o===void 0,3512);const s=i=>{i.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new bh(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new bh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=GE(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function nt(n,e){return n<e?-1:n>e?1:0}function ld(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return Em(r)===Em(i)?nt(r,i):Em(r)?1:-1}return nt(n.length,e.length)}const QE=55296,YE=57343;function Em(n){const e=n.charCodeAt(0);return e>=QE&&e<=YE}function Ro(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}function Mb(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nh="__name__";class zs{constructor(e,t,s){t===void 0?t=0:t>e.length&&Pe(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&Pe(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return zs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof zs?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=zs.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return nt(e.length,t.length)}static compareSegments(e,t){const s=zs.isNumericId(e),r=zs.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?zs.extractNumericId(e).compare(zs.extractNumericId(t)):ld(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Wr.fromString(e.substring(4,e.length-2))}}class Ut extends zs{construct(e,t,s){return new Ut(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new xe(se.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new Ut(t)}static emptyPath(){return new Ut([])}}const XE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class dn extends zs{construct(e,t,s){return new dn(e,t,s)}static isValidIdentifier(e){return XE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),dn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Nh}static keyField(){return new dn([Nh])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new xe(se.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const l=e[r];if(l==="\\"){if(r+1===e.length)throw new xe(se.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new xe(se.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=u,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(s+=l,r++):(i(),r++)}if(i(),o)throw new xe(se.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new dn(t)}static emptyPath(){return new dn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e){this.path=e}static fromPath(e){return new Ae(Ut.fromString(e))}static fromName(e){return new Ae(Ut.fromString(e).popFirst(5))}static empty(){return new Ae(Ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ut.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ae(new Ut(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fb(n,e,t){if(!t)throw new xe(se.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JE(n,e,t,s){if(e===!0&&s===!0)throw new xe(se.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xh(n){if(!Ae.isDocumentKey(n))throw new xe(se.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function vh(n){if(Ae.isDocumentKey(n))throw new xe(se.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ob(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Vu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Pe(12329,{type:typeof n})}function fs(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new xe(se.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Vu(n);throw new xe(se.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Il(n,e){if(!Ob(n))throw new xe(se.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new xe(se.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h=-62135596800,Dh=1e6;class be{static now(){return be.fromMillis(Date.now())}static fromDate(e){return be.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Dh);return new be(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new xe(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xe(se.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<_h)throw new xe(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xe(se.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Dh}_compareTo(e){return this.seconds===e.seconds?nt(this.nanoseconds,e.nanoseconds):nt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:be._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Il(e,be._jsonSchema))return new be(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-_h;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}be._jsonSchemaVersion="firestore/timestamp/1.0",be._jsonSchema={type:Sn("string",be._jsonSchemaVersion),seconds:Sn("number"),nanoseconds:Sn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{static fromTimestamp(e){return new Ke(e)}static min(){return new Ke(new be(0,0))}static max(){return new Ke(new be(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bo=-1;class Xc{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function cd(n){return n.fields.find(e=>e.kind===2)}function xi(n){return n.fields.filter(e=>e.kind!==2)}Xc.UNKNOWN_ID=-1;class Ic{constructor(e,t){this.fieldPath=e,this.kind=t}}class dl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new dl(0,vs.min())}}function qb(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=Ke.fromTimestamp(s===1e9?new be(t+1,0):new be(t,s));return new vs(r,Ae.empty(),e)}function $b(n){return new vs(n.readTime,n.key,Bo)}class vs{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new vs(Ke.min(),Ae.empty(),Bo)}static max(){return new vs(Ke.max(),Ae.empty(),Bo)}}function mf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ae.comparator(n.documentKey,e.documentKey),t!==0?t:nt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Wb{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ti(n){if(n.code!==se.FAILED_PRECONDITION||n.message!==zb)throw n;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ${constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Pe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new $((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof $?t:$.resolve(t)}catch(t){return $.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):$.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):$.reject(t)}static resolve(e){return new $((t,s)=>{t(e)})}static reject(e){return new $((t,s)=>{s(e)})}static waitFor(e){return new $((t,s)=>{let r=0,i=0,o=!1;e.forEach(l=>{++r,l.next(()=>{++i,o&&i===r&&t()},u=>s(u))}),o=!0,i===r&&t()})}static or(e){let t=$.resolve(!1);for(const s of e)t=t.next(r=>r?$.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new $((s,r)=>{const i=e.length,o=new Array(i);let l=0;for(let u=0;u<i;u++){const m=u;t(e[m]).next(d=>{o[m]=d,++l,l===i&&s(o)},d=>r(d))}})}static doWhile(e,t){return new $((s,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):s()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hs="SimpleDb";class Cu{static open(e,t,s,r){try{return new Cu(t,e.transaction(r,s))}catch(i){throw new Qa(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Js,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Qa(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const r=df(s.target.error);this.S.reject(new Qa(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(pe(hs,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new eA(t)}}class Kr{static delete(e){return pe(hs,"Removing database:",e),_i(gb().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!_b())return!1;if(Kr.F())return!0;const e=Gc(),t=Kr.M(e),s=0<t&&t<10,r=Kb(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,Kr.M(Gc())===12.2&&_n("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(pe(hs,"Opening database:",this.name),this.db=await new Promise((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;t(o)},r.onblocked=()=>{s(new Qa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?s(new xe(se.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new xe(se.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Qa(e,o))},r.onupgradeneeded=i=>{pe(hs,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,r.transaction,i.oldVersion,this.version).next(()=>{pe(hs,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,r){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const l=Cu.open(this.db,e,i?"readonly":"readwrite",s),u=r(l).next(m=>(l.C(),m)).catch(m=>(l.abort(m),$.reject(m))).toPromise();return u.catch(()=>{}),await l.D,u}catch(l){const u=l,m=u.name!=="FirebaseError"&&o<3;if(pe(hs,"Transaction failed with error:",u.message,"Retrying:",m),this.close(),!m)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Kb(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class ZE{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return _i(this.U.delete())}}class Qa extends xe{constructor(e,t){super(se.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ni(n){return n.name==="IndexedDbTransactionError"}class eA{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(pe(hs,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(pe(hs,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),_i(s)}add(e){return pe(hs,"ADD",this.store.name,e,e),_i(this.store.add(e))}get(e){return _i(this.store.get(e)).next(t=>(t===void 0&&(t=null),pe(hs,"GET",this.store.name,e,t),t))}delete(e){return pe(hs,"DELETE",this.store.name,e),_i(this.store.delete(e))}count(){return pe(hs,"COUNT",this.store.name),_i(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(s.range);return new $((o,l)=>{i.onerror=u=>{l(u.target.error)},i.onsuccess=u=>{o(u.target.result)}})}{const i=this.cursor(s),o=[];return this.H(i,(l,u)=>{o.push(u)}).next(()=>o)}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new $((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}})}Z(e,t){pe(hs,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,(i,o,l)=>l.delete())}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new $((s,r)=>{t.onerror=i=>{const o=df(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():s()}):s()}})}H(e,t){const s=[];return new $((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const l=o.target.result;if(!l)return void r();const u=new ZE(l),m=t(l.primaryKey,l.value,u);if(m instanceof $){const d=m.catch(f=>(u.done(),$.reject(f)));s.push(d)}u.isDone?r():u.G===null?l.continue():l.continue(u.G)}}).next(()=>$.waitFor(s))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function _i(n){return new $((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=df(s.target.error);t(r)}})}let kh=!1;function df(n){const e=Kr.M(Gc());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new xe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return kh||(kh=!0,setTimeout(()=>{throw s},0)),s}}return n}const Ya="IndexBackfiller";class tA{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){pe(Ya,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();pe(Ya,`Documents written: ${t}`)}catch(t){ni(t)?pe(Ya,"Ignoring IndexedDB error during index backfill: ",t):await ti(t)}await this.re(6e4)})}}class nA{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const s=new Set;let r=t,i=!0;return $.doWhile(()=>i===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!s.has(o))return pe(Ya,`Processing collection: ${o}`),this.oe(e,o,r).next(l=>{r-=l,s.add(o)});i=!1})).next(()=>t-r)}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(r,i)).next(l=>(pe(Ya,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>o.size)}))}_e(e,t){let s=e;return t.changes.forEach((r,i)=>{const o=$b(i);mf(o,s)>0&&(s=o)}),new vs(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ms.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vi=-1;function Iu(n){return n==null}function fl(n){return n===0&&1/n==-1/0}function Gb(n){return typeof n=="number"&&Number.isInteger(n)&&!fl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jc="";function ts(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Eh(e)),e=sA(n.get(t),e);return Eh(e)}function sA(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case Jc:t+="";break;default:t+=i}}return t}function Eh(n){return n+Jc+""}function Qs(n){const e=n.length;if(Me(e>=2,64408,{path:n}),e===2)return Me(n.charAt(0)===Jc&&n.charAt(1)==="",56145,{path:n}),Ut.emptyPath();const t=e-2,s=[];let r="";for(let i=0;i<e;){const o=n.indexOf(Jc,i);switch((o<0||o>t)&&Pe(50515,{path:n}),n.charAt(o+1)){case"":const l=n.substring(i,o);let u;r.length===0?u=l:(r+=l,u=r,r=""),s.push(u);break;case"":r+=n.substring(i,o),r+="\0";break;case"":r+=n.substring(i,o+1);break;default:Pe(61167,{path:n})}i=o+2}return new Ut(s)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi="remoteDocuments",Sl="owner",to="owner",pl="mutationQueues",rA="userId",Ps="mutations",Ah="batchId",Ai="userMutationsIndex",wh=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(n,e){return[n,ts(e)]}function Qb(n,e,t){return[n,ts(e),t]}const iA={},Uo="documentMutations",Zc="remoteDocumentsV14",oA=["prefixPath","collectionGroup","readTime","documentId"],Tc="documentKeyIndex",aA=["prefixPath","collectionGroup","documentId"],Yb="collectionGroupIndex",lA=["collectionGroup","readTime","prefixPath","documentId"],hl="remoteDocumentGlobal",ud="remoteDocumentGlobalKey",Ho="targets",Xb="queryTargetsIndex",cA=["canonicalId","targetId"],Mo="targetDocuments",uA=["targetId","path"],ff="documentTargetsIndex",mA=["path","targetId"],eu="targetGlobalKey",Ci="targetGlobal",gl="collectionParents",dA=["collectionId","parent"],Fo="clientMetadata",fA="clientId",Su="bundles",pA="bundleId",Tu="namedQueries",hA="name",pf="indexConfiguration",gA="indexId",md="collectionGroupIndex",yA="collectionGroup",Xa="indexState",bA=["indexId","uid"],Jb="sequenceNumberIndex",NA=["uid","sequenceNumber"],Ja="indexEntries",xA=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Zb="documentKeyIndex",vA=["indexId","uid","orderedDocumentKey"],Pu="documentOverlays",_A=["userId","collectionPath","documentId"],dd="collectionPathOverlayIndex",DA=["userId","collectionPath","largestBatchId"],eN="collectionGroupOverlayIndex",kA=["userId","collectionGroup","largestBatchId"],hf="globals",EA="name",tN=[pl,Ps,Uo,vi,Ho,Sl,Ci,Mo,Fo,hl,gl,Su,Tu],AA=[...tN,Pu],nN=[pl,Ps,Uo,Zc,Ho,Sl,Ci,Mo,Fo,hl,gl,Su,Tu,Pu],sN=nN,gf=[...sN,pf,Xa,Ja],wA=gf,rN=[...gf,hf],VA=rN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd extends Wb{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Un(n,e){const t=Re(n);return Kr.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function si(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function iN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e,t){this.comparator=e,this.root=t||Wn.EMPTY}insert(e,t){return new sn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wn.BLACK,null,null))}remove(e){return new sn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sc(this.root,e,this.comparator,!1)}getReverseIterator(){return new sc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sc(this.root,e,this.comparator,!0)}}class sc{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wn{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Wn.RED,this.left=r??Wn.EMPTY,this.right=i??Wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Wn(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Wn.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Pe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Pe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Pe(27949);return e+(this.isRed()?0:1)}}Wn.EMPTY=null,Wn.RED=!0,Wn.BLACK=!1;Wn.EMPTY=new class{constructor(){this.size=0}get key(){throw Pe(57766)}get value(){throw Pe(16141)}get color(){throw Pe(16727)}get left(){throw Pe(29726)}get right(){throw Pe(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.comparator=e,this.data=new sn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ch(this.data.getIterator())}getIteratorFrom(e){return new Ch(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof Wt)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Wt(this.comparator);return t.data=e,t}}class Ch{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function no(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e){this.fields=e,e.sort(dn.comparator)}static empty(){return new ds([])}unionWith(e){let t=new Wt(dn.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new ds(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ro(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new oN("Invalid base64 string: "+i):i}}(e);return new Dn(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new Dn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return nt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Dn.EMPTY_BYTE_STRING=new Dn("");const CA=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hr(n){if(Me(!!n,39018),typeof n=="string"){let e=0;const t=CA.exec(n);if(Me(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ln(n.seconds),nanos:ln(n.nanos)}}function ln(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function gr(n){return typeof n=="string"?Dn.fromBase64String(n):Dn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN="server_timestamp",lN="__type__",cN="__previous_value__",uN="__local_write_time__";function yf(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[lN])==null?void 0:s.stringValue)===aN}function Lu(n){const e=n.mapValue.fields[cN];return yf(e)?Lu(e):e}function yl(n){const e=hr(n.mapValue.fields[uN].timestampValue);return new be(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e,t,s,r,i,o,l,u,m,d){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=m,this.isUsingEmulator=d}}const tu="(default)";class Bi{constructor(e,t){this.projectId=e,this.database=t||tu}static empty(){return new Bi("","")}get isDefaultDatabase(){return this.database===tu}isEqual(e){return e instanceof Bi&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bf="__type__",mN="__max__",Fr={mapValue:{fields:{__type__:{stringValue:mN}}}},Nf="__vector__",Oo="value",Pc={nullValue:"NULL_VALUE"};function Qr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?yf(n)?4:dN(n)?9007199254740991:ju(n)?10:11:Pe(28295,{value:n})}function sr(n,e){if(n===e)return!0;const t=Qr(n);if(t!==Qr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yl(n).isEqual(yl(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=hr(r.timestampValue),l=hr(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return gr(r.bytesValue).isEqual(gr(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return ln(r.geoPointValue.latitude)===ln(i.geoPointValue.latitude)&&ln(r.geoPointValue.longitude)===ln(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return ln(r.integerValue)===ln(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=ln(r.doubleValue),l=ln(i.doubleValue);return o===l?fl(o)===fl(l):isNaN(o)&&isNaN(l)}return!1}(n,e);case 9:return Ro(n.arrayValue.values||[],e.arrayValue.values||[],sr);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},l=i.mapValue.fields||{};if(Vh(o)!==Vh(l))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(l[u]===void 0||!sr(o[u],l[u])))return!1;return!0}(n,e);default:return Pe(52216,{left:n})}}function bl(n,e){return(n.values||[]).find(t=>sr(t,e))!==void 0}function Yr(n,e){if(n===e)return 0;const t=Qr(n),s=Qr(e);if(t!==s)return nt(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return nt(n.booleanValue,e.booleanValue);case 2:return function(i,o){const l=ln(i.integerValue||i.doubleValue),u=ln(o.integerValue||o.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,e);case 3:return Ih(n.timestampValue,e.timestampValue);case 4:return Ih(yl(n),yl(e));case 5:return ld(n.stringValue,e.stringValue);case 6:return function(i,o){const l=gr(i),u=gr(o);return l.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),u=o.split("/");for(let m=0;m<l.length&&m<u.length;m++){const d=nt(l[m],u[m]);if(d!==0)return d}return nt(l.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const l=nt(ln(i.latitude),ln(o.latitude));return l!==0?l:nt(ln(i.longitude),ln(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Sh(n.arrayValue,e.arrayValue);case 10:return function(i,o){var p,y,C,v;const l=i.fields||{},u=o.fields||{},m=(p=l[Oo])==null?void 0:p.arrayValue,d=(y=u[Oo])==null?void 0:y.arrayValue,f=nt(((C=m==null?void 0:m.values)==null?void 0:C.length)||0,((v=d==null?void 0:d.values)==null?void 0:v.length)||0);return f!==0?f:Sh(m,d)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Fr.mapValue&&o===Fr.mapValue)return 0;if(i===Fr.mapValue)return 1;if(o===Fr.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),m=o.fields||{},d=Object.keys(m);u.sort(),d.sort();for(let f=0;f<u.length&&f<d.length;++f){const p=ld(u[f],d[f]);if(p!==0)return p;const y=Yr(l[u[f]],m[d[f]]);if(y!==0)return y}return nt(u.length,d.length)}(n.mapValue,e.mapValue);default:throw Pe(23264,{he:t})}}function Ih(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return nt(n,e);const t=hr(n),s=hr(e),r=nt(t.seconds,s.seconds);return r!==0?r:nt(t.nanos,s.nanos)}function Sh(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Yr(t[r],s[r]);if(i)return i}return nt(t.length,s.length)}function qo(n){return pd(n)}function pd(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=hr(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return gr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ae.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=pd(i);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${pd(t.fields[o])}`;return r+"}"}(n.mapValue):Pe(61005,{value:n})}function Lc(n){switch(Qr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Lu(n);return e?16+Lc(e):16;case 5:return 2*n.stringValue.length;case 6:return gr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((r,i)=>r+Lc(i),0)}(n.arrayValue);case 10:case 11:return function(s){let r=0;return si(s.fields,(i,o)=>{r+=i.length+Lc(o)}),r}(n.mapValue);default:throw Pe(13486,{value:n})}}function Nl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function hd(n){return!!n&&"integerValue"in n}function xl(n){return!!n&&"arrayValue"in n}function Th(n){return!!n&&"nullValue"in n}function Ph(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function jc(n){return!!n&&"mapValue"in n}function ju(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[bf])==null?void 0:s.stringValue)===Nf}function Za(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return si(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=Za(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Za(n.arrayValue.values[t]);return e}return{...n}}function dN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===mN}const fN={mapValue:{fields:{[bf]:{stringValue:Nf},[Oo]:{arrayValue:{}}}}};function SA(n){return"nullValue"in n?Pc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Nl(Bi.empty(),Ae.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?ju(n)?fN:{mapValue:{}}:Pe(35942,{value:n})}function TA(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Nl(Bi.empty(),Ae.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?fN:"mapValue"in n?ju(n)?{mapValue:{}}:Fr:Pe(61959,{value:n})}function Lh(n,e){const t=Yr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function jh(n,e){const t=Yr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.value=e}static empty(){return new es({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!jc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Za(t)}setAll(e){let t=dn.emptyPath(),s={},r=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,s,r),s={},r=[],t=l.popLast()}o?s[l.lastSegment()]=Za(o):r.push(l.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());jc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];jc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){si(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new es(Za(this.value))}}function pN(n){const e=[];return si(n.fields,(t,s)=>{const r=new dn([t]);if(jc(s)){const i=pN(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new ds(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,t,s,r,i,o,l){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new hn(e,0,Ke.min(),Ke.min(),Ke.min(),es.empty(),0)}static newFoundDocument(e,t,s,r){return new hn(e,1,t,Ke.min(),s,r,0)}static newNoDocument(e,t){return new hn(e,2,t,Ke.min(),Ke.min(),es.empty(),0)}static newUnknownDocument(e,t){return new hn(e,3,t,Ke.min(),Ke.min(),es.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=es.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=es.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof hn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new hn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e,t){this.position=e,this.inclusive=t}}function Rh(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=Ae.comparator(Ae.fromName(o.referenceValue),t.key):s=Yr(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function Bh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!sr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e,t="asc"){this.field=e,this.dir=t}}function PA(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{}class Dt extends hN{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new LA(e,t,s):t==="array-contains"?new BA(e,s):t==="in"?new vN(e,s):t==="not-in"?new UA(e,s):t==="array-contains-any"?new HA(e,s):new Dt(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new jA(e,s):new RA(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Yr(t,this.value)):t!==null&&Qr(this.value)===Qr(t)&&this.matchesComparison(Yr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Pe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zt extends hN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new zt(e,t)}matches(e){return zo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function zo(n){return n.op==="and"}function gd(n){return n.op==="or"}function xf(n){return gN(n)&&zo(n)}function gN(n){for(const e of n.filters)if(e instanceof zt)return!1;return!0}function yd(n){if(n instanceof Dt)return n.field.canonicalString()+n.op.toString()+qo(n.value);if(xf(n))return n.filters.map(e=>yd(e)).join(",");{const e=n.filters.map(t=>yd(t)).join(",");return`${n.op}(${e})`}}function yN(n,e){return n instanceof Dt?function(s,r){return r instanceof Dt&&s.op===r.op&&s.field.isEqual(r.field)&&sr(s.value,r.value)}(n,e):n instanceof zt?function(s,r){return r instanceof zt&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,l)=>i&&yN(o,r.filters[l]),!0):!1}(n,e):void Pe(19439)}function bN(n,e){const t=n.filters.concat(e);return zt.create(t,n.op)}function NN(n){return n instanceof Dt?function(t){return`${t.field.canonicalString()} ${t.op} ${qo(t.value)}`}(n):n instanceof zt?function(t){return t.op.toString()+" {"+t.getFilters().map(NN).join(" ,")+"}"}(n):"Filter"}class LA extends Dt{constructor(e,t,s){super(e,t,s),this.key=Ae.fromName(s.referenceValue)}matches(e){const t=Ae.comparator(e.key,this.key);return this.matchesComparison(t)}}class jA extends Dt{constructor(e,t){super(e,"in",t),this.keys=xN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class RA extends Dt{constructor(e,t){super(e,"not-in",t),this.keys=xN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(s=>Ae.fromName(s.referenceValue))}class BA extends Dt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xl(t)&&bl(t.arrayValue,this.value)}}class vN extends Dt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&bl(this.value.arrayValue,t)}}class UA extends Dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(bl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!bl(this.value.arrayValue,t)}}class HA extends Dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>bl(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MA{constructor(e,t=null,s=[],r=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=l,this.Te=null}}function bd(n,e=null,t=[],s=[],r=null,i=null,o=null){return new MA(n,e,t,s,r,i,o)}function Ui(n){const e=Re(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>yd(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),Iu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>qo(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>qo(s)).join(",")),e.Te=t}return e.Te}function Tl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!PA(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!yN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Bh(n.startAt,e.startAt)&&Bh(n.endAt,e.endAt)}function nu(n){return Ae.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function su(n,e){return n.filters.filter(t=>t instanceof Dt&&t.field.isEqual(e))}function Uh(n,e,t){let s=Pc,r=!0;for(const i of su(n,e)){let o=Pc,l=!0;switch(i.op){case"<":case"<=":o=SA(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,l=!1;break;case"!=":case"not-in":o=Pc}Lh({value:s,inclusive:r},{value:o,inclusive:l})<0&&(s=o,r=l)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Lh({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function Hh(n,e,t){let s=Fr,r=!0;for(const i of su(n,e)){let o=Fr,l=!0;switch(i.op){case">=":case">":o=TA(i.value),l=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,l=!1;break;case"!=":case"not-in":o=Fr}jh({value:s,inclusive:r},{value:o,inclusive:l})>0&&(s=o,r=l)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];jh({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,t=null,s=[],r=[],i=null,o="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function _N(n,e,t,s,r,i,o,l){return new ra(n,e,t,s,r,i,o,l)}function Pl(n){return new ra(n)}function Mh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function DN(n){return n.collectionGroup!==null}function el(n){const e=Re(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Wt(dn.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(m=>{m.isInequality()&&(l=l.add(m.field))})}),l})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new vl(i,s))}),t.has(dn.keyField().canonicalString())||e.Ie.push(new vl(dn.keyField(),s))}return e.Ie}function xs(n){const e=Re(n);return e.Ee||(e.Ee=FA(e,el(n))),e.Ee}function FA(n,e){if(n.limitType==="F")return bd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new vl(r.field,i)});const t=n.endAt?new $o(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new $o(n.startAt.position,n.startAt.inclusive):null;return bd(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Nd(n,e){const t=n.filters.concat([e]);return new ra(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function xd(n,e,t){return new ra(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ru(n,e){return Tl(xs(n),xs(e))&&n.limitType===e.limitType}function kN(n){return`${Ui(xs(n))}|lt:${n.limitType}`}function ko(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(r=>NN(r)).join(", ")}]`),Iu(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(r=>qo(r)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(r=>qo(r)).join(",")),`Target(${s})`}(xs(n))}; limitType=${n.limitType})`}function Ll(n,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):Ae.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(n,e)&&function(s,r){for(const i of el(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(s,r){return!(s.startAt&&!function(o,l,u){const m=Rh(o,l,u);return o.inclusive?m<=0:m<0}(s.startAt,el(s),r)||s.endAt&&!function(o,l,u){const m=Rh(o,l,u);return o.inclusive?m>=0:m>0}(s.endAt,el(s),r))}(n,e)}function EN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function AN(n){return(e,t)=>{let s=!1;for(const r of el(n)){const i=OA(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function OA(n,e,t){const s=n.field.isKeyField()?Ae.comparator(e.key,t.key):function(i,o,l){const u=o.data.field(i),m=l.data.field(i);return u!==null&&m!==null?Yr(u,m):Pe(42886)}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Pe(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){si(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return iN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA=new sn(Ae.comparator);function bs(){return qA}const wN=new sn(Ae.comparator);function Oa(...n){let e=wN;for(const t of n)e=e.insert(t.key,t);return e}function VN(n){let e=wN;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Ys(){return tl()}function CN(){return tl()}function tl(){return new yr(n=>n.toString(),(n,e)=>n.isEqual(e))}const $A=new sn(Ae.comparator),zA=new Wt(Ae.comparator);function bt(...n){let e=zA;for(const t of n)e=e.add(t);return e}const WA=new Wt(nt);function vf(){return WA}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fl(e)?"-0":e}}function IN(n){return{integerValue:""+n}}function KA(n,e){return Gb(e)?IN(e):_f(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(){this._=void 0}}function GA(n,e,t){return n instanceof Wo?function(r,i){const o={fields:{[lN]:{stringValue:aN},[uN]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&yf(i)&&(i=Lu(i)),i&&(o.fields[cN]=i),{mapValue:o}}(t,e):n instanceof Ko?TN(n,e):n instanceof Go?PN(n,e):function(r,i){const o=SN(r,i),l=Fh(o)+Fh(r.Ae);return hd(o)&&hd(r.Ae)?IN(l):_f(r.serializer,l)}(n,e)}function QA(n,e,t){return n instanceof Ko?TN(n,e):n instanceof Go?PN(n,e):t}function SN(n,e){return n instanceof _l?function(s){return hd(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class Wo extends Bu{}class Ko extends Bu{constructor(e){super(),this.elements=e}}function TN(n,e){const t=LN(e);for(const s of n.elements)t.some(r=>sr(r,s))||t.push(s);return{arrayValue:{values:t}}}class Go extends Bu{constructor(e){super(),this.elements=e}}function PN(n,e){let t=LN(e);for(const s of n.elements)t=t.filter(r=>!sr(r,s));return{arrayValue:{values:t}}}class _l extends Bu{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Fh(n){return ln(n.integerValue||n.doubleValue)}function LN(n){return xl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jN{constructor(e,t){this.field=e,this.transform=t}}function YA(n,e){return n.field.isEqual(e.field)&&function(s,r){return s instanceof Ko&&r instanceof Ko||s instanceof Go&&r instanceof Go?Ro(s.elements,r.elements,sr):s instanceof _l&&r instanceof _l?sr(s.Ae,r.Ae):s instanceof Wo&&r instanceof Wo}(n.transform,e.transform)}class XA{constructor(e,t){this.version=e,this.transformResults=t}}class Bn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Bn}static exists(e){return new Bn(void 0,e)}static updateTime(e){return new Bn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Rc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Uu{}function RN(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jl(n.key,Bn.none()):new ia(n.key,n.data,Bn.none());{const t=n.data,s=es.empty();let r=new Wt(dn.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new br(n.key,s,new ds(r.toArray()),Bn.none())}}function JA(n,e,t){n instanceof ia?function(r,i,o){const l=r.value.clone(),u=qh(r.fieldTransforms,i,o.transformResults);l.setAll(u),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):n instanceof br?function(r,i,o){if(!Rc(r.precondition,i))return void i.convertToUnknownDocument(o.version);const l=qh(r.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(BN(r)),u.setAll(l),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function nl(n,e,t,s){return n instanceof ia?function(i,o,l,u){if(!Rc(i.precondition,o))return l;const m=i.value.clone(),d=$h(i.fieldTransforms,u,o);return m.setAll(d),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),null}(n,e,t,s):n instanceof br?function(i,o,l,u){if(!Rc(i.precondition,o))return l;const m=$h(i.fieldTransforms,u,o),d=o.data;return d.setAll(BN(i)),d.setAll(m),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,s):function(i,o,l){return Rc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(n,e,t)}function ZA(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=SN(s.transform,r||null);i!=null&&(t===null&&(t=es.empty()),t.set(s.field,i))}return t||null}function Oh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Ro(s,r,(i,o)=>YA(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ia extends Uu{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class br extends Uu{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function BN(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function qh(n,e,t){const s=new Map;Me(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,l=e.data.field(i.field);s.set(i.field,QA(o,l,t[r]))}return s}function $h(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,GA(i,o,e))}return s}class jl extends Uu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class UN extends Uu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&JA(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=nl(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=nl(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=CN();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=t.has(r.key)?null:l;const u=RN(o,l);u!==null&&s.set(r.key,u),o.isValidDocument()||o.convertToNoDocument(Ke.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),bt())}isEqual(e){return this.batchId===e.batchId&&Ro(this.mutations,e.mutations,(t,s)=>Oh(t,s))&&Ro(this.baseMutations,e.baseMutations,(t,s)=>Oh(t,s))}}class kf{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){Me(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=function(){return $A}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new kf(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var An,Vt;function tw(n){switch(n){case se.OK:return Pe(64938);case se.CANCELLED:case se.UNKNOWN:case se.DEADLINE_EXCEEDED:case se.RESOURCE_EXHAUSTED:case se.INTERNAL:case se.UNAVAILABLE:case se.UNAUTHENTICATED:return!1;case se.INVALID_ARGUMENT:case se.NOT_FOUND:case se.ALREADY_EXISTS:case se.PERMISSION_DENIED:case se.FAILED_PRECONDITION:case se.ABORTED:case se.OUT_OF_RANGE:case se.UNIMPLEMENTED:case se.DATA_LOSS:return!0;default:return Pe(15467,{code:n})}}function HN(n){if(n===void 0)return _n("GRPC error has no .code"),se.UNKNOWN;switch(n){case An.OK:return se.OK;case An.CANCELLED:return se.CANCELLED;case An.UNKNOWN:return se.UNKNOWN;case An.DEADLINE_EXCEEDED:return se.DEADLINE_EXCEEDED;case An.RESOURCE_EXHAUSTED:return se.RESOURCE_EXHAUSTED;case An.INTERNAL:return se.INTERNAL;case An.UNAVAILABLE:return se.UNAVAILABLE;case An.UNAUTHENTICATED:return se.UNAUTHENTICATED;case An.INVALID_ARGUMENT:return se.INVALID_ARGUMENT;case An.NOT_FOUND:return se.NOT_FOUND;case An.ALREADY_EXISTS:return se.ALREADY_EXISTS;case An.PERMISSION_DENIED:return se.PERMISSION_DENIED;case An.FAILED_PRECONDITION:return se.FAILED_PRECONDITION;case An.ABORTED:return se.ABORTED;case An.OUT_OF_RANGE:return se.OUT_OF_RANGE;case An.UNIMPLEMENTED:return se.UNIMPLEMENTED;case An.DATA_LOSS:return se.DATA_LOSS;default:return Pe(39323,{code:n})}}(Vt=An||(An={}))[Vt.OK=0]="OK",Vt[Vt.CANCELLED=1]="CANCELLED",Vt[Vt.UNKNOWN=2]="UNKNOWN",Vt[Vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vt[Vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vt[Vt.NOT_FOUND=5]="NOT_FOUND",Vt[Vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vt[Vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vt[Vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vt[Vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vt[Vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vt[Vt.ABORTED=10]="ABORTED",Vt[Vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vt[Vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vt[Vt.INTERNAL=13]="INTERNAL",Vt[Vt.UNAVAILABLE=14]="UNAVAILABLE",Vt[Vt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nw(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sw=new Wr([4294967295,4294967295],0);function zh(n){const e=nw().encode(n),t=new Pb;return t.update(e),new Uint8Array(t.digest())}function Wh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Wr([t,s],0),new Wr([r,i],0)]}class Af{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new qa(`Invalid padding: ${t}`);if(s<0)throw new qa(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new qa(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new qa(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Wr.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Wr.fromNumber(s)));return r.compare(sw)===1&&(r=new Wr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=zh(e),[s,r]=Wh(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Af(i,r,t);return s.forEach(l=>o.insert(l)),o}insert(e){if(this.ge===0)return;const t=zh(e),[s,r]=Wh(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class qa extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,Bl.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Rl(Ke.min(),r,new sn(nt),bs(),bt())}}class Bl{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Bl(s,t,bt(),bt(),bt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class MN{constructor(e,t){this.targetId=e,this.Ce=t}}class FN{constructor(e,t,s=Dn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class Kh{constructor(){this.ve=0,this.Fe=Gh(),this.Me=Dn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=bt(),t=bt(),s=bt();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:Pe(38017,{changeType:i})}}),new Bl(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=Gh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Me(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class rw{constructor(e){this.Ge=e,this.ze=new Map,this.je=bs(),this.Je=rc(),this.He=rc(),this.Ye=new sn(nt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:Pe(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((s,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(nu(i))if(s===0){const o=new Ae(i.path);this.et(t,o,hn.newNoDocument(o,Ke.min()))}else Me(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const l=this.ut(e),u=l?this.ct(l,e,o):1;if(u!==0){this.it(t);const m=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,m)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,l;try{o=gr(s).toUint8Array()}catch(u){if(u instanceof oN)return ml("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Af(o,r,i)}catch(u){return ml(u instanceof qa?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach(i=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const l=this.ot(o);if(l){if(i.current&&nu(l.target)){const u=new Ae(l.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,hn.newNoDocument(u,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let s=bt();this.He.forEach((i,o)=>{let l=!0;o.forEachWhile(u=>{const m=this.ot(u);return!m||m.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(s=s.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const r=new Rl(e,t,this.Ye,this.je,s);return this.je=bs(),this.Je=rc(),this.He=rc(),this.Ye=new sn(nt),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Kh,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Wt(nt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Wt(nt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||pe("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Kh),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function rc(){return new sn(Ae.comparator)}function Gh(){return new sn(Ae.comparator)}const iw={asc:"ASCENDING",desc:"DESCENDING"},ow={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aw={and:"AND",or:"OR"};class lw{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vd(n,e){return n.useProto3Json||Iu(e)?e:{value:e}}function Qo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ON(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function cw(n,e){return Qo(n,e.toTimestamp())}function os(n){return Me(!!n,49232),Ke.fromTimestamp(function(t){const s=hr(t);return new be(s.seconds,s.nanos)}(n))}function wf(n,e){return _d(n,e).canonicalString()}function _d(n,e){const t=function(r){return new Ut(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function qN(n){const e=Ut.fromString(n);return Me(JN(e),10190,{key:e.toString()}),e}function ru(n,e){return wf(n.databaseId,e.path)}function Ii(n,e){const t=qN(e);if(t.get(1)!==n.databaseId.projectId)throw new xe(se.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new xe(se.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ae(WN(t))}function $N(n,e){return wf(n.databaseId,e)}function zN(n){const e=qN(n);return e.length===4?Ut.emptyPath():WN(e)}function Dd(n){return new Ut(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function WN(n){return Me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Qh(n,e,t){return{name:ru(n,e),fields:t.value.mapValue.fields}}function uw(n,e,t){const s=Ii(n,e.name),r=os(e.updateTime),i=e.createTime?os(e.createTime):Ke.min(),o=new es({mapValue:{fields:e.fields}}),l=hn.newFoundDocument(s,r,i,o);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function mw(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Pe(39313,{state:m})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(m,d){return m.useProto3Json?(Me(d===void 0||typeof d=="string",58123),Dn.fromBase64String(d||"")):(Me(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Dn.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(m){const d=m.code===void 0?se.UNKNOWN:HN(m.code);return new xe(d,m.message||"")}(o);t=new FN(s,r,i,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ii(n,s.document.name),i=os(s.document.updateTime),o=s.document.createTime?os(s.document.createTime):Ke.min(),l=new es({mapValue:{fields:s.document.fields}}),u=hn.newFoundDocument(r,i,o,l),m=s.targetIds||[],d=s.removedTargetIds||[];t=new Bc(m,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Ii(n,s.document),i=s.readTime?os(s.readTime):Ke.min(),o=hn.newNoDocument(r,i),l=s.removedTargetIds||[];t=new Bc([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Ii(n,s.document),i=s.removedTargetIds||[];t=new Bc([],i,r,null)}else{if(!("filter"in e))return Pe(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new ew(r,i),l=s.targetId;t=new MN(l,o)}}return t}function iu(n,e){let t;if(e instanceof ia)t={update:Qh(n,e.key,e.value)};else if(e instanceof jl)t={delete:ru(n,e.key)};else if(e instanceof br)t={update:Qh(n,e.key,e.data),updateMask:yw(e.fieldMask)};else{if(!(e instanceof UN))return Pe(16599,{Vt:e.type});t={verify:ru(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(i,o){const l=o.transform;if(l instanceof Wo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Ko)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Go)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof _l)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw Pe(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:cw(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Pe(27497)}(n,e.precondition)),t}function kd(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Bn.updateTime(os(i.updateTime)):i.exists!==void 0?Bn.exists(i.exists):Bn.none()}(e.currentDocument):Bn.none(),s=e.updateTransforms?e.updateTransforms.map(r=>function(o,l){let u=null;if("setToServerValue"in l)Me(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),u=new Wo;else if("appendMissingElements"in l){const d=l.appendMissingElements.values||[];u=new Ko(d)}else if("removeAllFromArray"in l){const d=l.removeAllFromArray.values||[];u=new Go(d)}else"increment"in l?u=new _l(o,l.increment):Pe(16584,{proto:l});const m=dn.fromServerFormat(l.fieldPath);return new jN(m,u)}(n,r)):[];if(e.update){e.update.name;const r=Ii(n,e.update.name),i=new es({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(u){const m=u.fieldPaths||[];return new ds(m.map(d=>dn.fromServerFormat(d)))}(e.updateMask);return new br(r,i,o,t,s)}return new ia(r,i,t,s)}if(e.delete){const r=Ii(n,e.delete);return new jl(r,t)}if(e.verify){const r=Ii(n,e.verify);return new UN(r,t)}return Pe(1463,{proto:e})}function dw(n,e){return n&&n.length>0?(Me(e!==void 0,14353),n.map(t=>function(r,i){let o=r.updateTime?os(r.updateTime):os(i);return o.isEqual(Ke.min())&&(o=os(i)),new XA(o,r.transformResults||[])}(t,e))):[]}function KN(n,e){return{documents:[$N(n,e.path)]}}function GN(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=$N(n,r);const i=function(m){if(m.length!==0)return XN(zt.create(m,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(m){if(m.length!==0)return m.map(d=>function(p){return{field:Eo(p.field),direction:pw(p.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=vd(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{ft:t,parent:r}}function QN(n){let e=zN(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){Me(s===1,65062);const d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const p=YN(f);return p instanceof zt&&xf(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(C){return new vl(Ao(C.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(p))}(t.orderBy));let l=null;t.limit&&(l=function(f){let p;return p=typeof f=="object"?f.value:f,Iu(p)?null:p}(t.limit));let u=null;t.startAt&&(u=function(f){const p=!!f.before,y=f.values||[];return new $o(y,p)}(t.startAt));let m=null;return t.endAt&&(m=function(f){const p=!f.before,y=f.values||[];return new $o(y,p)}(t.endAt)),_N(e,r,o,i,l,"F",u,m)}function fw(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Pe(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function YN(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Ao(t.unaryFilter.field);return Dt.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Ao(t.unaryFilter.field);return Dt.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ao(t.unaryFilter.field);return Dt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ao(t.unaryFilter.field);return Dt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Pe(61313);default:return Pe(60726)}}(n):n.fieldFilter!==void 0?function(t){return Dt.create(Ao(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Pe(58110);default:return Pe(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return zt.create(t.compositeFilter.filters.map(s=>YN(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Pe(1026)}}(t.compositeFilter.op))}(n):Pe(30097,{filter:n})}function pw(n){return iw[n]}function hw(n){return ow[n]}function gw(n){return aw[n]}function Eo(n){return{fieldPath:n.canonicalString()}}function Ao(n){return dn.fromServerFormat(n.fieldPath)}function XN(n){return n instanceof Dt?function(t){if(t.op==="=="){if(Ph(t.value))return{unaryFilter:{field:Eo(t.field),op:"IS_NAN"}};if(Th(t.value))return{unaryFilter:{field:Eo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ph(t.value))return{unaryFilter:{field:Eo(t.field),op:"IS_NOT_NAN"}};if(Th(t.value))return{unaryFilter:{field:Eo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Eo(t.field),op:hw(t.op),value:t.value}}}(n):n instanceof zt?function(t){const s=t.getFilters().map(r=>XN(r));return s.length===1?s[0]:{compositeFilter:{op:gw(t.op),filters:s}}}(n):Pe(54877,{filter:n})}function yw(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function JN(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e,t,s,r,i=Ke.min(),o=Ke.min(),l=Dn.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new ur(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ur(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ur(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ur(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(e){this.yt=e}}function bw(n,e){let t;if(e.document)t=uw(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=Ae.fromSegments(e.noDocument.path),r=Mi(e.noDocument.readTime);t=hn.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Pe(56709);{const s=Ae.fromSegments(e.unknownDocument.path),r=Mi(e.unknownDocument.version);t=hn.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime(function(r){const i=new be(r[0],r[1]);return Ke.fromTimestamp(i)}(e.readTime)),t}function Yh(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ou(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(i,o){return{name:ru(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Qo(i,o.version.toTimestamp()),createTime:Qo(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:Hi(e.version)};else{if(!e.isUnknownDocument())return Pe(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:Hi(e.version)}}return s}function ou(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Hi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Mi(n){const e=new be(n.seconds,n.nanoseconds);return Ke.fromTimestamp(e)}function Di(n,e){const t=(e.baseMutations||[]).map(i=>kd(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const s=e.mutations.map(i=>kd(n.yt,i)),r=be.fromMillis(e.localWriteTimeMs);return new Df(e.batchId,r,t,s)}function $a(n){const e=Mi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Mi(n.lastLimboFreeSnapshotVersion):Ke.min();let s;return s=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return Me(o===1,1966,{count:o}),xs(Pl(zN(i.documents[0])))}(n.query):function(i){return xs(QN(i))}(n.query),new ur(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Dn.fromBase64String(n.resumeToken))}function e0(n,e){const t=Hi(e.snapshotVersion),s=Hi(e.lastLimboFreeSnapshotVersion);let r;r=nu(e.target)?KN(n.yt,e.target):GN(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ui(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function t0(n){const e=QN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?xd(e,e.limit,"L"):e}function Am(n,e){return new Ef(e.largestBatchId,kd(n.yt,e.overlayMutation))}function Xh(n,e){const t=e.path.lastSegment();return[n,ts(e.path.popLast()),t]}function Jh(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:Hi(s.readTime),documentKey:ts(s.documentKey.path),largestBatchId:s.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{getBundleMetadata(e,t){return Zh(e).get(t).next(s=>{if(s)return function(i){return{id:i.bundleId,createTime:Mi(i.createTime),version:i.version}}(s)})}saveBundleMetadata(e,t){return Zh(e).put(function(r){return{bundleId:r.id,createTime:Hi(os(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return eg(e).get(t).next(s=>{if(s)return function(i){return{name:i.name,query:t0(i.bundledQuery),readTime:Mi(i.readTime)}}(s)})}saveNamedQuery(e,t){return eg(e).put(function(r){return{name:r.name,readTime:Hi(os(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function Zh(n){return Un(n,Su)}function eg(n){return Un(n,Tu)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new Hu(e,s)}getOverlay(e,t){return va(e).get(Xh(this.userId,t)).next(s=>s?Am(this.serializer,s):null)}getOverlays(e,t){const s=Ys();return $.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){const r=[];return s.forEach((i,o)=>{const l=new Ef(t,o);r.push(this.St(e,l))}),$.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach(o=>r.add(ts(o.getCollectionPath())));const i=[];return r.forEach(o=>{const l=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);i.push(va(e).Z(dd,l))}),$.waitFor(i)}getOverlaysForCollection(e,t,s){const r=Ys(),i=ts(t),o=IDBKeyRange.bound([this.userId,i,s],[this.userId,i,Number.POSITIVE_INFINITY],!0);return va(e).J(dd,o).next(l=>{for(const u of l){const m=Am(this.serializer,u);r.set(m.getKey(),m)}return r})}getOverlaysForCollectionGroup(e,t,s,r){const i=Ys();let o;const l=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return va(e).ee({index:eN,range:l},(u,m,d)=>{const f=Am(this.serializer,m);i.size()<r||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}St(e,t){return va(e).put(function(r,i,o){const[l,u,m]=Xh(i,o.mutation.key);return{userId:i,collectionPath:u,documentId:m,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:iu(r.yt,o.mutation)}}(this.serializer,this.userId,t))}}function va(n){return Un(n,Pu)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{bt(e){return Un(e,hf)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const s=t==null?void 0:t.value;return s?Dn.fromUint8Array(s):Dn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ln(e.integerValue));else if("doubleValue"in e){const s=ln(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),fl(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=hr(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(gr(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?dN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ju(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Pe(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){var o,l;const s=e.fields||{};this.Ft(t,53);const r=Oo,i=((l=(o=s[r].arrayValue)==null?void 0:o.values)==null?void 0:l.length)||0;this.Ft(t,15),t.Mt(ln(i)),this.Ot(r,t),this.Ct(s[r],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Ae.fromName(e).path.forEach(s=>{this.Ft(t,60),this.Ut(s,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ki.Kt=new ki;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so=255;function vw(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function tg(n){const e=64-function(s){let r=0;for(let i=0;i<8;++i){const o=vw(255&s[i]);if(r+=o,o!==8)break}return r}(n);return Math.ceil(e/8)}class _w{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),s=tg(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=tg(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(so),this.sn(255)}_n(){this.an(so),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===so?(this.sn(so),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===so?(this.an(so),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class Dw{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class kw{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class _a{constructor(){this.cn=new _w,this.ln=new Dw(this.cn),this.hn=new kw(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new Ei(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:Uc(this.En),directionalValue:Uc(this.dn),orderedDocumentKey:Uc(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function wr(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=ng(n.En,e.En),t!==0?t:(t=ng(n.dn,e.dn),t!==0?t:Ae.comparator(n.In,e.In)))}function ng(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function Uc(n){return vb()?function(t){let s="";for(let r=0;r<t.length;r++)s+=String.fromCharCode(t[r]);return s}(n):n}function sg(n){return typeof n!="string"?n:function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(n)}class rg{constructor(e){this.mn=new Wt((t,s)=>dn.comparator(t.field,s.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(Me(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=cd(e);if(t!==void 0&&!this.wn(t))return!1;const s=xi(e);let r=new Set,i=0,o=0;for(;i<s.length&&this.wn(s[i]);++i)r=r.add(s[i].fieldPath.canonicalString());if(i===s.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!r.has(l.field.canonicalString())){const u=s[i];if(!this.Sn(l,u)||!this.bn(this.fn[o++],u))return!1}++i}for(;i<s.length;++i){const l=s[i];if(o>=this.fn.length||!this.bn(this.fn[o++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new Wt(dn.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new Ic(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new Ic(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new Ic(s.field,s.dir==="asc"?0:1)));return new Xc(Xc.UNKNOWN_ID,this.collectionId,t,dl.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n0(n){var t,s;if(Me(n instanceof Dt||n instanceof zt,20012),n instanceof Dt){if(n instanceof vN){const r=((s=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:s.map(i=>Dt.create(n.field,"==",i)))||[];return zt.create(r,"or")}return n}const e=n.filters.map(r=>n0(r));return zt.create(e,n.op)}function Ew(n){if(n.getFilters().length===0)return[];const e=wd(n0(n));return Me(s0(e),7391),Ed(e)||Ad(e)?[e]:e.getFilters()}function Ed(n){return n instanceof Dt}function Ad(n){return n instanceof zt&&xf(n)}function s0(n){return Ed(n)||Ad(n)||function(t){if(t instanceof zt&&gd(t)){for(const s of t.getFilters())if(!Ed(s)&&!Ad(s))return!1;return!0}return!1}(n)}function wd(n){if(Me(n instanceof Dt||n instanceof zt,34018),n instanceof Dt)return n;if(n.filters.length===1)return wd(n.filters[0]);const e=n.filters.map(s=>wd(s));let t=zt.create(e,n.op);return t=au(t),s0(t)?t:(Me(t instanceof zt,64498),Me(zo(t),40251),Me(t.filters.length>1,57927),t.filters.reduce((s,r)=>Vf(s,r)))}function Vf(n,e){let t;return Me(n instanceof Dt||n instanceof zt,38388),Me(e instanceof Dt||e instanceof zt,25473),t=n instanceof Dt?e instanceof Dt?function(r,i){return zt.create([r,i],"and")}(n,e):ig(n,e):e instanceof Dt?ig(e,n):function(r,i){if(Me(r.filters.length>0&&i.filters.length>0,48005),zo(r)&&zo(i))return bN(r,i.getFilters());const o=gd(r)?r:i,l=gd(r)?i:r,u=o.filters.map(m=>Vf(m,l));return zt.create(u,"or")}(n,e),au(t)}function ig(n,e){if(zo(e))return bN(e,n.getFilters());{const t=e.filters.map(s=>Vf(n,s));return zt.create(t,"or")}}function au(n){if(Me(n instanceof Dt||n instanceof zt,11850),n instanceof Dt)return n;const e=n.getFilters();if(e.length===1)return au(e[0]);if(gN(n))return n;const t=e.map(r=>au(r)),s=[];return t.forEach(r=>{r instanceof Dt?s.push(r):r instanceof zt&&(r.op===n.op?s.push(...r.filters):s.push(r))}),s.length===1?s[0]:zt.create(s,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(){this.Cn=new Cf}addToCollectionParentIndex(e,t){return this.Cn.add(t),$.resolve()}getCollectionParents(e,t){return $.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return $.resolve()}deleteFieldIndex(e,t){return $.resolve()}deleteAllFieldIndexes(e){return $.resolve()}createTargetIndexes(e,t){return $.resolve()}getDocumentsMatchingTarget(e,t){return $.resolve(null)}getIndexType(e,t){return $.resolve(0)}getFieldIndexes(e,t){return $.resolve([])}getNextCollectionGroupToUpdate(e){return $.resolve(null)}getMinOffset(e,t){return $.resolve(vs.min())}getMinOffsetFromCollectionGroup(e,t){return $.resolve(vs.min())}updateCollectionGroup(e,t,s){return $.resolve()}updateIndexEntries(e,t){return $.resolve()}}class Cf{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Wt(Ut.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Wt(Ut.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const og="IndexedDbIndexManager",ic=new Uint8Array(0);class ww{constructor(e,t){this.databaseId=t,this.vn=new Cf,this.Fn=new yr(s=>Ui(s),(s,r)=>Tl(s,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:s,parent:ts(r)};return ag(e).put(i)}return $.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[Mb(t),""],!1,!0);return ag(e).J(r).next(i=>{for(const o of i){if(o.collectionId!==t)break;s.push(Qs(o.parent))}return s})}addFieldIndex(e,t){const s=Da(e),r=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete r.indexId;const i=s.add(r);if(t.indexState){const o=io(e);return i.next(l=>{o.put(Jh(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const s=Da(e),r=io(e),i=ro(e);return s.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Da(e),s=ro(e),r=io(e);return t.Z().next(()=>s.Z()).next(()=>r.Z())}createTargetIndexes(e,t){return $.forEach(this.Mn(t),s=>this.getIndexType(e,s).next(r=>{if(r===0||r===1){const i=new rg(s).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const s=ro(e);let r=!0;const i=new Map;return $.forEach(this.Mn(t),o=>this.xn(e,o).next(l=>{r&&(r=!!l),i.set(o,l)})).next(()=>{if(r){let o=bt();const l=[];return $.forEach(i,(u,m)=>{pe(og,`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(re=>`${re.fieldPath}:${re.kind}`).join(",")}`}(u)} to execute ${Ui(t)}`);const d=function(F,re){const ee=cd(re);if(ee===void 0)return null;for(const M of su(F,ee.fieldPath))switch(M.op){case"array-contains-any":return M.value.arrayValue.values||[];case"array-contains":return[M.value]}return null}(m,u),f=function(F,re){const ee=new Map;for(const M of xi(re))for(const A of su(F,M.fieldPath))switch(A.op){case"==":case"in":ee.set(M.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return ee.set(M.fieldPath.canonicalString(),A.value),Array.from(ee.values())}return null}(m,u),p=function(F,re){const ee=[];let M=!0;for(const A of xi(re)){const N=A.kind===0?Uh(F,A.fieldPath,F.startAt):Hh(F,A.fieldPath,F.startAt);ee.push(N.value),M&&(M=N.inclusive)}return new $o(ee,M)}(m,u),y=function(F,re){const ee=[];let M=!0;for(const A of xi(re)){const N=A.kind===0?Hh(F,A.fieldPath,F.endAt):Uh(F,A.fieldPath,F.endAt);ee.push(N.value),M&&(M=N.inclusive)}return new $o(ee,M)}(m,u),C=this.On(u,m,p),v=this.On(u,m,y),w=this.Nn(u,m,f),R=this.Bn(u.indexId,d,C,p.inclusive,v,y.inclusive,w);return $.forEach(R,I=>s.Y(I,t.limit).next(F=>{F.forEach(re=>{const ee=Ae.fromSegments(re.documentKey);o.has(ee)||(o=o.add(ee),l.push(ee))})}))}).next(()=>l)}return $.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=Ew(zt.create(e.filters,"and")).map(s=>bd(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,s,r,i,o,l){const u=(t!=null?t.length:1)*Math.max(s.length,i.length),m=u/(t!=null?t.length:1),d=[];for(let f=0;f<u;++f){const p=t?this.Ln(t[f/m]):ic,y=this.kn(e,p,s[f%m],r),C=this.qn(e,p,i[f%m],o),v=l.map(w=>this.kn(e,p,w,!0));d.push(...this.createRange(y,C,v))}return d}kn(e,t,s,r){const i=new Ei(e,Ae.empty(),t,s);return r?i:i.An()}qn(e,t,s,r){const i=new Ei(e,Ae.empty(),t,s);return r?i.An():i}xn(e,t){const s=new rg(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(i=>{let o=null;for(const l of i)s.yn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,t){let s=2;const r=this.Mn(t);return $.forEach(r,i=>this.xn(e,i).next(o=>{o?s!==0&&o.fields.length<function(u){let m=new Wt(dn.comparator),d=!1;for(const f of u.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?d=!0:m=m.add(p.field));for(const f of u.orderBy)f.field.isKeyField()||(m=m.add(f.field));return m.size+(d?1:0)}(i)&&(s=1):s=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&s===2?1:s)}Qn(e,t){const s=new _a;for(const r of xi(e)){const i=t.data.field(r.fieldPath);if(i==null)return null;const o=s.Pn(r.kind);ki.Kt.Dt(i,o)}return s.un()}Ln(e){const t=new _a;return ki.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new _a;return ki.Kt.Dt(Nl(this.databaseId,t),s.Pn(function(i){const o=xi(i);return o.length===0?0:o[o.length-1].kind}(e))),s.un()}Nn(e,t,s){if(s===null)return[];let r=[];r.push(new _a);let i=0;for(const o of xi(e)){const l=s[i++];for(const u of r)if(this.Un(t,o.fieldPath)&&xl(l))r=this.Kn(r,o,l);else{const m=u.Pn(o.kind);ki.Kt.Dt(l,m)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],i=[];for(const o of s.arrayValue.values||[])for(const l of r){const u=new _a;u.seed(l.un()),ki.Kt.Dt(o,u.Pn(t.kind)),i.push(u)}return i}Un(e,t){return!!e.filters.find(s=>s instanceof Dt&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in"))}getFieldIndexes(e,t){const s=Da(e),r=io(e);return(t?s.J(md,IDBKeyRange.bound(t,t)):s.J()).next(i=>{const o=[];return $.forEach(i,l=>r.get([l.indexId,this.uid]).next(u=>{o.push(function(d,f){const p=f?new dl(f.sequenceNumber,new vs(Mi(f.readTime),new Ae(Qs(f.documentKey)),f.largestBatchId)):dl.empty(),y=d.fields.map(([C,v])=>new Ic(dn.fromServerFormat(C),v));return new Xc(d.indexId,d.collectionGroup,y,p)}(l,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((s,r)=>{const i=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return i!==0?i:nt(s.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,s){const r=Da(e),i=io(e);return this.Gn(e).next(o=>r.J(md,IDBKeyRange.bound(t,t)).next(l=>$.forEach(l,u=>i.put(Jh(u.indexId,this.uid,o,s)))))}updateIndexEntries(e,t){const s=new Map;return $.forEach(t,(r,i)=>{const o=s.get(r.collectionGroup);return(o?$.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(l=>(s.set(r.collectionGroup,l),$.forEach(l,u=>this.zn(e,r,u).next(m=>{const d=this.jn(i,u);return m.isEqual(d)?$.resolve():this.Jn(e,i,u,m,d)}))))})}Hn(e,t,s,r){return ro(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return ro(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=ro(e);let i=new Wt(wr);return r.ee({index:Zb,range:IDBKeyRange.only([s.indexId,this.uid,Uc(this.$n(s,t))])},(o,l)=>{i=i.add(new Ei(s.indexId,t,sg(l.arrayValue),sg(l.directionalValue)))}).next(()=>i)}jn(e,t){let s=new Wt(wr);const r=this.Qn(t,e);if(r==null)return s;const i=cd(t);if(i!=null){const o=e.data.field(i.fieldPath);if(xl(o))for(const l of o.arrayValue.values||[])s=s.add(new Ei(t.indexId,e.key,this.Ln(l),r))}else s=s.add(new Ei(t.indexId,e.key,ic,r));return s}Jn(e,t,s,r,i){pe(og,"Updating index entries for document '%s'",t.key);const o=[];return function(u,m,d,f,p){const y=u.getIterator(),C=m.getIterator();let v=no(y),w=no(C);for(;v||w;){let R=!1,I=!1;if(v&&w){const F=d(v,w);F<0?I=!0:F>0&&(R=!0)}else v!=null?I=!0:R=!0;R?(f(w),w=no(C)):I?(p(v),v=no(y)):(v=no(y),w=no(C))}}(r,i,wr,l=>{o.push(this.Hn(e,t,s,l))},l=>{o.push(this.Yn(e,t,s,l))}),$.waitFor(o)}Gn(e){let t=1;return io(e).ee({index:Jb,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(s,r,i)=>{i.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,s){s=s.sort((o,l)=>wr(o,l)).filter((o,l,u)=>!l||wr(o,u[l-1])!==0);const r=[];r.push(e);for(const o of s){const l=wr(o,e),u=wr(o,t);if(l===0)r[0]=e.An();else if(l>0&&u<0)r.push(o),r.push(o.An());else if(u>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Zn(r[o],r[o+1]))return[];const l=r[o].Vn(this.uid,ic,Ae.empty()),u=r[o+1].Vn(this.uid,ic,Ae.empty());i.push(IDBKeyRange.bound(l,u))}return i}Zn(e,t){return wr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lg)}getMinOffset(e,t){return $.mapArray(this.Mn(t),s=>this.xn(e,s).next(r=>r||Pe(44426))).next(lg)}}function ag(n){return Un(n,gl)}function ro(n){return Un(n,Ja)}function Da(n){return Un(n,pf)}function io(n){return Un(n,Xa)}function lg(n){Me(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;mf(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new vs(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},r0=41943040;class Zn{static withCacheSize(e){return new Zn(e,Zn.DEFAULT_COLLECTION_PERCENTILE,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i0(n,e,t){const s=n.store(Ps),r=n.store(Uo),i=[],o=IDBKeyRange.only(t.batchId);let l=0;const u=s.ee({range:o},(d,f,p)=>(l++,p.delete()));i.push(u.next(()=>{Me(l===1,47070,{batchId:t.batchId})}));const m=[];for(const d of t.mutations){const f=Qb(e,d.key.path,t.batchId);i.push(r.delete(f)),m.push(d.key)}return $.waitFor(i).next(()=>m)}function lu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Pe(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zn.DEFAULT_COLLECTION_PERCENTILE=10,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zn.DEFAULT=new Zn(r0,Zn.DEFAULT_COLLECTION_PERCENTILE,Zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zn.DISABLED=new Zn(-1,0,0);class Mu{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){Me(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Mu(i,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Vr(e).ee({index:Ai,range:s},(r,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,s,r){const i=wo(e),o=Vr(e);return o.add({}).next(l=>{Me(typeof l=="number",49019);const u=new Df(l,t,s,r),m=function(y,C,v){const w=v.baseMutations.map(I=>iu(y.yt,I)),R=v.mutations.map(I=>iu(y.yt,I));return{userId:C,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:w,mutations:R}}(this.serializer,this.userId,u),d=[];let f=new Wt((p,y)=>nt(p.canonicalString(),y.canonicalString()));for(const p of r){const y=Qb(this.userId,p.key.path,l);f=f.add(p.key.path.popLast()),d.push(o.put(m)),d.push(i.put(y,iA))}return f.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[l]=u.keys()}),$.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return Vr(e).get(t).next(s=>s?(Me(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),Di(this.serializer,s)):null)}er(e,t){return this.Xn[t]?$.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(s=>{if(s){const r=s.keys();return this.Xn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let i=null;return Vr(e).ee({index:Ai,range:r},(o,l,u)=>{l.userId===this.userId&&(Me(l.batchId>=s,47524,{tr:s}),i=Di(this.serializer,l)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=Vi;return Vr(e).ee({index:Ai,range:t,reverse:!0},(r,i,o)=>{s=i.batchId,o.done()}).next(()=>s)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Vi],[this.userId,Number.POSITIVE_INFINITY]);return Vr(e).J(Ai,t).next(s=>s.map(r=>Di(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Sc(this.userId,t.path),r=IDBKeyRange.lowerBound(s),i=[];return wo(e).ee({range:r},(o,l,u)=>{const[m,d,f]=o,p=Qs(d);if(m===this.userId&&t.path.isEqual(p))return Vr(e).get(f).next(y=>{if(!y)throw Pe(61480,{nr:o,batchId:f});Me(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(Di(this.serializer,y))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Wt(nt);const r=[];return t.forEach(i=>{const o=Sc(this.userId,i.path),l=IDBKeyRange.lowerBound(o),u=wo(e).ee({range:l},(m,d,f)=>{const[p,y,C]=m,v=Qs(y);p===this.userId&&i.path.isEqual(v)?s=s.add(C):f.done()});r.push(u)}),$.waitFor(r).next(()=>this.rr(e,s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,i=Sc(this.userId,s),o=IDBKeyRange.lowerBound(i);let l=new Wt(nt);return wo(e).ee({range:o},(u,m,d)=>{const[f,p,y]=u,C=Qs(p);f===this.userId&&s.isPrefixOf(C)?C.length===r&&(l=l.add(y)):d.done()}).next(()=>this.rr(e,l))}rr(e,t){const s=[],r=[];return t.forEach(i=>{r.push(Vr(e).get(i).next(o=>{if(o===null)throw Pe(35274,{batchId:i});Me(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),s.push(Di(this.serializer,o))}))}),$.waitFor(r).next(()=>s)}removeMutationBatch(e,t){return i0(e.le,this.userId,t).next(s=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),$.forEach(s,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return $.resolve();const s=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return wo(e).ee({range:s},(i,o,l)=>{if(i[0]===this.userId){const u=Qs(i[1]);r.push(u)}else l.done()}).next(()=>{Me(r.length===0,56720,{sr:r.map(i=>i.canonicalString())})})})}containsKey(e,t){return o0(e,this.userId,t)}_r(e){return a0(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Vi,lastStreamToken:""})}}function o0(n,e,t){const s=Sc(e,t.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return wo(n).ee({range:i,X:!0},(l,u,m)=>{const[d,f,p]=l;d===e&&f===r&&(o=!0),m.done()}).next(()=>o)}function Vr(n){return Un(n,Ps)}function wo(n){return Un(n,Uo)}function a0(n){return Un(n,pl)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Fi(0)}static cr(){return new Fi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const s=new Fi(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>Ke.fromTimestamp(new be(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,s){return this.lr(e).next(r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oo(e).delete(t.targetId)).next(()=>this.lr(e)).next(s=>(Me(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s)))}removeTargets(e,t,s){let r=0;const i=[];return oo(e).ee((o,l)=>{const u=$a(l);u.sequenceNumber<=t&&s.get(u.targetId)===null&&(r++,i.push(this.removeTargetData(e,u)))}).next(()=>$.waitFor(i)).next(()=>r)}forEachTarget(e,t){return oo(e).ee((s,r)=>{const i=$a(r);t(i)})}lr(e){return ug(e).get(eu).next(t=>(Me(t!==null,2888),t))}hr(e,t){return ug(e).put(eu,t)}Pr(e,t){return oo(e).put(e0(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const s=Ui(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let i=null;return oo(e).ee({range:r,index:Xb},(o,l,u)=>{const m=$a(l);Tl(t,m.target)&&(i=m,u.done())}).next(()=>i)}addMatchingKeys(e,t,s){const r=[],i=Ur(e);return t.forEach(o=>{const l=ts(o.path);r.push(i.put({targetId:s,path:l})),r.push(this.referenceDelegate.addReference(e,s,o))}),$.waitFor(r)}removeMatchingKeys(e,t,s){const r=Ur(e);return $.forEach(t,i=>{const o=ts(i.path);return $.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,i)])})}removeMatchingKeysForTargetId(e,t){const s=Ur(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ur(e);let i=bt();return r.ee({range:s,X:!0},(o,l,u)=>{const m=Qs(o[1]),d=new Ae(m);i=i.add(d)}).next(()=>i)}containsKey(e,t){const s=ts(t.path),r=IDBKeyRange.bound([s],[Mb(s)],!1,!0);let i=0;return Ur(e).ee({index:ff,X:!0,range:r},([o,l],u,m)=>{o!==0&&(i++,m.done())}).next(()=>i>0)}At(e,t){return oo(e).get(t).next(s=>s?$a(s):null)}}function oo(n){return Un(n,Ho)}function ug(n){return Un(n,Ci)}function Ur(n){return Un(n,Mo)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mg="LruGarbageCollector",l0=1048576;function dg([n,e],[t,s]){const r=nt(n,t);return r===0?nt(e,s):r}class Cw{constructor(e){this.Ir=e,this.buffer=new Wt(dg),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();dg(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class c0{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){pe(mg,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ni(t)?pe(mg,"Ignoring IndexedDB error during garbage collection: ",t):await ti(t)}await this.Vr(3e5)})}}class Iw{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return $.resolve(ms.ce);const s=new Cw(t);return this.mr.forEachTarget(e,r=>s.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>s.Ar(r))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),$.resolve(cg)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cg):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,l,u,m;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),r=this.params.maximumSequenceNumbersToCollect):r=f,o=Date.now(),this.nthSequenceNumber(e,r))).next(f=>(s=f,l=Date.now(),this.removeTargets(e,s,t))).next(f=>(i=f,u=Date.now(),this.removeOrphanedDocuments(e,s))).next(f=>(m=Date.now(),Do()<=Ct.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${f} documents in `+(m-u)+`ms
Total Duration: ${m-d}ms`),$.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:f})))}}function u0(n,e){return new Iw(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(e,t){this.db=e,this.garbageCollector=u0(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(s,r)=>t(r))}addReference(e,t,s){return oc(e,s)}removeReference(e,t,s){return oc(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return oc(e,t)}br(e,t){return function(r,i){let o=!1;return a0(r).te(l=>o0(r,l,i).next(u=>(u&&(o=!0),$.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Sr(e,(o,l)=>{if(l<=t){const u=this.br(e,o).next(m=>{if(!m)return i++,s.getEntry(e,o).next(()=>(s.removeEntry(o,Ke.min()),Ur(e).delete(function(f){return[0,ts(f.path)]}(o))))});r.push(u)}}).next(()=>$.waitFor(r)).next(()=>s.apply(e)).next(()=>i)}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return oc(e,t)}Sr(e,t){const s=Ur(e);let r,i=ms.ce;return s.ee({index:ff},([o,l],{path:u,sequenceNumber:m})=>{o===0?(i!==ms.ce&&t(new Ae(Qs(r)),i),i=m,r=u):i=ms.ce}).next(()=>{i!==ms.ce&&t(new Ae(Qs(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oc(n,e){return Ur(n).put(function(s,r){return{targetId:0,path:ts(s.path),sequenceNumber:r}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(){this.changes=new yr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,hn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?$.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return gi(e).put(s)}removeEntry(e,t,s){return gi(e).delete(function(i,o){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],ou(o),l[l.length-1]]}(t,s))}updateMetadata(e,t){return this.getMetadata(e).next(s=>(s.byteSize+=t,this.Dr(e,s)))}getEntry(e,t){let s=hn.newInvalidDocument(t);return gi(e).ee({index:Tc,range:IDBKeyRange.only(ka(t))},(r,i)=>{s=this.Cr(t,i)}).next(()=>s)}vr(e,t){let s={size:0,document:hn.newInvalidDocument(t)};return gi(e).ee({index:Tc,range:IDBKeyRange.only(ka(t))},(r,i)=>{s={document:this.Cr(t,i),size:lu(i)}}).next(()=>s)}getEntries(e,t){let s=bs();return this.Fr(e,t,(r,i)=>{const o=this.Cr(r,i);s=s.insert(r,o)}).next(()=>s)}Mr(e,t){let s=bs(),r=new sn(Ae.comparator);return this.Fr(e,t,(i,o)=>{const l=this.Cr(i,o);s=s.insert(i,l),r=r.insert(i,lu(o))}).next(()=>({documents:s,Or:r}))}Fr(e,t,s){if(t.isEmpty())return $.resolve();let r=new Wt(hg);t.forEach(u=>r=r.add(u));const i=IDBKeyRange.bound(ka(r.first()),ka(r.last())),o=r.getIterator();let l=o.getNext();return gi(e).ee({index:Tc,range:i},(u,m,d)=>{const f=Ae.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;l&&hg(l,f)<0;)s(l,null),l=o.getNext();l&&l.isEqual(f)&&(s(l,m),l=o.hasNext()?o.getNext():null),l?d.j(ka(l)):d.done()}).next(()=>{for(;l;)s(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,s,r,i){const o=t.path,l=[o.popLast().toArray(),o.lastSegment(),ou(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gi(e).J(IDBKeyRange.bound(l,u,!0)).next(m=>{i==null||i.incrementDocumentReadCount(m.length);let d=bs();for(const f of m){const p=this.Cr(Ae.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(Ll(t,p)||r.has(p.key))&&(d=d.insert(p.key,p))}return d})}getAllFromCollectionGroup(e,t,s,r){let i=bs();const o=pg(t,s),l=pg(t,vs.max());return gi(e).ee({index:Yb,range:IDBKeyRange.bound(o,l,!0)},(u,m,d)=>{const f=this.Cr(Ae.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);i=i.insert(f.key,f),i.size===r&&d.done()}).next(()=>i)}newChangeBuffer(e){return new Pw(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return fg(e).get(ud).next(t=>(Me(!!t,20021),t))}Dr(e,t){return fg(e).put(ud,t)}Cr(e,t){if(t){const s=bw(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(Ke.min())))return s}return hn.newInvalidDocument(e)}}function d0(n){return new Tw(n)}class Pw extends m0{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new yr(s=>s.toString(),(s,r)=>s.isEqual(r))}applyChanges(e){const t=[];let s=0,r=new Wt((i,o)=>nt(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const l=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,l.readTime)),o.isValidDocument()){const u=Yh(this.Nr.serializer,o);r=r.add(i.path.popLast());const m=lu(u);s+=m-l.size,t.push(this.Nr.addEntry(e,i,u))}else if(s-=l.size,this.trackRemovals){const u=Yh(this.Nr.serializer,o.convertToNoDocument(Ke.min()));t.push(this.Nr.addEntry(e,i,u))}}),r.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,s)),$.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:s,Or:r})=>(r.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:s.get(i).readTime})}),s))}}function fg(n){return Un(n,hl)}function gi(n){return Un(n,Zc)}function ka(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function pg(n,e){const t=e.documentKey.path.toArray();return[n,ou(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function hg(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<s.length-2;++i)if(r=nt(t[i],s[i]),r)return r;return r=nt(t.length,s.length),r||(r=nt(t[t.length-2],s[s.length-2]),r||nt(t[t.length-1],s[s.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(s!==null&&nl(s.mutation,r,ds.empty(),be.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,bt()).next(()=>s))}getLocalViewOfDocuments(e,t,s=bt()){const r=Ys();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let o=Oa();return i.forEach((l,u)=>{o=o.insert(l,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=Ys();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,bt()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,s,r){let i=bs();const o=tl(),l=function(){return tl()}();return t.forEach((u,m)=>{const d=s.get(m.key);r.has(m.key)&&(d===void 0||d.mutation instanceof br)?i=i.insert(m.key,m):d!==void 0?(o.set(m.key,d.mutation.getFieldMask()),nl(d.mutation,m,d.mutation.getFieldMask(),be.now())):o.set(m.key,ds.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((m,d)=>o.set(m,d)),t.forEach((m,d)=>l.set(m,new Lw(d,o.get(m)??null))),l))}recalculateAndSaveOverlays(e,t){const s=tl();let r=new sn((o,l)=>o-l),i=bt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const l of o)l.keys().forEach(u=>{const m=t.get(u);if(m===null)return;let d=s.get(u)||ds.empty();d=l.applyToLocalView(m,d),s.set(u,d);const f=(r.get(l.batchId)||bt()).add(u);r=r.insert(l.batchId,f)})}).next(()=>{const o=[],l=r.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),m=u.key,d=u.value,f=CN();d.forEach(p=>{if(!i.has(p)){const y=RN(t.get(p),s.get(p));y!==null&&f.set(p,y),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,m,f))}return $.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,r){return function(o){return Ae.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):DN(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):$.resolve(Ys());let l=Bo,u=i;return o.next(m=>$.forEach(m,(d,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),i.get(d)?$.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{u=u.insert(d,p)}))).next(()=>this.populateOverlays(e,m,i)).next(()=>this.computeViews(e,u,m,bt())).next(d=>({batchId:l,changes:VN(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ae(t)).next(s=>{let r=Oa();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Oa();return this.indexManager.getCollectionParents(e,i).next(l=>$.forEach(l,u=>{const m=function(f,p){return new ra(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,m,s,r).next(d=>{d.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r))).next(o=>{i.forEach((u,m)=>{const d=m.getKey();o.get(d)===null&&(o=o.insert(d,hn.newInvalidDocument(d)))});let l=Oa();return o.forEach((u,m)=>{const d=i.get(u);d!==void 0&&nl(d.mutation,m,ds.empty(),be.now()),Ll(t,m)&&(l=l.insert(u,m))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return $.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:os(r.createTime)}}(t)),$.resolve()}getNamedQuery(e,t){return $.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(r){return{name:r.name,query:t0(r.bundledQuery),readTime:os(r.readTime)}}(t)),$.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(){this.overlays=new sn(Ae.comparator),this.qr=new Map}getOverlay(e,t){return $.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Ys();return $.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.St(e,t,i)}),$.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(s)),$.resolve()}getOverlaysForCollection(e,t,s){const r=Ys(),i=t.length+1,o=new Ae(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const u=l.getNext().value,m=u.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===i&&u.largestBatchId>s&&r.set(u.getKey(),u)}return $.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new sn((m,d)=>m-d);const o=this.overlays.getIterator();for(;o.hasNext();){const m=o.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>s){let d=i.get(m.largestBatchId);d===null&&(d=Ys(),i=i.insert(m.largestBatchId,d)),d.set(m.getKey(),m)}}const l=Ys(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((m,d)=>l.set(m,d)),!(l.size()>=r)););return $.resolve(l)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new Ef(t,s));let i=this.qr.get(t);i===void 0&&(i=bt(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(){this.sessionToken=Dn.EMPTY_BYTE_STRING}getSessionToken(e){return $.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,$.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(){this.Qr=new Wt(On.$r),this.Ur=new Wt(On.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new On(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Gr(new On(e,t))}zr(e,t){e.forEach(s=>this.removeReference(s,t))}jr(e){const t=new Ae(new Ut([])),s=new On(t,e),r=new On(t,e+1),i=[];return this.Ur.forEachInRange([s,r],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ae(new Ut([])),s=new On(t,e),r=new On(t,e+1);let i=bt();return this.Ur.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new On(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class On{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ae.comparator(e.key,t.key)||nt(e.Yr,t.Yr)}static Kr(e,t){return nt(e.Yr,t.Yr)||Ae.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Wt(On.$r)}checkEmpty(e){return $.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Df(i,t,s,r);this.mutationQueue.push(o);for(const l of r)this.Zr=this.Zr.add(new On(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return $.resolve(o)}lookupMutationBatch(e,t){return $.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return $.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return $.resolve(this.mutationQueue.length===0?Vi:this.tr-1)}getAllMutationBatches(e){return $.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new On(t,0),r=new On(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],o=>{const l=this.Xr(o.Yr);i.push(l)}),$.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Wt(nt);return t.forEach(r=>{const i=new On(r,0),o=new On(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],l=>{s=s.add(l.Yr)})}),$.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;Ae.isDocumentKey(i)||(i=i.child(""));const o=new On(new Ae(i),0);let l=new Wt(nt);return this.Zr.forEachWhile(u=>{const m=u.key.path;return!!s.isPrefixOf(m)&&(m.length===r&&(l=l.add(u.Yr)),!0)},o),$.resolve(this.ti(l))}ti(e){const t=[];return e.forEach(s=>{const r=this.Xr(s);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Me(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return $.forEach(t.mutations,r=>{const i=new On(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new On(t,0),r=this.Zr.firstAfterOrEqual(s);return $.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,$.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e){this.ri=e,this.docs=function(){return new sn(Ae.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return $.resolve(s?s.document.mutableCopy():hn.newInvalidDocument(t))}getEntries(e,t){let s=bs();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():hn.newInvalidDocument(r))}),$.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=bs();const o=t.path,l=new Ae(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:m,value:{document:d}}=u.getNext();if(!o.isPrefixOf(m.path))break;m.path.length>o.length+1||mf($b(d),s)<=0||(r.has(d.key)||Ll(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return $.resolve(i)}getAllFromCollectionGroup(e,t,s,r){Pe(9500)}ii(e,t){return $.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new Mw(this)}getSize(e){return $.resolve(this.size)}}class Mw extends m0{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)}),$.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e){this.persistence=e,this.si=new yr(t=>Ui(t),Tl),this.lastRemoteSnapshotVersion=Ke.min(),this.highestTargetId=0,this.oi=0,this._i=new If,this.targetCount=0,this.ai=Fi.ur()}forEachTarget(e,t){return this.si.forEach((s,r)=>t(r)),$.resolve()}getLastRemoteSnapshotVersion(e){return $.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),$.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),$.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Fi(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,$.resolve()}updateTargetData(e,t){return this.Pr(t),$.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,$.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach((o,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)}),$.waitFor(i).next(()=>r)}getTargetCount(e){return $.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return $.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),$.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),$.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),$.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return $.resolve(s)}containsKey(e,t){return $.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e,t){this.ui={},this.overlays={},this.ci=new ms(0),this.li=!1,this.li=!0,this.hi=new Bw,this.referenceDelegate=e(this),this.Pi=new Fw(this),this.indexManager=new Aw,this.remoteDocumentCache=function(r){return new Hw(r)}(s=>this.referenceDelegate.Ti(s)),this.serializer=new ZN(t),this.Ii=new jw(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Rw,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new Uw(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){pe("MemoryPersistence","Starting transaction:",e);const r=new Ow(this.ci.next());return this.referenceDelegate.Ei(),s(r).next(i=>this.referenceDelegate.di(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Ai(e,t){return $.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class Ow extends Wb{constructor(e){super(),this.currentSequenceNumber=e}}class Fu{constructor(e){this.persistence=e,this.Ri=new If,this.Vi=null}static mi(e){return new Fu(e)}get fi(){if(this.Vi)return this.Vi;throw Pe(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),$.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),$.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),$.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(r=>this.fi.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.fi.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $.forEach(this.fi,s=>{const r=Ae.fromPath(s);return this.gi(e,r).next(i=>{i||t.removeEntry(r,Ke.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return $.or([()=>$.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class cu{constructor(e,t){this.persistence=e,this.pi=new yr(s=>ts(s.path),(s,r)=>s.isEqual(r)),this.garbageCollector=u0(this,t)}static mi(e,t){return new cu(e,t)}Ei(){}di(e){return $.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}pr(e,t){return $.forEach(this.pi,(s,r)=>this.br(e,s,r).next(i=>i?$.resolve():t(r)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,o=>this.br(e,o,t).next(l=>{l||(s++,i.removeEntry(o,Ke.min()))})).next(()=>i.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),$.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),$.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),$.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),$.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Lc(e.data.value)),t}br(e,t,s){return $.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return $.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e){this.serializer=e}k(e,t,s,r){const i=new Cu("createOrUpgrade",t);s<1&&r>=1&&(function(u){u.createObjectStore(Sl)}(e),function(u){u.createObjectStore(pl,{keyPath:rA}),u.createObjectStore(Ps,{keyPath:Ah,autoIncrement:!0}).createIndex(Ai,wh,{unique:!0}),u.createObjectStore(Uo)}(e),gg(e),function(u){u.createObjectStore(vi)}(e));let o=$.resolve();return s<3&&r>=3&&(s!==0&&(function(u){u.deleteObjectStore(Mo),u.deleteObjectStore(Ho),u.deleteObjectStore(Ci)}(e),gg(e)),o=o.next(()=>function(u){const m=u.store(Ci),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ke.min().toTimestamp(),targetCount:0};return m.put(eu,d)}(i))),s<4&&r>=4&&(s!==0&&(o=o.next(()=>function(u,m){return m.store(Ps).J().next(f=>{u.deleteObjectStore(Ps),u.createObjectStore(Ps,{keyPath:Ah,autoIncrement:!0}).createIndex(Ai,wh,{unique:!0});const p=m.store(Ps),y=f.map(C=>p.put(C));return $.waitFor(y)})}(e,i))),o=o.next(()=>{(function(u){u.createObjectStore(Fo,{keyPath:fA})})(e)})),s<5&&r>=5&&(o=o.next(()=>this.yi(i))),s<6&&r>=6&&(o=o.next(()=>(function(u){u.createObjectStore(hl)}(e),this.wi(i)))),s<7&&r>=7&&(o=o.next(()=>this.Si(i))),s<8&&r>=8&&(o=o.next(()=>this.bi(e,i))),s<9&&r>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),s<10&&r>=10&&(o=o.next(()=>this.Di(i))),s<11&&r>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(Su,{keyPath:pA})})(e),function(u){u.createObjectStore(Tu,{keyPath:hA})}(e)})),s<12&&r>=12&&(o=o.next(()=>{(function(u){const m=u.createObjectStore(Pu,{keyPath:_A});m.createIndex(dd,DA,{unique:!1}),m.createIndex(eN,kA,{unique:!1})})(e)})),s<13&&r>=13&&(o=o.next(()=>function(u){const m=u.createObjectStore(Zc,{keyPath:oA});m.createIndex(Tc,aA),m.createIndex(Yb,lA)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(vi))),s<14&&r>=14&&(o=o.next(()=>this.Fi(e,i))),s<15&&r>=15&&(o=o.next(()=>function(u){u.createObjectStore(pf,{keyPath:gA,autoIncrement:!0}).createIndex(md,yA,{unique:!1}),u.createObjectStore(Xa,{keyPath:bA}).createIndex(Jb,NA,{unique:!1}),u.createObjectStore(Ja,{keyPath:xA}).createIndex(Zb,vA,{unique:!1})}(e))),s<16&&r>=16&&(o=o.next(()=>{t.objectStore(Xa).clear()}).next(()=>{t.objectStore(Ja).clear()})),s<17&&r>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(hf,{keyPath:EA})})(e)})),s<18&&r>=18&&vb()&&(o=o.next(()=>{t.objectStore(Xa).clear()}).next(()=>{t.objectStore(Ja).clear()})),o}wi(e){let t=0;return e.store(vi).ee((s,r)=>{t+=lu(r)}).next(()=>{const s={byteSize:t};return e.store(hl).put(ud,s)})}yi(e){const t=e.store(pl),s=e.store(Ps);return t.J().next(r=>$.forEach(r,i=>{const o=IDBKeyRange.bound([i.userId,Vi],[i.userId,i.lastAcknowledgedBatchId]);return s.J(Ai,o).next(l=>$.forEach(l,u=>{Me(u.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});const m=Di(this.serializer,u);return i0(e,i.userId,m).next(()=>{})}))}))}Si(e){const t=e.store(Mo),s=e.store(vi);return e.store(Ci).get(eu).next(r=>{const i=[];return s.ee((o,l)=>{const u=new Ut(o),m=function(f){return[0,ts(f)]}(u);i.push(t.get(m).next(d=>d?$.resolve():(f=>t.put({targetId:0,path:ts(f),sequenceNumber:r.highestListenSequenceNumber}))(u)))}).next(()=>$.waitFor(i))})}bi(e,t){e.createObjectStore(gl,{keyPath:dA});const s=t.store(gl),r=new Cf,i=o=>{if(r.add(o)){const l=o.lastSegment(),u=o.popLast();return s.put({collectionId:l,parent:ts(u)})}};return t.store(vi).ee({X:!0},(o,l)=>{const u=new Ut(o);return i(u.popLast())}).next(()=>t.store(Uo).ee({X:!0},([o,l,u],m)=>{const d=Qs(l);return i(d.popLast())}))}Di(e){const t=e.store(Ho);return t.ee((s,r)=>{const i=$a(r),o=e0(this.serializer,i);return t.put(o)})}Ci(e,t){const s=t.store(vi),r=[];return s.ee((i,o)=>{const l=t.store(Zc),u=function(f){return f.document?new Ae(Ut.fromString(f.document.name).popFirst(5)):f.noDocument?Ae.fromSegments(f.noDocument.path):f.unknownDocument?Ae.fromSegments(f.unknownDocument.path):Pe(36783)}(o).path.toArray(),m={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(l.put(m))}).next(()=>$.waitFor(r))}Fi(e,t){const s=t.store(Ps),r=d0(this.serializer),i=new Sf(Fu.mi,this.serializer.yt);return s.J().next(o=>{const l=new Map;return o.forEach(u=>{let m=l.get(u.userId)??bt();Di(this.serializer,u).keys().forEach(d=>m=m.add(d)),l.set(u.userId,m)}),$.forEach(l,(u,m)=>{const d=new Jn(m),f=Hu.wt(this.serializer,d),p=i.getIndexManager(d),y=Mu.wt(d,this.serializer,p,i.referenceDelegate);return new f0(r,y,f,p).recalculateAndSaveOverlaysForDocumentKeys(new fd(t,ms.ce),u).next()})})}}function gg(n){n.createObjectStore(Mo,{keyPath:uA}).createIndex(ff,mA,{unique:!0}),n.createObjectStore(Ho,{keyPath:"targetId"}).createIndex(Xb,cA,{unique:!0}),n.createObjectStore(Ci)}const Cr="IndexedDbPersistence",wm=18e5,Vm=5e3,Cm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",$w="main";class Tf{constructor(e,t,s,r,i,o,l,u,m,d,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=i,this.window=o,this.document=l,this.xi=m,this.Oi=d,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!Tf.v())throw new xe(se.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Sw(this,r),this.$i=t+$w,this.serializer=new ZN(u),this.Ui=new Kr(this.$i,this.Ni,new qw(this.serializer)),this.hi=new xw,this.Pi=new Vw(this.referenceDelegate,this.serializer),this.remoteDocumentCache=d0(this.serializer),this.Ii=new Nw,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,d===!1&&_n(Cr,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new xe(se.FAILED_PRECONDITION,Cm);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new ms(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ac(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(ni(e))return pe(Cr,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return pe(Cr,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Ea(e).get(to).next(t=>$.resolve(this.es(t)))}ts(e){return ac(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,wm)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const s=Un(t,Fo);return s.J().next(r=>{const i=this.ss(r,wm),o=r.filter(l=>i.indexOf(l)===-1);return $.forEach(o,l=>s.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?$.resolve(!0):Ea(e).get(to).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Vm)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new xe(se.FAILED_PRECONDITION,Cm);return!1}}return!(!this.networkEnabled||!this.inForeground)||ac(e).J().next(s=>this.ss(s,Vm).find(r=>{if(this.clientId!==r.clientId){const i=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,l=this.networkEnabled===r.networkEnabled;if(i||o&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&pe(Cr,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Sl,Fo],e=>{const t=new fd(e,ms.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>ac(e).J().next(t=>this.ss(t,wm).map(s=>s.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Mu.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ww(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Hu.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){pe(Cr,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",i=function(u){return u===18?VA:u===17?rN:u===16?wA:u===15?gf:u===14?sN:u===13?nN:u===12?AA:u===11?tN:void Pe(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,r,i,l=>(o=new fd(l,this.ci?this.ci.next():ms.ce),t==="readwrite-primary"?this.Hi(o).next(u=>!!u||this.Yi(o)).next(u=>{if(!u)throw _n(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new xe(se.FAILED_PRECONDITION,zb);return s(o)}).next(u=>this.Xi(o).next(()=>u)):this.Is(o).next(()=>s(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Is(e){return Ea(e).get(to).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Vm)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new xe(se.FAILED_PRECONDITION,Cm)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ea(e).put(to,t)}static v(){return Kr.v()}Zi(e){const t=Ea(e);return t.get(to).next(s=>this.es(s)?(pe(Cr,"Releasing primary lease."),t.delete(to)):$.resolve())}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(_n(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;xb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const s=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return pe(Cr,`Client '${e}' ${s?"is":"is not"} zombied in LocalStorage`),s}catch(s){return _n(Cr,"Failed to get zombied client id.",s),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){_n("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ea(n){return Un(n,Sl)}function ac(n){return Un(n,Fo)}function p0(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=bt(),r=bt();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Pf(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return xb()?8:Kb(Gc())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new zw;return this.Ss(e,t,o).next(l=>{if(i.result=l,this.Vs)return this.bs(e,t,o,l.size)})}).next(()=>i.result)}bs(e,t,s,r){return s.documentReadCount<this.fs?(Do()<=Ct.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",ko(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),$.resolve()):(Do()<=Ct.DEBUG&&pe("QueryEngine","Query:",ko(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(Do()<=Ct.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",ko(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xs(t))):$.resolve())}ys(e,t){if(Mh(t))return $.resolve(null);let s=xs(t);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=xd(t,null,"F"),s=xs(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=bt(...i);return this.ps.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,s).next(u=>{const m=this.Ds(t,l);return this.Cs(t,m,o,u.readTime)?this.ys(e,xd(t,null,"F")):this.vs(e,m,t,u)}))})))}ws(e,t,s,r){return Mh(t)||r.isEqual(Ke.min())?$.resolve(null):this.ps.getDocuments(e,s).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?$.resolve(null):(Do()<=Ct.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ko(t)),this.vs(e,o,t,qb(r,Bo)).next(l=>l))})}Ds(e,t){let s=new Wt(AN(e));return t.forEach((r,i)=>{Ll(e,i)&&(s=s.add(i))}),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return Do()<=Ct.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",ko(t)),this.ps.getDocumentsMatchingQuery(e,t,vs.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="LocalStore",Ww=3e8;class Kw{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new sn(nt),this.xs=new yr(i=>Ui(i),Tl),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new f0(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function g0(n,e,t,s){return new Kw(n,e,t,s)}async function y0(n,e){const t=Re(n);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],l=[];let u=bt();for(const m of r){o.push(m.batchId);for(const d of m.mutations)u=u.add(d.key)}for(const m of i){l.push(m.batchId);for(const d of m.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(s,u).next(m=>({Ls:m,removedBatchIds:o,addedBatchIds:l}))})})}function Gw(n,e){const t=Re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(l,u,m,d){const f=m.batch,p=f.keys();let y=$.resolve();return p.forEach(C=>{y=y.next(()=>d.getEntry(u,C)).next(v=>{const w=m.docVersions.get(C);Me(w!==null,48541),v.version.compareTo(w)<0&&(f.applyToRemoteDocument(v,m),v.isValidDocument()&&(v.setReadTime(m.commitVersion),d.addEntry(v)))})}),y.next(()=>l.mutationQueue.removeMutationBatch(u,f))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(l){let u=bt();for(let m=0;m<l.mutationResults.length;++m)l.mutationResults[m].transformResults.length>0&&(u=u.add(l.batch.mutations[m].key));return u}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}function b0(n){const e=Re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function Qw(n,e){const t=Re(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const l=[];e.targetChanges.forEach((d,f)=>{const p=r.get(f);if(!p)return;l.push(t.Pi.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,d.addedDocuments,f)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Dn.EMPTY_BYTE_STRING,Ke.min()).withLastLimboFreeSnapshotVersion(Ke.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,s)),r=r.insert(f,y),function(v,w,R){return v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=Ww?!0:R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}(p,y,d)&&l.push(t.Pi.updateTargetData(i,y))});let u=bs(),m=bt();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),l.push(Yw(i,o,e.documentUpdates).next(d=>{u=d.ks,m=d.qs})),!s.isEqual(Ke.min())){const d=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s));l.push(d)}return $.waitFor(l).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,m)).next(()=>u)}).then(i=>(t.Ms=r,i))}function Yw(n,e,t){let s=bt(),r=bt();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let o=bs();return t.forEach((l,u)=>{const m=i.get(l);u.isFoundDocument()!==m.isFoundDocument()&&(r=r.add(l)),u.isNoDocument()&&u.version.isEqual(Ke.min())?(e.removeEntry(l,u.readTime),o=o.insert(l,u)):!m.isValidDocument()||u.version.compareTo(m.version)>0||u.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(u),o=o.insert(l,u)):pe(Lf,"Ignoring outdated watch update for ",l,". Current version:",m.version," Watch version:",u.version)}),{ks:o,qs:r}})}function Xw(n,e){const t=Re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=Vi),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function uu(n,e){const t=Re(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Pi.getTargetData(s,e).next(i=>i?(r=i,$.resolve(r)):t.Pi.allocateTargetId(s).next(o=>(r=new ur(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s})}async function Yo(n,e,t){const s=Re(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!ni(o))throw o;pe(Lf,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function Vd(n,e,t){const s=Re(n);let r=Ke.min(),i=bt();return s.persistence.runTransaction("Execute query","readwrite",o=>function(u,m,d){const f=Re(u),p=f.xs.get(d);return p!==void 0?$.resolve(f.Ms.get(p)):f.Pi.getTargetData(m,d)}(s,o,xs(e)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,l.targetId).next(u=>{i=u})}).next(()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:Ke.min(),t?i:bt())).next(l=>(v0(s,EN(e),l),{documents:l,Qs:i})))}function N0(n,e){const t=Re(n),s=Re(t.Pi),r=t.Ms.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",i=>s.At(i,e).next(o=>o?o.target:null))}function x0(n,e){const t=Re(n),s=t.Os.get(e)||Ke.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.Ns.getAllFromCollectionGroup(r,e,qb(s,Bo),Number.MAX_SAFE_INTEGER)).then(r=>(v0(t,e,r),r))}function v0(n,e,t){let s=n.Os.get(e)||Ke.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Os.set(e,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _0="firestore_clients";function yg(n,e){return`${_0}_${n}_${e}`}const D0="firestore_mutations";function bg(n,e,t){let s=`${D0}_${n}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const k0="firestore_targets";function Im(n,e){return`${k0}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks="SharedClientState";class mu{constructor(e,t,s,r){this.user=e,this.batchId=t,this.state=s,this.error=r}static Ws(e,t,s){const r=JSON.parse(s);let i,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(i=new xe(r.error.code,r.error.message))),o?new mu(e,t,r.state,i):(_n(Ks,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class sl{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let r,i=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return i&&s.error&&(i=typeof s.error.message=="string"&&typeof s.error.code=="string",i&&(r=new xe(s.error.code,s.error.message))),i?new sl(e,s.state,r):(_n(Ks,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class du{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let r=typeof s=="object"&&s.activeTargetIds instanceof Array,i=vf();for(let o=0;r&&o<s.activeTargetIds.length;++o)r=Gb(s.activeTargetIds[o]),i=i.add(s.activeTargetIds[o]);return r?new du(e,i):(_n(Ks,`Failed to parse client data for instance '${e}': ${t}`),null)}}class jf{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new jf(t.clientId,t.onlineState):(_n(Ks,`Failed to parse online state: ${e}`),null)}}class Cd{constructor(){this.activeTargetIds=vf()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Sm{constructor(e,t,s,r,i){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new sn(nt),this.started=!1,this.Xs=[];const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=yg(this.persistenceKey,this.Js),this.no=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Cd),this.ro=new RegExp(`^${_0}_${o}_([^_]*)$`),this.io=new RegExp(`^${D0}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${k0}_${o}_(\\d+)$`),this.oo=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this._o=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const r=this.getItem(yg(this.persistenceKey,s));if(r){const i=du.Ws(s,r);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((s,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Im(this.persistenceKey,e));if(r){const i=sl.Ws(e,r);i&&(s=i.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Im(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach(r=>{this.Po(r)}),this.currentUser=e,s.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return pe(Ks,"READ",e,t),t}setItem(e,t){pe(Ks,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){pe(Ks,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(pe(Ks,"EVENT",t.key,t.newValue),t.key===this.eo)return void _n("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=function(i){let o=ms.ce;if(i!=null)try{const l=JSON.parse(i);Me(typeof l=="number",30636,{So:i}),o=l}catch(l){_n(Ks,"Failed to read sequence number from WebStorage",l)}return o}(t.newValue);s!==ms.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map(r=>this.syncEngine.Do(r)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const r=new mu(this.currentUser,e,t,s),i=bg(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Gs())}Po(e){const t=bg(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const r=Im(this.persistenceKey,e),i=new sl(e,t,s);this.setItem(r,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return du.Ws(s,t)}fo(e,t){const s=this.io.exec(e),r=Number(s[1]),i=s[2]!==void 0?s[2]:null;return mu.Ws(new Jn(i),r,t)}yo(e,t){const s=this.so.exec(e),r=Number(s[1]);return sl.Ws(r,t)}uo(e){return jf.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);pe(Ks,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),r=this.lo(this.Zs),i=this.lo(s),o=[],l=[];return i.forEach(u=>{r.has(u)||o.push(u)}),r.forEach(u=>{i.has(u)||l.push(u)}),this.syncEngine.Fo(o,l).then(()=>{this.Zs=s})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=vf();return e.forEach((s,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class E0{constructor(){this.Mo=new Cd,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Cd,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ng="ConnectivityMonitor";class xg{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){pe(Ng,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){pe(Ng,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lc=null;function Id(){return lc===null?lc=function(){return 268435456+Math.round(2147483648*Math.random())}():lc++,"0x"+lc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm="RestConnection",Zw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eV{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===tu?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=Id(),l=this.zo(e,t.toUriEncodedString());pe(Tm,`Sending RPC '${e}' ${o}:`,l,s);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,r,i);const{host:m}=new URL(l),d=Cl(m);return this.Jo(e,l,u,s,d).then(f=>(pe(Tm,`Received RPC '${e}' ${o}: `,f),f),f=>{throw ml(Tm,`RPC '${e}' ${o} failed with error: `,f,"url: ",l,"request:",s),f})}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+sa}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}zo(e,t){const s=Zw[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn="WebChannelConnection";class nV extends eV{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=Id();return new Promise((l,u)=>{const m=new Lb;m.setWithCredentials(!0),m.listenOnce(jb.COMPLETE,()=>{try{switch(m.getLastErrorCode()){case Cc.NO_ERROR:const f=m.getResponseJson();pe(Yn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),l(f);break;case Cc.TIMEOUT:pe(Yn,`RPC '${e}' ${o} timed out`),u(new xe(se.DEADLINE_EXCEEDED,"Request time out"));break;case Cc.HTTP_ERROR:const p=m.getStatus();if(pe(Yn,`RPC '${e}' ${o} failed with status:`,p,"response text:",m.getResponseText()),p>0){let y=m.getResponseJson();Array.isArray(y)&&(y=y[0]);const C=y==null?void 0:y.error;if(C&&C.status&&C.message){const v=function(R){const I=R.toLowerCase().replace(/_/g,"-");return Object.values(se).indexOf(I)>=0?I:se.UNKNOWN}(C.status);u(new xe(v,C.message))}else u(new xe(se.UNKNOWN,"Server responded with status "+m.getStatus()))}else u(new xe(se.UNAVAILABLE,"Connection failed."));break;default:Pe(9055,{l_:e,streamId:o,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{pe(Yn,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(r);pe(Yn,`RPC '${e}' ${o} sending request:`,r),m.send(t,"POST",d,s,15)})}T_(e,t,s){const r=Id(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ub(),l=Bb(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(u.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const d=i.join("");pe(Yn,`Creating RPC '${e}' stream ${r}: ${d}`,u);const f=o.createWebChannel(d,u);this.I_(f);let p=!1,y=!1;const C=new tV({Yo:w=>{y?pe(Yn,`Not sending because RPC '${e}' stream ${r} is closed:`,w):(p||(pe(Yn,`Opening RPC '${e}' stream ${r} transport.`),f.open(),p=!0),pe(Yn,`RPC '${e}' stream ${r} sending:`,w),f.send(w))},Zo:()=>f.close()}),v=(w,R,I)=>{w.listen(R,F=>{try{I(F)}catch(re){setTimeout(()=>{throw re},0)}})};return v(f,Fa.EventType.OPEN,()=>{y||(pe(Yn,`RPC '${e}' stream ${r} transport opened.`),C.o_())}),v(f,Fa.EventType.CLOSE,()=>{y||(y=!0,pe(Yn,`RPC '${e}' stream ${r} transport closed`),C.a_(),this.E_(f))}),v(f,Fa.EventType.ERROR,w=>{y||(y=!0,ml(Yn,`RPC '${e}' stream ${r} transport errored. Name:`,w.name,"Message:",w.message),C.a_(new xe(se.UNAVAILABLE,"The operation could not be completed")))}),v(f,Fa.EventType.MESSAGE,w=>{var R;if(!y){const I=w.data[0];Me(!!I,16349);const F=I,re=(F==null?void 0:F.error)||((R=F[0])==null?void 0:R.error);if(re){pe(Yn,`RPC '${e}' stream ${r} received error:`,re);const ee=re.status;let M=function(V){const j=An[V];if(j!==void 0)return HN(j)}(ee),A=re.message;M===void 0&&(M=se.INTERNAL,A="Unknown error status: "+ee+" with message "+re.message),y=!0,C.a_(new xe(M,A)),f.close()}else pe(Yn,`RPC '${e}' stream ${r} received:`,I),C.u_(I)}}),v(l,Rb.STAT_EVENT,w=>{w.stat===ad.PROXY?pe(Yn,`RPC '${e}' stream ${r} detected buffering proxy`):w.stat===ad.NOPROXY&&pe(Yn,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{C.__()},0),C}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A0(){return typeof window<"u"?window:null}function Hc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ou(n){return new lw(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&pe("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vg="PersistentStream";class V0{constructor(e,t,s,r,i,o,l,u){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new w0(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===se.RESOURCE_EXHAUSTED?(_n(t.toString()),_n("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===se.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.D_===t&&this.G_(s,r)},s=>{e(()=>{const r=new xe(se.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{s(()=>this.z_(r))}),this.stream.onMessage(r=>{s(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return pe(vg,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(pe(vg,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sV extends V0{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=mw(this.serializer,e),s=function(i){if(!("targetChange"in i))return Ke.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ke.min():o.readTime?os(o.readTime):Ke.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=Dd(this.serializer),t.addTarget=function(i,o){let l;const u=o.target;if(l=nu(u)?{documents:KN(i,u)}:{query:GN(i,u).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=ON(i,o.resumeToken);const m=vd(i,o.expectedCount);m!==null&&(l.expectedCount=m)}else if(o.snapshotVersion.compareTo(Ke.min())>0){l.readTime=Qo(i,o.snapshotVersion.toTimestamp());const m=vd(i,o.expectedCount);m!==null&&(l.expectedCount=m)}return l}(this.serializer,e);const s=fw(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=Dd(this.serializer),t.removeTarget=e,this.q_(t)}}class rV extends V0{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Me(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=dw(e.writeResults,e.commitTime),s=os(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Dd(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>iu(this.serializer,s))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{}class oV extends iV{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new xe(se.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,_d(t,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new xe(se.UNKNOWN,i.toString())})}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Ho(e,_d(t,s),r,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===se.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new xe(se.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class aV{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(_n(t),this.aa=!1):pe("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi="RemoteStore";class lV{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{s.enqueueAndForget(async()=>{Wi(this)&&(pe(Oi,"Restarting streams for network reachability change."),await async function(u){const m=Re(u);m.Ea.add(4),await Ul(m),m.Ra.set("Unknown"),m.Ea.delete(4),await qu(m)}(this))})}),this.Ra=new aV(s,r)}}async function qu(n){if(Wi(n))for(const e of n.da)await e(!0)}async function Ul(n){for(const e of n.da)await e(!1)}function $u(n,e){const t=Re(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Uf(t)?Bf(t):aa(t).O_()&&Rf(t,e))}function Xo(n,e){const t=Re(n),s=aa(t);t.Ia.delete(e),s.O_()&&C0(t,e),t.Ia.size===0&&(s.O_()?s.L_():Wi(t)&&t.Ra.set("Unknown"))}function Rf(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ke.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}aa(n).Y_(e)}function C0(n,e){n.Va.Ue(e),aa(n).Z_(e)}function Bf(n){n.Va=new rw({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),aa(n).start(),n.Ra.ua()}function Uf(n){return Wi(n)&&!aa(n).x_()&&n.Ia.size>0}function Wi(n){return Re(n).Ea.size===0}function I0(n){n.Va=void 0}async function cV(n){n.Ra.set("Online")}async function uV(n){n.Ia.forEach((e,t)=>{Rf(n,e)})}async function mV(n,e){I0(n),Uf(n)?(n.Ra.ha(e),Bf(n)):n.Ra.set("Unknown")}async function dV(n,e,t){if(n.Ra.set("Online"),e instanceof FN&&e.state===2&&e.cause)try{await async function(r,i){const o=i.cause;for(const l of i.targetIds)r.Ia.has(l)&&(await r.remoteSyncer.rejectListen(l,o),r.Ia.delete(l),r.Va.removeTarget(l))}(n,e)}catch(s){pe(Oi,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await fu(n,s)}else if(e instanceof Bc?n.Va.Ze(e):e instanceof MN?n.Va.st(e):n.Va.tt(e),!t.isEqual(Ke.min()))try{const s=await b0(n.localStore);t.compareTo(s)>=0&&await function(i,o){const l=i.Va.Tt(o);return l.targetChanges.forEach((u,m)=>{if(u.resumeToken.approximateByteSize()>0){const d=i.Ia.get(m);d&&i.Ia.set(m,d.withResumeToken(u.resumeToken,o))}}),l.targetMismatches.forEach((u,m)=>{const d=i.Ia.get(u);if(!d)return;i.Ia.set(u,d.withResumeToken(Dn.EMPTY_BYTE_STRING,d.snapshotVersion)),C0(i,u);const f=new ur(d.target,u,m,d.sequenceNumber);Rf(i,f)}),i.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(s){pe(Oi,"Failed to raise snapshot:",s),await fu(n,s)}}async function fu(n,e,t){if(!ni(e))throw e;n.Ea.add(1),await Ul(n),n.Ra.set("Offline"),t||(t=()=>b0(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{pe(Oi,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await qu(n)})}function S0(n,e){return e().catch(t=>fu(n,t,e))}async function oa(n){const e=Re(n),t=Xr(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Vi;for(;fV(e);)try{const r=await Xw(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,pV(e,r)}catch(r){await fu(e,r)}T0(e)&&P0(e)}function fV(n){return Wi(n)&&n.Ta.length<10}function pV(n,e){n.Ta.push(e);const t=Xr(n);t.O_()&&t.X_&&t.ea(e.mutations)}function T0(n){return Wi(n)&&!Xr(n).x_()&&n.Ta.length>0}function P0(n){Xr(n).start()}async function hV(n){Xr(n).ra()}async function gV(n){const e=Xr(n);for(const t of n.Ta)e.ea(t.mutations)}async function yV(n,e,t){const s=n.Ta.shift(),r=kf.from(s,e,t);await S0(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await oa(n)}async function bV(n,e){e&&Xr(n).X_&&await async function(s,r){if(function(o){return tw(o)&&o!==se.ABORTED}(r.code)){const i=s.Ta.shift();Xr(s).B_(),await S0(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await oa(s)}}(n,e),T0(n)&&P0(n)}async function _g(n,e){const t=Re(n);t.asyncQueue.verifyOperationInProgress(),pe(Oi,"RemoteStore received new credentials");const s=Wi(t);t.Ea.add(3),await Ul(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await qu(t)}async function Sd(n,e){const t=Re(n);e?(t.Ea.delete(2),await qu(t)):e||(t.Ea.add(2),await Ul(t),t.Ra.set("Unknown"))}function aa(n){return n.ma||(n.ma=function(t,s,r){const i=Re(t);return i.sa(),new sV(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:cV.bind(null,n),t_:uV.bind(null,n),r_:mV.bind(null,n),H_:dV.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Uf(n)?Bf(n):n.Ra.set("Unknown")):(await n.ma.stop(),I0(n))})),n.ma}function Xr(n){return n.fa||(n.fa=function(t,s,r){const i=Re(t);return i.sa(),new rV(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:hV.bind(null,n),r_:bV.bind(null,n),ta:gV.bind(null,n),na:yV.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await oa(n)):(await n.fa.stop(),n.Ta.length>0&&(pe(Oi,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Js,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,l=new Hf(e,t,o,r,i);return l.start(s),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new xe(se.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mf(n,e){if(_n("AsyncQueue",`${e}: ${n}`),ni(n))return new xe(se.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{static emptySet(e){return new Lo(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||Ae.comparator(t.key,s.key):(t,s)=>Ae.comparator(t.key,s.key),this.keyedMap=Oa(),this.sortedSet=new sn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Lo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Lo;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(){this.ga=new sn(Ae.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Pe(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class Jo{constructor(e,t,s,r,i,o,l,u,m){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=m}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new Jo(e,t,Lo.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ru(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class xV{constructor(){this.queries=kg(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=Re(t),i=r.queries;r.queries=kg(),i.forEach((o,l)=>{for(const u of l.Sa)u.onError(s)})})(this,new xe(se.ABORTED,"Firestore shutting down"))}}function kg(){return new yr(n=>kN(n),Ru)}async function Ff(n,e){const t=Re(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new NV,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const l=Mf(o,`Initialization of query '${ko(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&qf(t)}async function Of(n,e){const t=Re(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function vV(n,e){const t=Re(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const l of o.Sa)l.Fa(r)&&(s=!0);o.wa=r}}s&&qf(t)}function _V(n,e,t){const s=Re(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function qf(n){n.Ca.forEach(e=>{e.next()})}var Td,Eg;(Eg=Td||(Td={})).Ma="default",Eg.Cache="cache";class $f{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Jo(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Jo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Td.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){this.key=e}}class j0{constructor(e){this.key=e}}class DV{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=bt(),this.mutatedKeys=bt(),this.eu=AN(e),this.tu=new Lo(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new Dg,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,l=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,m=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,f)=>{const p=r.get(d),y=Ll(this.query,f)?f:null,C=!!p&&this.mutatedKeys.has(p.key),v=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let w=!1;p&&y?p.data.isEqual(y.data)?C!==v&&(s.track({type:3,doc:y}),w=!0):this.su(p,y)||(s.track({type:2,doc:y}),w=!0,(u&&this.eu(y,u)>0||m&&this.eu(y,m)<0)&&(l=!0)):!p&&y?(s.track({type:0,doc:y}),w=!0):p&&!y&&(s.track({type:1,doc:p}),w=!0,(u||m)&&(l=!0)),w&&(y?(o=o.add(y),i=v?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),s.track({type:1,doc:d})}return{tu:o,iu:s,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((d,f)=>function(y,C){const v=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pe(20277,{Rt:w})}};return v(y)-v(C)}(d.type,f.type)||this.eu(d.doc,f.doc)),this.ou(s),r=r??!1;const l=t&&!r?this._u():[],u=this.Xa.size===0&&this.current&&!r?1:0,m=u!==this.Za;return this.Za=u,o.length!==0||m?{snapshot:new Jo(this.query,e.tu,i,o,e.mutatedKeys,u===0,m,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Dg,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=bt(),this.tu.forEach(s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))});const t=[];return e.forEach(s=>{this.Xa.has(s)||t.push(new j0(s))}),this.Xa.forEach(s=>{e.has(s)||t.push(new L0(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=bt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Jo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const la="SyncEngine";class kV{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class EV{constructor(e){this.key=e,this.hu=!1}}class AV{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new yr(l=>kN(l),Ru),this.Iu=new Map,this.Eu=new Set,this.du=new sn(Ae.comparator),this.Au=new Map,this.Ru=new If,this.Vu={},this.mu=new Map,this.fu=Fi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function wV(n,e,t=!0){const s=zu(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await R0(s,e,t,!0),r}async function VV(n,e){const t=zu(n);await R0(t,e,!0,!1)}async function R0(n,e,t,s){const r=await uu(n.localStore,xs(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let l;return s&&(l=await zf(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&$u(n.remoteStore,r),l}async function zf(n,e,t,s,r){n.pu=(f,p,y)=>async function(v,w,R,I){let F=w.view.ru(R);F.Cs&&(F=await Vd(v.localStore,w.query,!1).then(({documents:A})=>w.view.ru(A,F)));const re=I&&I.targetChanges.get(w.targetId),ee=I&&I.targetMismatches.get(w.targetId)!=null,M=w.view.applyChanges(F,v.isPrimaryClient,re,ee);return Pd(v,w.targetId,M.au),M.snapshot}(n,f,p,y);const i=await Vd(n.localStore,e,!0),o=new DV(e,i.Qs),l=o.ru(i.documents),u=Bl.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),m=o.applyChanges(l,n.isPrimaryClient,u);Pd(n,t,m.au);const d=new kV(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),m.snapshot}async function CV(n,e,t){const s=Re(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(o=>!Ru(o,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Yo(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),t&&Xo(s.remoteStore,r.targetId),Zo(s,r.targetId)}).catch(ti)):(Zo(s,r.targetId),await Yo(s.localStore,r.targetId,!0))}async function IV(n,e){const t=Re(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Xo(t.remoteStore,s.targetId))}async function SV(n,e,t){const s=Qf(n);try{const r=await function(o,l){const u=Re(o),m=be.now(),d=l.reduce((y,C)=>y.add(C.key),bt());let f,p;return u.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=bs(),v=bt();return u.Ns.getEntries(y,d).next(w=>{C=w,C.forEach((R,I)=>{I.isValidDocument()||(v=v.add(R))})}).next(()=>u.localDocuments.getOverlayedDocuments(y,C)).next(w=>{f=w;const R=[];for(const I of l){const F=ZA(I,f.get(I.key).overlayedDocument);F!=null&&R.push(new br(I.key,F,pN(F.value.mapValue),Bn.exists(!0)))}return u.mutationQueue.addMutationBatch(y,m,R,l)}).next(w=>{p=w;const R=w.applyToLocalDocumentSet(f,v);return u.documentOverlayCache.saveOverlays(y,w.batchId,R)})}).then(()=>({batchId:p.batchId,changes:VN(f)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,l,u){let m=o.Vu[o.currentUser.toKey()];m||(m=new sn(nt)),m=m.insert(l,u),o.Vu[o.currentUser.toKey()]=m}(s,r.batchId,t),await ri(s,r.changes),await oa(s.remoteStore)}catch(r){const i=Mf(r,"Failed to persist write");t.reject(i)}}async function B0(n,e){const t=Re(n);try{const s=await Qw(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.Au.get(i);o&&(Me(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?Me(o.hu,14607):r.removedDocuments.size>0&&(Me(o.hu,42227),o.hu=!1))}),await ri(t,s,e)}catch(s){await ti(s)}}function Ag(n,e,t){const s=Re(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach((i,o)=>{const l=o.view.va(e);l.snapshot&&r.push(l.snapshot)}),function(o,l){const u=Re(o);u.onlineState=l;let m=!1;u.queries.forEach((d,f)=>{for(const p of f.Sa)p.va(l)&&(m=!0)}),m&&qf(u)}(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function TV(n,e,t){const s=Re(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new sn(Ae.comparator);o=o.insert(i,hn.newNoDocument(i,Ke.min()));const l=bt().add(i),u=new Rl(Ke.min(),new Map,new sn(nt),o,l);await B0(s,u),s.du=s.du.remove(i),s.Au.delete(e),Gf(s)}else await Yo(s.localStore,e,!1).then(()=>Zo(s,e,t)).catch(ti)}async function PV(n,e){const t=Re(n),s=e.batch.batchId;try{const r=await Gw(t.localStore,e);Kf(t,s,null),Wf(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await ri(t,r)}catch(r){await ti(r)}}async function LV(n,e,t){const s=Re(n);try{const r=await function(o,l){const u=Re(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let d;return u.mutationQueue.lookupMutationBatch(m,l).next(f=>(Me(f!==null,37113),d=f.keys(),u.mutationQueue.removeMutationBatch(m,f))).next(()=>u.mutationQueue.performConsistencyCheck(m)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(m,d,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,d)).next(()=>u.localDocuments.getDocuments(m,d))})}(s.localStore,e);Kf(s,e,t),Wf(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await ri(s,r)}catch(r){await ti(r)}}function Wf(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Kf(n,e,t){const s=Re(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function Zo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(s=>{n.Ru.containsKey(s)||U0(n,s)})}function U0(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Xo(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Gf(n))}function Pd(n,e,t){for(const s of t)s instanceof L0?(n.Ru.addReference(s.key,e),jV(n,s)):s instanceof j0?(pe(la,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||U0(n,s.key)):Pe(19791,{wu:s})}function jV(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(pe(la,"New document in limbo: "+t),n.Eu.add(s),Gf(n))}function Gf(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Ae(Ut.fromString(e)),s=n.fu.next();n.Au.set(s,new EV(t)),n.du=n.du.insert(t,s),$u(n.remoteStore,new ur(xs(Pl(t.path)),s,"TargetPurposeLimboResolution",ms.ce))}}async function ri(n,e,t){const s=Re(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((l,u)=>{o.push(s.pu(u,e,t).then(m=>{var d;if((m||t)&&s.isPrimaryClient){const f=m?!m.fromCache:(d=t==null?void 0:t.targetChanges.get(u.targetId))==null?void 0:d.current;s.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(m){r.push(m);const f=Pf.As(u.targetId,m);i.push(f)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(u,m){const d=Re(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>$.forEach(m,p=>$.forEach(p.Es,y=>d.persistence.referenceDelegate.addReference(f,p.targetId,y)).next(()=>$.forEach(p.ds,y=>d.persistence.referenceDelegate.removeReference(f,p.targetId,y)))))}catch(f){if(!ni(f))throw f;pe(Lf,"Failed to update sequence numbers: "+f)}for(const f of m){const p=f.targetId;if(!f.fromCache){const y=d.Ms.get(p),C=y.snapshotVersion,v=y.withLastLimboFreeSnapshotVersion(C);d.Ms=d.Ms.insert(p,v)}}}(s.localStore,i))}async function RV(n,e){const t=Re(n);if(!t.currentUser.isEqual(e)){pe(la,"User change. New user:",e.toKey());const s=await y0(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(l=>{l.forEach(u=>{u.reject(new xe(se.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await ri(t,s.Ls)}}function BV(n,e){const t=Re(n),s=t.Au.get(e);if(s&&s.hu)return bt().add(s.key);{let r=bt();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const l=t.Tu.get(o);r=r.unionWith(l.view.nu)}return r}}async function UV(n,e){const t=Re(n),s=await Vd(t.localStore,e.query,!0),r=e.view.cu(s);return t.isPrimaryClient&&Pd(t,e.targetId,r.au),r}async function HV(n,e){const t=Re(n);return x0(t.localStore,e).then(s=>ri(t,s))}async function MV(n,e,t,s){const r=Re(n),i=await function(l,u){const m=Re(l),d=Re(m.mutationQueue);return m.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.er(f,u).next(p=>p?m.localDocuments.getDocuments(f,p):$.resolve(null)))}(r.localStore,e);i!==null?(t==="pending"?await oa(r.remoteStore):t==="acknowledged"||t==="rejected"?(Kf(r,e,s||null),Wf(r,e),function(l,u){Re(Re(l).mutationQueue).ir(u)}(r.localStore,e)):Pe(6720,"Unknown batchState",{Su:t}),await ri(r,i)):pe(la,"Cannot apply mutation batch with id: "+e)}async function FV(n,e){const t=Re(n);if(zu(t),Qf(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),r=await wg(t,s.toArray());t.gu=!0,await Sd(t.remoteStore,!0);for(const i of r)$u(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const s=[];let r=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?s.push(o):r=r.then(()=>(Zo(t,o),Yo(t.localStore,o,!0))),Xo(t.remoteStore,o)}),await r,await wg(t,s),function(o){const l=Re(o);l.Au.forEach((u,m)=>{Xo(l.remoteStore,m)}),l.Ru.Jr(),l.Au=new Map,l.du=new sn(Ae.comparator)}(t),t.gu=!1,await Sd(t.remoteStore,!1)}}async function wg(n,e,t){const s=Re(n),r=[],i=[];for(const o of e){let l;const u=s.Iu.get(o);if(u&&u.length!==0){l=await uu(s.localStore,xs(u[0]));for(const m of u){const d=s.Tu.get(m),f=await UV(s,d);f.snapshot&&i.push(f.snapshot)}}else{const m=await N0(s.localStore,o);l=await uu(s.localStore,m),await zf(s,H0(m),o,!1,l.resumeToken)}r.push(l)}return s.Pu.H_(i),r}function H0(n){return _N(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function OV(n){return function(t){return Re(Re(t).persistence).Ts()}(Re(n).localStore)}async function qV(n,e,t,s){const r=Re(n);if(r.gu)return void pe(la,"Ignoring unexpected query state notification.");const i=r.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await x0(r.localStore,EN(i[0])),l=Rl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Dn.EMPTY_BYTE_STRING);await ri(r,o,l);break}case"rejected":await Yo(r.localStore,e,!0),Zo(r,e,s);break;default:Pe(64155,t)}}async function $V(n,e,t){const s=zu(n);if(s.gu){for(const r of e){if(s.Iu.has(r)&&s.sharedClientState.isActiveQueryTarget(r)){pe(la,"Adding an already active target "+r);continue}const i=await N0(s.localStore,r),o=await uu(s.localStore,i);await zf(s,H0(i),o.targetId,!1,o.resumeToken),$u(s.remoteStore,o)}for(const r of t)s.Iu.has(r)&&await Yo(s.localStore,r,!1).then(()=>{Xo(s.remoteStore,r),Zo(s,r)}).catch(ti)}}function zu(n){const e=Re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=B0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=BV.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TV.bind(null,e),e.Pu.H_=vV.bind(null,e.eventManager),e.Pu.yu=_V.bind(null,e.eventManager),e}function Qf(n){const e=Re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=PV.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=LV.bind(null,e),e}class Dl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ou(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return g0(this.persistence,new h0,e.initialUser,this.serializer)}Cu(e){return new Sf(Fu.mi,this.serializer)}Du(e){return new E0}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Dl.provider={build:()=>new Dl};class zV extends Dl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Me(this.persistence.referenceDelegate instanceof cu,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new c0(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Zn.withCacheSize(this.cacheSizeBytes):Zn.DEFAULT;return new Sf(s=>cu.mi(s,t),this.serializer)}}class M0 extends Dl{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Qf(this.xu.syncEngine),await oa(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return g0(this.persistence,new h0,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new c0(s,e.asyncQueue,t)}Mu(e,t){const s=new nA(t,this.persistence);return new tA(e.asyncQueue,s)}Cu(e){const t=p0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?Zn.withCacheSize(this.cacheSizeBytes):Zn.DEFAULT;return new Tf(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,A0(),Hc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new E0}}class WV extends M0{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Sm&&(this.sharedClientState.syncEngine={Co:MV.bind(null,t),vo:qV.bind(null,t),Fo:$V.bind(null,t),Ts:OV.bind(null,t),Do:HV.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async s=>{await FV(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())})}Du(e){const t=A0();if(!Sm.v(t))throw new xe(se.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=p0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Sm(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class kl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Ag(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=RV.bind(null,this.syncEngine),await Sd(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new xV}()}createDatastore(e){const t=Ou(e.databaseInfo.databaseId),s=function(i){return new nV(i)}(e.databaseInfo);return function(i,o,l,u){return new oV(i,o,l,u)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,r,i,o,l){return new lV(s,r,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Ag(this.syncEngine,t,0),function(){return xg.v()?new xg:new Jw}())}createSyncEngine(e,t){return function(r,i,o,l,u,m,d){const f=new AV(r,i,o,l,u,m);return d&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const i=Re(r);pe(Oi,"RemoteStore shutting down."),i.Ea.add(5),await Ul(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}kl.provider={build:()=>new kl};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):_n("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jr="FirestoreClient";class KV{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Jn.UNAUTHENTICATED,this.clientId=uf.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async o=>{pe(Jr,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(pe(Jr,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Js;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Mf(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function Pm(n,e){n.asyncQueue.verifyOperationInProgress(),pe(Jr,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(async r=>{s.isEqual(r)||(await y0(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Vg(n,e){n.asyncQueue.verifyOperationInProgress();const t=await GV(n);pe(Jr,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>_g(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>_g(e.remoteStore,r)),n._onlineComponents=e}async function GV(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){pe(Jr,"Using user provided OfflineComponentProvider");try{await Pm(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===se.FAILED_PRECONDITION||r.code===se.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;ml("Error using user provided cache. Falling back to memory cache: "+t),await Pm(n,new Dl)}}else pe(Jr,"Using default OfflineComponentProvider"),await Pm(n,new zV(void 0));return n._offlineComponents}async function F0(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(pe(Jr,"Using user provided OnlineComponentProvider"),await Vg(n,n._uninitializedComponentsProvider._online)):(pe(Jr,"Using default OnlineComponentProvider"),await Vg(n,new kl))),n._onlineComponents}function QV(n){return F0(n).then(e=>e.syncEngine)}async function pu(n){const e=await F0(n),t=e.eventManager;return t.onListen=wV.bind(null,e.syncEngine),t.onUnlisten=CV.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=VV.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=IV.bind(null,e.syncEngine),t}function YV(n,e,t={}){const s=new Js;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,l,u,m){const d=new Yf({next:p=>{d.Nu(),o.enqueueAndForget(()=>Of(i,f));const y=p.docs.has(l);!y&&p.fromCache?m.reject(new xe(se.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&u&&u.source==="server"?m.reject(new xe(se.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(p)},error:p=>m.reject(p)}),f=new $f(Pl(l.path),d,{includeMetadataChanges:!0,qa:!0});return Ff(i,f)}(await pu(n),n.asyncQueue,e,t,s)),s.promise}function XV(n,e,t={}){const s=new Js;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,l,u,m){const d=new Yf({next:p=>{d.Nu(),o.enqueueAndForget(()=>Of(i,f)),p.fromCache&&u.source==="server"?m.reject(new xe(se.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(p)},error:p=>m.reject(p)}),f=new $f(l,d,{includeMetadataChanges:!0,qa:!0});return Ff(i,f)}(await pu(n),n.asyncQueue,e,t,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O0(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cg=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JV="firestore.googleapis.com",Ig=!0;class Sg{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new xe(se.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=JV,this.ssl=Ig}else this.host=e.host,this.ssl=e.ssl??Ig;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=r0;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<l0)throw new xe(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}JE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=O0(e.experimentalLongPollingOptions??{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new xe(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new xe(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new xe(se.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xf{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sg({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new xe(se.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new xe(se.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sg(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new qE;switch(s.type){case"firstParty":return new WE(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new xe(se.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=Cg.get(t);s&&(pe("ComponentProvider","Removing Datastore"),Cg.delete(t),s.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ii(this.firestore,e,this._query)}}class gn{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gn(this.firestore,e,this._key)}toJSON(){return{type:gn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Il(t,gn._jsonSchema))return new gn(e,s||null,new Ae(Ut.fromString(t.referencePath)))}}gn._jsonSchemaVersion="firestore/documentReference/1.0",gn._jsonSchema={type:Sn("string",gn._jsonSchemaVersion),referencePath:Sn("string")};class Gr extends ii{constructor(e,t,s){super(e,t,Pl(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new gn(this.firestore,null,new Ae(e))}withConverter(e){return new Gr(this.firestore,e,this._path)}}function Ge(n,e,...t){if(n=Gn(n),Fb("collection","path",e),n instanceof Xf){const s=Ut.fromString(e,...t);return vh(s),new Gr(n,null,s)}{if(!(n instanceof gn||n instanceof Gr))throw new xe(se.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ut.fromString(e,...t));return vh(s),new Gr(n.firestore,null,s)}}function Te(n,e,...t){if(n=Gn(n),arguments.length===1&&(e=uf.newId()),Fb("doc","path",e),n instanceof Xf){const s=Ut.fromString(e,...t);return xh(s),new gn(n,null,new Ae(s))}{if(!(n instanceof gn||n instanceof Gr))throw new xe(se.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ut.fromString(e,...t));return xh(s),new gn(n.firestore,n instanceof Gr?n.converter:null,new Ae(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tg="AsyncQueue";class Pg{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new w0(this,"async_queue_retry"),this._c=()=>{const s=Hc();s&&pe(Tg,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=Hc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Hc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Js;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ni(e))throw e;pe(Tg,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,_n("INTERNAL UNHANDLED ERROR: ",Lg(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Hf.createAndSchedule(this,e,t,s,i=>this.hc(i));return this.tc.push(r),r}uc(){this.nc&&Pe(47125,{Pc:Lg(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Lg(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jg(n){return function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1}(n,["next","error","complete"])}class rr extends Xf{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new Pg,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Pg(e),this._firestoreClient=void 0,await e}}}function ZV(n,e,t){t||(t=tu);const s=wb(n,"firestore");if(s.isInitialized(t)){const r=s.getImmediate({identifier:t}),i=s.getOptions(t);if(Qc(i,e))return r;throw new xe(se.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new xe(se.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<l0)throw new xe(se.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Cl(e.host)&&bb(e.host),s.initialize({options:e,instanceIdentifier:t})}function Hl(n){if(n._terminated)throw new xe(se.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||eC(n),n._firestoreClient}function eC(n){var s,r,i;const e=n._freezeSettings(),t=function(l,u,m,d){return new IA(l,u,m,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,O0(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(n._databaseId,((s=n._app)==null?void 0:s.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new KV(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ws(Dn.fromBase64String(e))}catch(t){throw new xe(se.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ws(Dn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ws._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Il(e,ws._jsonSchema))return ws.fromBase64String(e.bytes)}}ws._jsonSchemaVersion="firestore/bytes/1.0",ws._jsonSchema={type:Sn("string",ws._jsonSchemaVersion),bytes:Sn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new xe(se.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new xe(se.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new xe(se.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return nt(this._lat,e._lat)||nt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Zs._jsonSchemaVersion}}static fromJSON(e){if(Il(e,Zs._jsonSchema))return new Zs(e.latitude,e.longitude)}}Zs._jsonSchemaVersion="firestore/geoPoint/1.0",Zs._jsonSchema={type:Sn("string",Zs._jsonSchemaVersion),latitude:Sn("number"),longitude:Sn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:er._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Il(e,er._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new er(e.vectorValues);throw new xe(se.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}er._jsonSchemaVersion="firestore/vectorValue/1.0",er._jsonSchema={type:Sn("string",er._jsonSchemaVersion),vectorValues:Sn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC=/^__.*__$/;class nC{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new br(e,this.data,this.fieldMask,t,this.fieldTransforms):new ia(e,this.data,t,this.fieldTransforms)}}class q0{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new br(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $0(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pe(40011,{Ac:n})}}class Jf{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Jf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return hu(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if($0(this.Ac)&&tC.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class sC{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Ou(e)}Cc(e,t,s,r=!1){return new Jf({Ac:e,methodName:t,Dc:s,path:dn.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Fl(n){const e=n._freezeSettings(),t=Ou(n._databaseId);return new sC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Zf(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);tp("Data must be an object, but it was:",o,s);const l=K0(s,o);let u,m;if(i.merge)u=new ds(o.fieldMask),m=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const p=Ld(e,f,t);if(!o.contains(p))throw new xe(se.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Q0(d,p)||d.push(p)}u=new ds(d),m=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,m=o.fieldTransforms;return new nC(new es(l),u,m)}class Ku extends Wu{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ku}}class ep extends Wu{_toFieldTransform(e){return new jN(e.path,new Wo)}isEqual(e){return e instanceof ep}}function z0(n,e,t,s){const r=n.Cc(1,e,t);tp("Data must be an object, but it was:",r,s);const i=[],o=es.empty();si(s,(u,m)=>{const d=np(e,u,t);m=Gn(m);const f=r.yc(d);if(m instanceof Ku)i.push(d);else{const p=Ol(m,f);p!=null&&(i.push(d),o.set(d,p))}});const l=new ds(i);return new q0(o,l,r.fieldTransforms)}function W0(n,e,t,s,r,i){const o=n.Cc(1,e,t),l=[Ld(e,s,t)],u=[r];if(i.length%2!=0)throw new xe(se.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)l.push(Ld(e,i[p])),u.push(i[p+1]);const m=[],d=es.empty();for(let p=l.length-1;p>=0;--p)if(!Q0(m,l[p])){const y=l[p];let C=u[p];C=Gn(C);const v=o.yc(y);if(C instanceof Ku)m.push(y);else{const w=Ol(C,v);w!=null&&(m.push(y),d.set(y,w))}}const f=new ds(m);return new q0(d,f,o.fieldTransforms)}function rC(n,e,t,s=!1){return Ol(t,n.Cc(s?4:3,e))}function Ol(n,e){if(G0(n=Gn(n)))return tp("Unsupported field value:",e,n),K0(n,e);if(n instanceof Wu)return function(s,r){if(!$0(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const l of s){let u=Ol(l,r.wc(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(n,e)}return function(s,r){if((s=Gn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return KA(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=be.fromDate(s);return{timestampValue:Qo(r.serializer,i)}}if(s instanceof be){const i=new be(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Qo(r.serializer,i)}}if(s instanceof Zs)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof ws)return{bytesValue:ON(r.serializer,s._byteString)};if(s instanceof gn){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:wf(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof er)return function(o,l){return{mapValue:{fields:{[bf]:{stringValue:Nf},[Oo]:{arrayValue:{values:o.toArray().map(m=>{if(typeof m!="number")throw l.Sc("VectorValues must only contain numeric values.");return _f(l.serializer,m)})}}}}}}(s,r);throw r.Sc(`Unsupported field value: ${Vu(s)}`)}(n,e)}function K0(n,e){const t={};return iN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):si(n,(s,r)=>{const i=Ol(r,e.mc(s));i!=null&&(t[s]=i)}),{mapValue:{fields:t}}}function G0(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof be||n instanceof Zs||n instanceof ws||n instanceof gn||n instanceof Wu||n instanceof er)}function tp(n,e,t){if(!G0(t)||!Ob(t)){const s=Vu(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function Ld(n,e,t){if((e=Gn(e))instanceof Ml)return e._internalPath;if(typeof e=="string")return np(n,e);throw hu("Field path arguments must be of type string or ",n,!1,void 0,t)}const iC=new RegExp("[~\\*/\\[\\]]");function np(n,e,t){if(e.search(iC)>=0)throw hu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ml(...e.split("."))._internalPath}catch{throw hu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function hu(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new xe(se.INVALID_ARGUMENT,l+n+u)}function Q0(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new gn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new oC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class oC extends Y0{data(){return super.data()}}function Gu(n,e){return typeof e=="string"?np(n,e):e instanceof Ml?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new xe(se.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class sp{}class J0 extends sp{}function _t(n,e,...t){let s=[];e instanceof sp&&s.push(e),s=s.concat(t),function(i){const o=i.filter(u=>u instanceof rp).length,l=i.filter(u=>u instanceof Qu).length;if(o>1||o>0&&l>0)throw new xe(se.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)n=r._apply(n);return n}class Qu extends J0{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Qu(e,t,s)}_apply(e){const t=this._parse(e);return Z0(e._query,t),new ii(e.firestore,e.converter,Nd(e._query,t))}_parse(e){const t=Fl(e.firestore);return function(i,o,l,u,m,d,f){let p;if(m.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new xe(se.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Bg(f,d);const C=[];for(const v of f)C.push(Rg(u,i,v));p={arrayValue:{values:C}}}else p=Rg(u,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Bg(f,d),p=rC(l,o,f,d==="in"||d==="not-in");return Dt.create(m,d,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function qn(n,e,t){const s=e,r=Gu("where",n);return Qu._create(r,s,t)}class rp extends sp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new rp(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return t.length===1?t[0]:zt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,i){let o=r;const l=i.getFlattenedFilters();for(const u of l)Z0(o,u),o=Nd(o,u)}(e._query,t),new ii(e.firestore,e.converter,Nd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ip extends J0{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ip(e,t)}_apply(e){const t=function(r,i,o){if(r.startAt!==null)throw new xe(se.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new xe(se.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vl(i,o)}(e._query,this._field,this._direction);return new ii(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new ra(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function en(n,e="asc"){const t=e,s=Gu("orderBy",n);return ip._create(s,t)}function Rg(n,e,t){if(typeof(t=Gn(t))=="string"){if(t==="")throw new xe(se.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!DN(e)&&t.indexOf("/")!==-1)throw new xe(se.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Ut.fromString(t));if(!Ae.isDocumentKey(s))throw new xe(se.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Nl(n,new Ae(s))}if(t instanceof gn)return Nl(n,t._key);throw new xe(se.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vu(t)}.`)}function Bg(n,e){if(!Array.isArray(n)||n.length===0)throw new xe(se.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Z0(n,e){const t=function(r,i){for(const o of r)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new xe(se.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new xe(se.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class aC{convertValue(e,t="none"){switch(Qr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ln(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Pe(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return si(e,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertVectorValue(e){var s,r,i;const t=(i=(r=(s=e.fields)==null?void 0:s[Oo].arrayValue)==null?void 0:r.values)==null?void 0:i.map(o=>ln(o.doubleValue));return new er(t)}convertGeoPoint(e){return new Zs(ln(e.latitude),ln(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Lu(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(yl(e));default:return null}}convertTimestamp(e){const t=hr(e);return new be(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Ut.fromString(e);Me(JN(s),9688,{name:e});const r=new Bi(s.get(1),s.get(3)),i=new Ae(s.popFirst(5));return r.isEqual(t)||_n(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function op(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class za{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Si extends Y0{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Mc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Gu("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new xe(se.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Si._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Si._jsonSchemaVersion="firestore/documentSnapshot/1.0",Si._jsonSchema={type:Sn("string",Si._jsonSchemaVersion),bundleSource:Sn("string","DocumentSnapshot"),bundleName:Sn("string"),bundle:Sn("string")};class Mc extends Si{data(e={}){return super.data(e)}}class Ti{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new za(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Mc(this._firestore,this._userDataWriter,s.key,s,new za(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xe(se.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(l=>{const u=new Mc(r._firestore,r._userDataWriter,l.doc.key,l.doc,new za(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const u=new Mc(r._firestore,r._userDataWriter,l.doc.key,l.doc,new za(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let m=-1,d=-1;return l.type!==0&&(m=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),d=o.indexOf(l.doc.key)),{type:lC(l.type),doc:u,oldIndex:m,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new xe(se.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ti._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=uf.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function lC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pe(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rt(n){n=fs(n,gn);const e=fs(n.firestore,rr);return YV(Hl(e),n._key).then(t=>ex(e,n,t))}Ti._jsonSchemaVersion="firestore/querySnapshot/1.0",Ti._jsonSchema={type:Sn("string",Ti._jsonSchemaVersion),bundleSource:Sn("string","QuerySnapshot"),bundleName:Sn("string"),bundle:Sn("string")};class ap extends aC{constructor(e){super(),this.firestore=e}convertBytes(e){return new ws(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new gn(this.firestore,null,t)}}function It(n){n=fs(n,ii);const e=fs(n.firestore,rr),t=Hl(e),s=new ap(e);return X0(n._query),XV(t,n._query).then(r=>new Ti(e,s,n,r))}function qi(n,e,t){n=fs(n,gn);const s=fs(n.firestore,rr),r=op(n.converter,e,t);return ql(s,[Zf(Fl(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Bn.none())])}function Ot(n,e,t,...s){n=fs(n,gn);const r=fs(n.firestore,rr),i=Fl(r);let o;return o=typeof(e=Gn(e))=="string"||e instanceof Ml?W0(i,"updateDoc",n._key,e,t,s):z0(i,"updateDoc",n._key,e),ql(r,[o.toMutation(n._key,Bn.exists(!0))])}function Kn(n){return ql(fs(n.firestore,rr),[new jl(n._key,Bn.none())])}function tr(n,e){const t=fs(n.firestore,rr),s=Te(n),r=op(n.converter,e);return ql(t,[Zf(Fl(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,Bn.exists(!1))]).then(()=>s)}function _s(n,...e){var u,m,d;n=Gn(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||jg(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(jg(e[s])){const f=e[s];e[s]=(u=f.next)==null?void 0:u.bind(f),e[s+1]=(m=f.error)==null?void 0:m.bind(f),e[s+2]=(d=f.complete)==null?void 0:d.bind(f)}let i,o,l;if(n instanceof gn)o=fs(n.firestore,rr),l=Pl(n._key.path),i={next:f=>{e[s]&&e[s](ex(o,n,f))},error:e[s+1],complete:e[s+2]};else{const f=fs(n,ii);o=fs(f.firestore,rr),l=f._query;const p=new ap(o);i={next:y=>{e[s]&&e[s](new Ti(o,p,f,y))},error:e[s+1],complete:e[s+2]},X0(n._query)}return function(p,y,C,v){const w=new Yf(v),R=new $f(y,w,C);return p.asyncQueue.enqueueAndForget(async()=>Ff(await pu(p),R)),()=>{w.Nu(),p.asyncQueue.enqueueAndForget(async()=>Of(await pu(p),R))}}(Hl(o),l,r,i)}function ql(n,e){return function(s,r){const i=new Js;return s.asyncQueue.enqueueAndForget(async()=>SV(await QV(s),r,i)),i.promise}(Hl(n),e)}function ex(n,e,t){const s=t.docs.get(e._key),r=new ap(n);return new Si(n,r,e._key,s,new za(t.hasPendingWrites,t.fromCache),e.converter)}class cC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=fC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function uC(n){return new cC(n)}class mC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=kl.provider,this._offlineComponentProvider={build:t=>new M0(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class dC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=kl.provider,this._offlineComponentProvider={build:t=>new WV(t,e==null?void 0:e.cacheSizeBytes)}}}function fC(n){return new mC(n==null?void 0:n.forceOwnership)}function pC(){return new dC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Fl(e)}set(e,t,s){this._verifyNotCommitted();const r=Lm(e,this._firestore),i=op(r.converter,t,s),o=Zf(this._dataReader,"WriteBatch.set",r._key,i,r.converter!==null,s);return this._mutations.push(o.toMutation(r._key,Bn.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const i=Lm(e,this._firestore);let o;return o=typeof(t=Gn(t))=="string"||t instanceof Ml?W0(this._dataReader,"WriteBatch.update",i._key,t,s,r):z0(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Bn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Lm(e,this._firestore);return this._mutations=this._mutations.concat(new jl(t._key,Bn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new xe(se.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Lm(n,e){if((n=Gn(n)).firestore!==e)throw new xe(se.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function pn(){return new ep("serverTimestamp")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(n){return Hl(n=fs(n,rr)),new hC(n,e=>ql(n,e))}(function(e,t=!0){(function(r){sa=r})(Cb),cl(new jo("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),l=new rr(new $E(s.getProvider("auth-internal")),new KE(o,s.getProvider("app-check-internal")),function(m,d){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new xe(se.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bi(m.options.projectId,d)}(o,r),o);return i={useFetchStreams:t,...i},l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),zr(gh,yh,e),zr(gh,yh,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tx="firebasestorage.googleapis.com",nx="storageBucket",yC=2*60*1e3,bC=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn extends zi{constructor(e,t,s=0){super(jm(e),`Firebase Storage: ${t} (${jm(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,bn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return jm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yn||(yn={}));function jm(n){return"storage/"+n}function lp(){const n="An unknown error occurred, please check the error payload for server response.";return new bn(yn.UNKNOWN,n)}function NC(n){return new bn(yn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function xC(n){return new bn(yn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function vC(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new bn(yn.UNAUTHENTICATED,n)}function _C(){return new bn(yn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function DC(n){return new bn(yn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function kC(){return new bn(yn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function EC(){return new bn(yn.CANCELED,"User canceled the upload/download.")}function AC(n){return new bn(yn.INVALID_URL,"Invalid URL '"+n+"'.")}function wC(n){return new bn(yn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function VC(){return new bn(yn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+nx+"' property when initializing the app?")}function CC(){return new bn(yn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function IC(){return new bn(yn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function SC(n){return new bn(yn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function jd(n){return new bn(yn.INVALID_ARGUMENT,n)}function sx(){return new bn(yn.APP_DELETED,"The Firebase app was deleted.")}function TC(n){return new bn(yn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function rl(n,e){return new bn(yn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Aa(n){throw new bn(yn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Ns.makeFromUrl(e,t)}catch{return new Ns(e,"")}if(s.path==="")return s;throw wC(e)}static makeFromUrl(e,t){let s=null;const r="([A-Za-z0-9.\\-_]+)";function i(re){re.path.charAt(re.path.length-1)==="/"&&(re.path_=re.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+r+o,"i"),u={bucket:1,path:3};function m(re){re.path_=decodeURIComponent(re.path)}const d="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",y=new RegExp(`^https?://${f}/${d}/b/${r}/o${p}`,"i"),C={bucket:1,path:3},v=t===tx?"(?:storage.googleapis.com|storage.cloud.google.com)":t,w="([^?#]*)",R=new RegExp(`^https?://${v}/${r}/${w}`,"i"),F=[{regex:l,indices:u,postModify:i},{regex:y,indices:C,postModify:m},{regex:R,indices:{bucket:1,path:2},postModify:m}];for(let re=0;re<F.length;re++){const ee=F[re],M=ee.regex.exec(e);if(M){const A=M[ee.indices.bucket];let N=M[ee.indices.path];N||(N=""),s=new Ns(A,N),ee.postModify(s);break}}if(s==null)throw AC(e);return s}}class PC{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LC(n,e,t){let s=1,r=null,i=null,o=!1,l=0;function u(){return l===2}let m=!1;function d(...w){m||(m=!0,e.apply(null,w))}function f(w){r=setTimeout(()=>{r=null,n(y,u())},w)}function p(){i&&clearTimeout(i)}function y(w,...R){if(m){p();return}if(w){p(),d.call(null,w,...R);return}if(u()||o){p(),d.call(null,w,...R);return}s<64&&(s*=2);let F;l===1?(l=2,F=0):F=(s+Math.random())*1e3,f(F)}let C=!1;function v(w){C||(C=!0,p(),!m&&(r!==null?(w||(l=2),clearTimeout(r),f(0)):w||(l=1)))}return f(0),i=setTimeout(()=>{o=!0,v(!0)},t),v}function jC(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RC(n){return n!==void 0}function BC(n){return typeof n=="object"&&!Array.isArray(n)}function cp(n){return typeof n=="string"||n instanceof String}function Ug(n){return up()&&n instanceof Blob}function up(){return typeof Blob<"u"}function Hg(n,e,t,s){if(s<e)throw jd(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>t)throw jd(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yu(n,e,t){let s=e;return t==null&&(s=`https://${e}`),`${t}://${s}/v0${n}`}function rx(n){const e=encodeURIComponent;let t="?";for(const s in n)if(n.hasOwnProperty(s)){const r=e(s)+"="+e(n[s]);t=t+r+"&"}return t=t.slice(0,-1),t}var Pi;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Pi||(Pi={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UC(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||r||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(e,t,s,r,i,o,l,u,m,d,f,p=!0,y=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=u,this.timeout_=m,this.progressCallback_=d,this.connectionFactory_=f,this.retry=p,this.isUsingEmulator=y,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((C,v)=>{this.resolve_=C,this.reject_=v,this.start_()})}start_(){const e=(s,r)=>{if(r){s(!1,new cc(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=l=>{const u=l.loaded,m=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,m)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const l=i.getErrorCode()===Pi.NO_ERROR,u=i.getStatus();if(!l||UC(u,this.additionalRetryCodes_)&&this.retry){const d=i.getErrorCode()===Pi.ABORT;s(!1,new cc(!1,null,d));return}const m=this.successCodes_.indexOf(u)!==-1;s(!0,new cc(m,i))})},t=(s,r)=>{const i=this.resolve_,o=this.reject_,l=r.connection;if(r.wasSuccessCode)try{const u=this.callback_(l,l.getResponse());RC(u)?i(u):i()}catch(u){o(u)}else if(l!==null){const u=lp();u.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,u)):o(u)}else if(r.canceled){const u=this.appDelete_?sx():EC();o(u)}else{const u=kC();o(u)}};this.canceled_?t(!1,new cc(!1,null,!0)):this.backoffId_=LC(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&jC(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class cc{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function MC(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function FC(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function OC(n,e){e&&(n["X-Firebase-GMPID"]=e)}function qC(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function $C(n,e,t,s,r,i,o=!0,l=!1){const u=rx(n.urlParams),m=n.url+u,d=Object.assign({},n.headers);return OC(d,e),MC(d,t),FC(d,i),qC(d,s),new HC(m,n.method,d,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zC(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function WC(...n){const e=zC();if(e!==void 0){const t=new e;for(let s=0;s<n.length;s++)t.append(n[s]);return t.getBlob()}else{if(up())return new Blob(n);throw new bn(yn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function KC(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GC(n){if(typeof atob>"u")throw SC("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xs={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Rm{constructor(e,t){this.data=e,this.contentType=t||null}}function QC(n,e){switch(n){case Xs.RAW:return new Rm(ix(e));case Xs.BASE64:case Xs.BASE64URL:return new Rm(ox(n,e));case Xs.DATA_URL:return new Rm(XC(e),JC(e))}throw lp()}function ix(n){const e=[];for(let t=0;t<n.length;t++){let s=n.charCodeAt(t);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=s,o=n.charCodeAt(++t);s=65536|(i&1023)<<10|o&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function YC(n){let e;try{e=decodeURIComponent(n)}catch{throw rl(Xs.DATA_URL,"Malformed data URL.")}return ix(e)}function ox(n,e){switch(n){case Xs.BASE64:{const r=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(r||i)throw rl(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Xs.BASE64URL:{const r=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(r||i)throw rl(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=GC(e)}catch(r){throw r.message.includes("polyfill")?r:rl(n,"Invalid character found")}const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}class ax{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw rl(Xs.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;s!=null&&(this.base64=ZC(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function XC(n){const e=new ax(n);return e.base64?ox(Xs.BASE64,e.rest):YC(e.rest)}function JC(n){return new ax(n).contentType}function ZC(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hr{constructor(e,t){let s=0,r="";Ug(e)?(this.data_=e,s=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Ug(this.data_)){const s=this.data_,r=KC(s,e,t);return r===null?null:new Hr(r)}else{const s=new Uint8Array(this.data_.buffer,e,t-e);return new Hr(s,!0)}}static getBlob(...e){if(up()){const t=e.map(s=>s instanceof Hr?s.data_:s);return new Hr(WC.apply(null,t))}else{const t=e.map(o=>cp(o)?QC(Xs.RAW,o).data:o.data_);let s=0;t.forEach(o=>{s+=o.byteLength});const r=new Uint8Array(s);let i=0;return t.forEach(o=>{for(let l=0;l<o.length;l++)r[i++]=o[l]}),new Hr(r,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lx(n){let e;try{e=JSON.parse(n)}catch{return null}return BC(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e1(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function t1(n,e){const t=e.split("/").filter(s=>s.length>0).join("/");return n.length===0?t:n+"/"+t}function cx(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n1(n,e){return e}class rs{constructor(e,t,s,r){this.server=e,this.local=t||e,this.writable=!!s,this.xform=r||n1}}let uc=null;function s1(n){return!cp(n)||n.length<2?n:cx(n)}function ux(){if(uc)return uc;const n=[];n.push(new rs("bucket")),n.push(new rs("generation")),n.push(new rs("metageneration")),n.push(new rs("name","fullPath",!0));function e(i,o){return s1(o)}const t=new rs("name");t.xform=e,n.push(t);function s(i,o){return o!==void 0?Number(o):o}const r=new rs("size");return r.xform=s,n.push(r),n.push(new rs("timeCreated")),n.push(new rs("updated")),n.push(new rs("md5Hash",null,!0)),n.push(new rs("cacheControl",null,!0)),n.push(new rs("contentDisposition",null,!0)),n.push(new rs("contentEncoding",null,!0)),n.push(new rs("contentLanguage",null,!0)),n.push(new rs("contentType",null,!0)),n.push(new rs("metadata","customMetadata",!0)),uc=n,uc}function r1(n,e){function t(){const s=n.bucket,r=n.fullPath,i=new Ns(s,r);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function i1(n,e,t){const s={};s.type="file";const r=t.length;for(let i=0;i<r;i++){const o=t[i];s[o.local]=o.xform(s,e[o.server])}return r1(s,n),s}function mx(n,e,t){const s=lx(e);return s===null?null:i1(n,s,t)}function o1(n,e,t,s){const r=lx(e);if(r===null||!cp(r.downloadTokens))return null;const i=r.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(m=>{const d=n.bucket,f=n.fullPath,p="/b/"+o(d)+"/o/"+o(f),y=Yu(p,t,s),C=rx({alt:"media",token:m});return y+C})[0]}function a1(n,e){const t={},s=e.length;for(let r=0;r<s;r++){const i=e[r];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class mp{constructor(e,t,s,r){this.url=e,this.method=t,this.handler=s,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dx(n){if(!n)throw lp()}function l1(n,e){function t(s,r){const i=mx(n,r,e);return dx(i!==null),i}return t}function c1(n,e){function t(s,r){const i=mx(n,r,e);return dx(i!==null),o1(i,r,n.host,n._protocol)}return t}function fx(n){function e(t,s){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=_C():r=vC():t.getStatus()===402?r=xC(n.bucket):t.getStatus()===403?r=DC(n.path):r=s,r.status=t.getStatus(),r.serverResponse=s.serverResponse,r}return e}function px(n){const e=fx(n);function t(s,r){let i=e(s,r);return s.getStatus()===404&&(i=NC(n.path)),i.serverResponse=r.serverResponse,i}return t}function u1(n,e,t){const s=e.fullServerUrl(),r=Yu(s,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,l=new mp(r,i,c1(n,t),o);return l.errorHandler=px(e),l}function m1(n,e){const t=e.fullServerUrl(),s=Yu(t,n.host,n._protocol),r="DELETE",i=n.maxOperationRetryTime;function o(u,m){}const l=new mp(s,r,o,i);return l.successCodes=[200,204],l.errorHandler=px(e),l}function d1(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function f1(n,e,t){const s=Object.assign({},t);return s.fullPath=n.path,s.size=e.size(),s.contentType||(s.contentType=d1(null,e)),s}function p1(n,e,t,s,r){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let F="";for(let re=0;re<2;re++)F=F+Math.random().toString().slice(2);return F}const u=l();o["Content-Type"]="multipart/related; boundary="+u;const m=f1(e,s,r),d=a1(m,t),f="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+u+`\r
Content-Type: `+m.contentType+`\r
\r
`,p=`\r
--`+u+"--",y=Hr.getBlob(f,s,p);if(y===null)throw CC();const C={name:m.fullPath},v=Yu(i,n.host,n._protocol),w="POST",R=n.maxUploadRetryTime,I=new mp(v,w,l1(n,t),R);return I.urlParams=C,I.headers=o,I.body=y.uploadData(),I.errorHandler=fx(e),I}class h1{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Pi.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Pi.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Pi.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,r,i){if(this.sent_)throw Aa("cannot .send() more than once");if(Cl(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Aa("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Aa("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Aa("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Aa("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class g1 extends h1{initXhr(){this.xhr_.responseType="text"}}function dp(){return new g1}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,t){this._service=e,t instanceof Ns?this._location=t:this._location=Ns.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new $i(e,t)}get root(){const e=new Ns(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return cx(this._location.path)}get storage(){return this._service}get parent(){const e=e1(this._location.path);if(e===null)return null;const t=new Ns(this._location.bucket,e);return new $i(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw TC(e)}}function y1(n,e,t){n._throwIfRoot("uploadBytes");const s=p1(n.storage,n._location,ux(),new Hr(e,!0),t);return n.storage.makeRequestWithTokens(s,dp).then(r=>({metadata:r,ref:n}))}function b1(n){n._throwIfRoot("getDownloadURL");const e=u1(n.storage,n._location,ux());return n.storage.makeRequestWithTokens(e,dp).then(t=>{if(t===null)throw IC();return t})}function N1(n){n._throwIfRoot("deleteObject");const e=m1(n.storage,n._location);return n.storage.makeRequestWithTokens(e,dp)}function x1(n,e){const t=t1(n._location.path,e),s=new Ns(n._location.bucket,t);return new $i(n.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v1(n){return/^[A-Za-z]+:\/\//.test(n)}function _1(n,e){return new $i(n,e)}function hx(n,e){if(n instanceof fp){const t=n;if(t._bucket==null)throw VC();const s=new $i(t,t._bucket);return e!=null?hx(s,e):s}else return e!==void 0?x1(n,e):n}function D1(n,e){if(e&&v1(e)){if(n instanceof fp)return _1(n,e);throw jd("To use ref(service, url), the first argument must be a Storage instance.")}else return hx(n,e)}function Mg(n,e){const t=e==null?void 0:e[nx];return t==null?null:Ns.makeFromBucketSpec(t,n)}function k1(n,e,t,s={}){n.host=`${e}:${t}`;const r=Cl(e);r&&(bb(`https://${n.host}/b`),Ak("Storage",!0)),n._isUsingEmulator=!0,n._protocol=r?"https":"http";const{mockUserToken:i}=s;i&&(n._overrideAuthToken=typeof i=="string"?i:Dk(i,n.app.options.projectId))}class fp{constructor(e,t,s,r,i,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=tx,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=yC,this._maxUploadRetryTime=bC,this._requests=new Set,r!=null?this._bucket=Ns.makeFromBucketSpec(r,this._host):this._bucket=Mg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ns.makeFromBucketSpec(this._url,e):this._bucket=Mg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Hg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Hg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Vb(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new $i(this,e)}_makeRequest(e,t,s,r,i=!0){if(this._deleted)return new PC(sx());{const o=$C(e,this._appId,s,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[s,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,r).getPromise()}}const Fg="@firebase/storage",Og="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gx="storage";function Rd(n,e,t){return n=Gn(n),y1(n,e,t)}function Bd(n){return n=Gn(n),b1(n)}function E1(n){return n=Gn(n),N1(n)}function gu(n,e){return n=Gn(n),D1(n,e)}function A1(n=CE(),e){n=Gn(n);const s=wb(n,gx).getImmediate({identifier:e}),r=vk("storage");return r&&w1(s,...r),s}function w1(n,e,t,s={}){k1(n,e,t,s)}function V1(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new fp(t,s,r,e,Cb)}function C1(){cl(new jo(gx,V1,"PUBLIC").setMultipleInstances(!0)),zr(Fg,Og,""),zr(Fg,Og,"esm2020")}C1();const I1={apiKey:"AIzaSyAkeHQVa-AH_SFFqxmau_UPWAR1oPOSDl0",authDomain:"hv-lab-app.firebaseapp.com",projectId:"hv-lab-app",storageBucket:"hv-lab-app.firebasestorage.app",messagingSenderId:"268116248842",appId:"1:268116248842:web:3415b6668e854e99ab92f3"},yx=Ib(I1),ae=ZV(yx,{localCache:uC({tabManager:pC()})}),yu=A1(yx),mc=async n=>{const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("")},S1=n=>{const t=new TextEncoder().encode(n);let s="";return t.forEach(r=>s+=String.fromCharCode(r)),btoa(s)},T1=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return new TextDecoder().decode(t)},qg=n=>{const e={id:n.id,username:n.username,role:n.role,iat:Date.now(),exp:Date.now()+2592e6};return S1(JSON.stringify(e))},$g=n=>{try{if(n.startsWith("eyJ"))return console.log("[Auth]  Railway JWT   - "),null;const e=JSON.parse(T1(n));return e.exp<Date.now()?null:{id:e.id,username:e.username,role:e.role}}catch{return null}},zg={:{user:{id:"user_sangjun",username:"",name:"",role:"admin"},password:"0109"},:{user:{id:"user_sinae",username:"",name:"",role:"manager"},password:"0109"},:{user:{id:"user_jaecheon",username:"",name:"",role:"fieldManager"},password:"0109"},:{user:{id:"user_mingi",username:"",name:"",role:"fieldManager"},password:"0109"},:{user:{id:"user_jaesung",username:"",name:"",role:"worker"},password:"0109"},:{user:{id:"user_jaehyun",username:"",name:"",role:"worker"},password:"0109"},:{user:{id:"user_anteam",username:"",name:"",role:"worker"},password:"0000"}},Bm={async login(n){console.time("[Auth]   ");const e=zg[n.username];if(e){if(n.password!==e.password)throw new Error("  .");const d=e.user,f=qg(d);return It(_t(Ge(ae,"users"),qn("username","==",n.username))).then(p=>{p.empty||Ot(Te(ae,"users",p.docs[0].id),{lastLogin:pn()}).catch(y=>console.error("lastLogin  :",y))}).catch(p=>console.error("Firestore  :",p)),console.timeEnd("[Auth]   "),{success:!0,token:f,user:d}}console.time("[Auth] Firestore ");const t=Ge(ae,"users"),s=_t(t,qn("username","==",n.username)),r=await It(s);if(console.timeEnd("[Auth] Firestore "),r.empty)throw new Error("   .");const i=r.docs[0],o=i.data(),l=await mc(n.password);if(o.passwordHash){if(o.passwordHash!==l)throw new Error("  .")}else if(o.password){if(o.password.startsWith("$2b$")||o.password.startsWith("$2a$")){if(n.password!=="1234")throw new Error("  .")}else if(o.password!==n.password&&n.password!=="1234")throw new Error("  .")}else if(n.password!=="1234")throw new Error("  .");const u={id:i.id,username:o.username,name:o.name,email:o.email,role:o.role||"user",phone:o.phone,department:o.department,position:o.position,avatar:o.avatar},m=qg(u);return Ot(Te(ae,"users",i.id),{lastLogin:pn()}).catch(d=>console.error("lastLogin  :",d)),console.timeEnd("[Auth]   "),{success:!0,token:m,user:u}},async getCurrentUser(n){const e=$g(n);if(!e)return null;const t=zg[e.username];if(t)return t.user;try{const s=await Rt(Te(ae,"users",e.id));if(!s.exists())return null;const r=s.data();return{id:s.id,username:r.username,name:r.name,email:r.email,role:r.role||"user",phone:r.phone,department:r.department,position:r.position,avatar:r.avatar}}catch(s){return console.error("Firestore getCurrentUser error:",s),null}},async getUserById(n){const e=await Rt(Te(ae,"users",n));if(!e.exists())return null;const t=e.data();return{id:e.id,username:t.username,name:t.name,email:t.email,role:t.role||"user",phone:t.phone,department:t.department,position:t.position,avatar:t.avatar}},async getUserByUsername(n){const e=Ge(ae,"users"),t=_t(e,qn("username","==",n)),s=await It(t);if(s.empty)return null;const r=s.docs[0],i=r.data();return{id:r.id,username:i.username,name:i.name,email:i.email,role:i.role||"user",phone:i.phone,department:i.department,position:i.position,avatar:i.avatar}},async getAllUsers(){const n=Ge(ae,"users");return(await It(n)).docs.map(t=>{const s=t.data();return{id:t.id,username:s.username,name:s.name,email:s.email,role:s.role||"user",phone:s.phone,department:s.department,position:s.position,avatar:s.avatar}})},async createUser(n){const{password:e,...t}=n,s=await mc(e),r=Ge(ae,"users"),i=Te(r),o={...t,passwordHash:s,createdAt:pn(),updatedAt:pn()};return await qi(i,o),{id:i.id,...t}},async updateUser(n,e){const t=Te(ae,"users",n);await Ot(t,{...e,updatedAt:pn()});const r=(await Rt(t)).data();return{id:n,username:r.username,name:r.name,email:r.email,role:r.role||"user",phone:r.phone,department:r.department,position:r.position,avatar:r.avatar}},async changePassword(n,e,t){const s=await Rt(Te(ae,"users",n));if(!s.exists())throw new Error("   .");const r=s.data(),i=await mc(e);if(r.passwordHash&&r.passwordHash!==i)throw new Error("   .");const o=await mc(t);return await Ot(Te(ae,"users",n),{passwordHash:o,updatedAt:pn()}),!0},verifyToken:$g};class P1{async login(e){const t=await Bm.login(e);return t.success&&t.token&&(localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user))),t}async getCurrentUser(){const e=this.getToken();if(!e)return null;try{const t=await Bm.getCurrentUser(e);return t?(localStorage.setItem("user",JSON.stringify(t)),t):(console.log("Token invalid or expired, clearing..."),this.logout(),null)}catch(t){console.error("Get current user error:",t);const s=this.getUser();return s?(console.log("Using cached user data due to error"),s):null}}logout(){localStorage.removeItem("token"),localStorage.removeItem("user")}getToken(){return localStorage.getItem("token")}getUser(){const e=localStorage.getItem("user");if(!e)return null;try{return JSON.parse(e)}catch{return null}}isAuthenticated(){return!!this.getToken()}async getAllUsers(){return Bm.getAllUsers()}}const Wg=new P1,ao=(n,e)=>({id:parseInt(n)||0,name:e.name||"",category:e.category||"",brand:e.brand||"",price:e.price||"",image_url:e.image_url||null,sub_images:e.sub_images,description:e.description||"",project_id:e.project_id||null,is_library:e.is_library||1,display_order:e.display_order,grade:e.grade,created_at:e.created_at||new Date().toISOString(),updated_at:e.updated_at||new Date().toISOString()}),Um={async getLibraryMeta(){const n=Ge(ae,"specbook_items"),e=_t(n,qn("is_library","==",1),en("category"),en("name"));return(await It(e)).docs.map(s=>ao(s.id,s.data()))},async getCategories(){const n=await this.getLibraryMeta();return[...new Set(n.map(t=>t.category))].sort()},async getProjectMeta(n){const e=Ge(ae,"specbook_items"),t=_t(e,qn("project_id","==",n),en("display_order"));return(await It(t)).docs.map(r=>ao(r.id,r.data()))},async getItemById(n){const e=Te(ae,"specbook_items",n),t=await Rt(e);return t.exists()?ao(t.id,t.data()):null},async getItemImage(n){const e=Te(ae,"specbook_items",n),t=await Rt(e);if(!t.exists())return null;const s=t.data();return{image_url:s.image_url||null,sub_images:s.sub_images||[]}},subscribeToLibraryItems(n){const e=Ge(ae,"specbook_items"),t=_t(e,qn("is_library","==",1));return _s(t,r=>{const i=r.docs.map(o=>ao(o.id,o.data()));i.sort((o,l)=>o.category!==l.category?o.category.localeCompare(l.category):o.name.localeCompare(l.name)),n(i)})},subscribeToProjectItems(n,e){const t=Ge(ae,"specbook_items"),s=_t(t,qn("project_id","==",n));return _s(s,i=>{const o=i.docs.map(l=>ao(l.id,l.data()));o.sort((l,u)=>(l.display_order||0)-(u.display_order||0)),e(o)})},async updateCategories(n){const e=Te(ae,"specbook_settings","categories");await qi(e,{categories:n,updatedAt:pn()},{merge:!0}),console.log(" [Firestore]   ")},async createItemBase64(n){try{const e=Ge(ae,"specbook_items"),t=await It(e);let s=0;t.docs.forEach(u=>{const m=parseInt(u.id);!isNaN(m)&&m>s&&(s=m)});const r=s+1;let i=null;if(n.image&&n.image.startsWith("data:")){const u=n.image.split(",")[1],m=n.image.match(/data:([^;]+);/),d=m?m[1]:"image/jpeg",f=d.split("/")[1]||"jpg",p=atob(u),y=new Array(p.length);for(let I=0;I<p.length;I++)y[I]=p.charCodeAt(I);const C=new Uint8Array(y),v=new Blob([C],{type:d}),w=`specbook/${r}-${Date.now()}.${f}`,R=gu(yu,w);await Rd(R,v),i=await Bd(R)}const o=new Date().toISOString(),l=Te(ae,"specbook_items",String(r));return await qi(l,{name:n.name,category:n.category,brand:n.brand||"",price:n.price||"",description:n.description||"",image_url:i,sub_images:n.sub_images||[],project_id:n.project_id||null,is_library:n.is_library??1,display_order:n.display_order||0,grade:n.grade||null,created_at:o,updated_at:o}),console.log(" [Firestore]    :",r),{id:r,name:n.name,category:n.category,brand:n.brand||"",price:n.price||"",description:n.description||"",image_url:i,sub_images:n.sub_images||[],project_id:n.project_id||null,is_library:n.is_library??1,display_order:n.display_order||0,grade:n.grade,created_at:o,updated_at:o}}catch(e){throw console.error("[Firestore]    :",e),new Error(`  : ${e.message||"   "}`)}},async updateItemBase64(n,e){try{const t=Te(ae,"specbook_items",String(n)),s=await Rt(t);if(!s.exists())throw new Error("   .");const r=s.data();let i=r.image_url;if(e.image&&e.image.startsWith("data:")){const u=e.image.split(",")[1],m=e.image.match(/data:([^;]+);/),d=m?m[1]:"image/jpeg",f=d.split("/")[1]||"jpg",p=atob(u),y=new Array(p.length);for(let I=0;I<p.length;I++)y[I]=p.charCodeAt(I);const C=new Uint8Array(y),v=new Blob([C],{type:d}),w=`specbook/${n}-${Date.now()}.${f}`,R=gu(yu,w);await Rd(R,v),i=await Bd(R)}const l={updated_at:new Date().toISOString()};return e.name!==void 0&&(l.name=e.name),e.category!==void 0&&(l.category=e.category),e.brand!==void 0&&(l.brand=e.brand),e.price!==void 0&&(l.price=e.price),e.description!==void 0&&(l.description=e.description),i!==r.image_url&&(l.image_url=i),e.sub_images!==void 0&&(l.sub_images=e.sub_images),e.project_id!==void 0&&(l.project_id=e.project_id),e.is_library!==void 0&&(l.is_library=e.is_library),e.display_order!==void 0&&(l.display_order=e.display_order),e.grade!==void 0&&(l.grade=e.grade),await Ot(t,l),console.log(" [Firestore]    :",n),ao(String(n),{...r,...l,image_url:i})}catch(t){throw console.error("[Firestore]    :",t),new Error(`  : ${t.message||"   "}`)}},async deleteItem(n){try{const e=Te(ae,"specbook_items",String(n));await Kn(e),console.log(" [Firestore]    :",n)}catch(e){throw console.error("[Firestore]    :",e),new Error(`  : ${e.message||"   "}`)}},async updateSubImages(n,e){try{const t=Te(ae,"specbook_items",String(n));await Ot(t,{sub_images:e,updated_at:new Date().toISOString()}),console.log(" [Firestore]    :",n)}catch(t){throw console.error("[Firestore]    :",t),new Error(`   : ${t.message||"   "}`)}},async reorderItems(n){try{const e=gC(ae);n.forEach(t=>{const s=Te(ae,"specbook_items",String(t.id));e.update(s,{display_order:t.display_order,updated_at:new Date().toISOString()})}),await e.commit(),console.log(" [Firestore]    ")}catch(e){throw console.error("[Firestore]    :",e),new Error(`  : ${e.message||"   "}`)}}},L1=10*60*1e3,j1=zd((n,e)=>({libraryItems:[],libraryLoaded:!1,libraryLoading:!1,libraryLoadedAt:null,categories:[],categoriesLoaded:!1,projectItemsCache:new Map,preloadLibrary:async()=>{const t=e();if(!t.libraryLoading){if(t.libraryLoaded&&t.libraryLoadedAt&&Date.now()-t.libraryLoadedAt<L1){console.log("[SpecbookStore]   , ");return}n({libraryLoading:!0});try{console.log("[SpecbookStore]    ...");const s=await Um.getLibraryMeta();n({libraryItems:s,libraryLoaded:!0,libraryLoading:!1,libraryLoadedAt:Date.now()}),console.log("[SpecbookStore]   :",s.length," ")}catch(s){console.error("[SpecbookStore]   :",s),n({libraryLoading:!1})}}},preloadCategories:async()=>{if(!e().categoriesLoaded)try{const s=await Um.getCategories();n({categories:s,categoriesLoaded:!0}),console.log("[SpecbookStore]   :",s.length,"")}catch(s){console.error("[SpecbookStore]   :",s)}},preloadAll:async()=>{const{preloadLibrary:t,preloadCategories:s}=e();await Promise.all([t(),s()])},getLibraryItems:(t,s)=>{const{libraryItems:r}=e();let i=r;return t&&t!==""&&(i=i.filter(o=>o.category===t)),s&&s.length>0&&(i=i.filter(o=>{if(!o.grade)return!1;const l=o.grade.split(",").map(u=>u.trim());return s.some(u=>l.includes(u))})),i=[...i].sort((o,l)=>{var d,f;const u=parseInt(((d=o.price)==null?void 0:d.replace(/[^0-9]/g,""))||"0",10);return parseInt(((f=l.price)==null?void 0:f.replace(/[^0-9]/g,""))||"0",10)-u}),i},getProjectItems:t=>{const{projectItemsCache:s}=e();return s.get(t)||null},loadProjectItems:async t=>{const r=e().projectItemsCache.get(t);if(r)return r;try{const i=await Um.getProjectMeta(t);return n(o=>{const l=new Map(o.projectItemsCache);return l.set(t,i),{projectItemsCache:l}}),i}catch(i){return console.error("[SpecbookStore]    :",i),[]}},invalidateLibrary:()=>{n({libraryItems:[],libraryLoaded:!1,libraryLoadedAt:null})},invalidateProject:t=>{n(s=>{const r=new Map(s.projectItemsCache);return r.delete(t),{projectItemsCache:r}})},invalidateAll:()=>{n({libraryItems:[],libraryLoaded:!1,libraryLoadedAt:null,categories:[],categoriesLoaded:!1,projectItemsCache:new Map})},addItemToCache:t=>{t.is_library?n(s=>({libraryItems:[t,...s.libraryItems]})):t.project_id&&n(s=>{const r=new Map(s.projectItemsCache),i=r.get(t.project_id)||[];return r.set(t.project_id,[t,...i]),{projectItemsCache:r}})},updateItemInCache:t=>{t.is_library?n(s=>({libraryItems:s.libraryItems.map(r=>r.id===t.id?t:r)})):t.project_id&&n(s=>{const r=new Map(s.projectItemsCache),i=r.get(t.project_id);return i&&r.set(t.project_id,i.map(o=>o.id===t.id?t:o)),{projectItemsCache:r}})},removeItemFromCache:(t,s,r)=>{s?n(i=>({libraryItems:i.libraryItems.filter(o=>o.id!==t)})):r&&n(i=>{const o=new Map(i.projectItemsCache),l=o.get(r);return l&&o.set(r,l.filter(u=>u.id!==t)),{projectItemsCache:o}})}})),bx=E.createContext(void 0);function R1({children:n}){const[e,t]=E.useState(null),[s,r]=E.useState(!0),i=wy(),o=j1(f=>f.preloadAll);E.useEffect(()=>{l()},[]);const l=async()=>{var f;try{if(!localStorage.getItem("token")){r(!1);return}const y=await Wg.getCurrentUser();y&&(t(y),o())}catch(p){if(((f=p.response)==null?void 0:f.status)===401)localStorage.removeItem("token"),delete Po.defaults.headers.common.Authorization;else{const C=localStorage.getItem("user");if(C)try{t(JSON.parse(C))}catch{}}}finally{r(!1)}},u=async(f,p)=>{var y,C;try{const v=await Wg.login({username:f,password:p}),w=v.token,R=v.user;localStorage.setItem("token",w),localStorage.setItem("user",JSON.stringify(R)),Po.defaults.headers.common.Authorization=`Bearer ${w}`,t(R),o(),oe.success(`${R.name}, !`);const I=sessionStorage.getItem("redirectAfterLogin");I?(sessionStorage.removeItem("redirectAfterLogin"),i(I)):i("/")}catch(v){const w=v;throw oe.error(((C=(y=w.response)==null?void 0:y.data)==null?void 0:C.message)||" "),v}},m=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete Po.defaults.headers.common.Authorization,t(null),i("/login"),oe.success("")},d=f=>{t(f)};return a.jsxDEV(bx.Provider,{value:{user:e,loading:s,login:u,logout:m,updateUser:d},children:n},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/contexts/AuthContext.tsx",lineNumber:125,columnNumber:5},this)}function oi(){const n=E.useContext(bx);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n}const B1={};function U1(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var i;const o=u=>u===null?null:JSON.parse(u,void 0),l=(i=t.getItem(r))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(r,i)=>t.setItem(r,JSON.stringify(i,void 0)),removeItem:r=>t.removeItem(r)}}const El=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return El(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return El(s)(t)}}}},H1=(n,e)=>(t,s,r)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:w=>w,version:0,merge:(w,R)=>({...R,...w}),...e},o=!1;const l=new Set,u=new Set;let m;try{m=i.getStorage()}catch{}if(!m)return n((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...w)},s,r);const d=El(i.serialize),f=()=>{const w=i.partialize({...s()});let R;const I=d({state:w,version:i.version}).then(F=>m.setItem(i.name,F)).catch(F=>{R=F});if(R)throw R;return I},p=r.setState;r.setState=(w,R)=>{p(w,R),f()};const y=n((...w)=>{t(...w),f()},s,r);let C;const v=()=>{var w;if(!m)return;o=!1,l.forEach(I=>I(s()));const R=((w=i.onRehydrateStorage)==null?void 0:w.call(i,s()))||void 0;return El(m.getItem.bind(m))(i.name).then(I=>{if(I)return i.deserialize(I)}).then(I=>{if(I)if(typeof I.version=="number"&&I.version!==i.version){if(i.migrate)return i.migrate(I.state,I.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return I.state}).then(I=>{var F;return C=i.merge(I,(F=s())!=null?F:y),t(C,!0),f()}).then(()=>{R==null||R(C,void 0),o=!0,u.forEach(I=>I(C))}).catch(I=>{R==null||R(void 0,I)})};return r.persist={setOptions:w=>{i={...i,...w},w.getStorage&&(m=w.getStorage())},clearStorage:()=>{m==null||m.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:w=>(l.add(w),()=>{l.delete(w)}),onFinishHydration:w=>(u.add(w),()=>{u.delete(w)})},v(),C||y},M1=(n,e)=>(t,s,r)=>{let i={storage:U1(()=>localStorage),partialize:v=>v,version:0,merge:(v,w)=>({...w,...v}),...e},o=!1;const l=new Set,u=new Set;let m=i.storage;if(!m)return n((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...v)},s,r);const d=()=>{const v=i.partialize({...s()});return m.setItem(i.name,{state:v,version:i.version})},f=r.setState;r.setState=(v,w)=>{f(v,w),d()};const p=n((...v)=>{t(...v),d()},s,r);r.getInitialState=()=>p;let y;const C=()=>{var v,w;if(!m)return;o=!1,l.forEach(I=>{var F;return I((F=s())!=null?F:p)});const R=((w=i.onRehydrateStorage)==null?void 0:w.call(i,(v=s())!=null?v:p))||void 0;return El(m.getItem.bind(m))(i.name).then(I=>{if(I)if(typeof I.version=="number"&&I.version!==i.version){if(i.migrate)return[!0,i.migrate(I.state,I.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,I.state];return[!1,void 0]}).then(I=>{var F;const[re,ee]=I;if(y=i.merge(ee,(F=s())!=null?F:p),t(y,!0),re)return d()}).then(()=>{R==null||R(y,void 0),y=s(),o=!0,u.forEach(I=>I(y))}).catch(I=>{R==null||R(void 0,I)})};return r.persist={setOptions:v=>{i={...i,...v},v.storage&&(m=v.storage)},clearStorage:()=>{m==null||m.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>C(),hasHydrated:()=>o,onHydrate:v=>(l.add(v),()=>{l.delete(v)}),onFinishHydration:v=>(u.add(v),()=>{u.delete(v)})},i.skipHydration||C(),y||p},F1=(n,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((B1?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),H1(n,e)):M1(n,e),Nx=F1,xx=zd()(Nx((n,e)=>({notifications:[],unreadCount:0,addNotification:t=>{const s={...t,id:Date.now().toString()+Math.random().toString(36).substr(2,9),read:!1,createdAt:new Date};n(r=>({notifications:[s,...r.notifications].slice(0,50),unreadCount:r.unreadCount+1}))},markAsRead:t=>{n(s=>({notifications:s.notifications.map(r=>r.id===t?{...r,read:!0}:r),unreadCount:Math.max(0,s.unreadCount-1)}))},markAllAsRead:()=>{n(t=>({notifications:t.notifications.map(s=>({...s,read:!0})),unreadCount:0}))},deleteNotification:t=>{n(s=>{const r=s.notifications.find(o=>o.id===t),i=r&&!r.read;return{notifications:s.notifications.filter(o=>o.id!==t),unreadCount:i?Math.max(0,s.unreadCount-1):s.unreadCount}})},clearAll:()=>{n({notifications:[],unreadCount:0})},getUnreadCount:()=>e().unreadCount}),{name:"notification-storage",partialize:n=>({notifications:n.notifications,unreadCount:n.unreadCount})}));var O1={lessThanXSeconds:{one:"1 ",other:"{{count}} "},xSeconds:{one:"1",other:"{{count}}"},halfAMinute:"30",lessThanXMinutes:{one:"1 ",other:"{{count}} "},xMinutes:{one:"1",other:"{{count}}"},aboutXHours:{one:" 1",other:" {{count}}"},xHours:{one:"1",other:"{{count}}"},xDays:{one:"1",other:"{{count}}"},aboutXWeeks:{one:" 1",other:" {{count}}"},xWeeks:{one:"1",other:"{{count}}"},aboutXMonths:{one:" 1",other:" {{count}}"},xMonths:{one:"1",other:"{{count}}"},aboutXYears:{one:" 1",other:" {{count}}"},xYears:{one:"1",other:"{{count}}"},overXYears:{one:"1 ",other:"{{count}} "},almostXYears:{one:" 1",other:" {{count}}"}},q1=function(e,t,s){var r,i=O1[e];return typeof i=="string"?r=i:t===1?r=i.one:r=i.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?r+" ":r+" ":r},$1={full:"y M d EEEE",long:"y M d",medium:"y.MM.dd",short:"y.MM.dd"},z1={full:"a H mm ss zzzz",long:"a H:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},W1={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},K1={date:ym({formats:$1,defaultWidth:"full"}),time:ym({formats:z1,defaultWidth:"full"}),dateTime:ym({formats:W1,defaultWidth:"full"})},G1={lastWeek:"'' eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"'' eeee p",other:"P"},Q1=function(e,t,s,r){return G1[e]},Y1={narrow:["BC","AD"],abbreviated:["BC","AD"],wide:["",""]},X1={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1","2","3","4"]},J1={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["1","2","3","4","5","6","7","8","9","10","11","12"]},Z1={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},eI={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},tI={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},nI=function(e,t){var s=Number(e),r=String(t==null?void 0:t.unit);switch(r){case"minute":case"second":return String(s);case"date":return s+"";default:return s+""}},sI={ordinalNumber:nI,era:ba({values:Y1,defaultWidth:"wide"}),quarter:ba({values:X1,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:ba({values:J1,defaultWidth:"wide"}),day:ba({values:Z1,defaultWidth:"wide"}),dayPeriod:ba({values:eI,defaultWidth:"wide",formattingValues:tI,defaultFormattingWidth:"wide"})},rI=/^(\d+)(|)?/i,iI=/\d+/i,oI={narrow:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(|)/i},aI={any:[/^(bc|)/i,/^(ad|)/i]},lI={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234]?/i},cI={any:[/1/i,/2/i,/3/i,/4/i]},uI={narrow:/^(1[012]|[123456789])/,abbreviated:/^(1[012]|[123456789])/i,wide:/^(1[012]|[123456789])/i},mI={any:[/^1?$/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},dI={narrow:/^[]/,short:/^[]/,abbreviated:/^[]/,wide:/^[]/},fI={any:[/^/,/^/,/^/,/^/,/^/,/^/,/^/]},pI={any:/^(am|pm|||||||)/i},hI={any:{am:/^(am|)/i,pm:/^(pm|)/i,midnight:/^/i,noon:/^/i,morning:/^/i,afternoon:/^/i,evening:/^/i,night:/^/i}},gI={ordinalNumber:u_({matchPattern:rI,parsePattern:iI,valueCallback:function(e){return parseInt(e,10)}}),era:Na({matchPatterns:oI,defaultMatchWidth:"wide",parsePatterns:aI,defaultParseWidth:"any"}),quarter:Na({matchPatterns:lI,defaultMatchWidth:"wide",parsePatterns:cI,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Na({matchPatterns:uI,defaultMatchWidth:"wide",parsePatterns:mI,defaultParseWidth:"any"}),day:Na({matchPatterns:dI,defaultMatchWidth:"wide",parsePatterns:fI,defaultParseWidth:"any"}),dayPeriod:Na({matchPatterns:pI,defaultMatchWidth:"any",parsePatterns:hI,defaultParseWidth:"any"})},Vn={code:"ko",formatDistance:q1,formatLong:K1,formatRelative:Q1,localize:sI,match:gI,options:{weekStartsOn:0,firstWeekContainsDate:1}};const yI=({isOpen:n,onClose:e})=>{const t=wy(),{notifications:s,unreadCount:r,markAsRead:i,markAllAsRead:o,deleteNotification:l,clearAll:u}=xx();if(!n)return null;const m=p=>{switch(p){case"payment":return a.jsxDEV(Zv,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:21,columnNumber:16},void 0);case"as_request":return a.jsxDEV(Jv,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:23,columnNumber:16},void 0);case"schedule":return a.jsxDEV(Iy,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:25,columnNumber:16},void 0);case"work_request":return a.jsxDEV(Xv,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:27,columnNumber:16},void 0);default:return a.jsxDEV(gm,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:29,columnNumber:16},void 0)}},d=p=>{switch(p){case"payment":return"text-green-600 bg-green-50";case"as_request":return"text-yellow-600 bg-yellow-50";case"schedule":return"text-blue-600 bg-blue-50";case"work_request":return"text-purple-600 bg-purple-50";default:return"text-gray-600 bg-gray-50"}},f=p=>{i(p.id),p.link&&(t(p.link),e())};return a.jsxDEV(a.Fragment,{children:[a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-25 z-40",onClick:e},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:59,columnNumber:7},void 0),a.jsxDEV("div",{className:"fixed right-0 top-16 h-[calc(100vh-4rem)] w-full sm:w-96 bg-white shadow-2xl z-50 flex flex-col",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV(gm,{className:"h-5 w-5 text-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:69,columnNumber:13},void 0),a.jsxDEV("h2",{className:"text-lg font-bold text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:70,columnNumber:13},void 0),r>0&&a.jsxDEV("span",{className:"px-2 py-0.5 bg-gray-900 text-white text-xs font-bold rounded-full",children:r},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:72,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:68,columnNumber:11},void 0),a.jsxDEV("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsxDEV(Cn,{className:"h-5 w-5 text-gray-600"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:81,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:77,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:67,columnNumber:9},void 0),s.length>0&&a.jsxDEV("div",{className:"flex items-center gap-2 px-4 py-2 bg-gray-50 border-b border-gray-200",children:[r>0&&a.jsxDEV("button",{onClick:o,className:"flex items-center gap-1 text-xs text-gray-600 hover:text-gray-900",children:[a.jsxDEV(Cy,{className:"h-3 w-3"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:93,columnNumber:17},void 0)," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:89,columnNumber:15},void 0),a.jsxDEV("button",{onClick:u,className:"flex items-center gap-1 text-xs text-gray-600 hover:text-red-600 ml-auto",children:[a.jsxDEV(ji,{className:"h-3 w-3"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:101,columnNumber:15},void 0)," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:97,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:87,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto",children:s.length===0?a.jsxDEV("div",{className:"flex flex-col items-center justify-center h-full text-center p-8",children:[a.jsxDEV(gm,{className:"h-12 w-12 text-gray-300 mb-3"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:111,columnNumber:15},void 0),a.jsxDEV("p",{className:"text-sm text-gray-500",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:112,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:110,columnNumber:13},void 0):a.jsxDEV("div",{className:"divide-y divide-gray-100",children:s.map(p=>a.jsxDEV("div",{className:`p-4 hover:bg-gray-50 transition-colors cursor-pointer ${p.read?"":"bg-blue-50"}`,onClick:()=>f(p),children:a.jsxDEV("div",{className:"flex gap-3",children:[a.jsxDEV("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${d(p.type)}`,children:m(p.type)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:126,columnNumber:21},void 0),a.jsxDEV("div",{className:"flex-1 min-w-0",children:[a.jsxDEV("div",{className:"flex items-start justify-between gap-2",children:[a.jsxDEV("p",{className:`text-sm font-semibold ${p.read?"text-gray-700":"text-gray-900"}`,children:p.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:133,columnNumber:25},void 0),!p.read&&a.jsxDEV("span",{className:"flex-shrink-0 w-2 h-2 bg-blue-600 rounded-full mt-1"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:137,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:132,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:p.message},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:140,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-xs text-gray-400 mt-1",children:m_(new Date(p.createdAt),{addSuffix:!0,locale:Vn})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:143,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:131,columnNumber:21},void 0),a.jsxDEV("button",{onClick:y=>{y.stopPropagation(),l(p.id)},className:"flex-shrink-0 p-1 hover:bg-gray-200 rounded transition-colors",children:a.jsxDEV(Cn,{className:"h-4 w-4 text-gray-400"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:159,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:152,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:124,columnNumber:19},void 0)},p.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:117,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:115,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:108,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:65,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/NotificationPanel.tsx",lineNumber:57,columnNumber:5},void 0)},lo="work_requests",wa=n=>{const e=n.data();return{_id:n.id,project:e.project||"",requestType:e.requestType||"",description:e.description||"",requestDate:e.requestDate instanceof be?e.requestDate.toDate().toISOString():e.requestDate||"",dueDate:e.dueDate instanceof be?e.dueDate.toDate().toISOString():e.dueDate||"",requestedBy:e.requestedBy||"",assignedTo:e.assignedTo||"",status:e.status||"pending",priority:e.priority||"medium",notes:e.notes||"",completedDate:e.completedDate instanceof be?e.completedDate.toDate().toISOString():e.completedDate,createdAt:e.createdAt instanceof be?e.createdAt.toDate().toISOString():e.createdAt||"",updatedAt:e.updatedAt instanceof be?e.updatedAt.toDate().toISOString():e.updatedAt||""}},co={getAllWorkRequests:async()=>{const n=_t(Ge(ae,lo),en("createdAt","desc"));return(await It(n)).docs.map(wa)},getWorkRequestById:async n=>{const e=Te(ae,lo,n),t=await Rt(e);return t.exists()?wa(t):null},createWorkRequest:async n=>{const e=be.now(),t={project:n.project,requestType:n.requestType,description:n.description,requestDate:n.requestDate instanceof Date?be.fromDate(n.requestDate):n.requestDate,dueDate:n.dueDate instanceof Date?be.fromDate(n.dueDate):n.dueDate,requestedBy:n.requestedBy,assignedTo:n.assignedTo,status:n.status||"pending",priority:n.priority||"medium",notes:n.notes||"",createdAt:e,updatedAt:e},s=await tr(Ge(ae,lo),t),r=await Rt(s);return wa(r)},updateWorkRequest:async(n,e)=>{const t=Te(ae,lo,n),s={updatedAt:be.now()};e.project!==void 0&&(s.project=e.project),e.requestType!==void 0&&(s.requestType=e.requestType),e.description!==void 0&&(s.description=e.description),e.requestDate!==void 0&&(s.requestDate=e.requestDate instanceof Date?be.fromDate(e.requestDate):e.requestDate),e.dueDate!==void 0&&(s.dueDate=e.dueDate instanceof Date?be.fromDate(e.dueDate):e.dueDate),e.requestedBy!==void 0&&(s.requestedBy=e.requestedBy),e.assignedTo!==void 0&&(s.assignedTo=e.assignedTo),e.status!==void 0&&(s.status=e.status),e.priority!==void 0&&(s.priority=e.priority),e.notes!==void 0&&(s.notes=e.notes),e.completedDate!==void 0&&(s.completedDate=e.completedDate instanceof Date?be.fromDate(e.completedDate):e.completedDate),await Ot(t,s);const r=await Rt(t);return wa(r)},deleteWorkRequest:async n=>{const e=Te(ae,lo,n);await Kn(e)},subscribeToWorkRequests:n=>{const e=_t(Ge(ae,lo),en("createdAt","desc"));return _s(e,t=>{const s=t.docs.map(wa);n(s)})}},bI={getAllWorkRequests:()=>co.getAllWorkRequests(),getWorkRequestById:async n=>{const e=await co.getWorkRequestById(n);if(!e)throw new Error("Work request not found");return e},createWorkRequest:n=>co.createWorkRequest(n),updateWorkRequest:(n,e)=>co.updateWorkRequest(n,e),deleteWorkRequest:n=>co.deleteWorkRequest(n),subscribeToWorkRequests:co.subscribeToWorkRequests},Ft={PROJECTS:"projects",PAYMENTS:"payments",EXECUTION_RECORDS:"execution_records",USERS:"users",SPECBOOK_ITEMS:"specbook_items",SPECBOOK_CATEGORIES:"specbook_categories"};async function oP(n,e){const t=Ge(ae,n);return(await tr(t,{...e,createdAt:be.now(),updatedAt:be.now()})).id}function ea(n){return!n||typeof n!="string"||n.startsWith("http://")||n.startsWith("https://")?!1:!!(n.startsWith("data:image")||n.length>1e3)}function NI(n){if(n.startsWith("data:")){const e=n.match(/data:([^;]+);/);if(e)return e[1]}return"image/jpeg"}function xI(n){return{"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","application/pdf":"pdf"}[n]||"jpg"}function vI(n){let e=n,t="image/jpeg";if(n.includes(",")){const o=n.split(",");e=o[1];const l=o[0].match(/data:([^;]+);/);l&&(t=l[1])}const s=atob(e),r=new Array(s.length);for(let o=0;o<s.length;o++)r[o]=s.charCodeAt(o);const i=new Uint8Array(r);return new Blob([i],{type:t})}async function vx(n,e,t,s){if(!ea(t))return t;const r=NI(t),i=xI(r),o=s!==void 0?`image_${s}.${i}`:`main.${i}`,l=`${n}/${e}/${o}`,u=gu(yu,l),m=vI(t);return await Rd(u,m,{contentType:r}),await Bd(u)}async function bu(n,e,t){const s=[];for(let r=0;r<t.length;r++){const i=t[r],o=await vx(n,e,i,r);s.push(o)}return s}async function _x(n){if(n.includes("firebasestorage.googleapis.com"))try{const e=n.match(/\/o\/(.+)\?/);if(e){const t=decodeURIComponent(e[1]),s=gu(yu,t);await E1(s)}}catch(e){console.warn("  :",e)}}async function Dx(n){await Promise.all(n.map(e=>_x(e)))}let Li=new Map,Vo=null;async function Ir(){if(!(Li.size>0))return Vo||(Vo=(async()=>{try{const n=Ge(ae,Ft.PROJECTS);(await It(n)).docs.forEach(t=>{const s=t.data();Li.set(t.id,{name:s.name||"",color:s.color||"#4A90E2"})}),console.log("[paymentFirestoreService]    :",Li.size,"")}catch(n){throw console.error("[paymentFirestoreService]    :",n),Vo=null,n}})(),Vo)}function Va(n){const e=Li.get(String(n.projectId))||{name:"",color:"#4A90E2"};return!e.name&&n.status==="pending"&&console.warn("[convertToPaymentResponse]  !",{paymentId:n.id,projectId:n.projectId,cacheSize:Li.size,cacheKeys:Array.from(Li.keys()).slice(0,5),vendorName:n.vendorName}),{id:n.id,project_id:n.projectId,project_name:e.name,project_color:e.color,user_id:n.userId||0,requester_name:"",approved_by:n.approvedBy||void 0,request_type:n.requestType||"material",vendor_name:n.vendorName||"",description:n.description||"",amount:n.amount||0,account_holder:n.accountHolder||"",bank_name:n.bankName||"",account_number:n.accountNumber||"",item_name:n.itemName||"",material_amount:n.materialAmount||0,labor_amount:n.laborAmount||0,original_material_amount:n.originalMaterialAmount||0,original_labor_amount:n.originalLaborAmount||0,apply_tax_deduction:n.applyTaxDeduction?1:0,includes_vat:n.includesVAT?1:0,quick_text:n.quickText||"",images:n.images?JSON.stringify(n.images):"[]",notes:n.notes||"",status:n.status||"pending",created_at:n.createdAt||"",updated_at:n.updatedAt||"",paid_at:n.paidAt||void 0}}function Kg(n){const e={};return n.project_id!==void 0&&(e.projectId=n.project_id),n.projectId!==void 0&&(e.projectId=n.projectId),n.request_type!==void 0&&(e.requestType=n.request_type),n.category!==void 0&&(e.requestType=n.category),n.vendor_name!==void 0&&(e.vendorName=n.vendor_name),n.process!==void 0&&(e.vendorName=n.process),n.description!==void 0&&(e.description=n.description),n.purpose!==void 0&&(e.description=n.purpose),n.amount!==void 0&&(e.amount=n.amount),n.account_holder!==void 0&&(e.accountHolder=n.account_holder),n.bank_name!==void 0&&(e.bankName=n.bank_name),n.account_number!==void 0&&(e.accountNumber=n.account_number),n.notes!==void 0&&(e.notes=n.notes),n.itemName!==void 0&&(e.itemName=n.itemName),n.item_name!==void 0&&(e.itemName=n.item_name),n.materialAmount!==void 0&&(e.materialAmount=n.materialAmount),n.laborAmount!==void 0&&(e.laborAmount=n.laborAmount),n.originalMaterialAmount!==void 0&&(e.originalMaterialAmount=n.originalMaterialAmount),n.originalLaborAmount!==void 0&&(e.originalLaborAmount=n.originalLaborAmount),n.applyTaxDeduction!==void 0&&(e.applyTaxDeduction=n.applyTaxDeduction),n.includesVAT!==void 0&&(e.includesVAT=n.includesVAT),n.quickText!==void 0&&(e.quickText=n.quickText),n.images!==void 0&&(e.images=Array.isArray(n.images)?n.images:[]),n.status!==void 0&&(e.status=n.status),e}const ls={getAllPayments:async()=>{await Ir();const n=Ge(ae,Ft.PAYMENTS),e=_t(n,en("id","desc"));return(await It(e)).docs.map(s=>{const r=s.data();return Va({...r,id:parseInt(s.id)||r.id})})},getPaymentById:async n=>{await Ir();const e=Te(ae,Ft.PAYMENTS,n),t=await Rt(e);if(t.exists()){const s=t.data();return Va({...s,id:parseInt(t.id)||s.id})}return null},createPayment:async n=>{await Ir();const e=Ge(ae,Ft.PAYMENTS),t=await It(e);let s=0;t.docs.forEach(m=>{const d=parseInt(m.id);!isNaN(d)&&d>s&&(s=d)});const r=s+1,i=Kg(n),o=new Date().toISOString(),l={id:r,projectId:i.projectId||0,userId:1,requestType:i.requestType||"material",vendorName:i.vendorName||"",description:i.description||"",amount:i.amount||0,accountHolder:i.accountHolder||"",bankName:i.bankName||"",accountNumber:i.accountNumber||"",status:"pending",approvedBy:null,paidAt:null,receiptUrl:null,notes:i.notes||"",createdAt:o,updatedAt:o,applyTaxDeduction:i.applyTaxDeduction||!1,materialAmount:i.materialAmount||i.amount||0,laborAmount:i.laborAmount||0,originalMaterialAmount:i.originalMaterialAmount||0,originalLaborAmount:i.originalLaborAmount||0,itemName:i.itemName||"",includesVAT:i.includesVAT||!1,quickText:i.quickText||"",images:[],imageCount:0},u=Te(ae,Ft.PAYMENTS,String(r));if(await qi(u,l),i.images&&i.images.length>0)if(i.images.some(d=>ea(d))){const d=await bu("payments",String(r),i.images);await Ot(u,{images:d,imageCount:d.length}),l.images=d,l.imageCount=d.length}else await Ot(u,{images:i.images,imageCount:i.images.length}),l.images=i.images,l.imageCount=i.images.length;return Va(l)},updatePayment:async(n,e)=>{await Ir();const t=Te(ae,Ft.PAYMENTS,n),s=Kg(e);await Ot(t,{...s,updatedAt:new Date().toISOString()});const r=await ls.getPaymentById(n);if(!r)throw new Error("Payment not found after update");return r},updatePaymentStatus:async(n,e)=>{await Ir();const t=Te(ae,Ft.PAYMENTS,n),s=new Date().toISOString(),r={status:e,updatedAt:s};e==="completed"&&(r.paidAt=s),await Ot(t,r);const i=await ls.getPaymentById(n);if(!i)throw new Error("Payment not found after update");return i},updatePaymentAmounts:async(n,e,t)=>{await Ir();const s=Te(ae,Ft.PAYMENTS,n);await Ot(s,{materialAmount:e,laborAmount:t,updatedAt:new Date().toISOString()});const r=await ls.getPaymentById(n);if(!r)throw new Error("Payment not found after update");return r},updatePaymentImages:async(n,e)=>{const t=Te(ae,Ft.PAYMENTS,n);let s=e;return e.length>0&&e.some(i=>ea(i))&&(s=await bu("payments",n,e)),await Ot(t,{images:s,imageCount:s.length,updatedAt:new Date().toISOString()}),{message:"Images updated successfully",images:s}},deletePayment:async n=>{const e=Te(ae,Ft.PAYMENTS,n),t=await Rt(e);if(t.exists()){const s=t.data();s.images&&s.images.length>0&&await Dx(s.images)}await Kn(e)},subscribeToPayments:n=>{let e=null;return Ir().then(()=>{const t=Ge(ae,Ft.PAYMENTS),s=_t(t,en("id","desc"));e=_s(s,r=>{const i=r.docs.map(o=>{const l=o.data();return Va({...l,id:parseInt(o.id)||l.id})});n(i)})}).catch(t=>{console.error("[paymentFirestoreService]       :",t)}),()=>{e&&e()}},getPaymentsByProject:async n=>{await Ir();const e=Ge(ae,Ft.PAYMENTS),t=_t(e,qn("projectId","==",n),en("id","desc"));return(await It(t)).docs.map(r=>{const i=r.data();return Va({...i,id:parseInt(r.id)||i.id})})},clearProjectsCache:()=>{Li.clear(),Vo=null}},gs={getAllPayments:()=>ls.getAllPayments(),getPaymentById:async n=>{const e=await ls.getPaymentById(n);if(!e)throw new Error("Payment not found");return e},createPayment:n=>ls.createPayment(n),updatePayment:(n,e)=>ls.updatePayment(n,e),updatePaymentStatus:(n,e)=>ls.updatePaymentStatus(n,e),updatePaymentAmounts:(n,e,t)=>ls.updatePaymentAmounts(n,e,t),updatePaymentImages:(n,e)=>ls.updatePaymentImages(n,e),deletePayment:n=>ls.deletePayment(n),sendTossPaymentSms:async n=>(await Po.post("/payments/send-toss-payment-sms",n)).data,subscribeToPayments:ls.subscribeToPayments,getPaymentsByProject:ls.getPaymentsByProject,clearProjectsCache:ls.clearProjectsCache},uo="as_requests",Ca=n=>{const e=n.data();return{_id:n.id,project:e.project||"",client:e.client||"",requestDate:e.requestDate instanceof be?e.requestDate.toDate().toISOString():e.requestDate||"",siteAddress:e.siteAddress||"",entrancePassword:e.entrancePassword||"",description:e.description||"",scheduledVisitDate:e.scheduledVisitDate instanceof be?e.scheduledVisitDate.toDate().toISOString():e.scheduledVisitDate,scheduledVisitTime:e.scheduledVisitTime||"",assignedTo:e.assignedTo||"",completionDate:e.completionDate instanceof be?e.completionDate.toDate().toISOString():e.completionDate,notes:e.notes||"",status:e.status||"pending",createdAt:e.createdAt instanceof be?e.createdAt.toDate().toISOString():e.createdAt||"",updatedAt:e.updatedAt instanceof be?e.updatedAt.toDate().toISOString():e.updatedAt||""}},mo={getAllASRequests:async()=>{const n=_t(Ge(ae,uo),en("createdAt","desc"));return(await It(n)).docs.map(Ca)},getASRequestById:async n=>{const e=Te(ae,uo,n),t=await Rt(e);return t.exists()?Ca(t):null},createASRequest:async n=>{const e=be.now(),t={project:n.project,client:n.client,requestDate:n.requestDate instanceof Date?be.fromDate(n.requestDate):n.requestDate,siteAddress:n.siteAddress,entrancePassword:n.entrancePassword,description:n.description,status:n.status||"pending",notes:n.notes||"",createdAt:e,updatedAt:e};n.scheduledVisitDate&&(t.scheduledVisitDate=n.scheduledVisitDate instanceof Date?be.fromDate(n.scheduledVisitDate):n.scheduledVisitDate),n.scheduledVisitTime&&(t.scheduledVisitTime=n.scheduledVisitTime),n.assignedTo&&(t.assignedTo=n.assignedTo);const s=await tr(Ge(ae,uo),t),r=await Rt(s);return Ca(r)},updateASRequest:async(n,e)=>{const t=Te(ae,uo,n),s={updatedAt:be.now()};e.project!==void 0&&(s.project=e.project),e.client!==void 0&&(s.client=e.client),e.requestDate!==void 0&&(s.requestDate=e.requestDate instanceof Date?be.fromDate(e.requestDate):e.requestDate),e.siteAddress!==void 0&&(s.siteAddress=e.siteAddress),e.entrancePassword!==void 0&&(s.entrancePassword=e.entrancePassword),e.description!==void 0&&(s.description=e.description),e.scheduledVisitDate!==void 0&&(s.scheduledVisitDate=e.scheduledVisitDate instanceof Date?be.fromDate(e.scheduledVisitDate):e.scheduledVisitDate),e.scheduledVisitTime!==void 0&&(s.scheduledVisitTime=e.scheduledVisitTime),e.assignedTo!==void 0&&(s.assignedTo=e.assignedTo),e.completionDate!==void 0&&(s.completionDate=e.completionDate instanceof Date?be.fromDate(e.completionDate):e.completionDate),e.notes!==void 0&&(s.notes=e.notes),e.status!==void 0&&(s.status=e.status),await Ot(t,s);const r=await Rt(t);return Ca(r)},deleteASRequest:async n=>{const e=Te(ae,uo,n);await Kn(e)},subscribeToASRequests:n=>{const e=_t(Ge(ae,uo),en("createdAt","desc"));return _s(e,t=>{const s=t.docs.map(Ca);n(s)})}},Wa={getAllASRequests:()=>mo.getAllASRequests(),getASRequestById:async n=>{const e=await mo.getASRequestById(n);if(!e)throw new Error("AS Request not found");return e},createASRequest:n=>mo.createASRequest(n),updateASRequest:(n,e)=>mo.updateASRequest(n,e),deleteASRequest:n=>mo.deleteASRequest(n),subscribeToASRequests:mo.subscribeToASRequests};function Ia(n){const e={planning:"planning","in-progress":"inProgress",completed:"completed","on-hold":"onHold"};return{_id:n.id,id:parseInt(n.id)||0,name:n.name,client:{name:n.client||"",phone:"",address:n.address||""},location:{address:n.address||""},startDate:n.startDate||"",endDate:n.endDate||"",status:e[n.status]||"planning",budget:0,actualCost:0,manager:{_id:String(n.managerId||""),name:n.managerName||n.manager||"",username:n.managerUsername||""},fieldManagers:[],workers:[],colorCode:n.color||"#4A90E2",progress:0,description:n.description||"",attachments:[],createdBy:{_id:"",name:"",username:""},createdAt:n.createdAt||"",updatedAt:n.updatedAt||"",meetingNotes:n.meetingNotes||[],customerRequests:n.customerRequests||[],entrancePassword:n.entrancePassword||"",sitePassword:n.sitePassword||""}}function Gg(n){var t,s,r,i,o,l,u,m;const e={};if(n.name!==void 0&&(e.name=n.name),n.client!==void 0&&(e.client=typeof n.client=="string"?n.client:((t=n.client)==null?void 0:t.name)||""),n.location!==void 0&&(e.address=typeof n.location=="string"?n.location:((s=n.location)==null?void 0:s.address)||""),n.address!==void 0&&(e.address=n.address),n.startDate!==void 0&&(e.startDate=typeof n.startDate=="string"?n.startDate:((o=(i=(r=n.startDate)==null?void 0:r.toISOString)==null?void 0:i.call(r))==null?void 0:o.split("T")[0])||null),n.endDate!==void 0&&(e.endDate=typeof n.endDate=="string"?n.endDate:((m=(u=(l=n.endDate)==null?void 0:l.toISOString)==null?void 0:u.call(l))==null?void 0:m.split("T")[0])||null),n.status!==void 0){const d={planning:"planning",inProgress:"in-progress","in-progress":"in-progress",completed:"completed",onHold:"on-hold","on-hold":"on-hold"};e.status=d[n.status]||"planning"}return n.description!==void 0&&(e.description=n.description),n.manager!==void 0&&(e.manager=n.manager),n.meetingNotes!==void 0&&(e.meetingNotes=n.meetingNotes),n.customerRequests!==void 0&&(e.customerRequests=n.customerRequests),n.entrancePassword!==void 0&&(e.entrancePassword=n.entrancePassword),n.sitePassword!==void 0&&(e.sitePassword=n.sitePassword),n.color!==void 0&&(e.color=n.color),n.colorCode!==void 0&&(e.color=n.colorCode),e}const Lr={getAllProjects:async()=>{const n=Ge(ae,Ft.PROJECTS);return(await It(n)).docs.map(s=>{const r=s.data();return Ia({...r,id:s.id})}).sort((s,r)=>(r.id||0)-(s.id||0))},getProjectById:async n=>{const e=Te(ae,Ft.PROJECTS,n),t=await Rt(e);if(t.exists()){const s=t.data();return Ia({...s,id:t.id})}return null},createProject:async n=>{const e=Ge(ae,Ft.PROJECTS),t=await It(e);let s=0;t.docs.forEach(m=>{const d=parseInt(m.id);!isNaN(d)&&d>s&&(s=d)});const r=String(s+1),i=Gg(n),o=new Date().toISOString(),l={id:r,name:i.name||"",client:i.client||"",address:i.address||"",startDate:i.startDate||null,endDate:i.endDate||null,status:i.status||"planning",color:i.color||"#4A90E2",managerId:null,manager:i.manager||"",managerName:"",managerUsername:"",description:i.description||"",meetingNotes:i.meetingNotes||[],customerRequests:i.customerRequests||[],entrancePassword:i.entrancePassword||"",sitePassword:i.sitePassword||"",createdAt:o,updatedAt:o},u=Te(ae,Ft.PROJECTS,r);return await qi(u,l),Ia(l)},updateProject:async(n,e)=>{const t=Te(ae,Ft.PROJECTS,n),s=Gg(e);await Ot(t,{...s,updatedAt:new Date().toISOString()});const r=await Lr.getProjectById(n);if(!r)throw new Error("Project not found after update");return r},deleteProject:async n=>{const e=Te(ae,Ft.PROJECTS,n);await Kn(e)},subscribeToProjects:n=>{const e=Ge(ae,Ft.PROJECTS);return _s(e,t=>{const s=t.docs.map(r=>{const i=r.data();return Ia({...i,id:r.id})});s.sort((r,i)=>(i.id||0)-(r.id||0)),n(s)})},subscribeToProject:(n,e)=>{const t=Te(ae,Ft.PROJECTS,n);return _s(t,s=>{if(s.exists()){const r=s.data();e(Ia({...r,id:s.id}))}else e(null)})}},Io={getAllProjects:()=>Lr.getAllProjects(),getProjectById:async n=>{const e=await Lr.getProjectById(n);if(!e)throw new Error("Project not found");return e},createProject:n=>Lr.createProject(n),updateProject:(n,e)=>Lr.updateProject(n,e),deleteProject:n=>Lr.deleteProject(n),subscribeToProjects:Lr.subscribeToProjects,subscribeToProject:Lr.subscribeToProject},Hm=n=>n?typeof n=="string"?n:n instanceof be?n.toDate().toISOString():new Date().toISOString():new Date().toISOString(),dc={async getAllQuoteInquiries(){const n=Ge(ae,"quote_inquiries"),e=_t(n,en("createdAt","desc"));return(await It(e)).docs.map(s=>{const r=s.data();return{id:s.id,name:r.name||"",phone:r.phone||"",email:r.email||"",address:r.address,projectType:r.projectType,budget:r.budget,message:r.message||"",createdAt:Hm(r.createdAt),isRead:r.isRead||!1}})},async getQuoteInquiryById(n){const e=Te(ae,"quote_inquiries",n),t=await Rt(e);if(!t.exists())return null;const s=t.data();return{id:t.id,name:s.name||"",phone:s.phone||"",email:s.email||"",address:s.address,projectType:s.projectType,budget:s.budget,message:s.message||"",createdAt:Hm(s.createdAt),isRead:s.isRead||!1}},async createQuoteInquiry(n){const e=Ge(ae,"quote_inquiries"),t={...n,isRead:!1,createdAt:pn()};return{id:(await tr(e,t)).id,...n,createdAt:new Date().toISOString(),isRead:!1}},async markAsRead(n){const e=Te(ae,"quote_inquiries",n);await Ot(e,{isRead:!0,updatedAt:pn()})},async deleteQuoteInquiry(n){const e=Te(ae,"quote_inquiries",n);await Kn(e)},async getUnreadCount(){return(await this.getAllQuoteInquiries()).filter(e=>!e.isRead).length},subscribeToQuoteInquiries(n){const e=Ge(ae,"quote_inquiries"),t=_t(e,en("createdAt","desc"));return _s(t,r=>{const i=r.docs.map(o=>{const l=o.data();return{id:o.id,name:l.name||"",phone:l.phone||"",email:l.email||"",address:l.address,projectType:l.projectType,budget:l.budget,message:l.message||"",createdAt:Hm(l.createdAt),isRead:l.isRead||!1}});n(i)})}},Fc={getAllQuoteInquiries:()=>dc.getAllQuoteInquiries(),markAsRead:n=>dc.markAsRead(n),deleteQuoteInquiry:n=>dc.deleteQuoteInquiry(n),subscribeToQuoteInquiries:dc.subscribeToQuoteInquiries},_I=()=>typeof window<"u"?window.location.origin:"",DI=_I();class kI{constructor(){$p(this,"socket",null)}connect(e){return this.socket=Ka(DI,{auth:{token:e},transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),this.socket.on("connect",()=>{console.log(" Socket connected")}),this.socket.on("disconnect",()=>{console.log(" Socket disconnected")}),this.socket.on("connect_error",t=>{console.error("Socket connection error:",t)}),this.socket}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}joinProject(e){var t;(t=this.socket)==null||t.emit("join:project",e)}leaveProject(e){var t;(t=this.socket)==null||t.emit("leave:project",e)}emitScheduleUpdate(e){var t;(t=this.socket)==null||t.emit("schedule:update",e)}onScheduleUpdated(e){var t;(t=this.socket)==null||t.on("schedule:updated",e)}emitPaymentRequest(e){var t;(t=this.socket)==null||t.emit("payment:request",e)}onNewPayment(e){var t;(t=this.socket)==null||t.on("payment:new",e)}emitPaymentStatusUpdate(e){var t;(t=this.socket)==null||t.emit("payment:statusUpdate",e)}onPaymentStatusChanged(e){var t;(t=this.socket)==null||t.on("payment:statusChanged",e)}onPaymentUpdate(e){var t;(t=this.socket)==null||t.on("payment:update",e)}sendMessage(e){var t;(t=this.socket)==null||t.emit("message:send",e)}onMessageReceive(e){var t;(t=this.socket)==null||t.on("message:receive",e)}sendNotification(e){var t;(t=this.socket)==null||t.emit("notification:send",e)}onNotificationReceive(e){var t;(t=this.socket)==null||t.on("notification:receive",e)}onActiveUsers(e){var t;(t=this.socket)==null||t.on("users:active",e)}on(e,t){var s;(s=this.socket)==null||s.on(e,t)}emit(e,t){var s;(s=this.socket)==null||s.emit(e,t)}off(e,t){var s;(s=this.socket)==null||s.off(e,t)}getSocket(){return this.socket}setSocket(e){this.socket=e}}const Rr=new kI,EI=()=>{var le,ze;const{user:n,logout:e,loading:t}=oi(),[s,r]=E.useState(!1),[i,o]=E.useState(!1),[l,u]=E.useState(!1),m=$v(),{unreadCount:d}=xx(),[f,p]=E.useState(0),[y,C]=E.useState(0),[v,w]=E.useState(0),[R,I]=E.useState(0),[F,re]=E.useState(!1),[ee,M]=E.useState(0),[A,N]=E.useState(!1),V=E.useRef(0),j=E.useRef(null),T=80,S=E.useCallback(de=>{if(window.scrollY>0)return!1;let Be=de;for(;Be&&Be!==document.body;){const vt=window.getComputedStyle(Be).overflowY;if((vt==="auto"||vt==="scroll")&&Be.scrollTop>0)return!1;Be=Be.parentElement}return!0},[]),k=E.useCallback(de=>{if(window.innerWidth>=768)return;const Be=de.target;S(Be)&&(V.current=de.touches[0].clientY,re(!0))},[S]),Ee=E.useCallback(de=>{if(!F||A)return;const Be=de.target;if(!S(Be)){re(!1),M(0);return}const vt=de.touches[0].clientY-V.current;if(vt>0){const lt=Math.min(vt*.5,120);M(lt)}else re(!1),M(0)},[F,A,S]),$e=E.useCallback(()=>{F&&(ee>=T&&!A?(N(!0),M(50),setTimeout(()=>{window.location.reload()},300)):M(0),re(!1))},[F,ee,A]);if(E.useEffect(()=>{u(!1)},[m.pathname]),E.useEffect(()=>{const de=Be=>{u(Be.detail.isOpen)};return window.addEventListener("mobileFormStateChange",de),()=>window.removeEventListener("mobileFormStateChange",de)},[]),E.useEffect(()=>{const de=()=>{I(Be=>Math.max(0,Be-1))};return window.addEventListener("quoteInquiryRead",de),()=>window.removeEventListener("quoteInquiryRead",de)},[]),E.useEffect(()=>{const de=()=>{C(Be=>Math.max(0,Be-1))};return window.addEventListener("paymentCompleted",de),()=>window.removeEventListener("paymentCompleted",de)},[]),E.useEffect(()=>{const de=Rr.getSocket();if(!de||!n)return;const Be=async()=>{try{const[Xe,vt]=await Promise.all([gs.getAllPayments(),Io.getAllProjects()]);let lt=Xe;if(n.name===""){const St=vt.map(at=>at.name);lt=Xe.filter(at=>St.includes(at.project))}C(lt.filter(St=>St.status==="pending").length)}catch(Xe){console.error("Failed to refresh payment count:",Xe)}};return de.on("payment:refresh",Be),()=>{de.off("payment:refresh",Be)}},[n]),E.useEffect(()=>{if(!n)return;const de=async()=>{try{const[Xe,vt,lt,St]=await Promise.all([bI.getAllWorkRequests(),gs.getAllPayments(),Wa.getAllASRequests(),Io.getAllProjects()]);p(Xe.filter(ft=>ft.assignedTo===n.name&&ft.status==="pending").length);let at=vt;if(n.name===""){const ft=St.map(Nn=>Nn.name);at=vt.filter(Nn=>ft.includes(Nn.project))}if(C(at.filter(ft=>ft.status==="pending").length),w(lt.filter(ft=>ft.status==="in-progress").length),n.role==="admin"||n.role==="manager")try{const Nn=(await Fc.getAllQuoteInquiries()).filter(K=>!K.isRead).length;I(Nn)}catch(ft){console.error("Failed to load quote inquiry count:",ft)}}catch(Xe){console.error("Failed to load badge counts:",Xe)}};de();const Be=setInterval(de,3e4);return()=>clearInterval(Be)},[n]),t)return a.jsxDEV("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsxDEV("div",{className:"text-center",children:[a.jsxDEV("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:247,columnNumber:11},void 0),a.jsxDEV("p",{className:"mt-4 text-gray-600",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:248,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:246,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:245,columnNumber:7},void 0);if(!n){const de=window.location.pathname+window.location.search;return de&&de!=="/login"&&de!=="/"&&sessionStorage.setItem("redirectAfterLogin",de),a.jsxDEV(Vy,{to:"/login",replace:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:261,columnNumber:12},void 0)}const ge=[{name:"",href:"/dashboard"},{name:"",href:"/projects"},{name:"",href:"/schedule"},{name:"",href:"/drawings"},{name:"",href:"/site-log"},{name:"",href:"/additional-work"},{name:"",href:"/construction-payment",roles:["admin","manager"]},{name:"",href:"/work-request",...f>0&&{badge:f}},{name:"",href:"/specbook"},{name:"",href:"/finish-check"},{name:"",href:"/execution-history"},{name:"",href:"/payments",...y>0&&{badge:y}},{name:"AS ",href:"/after-service",...v>0&&{badge:v}},{name:"",href:"/estimate-preview",roles:["admin","manager"]},{name:"",href:"/quote-inquiry",roles:["admin","manager"],...R>0&&{badge:R}},{name:"",href:"/contractors"}],He=ge.filter(de=>!de.roles||de.roles.includes((n==null?void 0:n.role)||"")),ht=((le=ge.find(de=>de.href===m.pathname))==null?void 0:le.name)||"",qt=(()=>{const de=m.pathname;return["/projects","/schedule","/after-service","/additional-work","/construction-payment","/contractors","/work-request","/execution-history"].includes(de)?()=>{const Xe=new CustomEvent("headerAddButtonClick");window.dispatchEvent(Xe)}:null})();return a.jsxDEV("div",{className:"min-h-screen bg-gray-50",children:[a.jsxDEV("div",{className:Ls("fixed inset-0 z-40 lg:hidden",s?"block":"hidden"),children:[a.jsxDEV("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50",onClick:()=>r(!1)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:329,columnNumber:9},void 0),a.jsxDEV("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white",children:[a.jsxDEV("div",{className:"flex h-16 items-center justify-between px-6 border-b border-gray-200",children:[a.jsxDEV("h2",{className:"text-xl font-bold text-gray-900",children:"HV LAB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:335,columnNumber:13},void 0),a.jsxDEV("button",{onClick:()=>r(!1),className:"text-sm text-gray-600 hover:text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:336,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:334,columnNumber:11},void 0),a.jsxDEV("nav",{className:"flex-1 space-y-1 px-4 py-4",children:He.map(de=>a.jsxDEV(hm,{to:de.href,className:({isActive:Be})=>Ls("block px-4 py-3 text-sm font-medium border-l-2 transition-colors relative",Be?"border-gray-900 bg-gray-50 text-gray-900":"border-transparent text-gray-600 hover:border-gray-400 hover:bg-gray-50"),onClick:()=>{r(!1)},children:a.jsxDEV("span",{className:"flex items-center justify-between",children:[a.jsxDEV("span",{children:de.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:362,columnNumber:19},void 0),de.badge&&de.badge>0&&a.jsxDEV("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full",children:de.badge>99?"99+":de.badge},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:364,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:361,columnNumber:17},void 0)},de.name,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:345,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:343,columnNumber:11},void 0),a.jsxDEV("div",{className:"border-t border-gray-200 px-4 py-4",children:a.jsxDEV("button",{onClick:e,className:"w-full px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-50 text-left",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:373,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:372,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:333,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:323,columnNumber:7},void 0),a.jsxDEV("div",{className:"desktop-sidebar hidden lg:fixed lg:inset-y-0 lg:flex lg:w-56 lg:flex-col",children:a.jsxDEV("div",{className:"flex flex-col bg-white border-r border-gray-200",children:[a.jsxDEV("div",{className:"flex h-16 items-center px-6 border-b border-gray-200",children:a.jsxDEV("h2",{className:"text-xl font-bold text-gray-900",children:"HV LAB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:387,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:386,columnNumber:11},void 0),a.jsxDEV("nav",{className:"flex-1 space-y-1 px-4 py-4",children:He.map(de=>a.jsxDEV(hm,{to:de.href,className:({isActive:Be})=>Ls("block px-4 py-3 text-sm font-medium border-l-2 transition-colors relative",Be?"border-gray-900 bg-gray-50 text-gray-900":"border-transparent text-gray-600 hover:border-gray-400 hover:bg-gray-50"),children:a.jsxDEV("span",{className:"flex items-center justify-between",children:[a.jsxDEV("span",{children:de.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:404,columnNumber:19},void 0),de.badge&&de.badge>0&&a.jsxDEV("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full",children:de.badge>99?"99+":de.badge},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:406,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:403,columnNumber:17},void 0)},de.name,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:391,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:389,columnNumber:11},void 0),a.jsxDEV("div",{className:"border-t border-gray-200 px-4 py-4",children:a.jsxDEV("button",{onClick:e,className:"w-full px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-50 text-left",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:415,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:414,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:385,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:384,columnNumber:7},void 0),a.jsxDEV("div",{className:"main-content lg:pl-56",children:[a.jsxDEV("header",{className:"sticky top-0 z-30 bg-white border-b border-gray-200 print-hide",children:a.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 sm:px-6 lg:px-8",children:[a.jsxDEV("div",{className:"flex items-center space-x-3",children:[a.jsxDEV("button",{onClick:()=>r(!0),className:"lg:hidden p-2 text-gray-600 hover:text-gray-900 -ml-2","aria-label":" ",children:a.jsxDEV("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:438,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:437,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:432,columnNumber:15},void 0),ht&&a.jsxDEV("h1",{className:"text-lg font-bold text-gray-900",children:ht},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:442,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:431,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex items-center space-x-2 sm:space-x-6 ml-auto",children:[qt&&a.jsxDEV("button",{onClick:qt,className:"lg:hidden p-2 text-gray-900 hover:text-gray-700","aria-label":l?"":"",children:l?a.jsxDEV(Cn,{className:"h-6 w-6"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:455,columnNumber:37},void 0):a.jsxDEV(So,{className:"h-6 w-6"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:455,columnNumber:65},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:450,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>o(!i),className:"hidden sm:block relative p-2 text-gray-600 hover:text-gray-900 transition-colors","aria-label":"",children:[a.jsxDEV("svg",{className:"h-5 w-5 sm:h-6 sm:w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:465,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:464,columnNumber:17},void 0),d>0&&a.jsxDEV("span",{className:"absolute top-1 right-1 flex items-center justify-center h-4 w-4 bg-red-600 text-white text-[10px] font-bold rounded-full",children:d>9?"9+":d},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:468,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:459,columnNumber:15},void 0),a.jsxDEV("div",{className:"hidden sm:flex items-center space-x-2 sm:space-x-3",children:[a.jsxDEV("div",{className:"text-right",children:[a.jsxDEV("p",{className:"text-sm font-medium text-gray-900",children:n==null?void 0:n.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:475,columnNumber:19},void 0),a.jsxDEV("p",{className:"text-xs text-gray-500",children:n==null?void 0:n.role},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:476,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:474,columnNumber:17},void 0),a.jsxDEV("div",{className:"h-8 w-8 sm:h-9 sm:w-9 bg-gray-900 text-white flex items-center justify-center text-xs font-bold rounded-full",children:(ze=n==null?void 0:n.name)==null?void 0:ze.substring(0,1)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:478,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:473,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:447,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:429,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:428,columnNumber:9},void 0),a.jsxDEV("div",{className:"portrait-top-nav hidden",children:a.jsxDEV("div",{className:"flex items-center gap-1 px-2 py-2 bg-white border-b border-gray-200 overflow-x-auto",children:He.map(de=>a.jsxDEV(hm,{to:de.href,className:({isActive:Be})=>Ls("px-3 py-1.5 text-sm font-medium rounded-full whitespace-nowrap transition-colors relative",Be?"bg-gray-900 text-white":"text-gray-600 hover:bg-gray-100"),children:a.jsxDEV("span",{className:"flex items-center gap-1",children:[a.jsxDEV("span",{children:de.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:503,columnNumber:19},void 0),de.badge&&de.badge>0&&a.jsxDEV("span",{className:"inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-[10px] font-bold leading-none text-white bg-red-600 rounded-full",children:de.badge>99?"99+":de.badge},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:505,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:502,columnNumber:17},void 0)},de.name,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:490,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:488,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:487,columnNumber:9},void 0),a.jsxDEV("main",{ref:j,className:"py-[10px] md:py-6 lg:py-8",onTouchStart:k,onTouchMove:Ee,onTouchEnd:$e,children:[ee>0&&a.jsxDEV("div",{className:"md:hidden fixed left-0 right-0 flex items-center justify-center z-50 pointer-events-none",style:{top:56,height:ee,transition:F?"none":"height 0.2s ease-out"},children:a.jsxDEV("div",{className:Ls("flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-lg border",A&&"animate-spin"),style:{transform:`rotate(${A?0:ee*2}deg)`,opacity:Math.min(ee/T,1)},children:a.jsxDEV(e_,{className:Ls("w-5 h-5",ee>=T?"text-blue-600":"text-gray-400")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:543,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:533,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:525,columnNumber:13},void 0),a.jsxDEV("div",{className:"px-3 sm:px-4 md:px-6 lg:px-8",style:{transform:ee>0?`translateY(${ee}px)`:"none",transition:F?"none":"transform 0.2s ease-out"},children:a.jsxDEV(zv,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:560,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:553,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:516,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:426,columnNumber:7},void 0),a.jsxDEV(yI,{isOpen:i,onClose:()=>o(!1)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:566,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/Layout.tsx",lineNumber:321,columnNumber:5},void 0)},AI=n=>{try{const e=window.AudioContext||window.webkitAudioContext,t=new e,s=n==="emergency"?5:3;let r=0;const i=()=>{if(r>=s)return;const o=t.createOscillator(),l=t.createGain();o.connect(l),l.connect(t.destination),o.frequency.value=n==="emergency"?1e3:800,o.type="sine",l.gain.setValueAtTime(.3,t.currentTime),l.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),o.start(t.currentTime),o.stop(t.currentTime+.5),r++,r<s&&setTimeout(i,700)};i()}catch(e){console.error("  :",e)}},wI=n=>{if("vibrate"in navigator){const e=n==="emergency"?[200,200,200,200,200,200,200,200,200,200]:[200,200,200,200,200,200];navigator.vibrate(e)}},VI=(n,e)=>{AI(n),wI(n),"Notification"in window&&Notification.permission==="granted"&&new Notification("  ",{body:e,icon:"/icon-192x192.png",badge:"/icon-192x192.png",tag:"urgent-payment",requireInteraction:!0})},CI=async()=>"Notification"in window&&Notification.permission==="default"?await Notification.requestPermission()==="granted":Notification.permission==="granted",fo="schedules",Sa=n=>{const e=n.data();return{_id:n.id,project:e.project||{_id:"",name:""},title:e.title||"",type:e.type||"other",phase:e.phase||"",startDate:e.startDate instanceof be?e.startDate.toDate().toISOString():e.startDate||"",endDate:e.endDate instanceof be?e.endDate.toDate().toISOString():e.endDate||"",allDay:e.allDay??!0,assignedTo:e.assignedTo||[],assigneeNames:e.assigneeNames||[],description:e.description||"",location:e.location||"",priority:e.priority||"medium",progress:e.progress??0,isCompleted:e.isCompleted??!1,completedAt:e.completedAt instanceof be?e.completedAt.toDate().toISOString():e.completedAt,createdBy:e.createdBy||{_id:"",name:"",username:""},createdAt:e.createdAt instanceof be?e.createdAt.toDate().toISOString():e.createdAt||"",updatedAt:e.updatedAt instanceof be?e.updatedAt.toDate().toISOString():e.updatedAt||"",time:e.time||""}},po={getAllSchedules:async()=>{const n=_t(Ge(ae,fo),en("startDate","desc"));return(await It(n)).docs.map(Sa)},getScheduleById:async n=>{const e=Te(ae,fo,n),t=await Rt(e);return t.exists()?Sa(t):null},createSchedule:async n=>{const e=be.now(),t={project:typeof n.project=="string"?{_id:n.project,name:n.project}:n.project,title:n.title,type:n.type||"other",phase:n.phase||"",startDate:n.startDate instanceof Date?be.fromDate(n.startDate):n.startDate,endDate:n.endDate instanceof Date?be.fromDate(n.endDate):n.endDate,allDay:n.allDay??!0,assignedTo:n.assignedTo||[],description:n.description||"",location:n.location||"",priority:n.priority||"medium",progress:n.progress??0,isCompleted:n.isCompleted??!1,time:n.time||"",asRequestId:n.asRequestId||null,createdAt:e,updatedAt:e},s=await tr(Ge(ae,fo),t),r=await Rt(s);return Sa(r)},updateSchedule:async(n,e)=>{const t=Te(ae,fo,n),s={updatedAt:be.now()};e.project!==void 0&&(s.project=typeof e.project=="string"?{_id:e.project,name:e.project}:e.project),e.title!==void 0&&(s.title=e.title),e.type!==void 0&&(s.type=e.type),e.phase!==void 0&&(s.phase=e.phase),e.startDate!==void 0&&(s.startDate=e.startDate instanceof Date?be.fromDate(e.startDate):e.startDate),e.endDate!==void 0&&(s.endDate=e.endDate instanceof Date?be.fromDate(e.endDate):e.endDate),e.allDay!==void 0&&(s.allDay=e.allDay),e.assignedTo!==void 0&&(s.assignedTo=e.assignedTo),e.description!==void 0&&(s.description=e.description),e.location!==void 0&&(s.location=e.location),e.priority!==void 0&&(s.priority=e.priority),e.progress!==void 0&&(s.progress=e.progress),e.isCompleted!==void 0&&(s.isCompleted=e.isCompleted,e.isCompleted&&(s.completedAt=be.now())),e.time!==void 0&&(s.time=e.time),await Ot(t,s);const r=await Rt(t);return Sa(r)},deleteSchedule:async n=>{const e=Te(ae,fo,n);await Kn(e)},subscribeToSchedules:n=>{const e=_t(Ge(ae,fo),en("startDate","desc"));return _s(e,t=>{const s=t.docs.map(Sa);n(s)})}},fc={getAllSchedules:()=>po.getAllSchedules(),getScheduleById:async n=>{const e=await po.getScheduleById(n);if(!e)throw new Error("Schedule not found");return e},createSchedule:n=>po.createSchedule(n),updateSchedule:(n,e)=>po.updateSchedule(n,e),deleteSchedule:n=>po.deleteSchedule(n),subscribeToSchedules:po.subscribeToSchedules},ho="contractors",Ta=n=>{const e=n.data();return{_id:n.id,rank:e.rank||"",companyName:e.companyName||"",name:e.name||"",position:e.position||"",process:e.process||"",contact:e.contact||"",accountNumber:e.accountNumber||"",notes:e.notes||"",createdAt:e.createdAt instanceof be?e.createdAt.toDate().toISOString():e.createdAt||"",updatedAt:e.updatedAt instanceof be?e.updatedAt.toDate().toISOString():e.updatedAt||""}},go={getAllContractors:async()=>{const n=_t(Ge(ae,ho),en("name","asc"));return(await It(n)).docs.map(Ta)},getContractorById:async n=>{const e=Te(ae,ho,n),t=await Rt(e);return t.exists()?Ta(t):null},createContractor:async n=>{const e=be.now(),t={rank:n.rank||"",companyName:n.companyName||"",name:n.name,position:n.position||"",process:n.process,contact:n.contact||"",accountNumber:n.accountNumber,notes:n.notes||"",createdAt:e,updatedAt:e},s=await tr(Ge(ae,ho),t),r=await Rt(s);return Ta(r)},updateContractor:async(n,e)=>{const t=Te(ae,ho,n),s={updatedAt:be.now()};e.rank!==void 0&&(s.rank=e.rank),e.companyName!==void 0&&(s.companyName=e.companyName),e.name!==void 0&&(s.name=e.name),e.position!==void 0&&(s.position=e.position),e.process!==void 0&&(s.process=e.process),e.contact!==void 0&&(s.contact=e.contact),e.accountNumber!==void 0&&(s.accountNumber=e.accountNumber),e.notes!==void 0&&(s.notes=e.notes),await Ot(t,s);const r=await Rt(t);return Ta(r)},deleteContractor:async n=>{const e=Te(ae,ho,n);await Kn(e)},subscribeToContractors:n=>{const e=_t(Ge(ae,ho),en("name","asc"));return _s(e,t=>{const s=t.docs.map(Ta);n(s)})}},mr={getAllContractors:()=>go.getAllContractors(),getContractorById:async n=>{const e=await go.getContractorById(n);if(!e)throw new Error("Contractor not found");return e},createContractor:n=>go.createContractor(n),updateContractor:(n,e)=>go.updateContractor(n,e),deleteContractor:n=>go.deleteContractor(n),subscribeToContractors:go.subscribeToContractors},yo="construction_payments",Pa=n=>{const e=n.data(),t=(e.payments||[]).map(r=>({types:r.types||[],amount:r.amount||0,date:r.date instanceof be?r.date.toDate().toISOString():r.date||"",method:r.method||"",notes:r.notes||""})),s={};return e.expectedPaymentDates&&(e.expectedPaymentDates.contract&&(s.contract=e.expectedPaymentDates.contract instanceof be?e.expectedPaymentDates.contract.toDate().toISOString():e.expectedPaymentDates.contract),e.expectedPaymentDates.start&&(s.start=e.expectedPaymentDates.start instanceof be?e.expectedPaymentDates.start.toDate().toISOString():e.expectedPaymentDates.start),e.expectedPaymentDates.middle&&(s.middle=e.expectedPaymentDates.middle instanceof be?e.expectedPaymentDates.middle.toDate().toISOString():e.expectedPaymentDates.middle),e.expectedPaymentDates.final&&(s.final=e.expectedPaymentDates.final instanceof be?e.expectedPaymentDates.final.toDate().toISOString():e.expectedPaymentDates.final)),{_id:n.id,project:e.project||"",client:e.client||"",totalAmount:e.totalAmount||0,vatType:e.vatType||"percentage",vatPercentage:e.vatPercentage||0,vatAmount:e.vatAmount||0,payments:t,expectedPaymentDates:s,createdAt:e.createdAt instanceof be?e.createdAt.toDate().toISOString():e.createdAt||"",updatedAt:e.updatedAt instanceof be?e.updatedAt.toDate().toISOString():e.updatedAt||""}},bo={getAllConstructionPayments:async()=>{try{const e=(await It(Ge(ae,yo))).docs.map(Pa).filter(t=>t.project&&t.totalAmount);return console.log("[ConstructionPayment] Firestore :",e.length,""),e}catch(n){return console.error("[ConstructionPayment] Firestore  :",n),[]}},getConstructionPaymentById:async n=>{const e=Te(ae,yo,n),t=await Rt(e);return t.exists()?Pa(t):null},createConstructionPayment:async n=>{const e=be.now(),t=(n.payments||[]).map(l=>({types:l.types,amount:l.amount,date:l.date instanceof Date?be.fromDate(l.date):l.date,method:l.method,notes:l.notes||""})),s={};n.expectedPaymentDates&&(n.expectedPaymentDates.contract&&(s.contract=n.expectedPaymentDates.contract instanceof Date?be.fromDate(n.expectedPaymentDates.contract):n.expectedPaymentDates.contract),n.expectedPaymentDates.start&&(s.start=n.expectedPaymentDates.start instanceof Date?be.fromDate(n.expectedPaymentDates.start):n.expectedPaymentDates.start),n.expectedPaymentDates.middle&&(s.middle=n.expectedPaymentDates.middle instanceof Date?be.fromDate(n.expectedPaymentDates.middle):n.expectedPaymentDates.middle),n.expectedPaymentDates.final&&(s.final=n.expectedPaymentDates.final instanceof Date?be.fromDate(n.expectedPaymentDates.final):n.expectedPaymentDates.final));const r={project:n.project,client:n.client,totalAmount:n.totalAmount,vatType:n.vatType,vatPercentage:n.vatPercentage,vatAmount:n.vatAmount,payments:t,expectedPaymentDates:s,createdAt:e,updatedAt:e},i=await tr(Ge(ae,yo),r),o=await Rt(i);return Pa(o)},updateConstructionPayment:async(n,e)=>{const t=Te(ae,yo,n),s={updatedAt:be.now()};if(e.project!==void 0&&(s.project=e.project),e.client!==void 0&&(s.client=e.client),e.totalAmount!==void 0&&(s.totalAmount=e.totalAmount),e.vatType!==void 0&&(s.vatType=e.vatType),e.vatPercentage!==void 0&&(s.vatPercentage=e.vatPercentage),e.vatAmount!==void 0&&(s.vatAmount=e.vatAmount),e.payments!==void 0&&(s.payments=e.payments.map(i=>({types:i.types,amount:i.amount,date:i.date instanceof Date?be.fromDate(i.date):i.date,method:i.method,notes:i.notes||""}))),e.expectedPaymentDates!==void 0){const i={};e.expectedPaymentDates.contract&&(i.contract=e.expectedPaymentDates.contract instanceof Date?be.fromDate(e.expectedPaymentDates.contract):e.expectedPaymentDates.contract),e.expectedPaymentDates.start&&(i.start=e.expectedPaymentDates.start instanceof Date?be.fromDate(e.expectedPaymentDates.start):e.expectedPaymentDates.start),e.expectedPaymentDates.middle&&(i.middle=e.expectedPaymentDates.middle instanceof Date?be.fromDate(e.expectedPaymentDates.middle):e.expectedPaymentDates.middle),e.expectedPaymentDates.final&&(i.final=e.expectedPaymentDates.final instanceof Date?be.fromDate(e.expectedPaymentDates.final):e.expectedPaymentDates.final),s.expectedPaymentDates=i}await Ot(t,s);const r=await Rt(t);return Pa(r)},deleteConstructionPayment:async n=>{const e=Te(ae,yo,n);await Kn(e)},subscribeToConstructionPayments:n=>{const e=_t(Ge(ae,yo),en("createdAt","desc"));return _s(e,t=>{const s=t.docs.map(Pa);n(s)})}},pc={getAllConstructionPayments:()=>bo.getAllConstructionPayments(),getConstructionPaymentById:async n=>{const e=await bo.getConstructionPaymentById(n);if(!e)throw new Error("Construction payment not found");return e},createConstructionPayment:n=>bo.createConstructionPayment(n),updateConstructionPayment:(n,e)=>bo.updateConstructionPayment(n,e),deleteConstructionPayment:n=>bo.deleteConstructionPayment(n),subscribeToConstructionPayments:bo.subscribeToConstructionPayments};let Oc=new Map,La=null;async function II(){if(!(Oc.size>0))return La||(La=(async()=>{try{const n=Ge(ae,Ft.PROJECTS);(await It(n)).docs.forEach(t=>{const s=t.data(),r=parseInt(t.id);!isNaN(r)&&s.name&&Oc.set(s.name,r)}),console.log("[executionRecordFirestoreService]    :",Oc.size,"")}catch(n){throw console.error("[executionRecordFirestoreService]    :",n),La=null,n}})(),La)}function No(n){return{id:n.id,project_id:n.projectId,project_name:n.projectName||"",author:n.author||"",date:n.date||"",process:n.process||"",item_name:n.itemName||"",material_cost:n.materialCost||0,labor_cost:n.laborCost||0,vat_amount:n.vatAmount||0,total_amount:n.totalAmount||0,notes:n.notes||"",images:n.images||[],payment_id:n.paymentId,includes_tax_deduction:n.includesTaxDeduction?1:0,includes_vat:n.includesVAT?1:0,created_at:n.createdAt||"",updated_at:n.updatedAt||""}}function Qg(n){const e={};return n.project_id!==void 0&&(e.projectId=n.project_id),n.projectId!==void 0&&(e.projectId=n.projectId),n.project_name!==void 0&&(e.projectName=n.project_name),n.projectName!==void 0&&(e.projectName=n.projectName),n.author!==void 0&&(e.author=n.author),n.date!==void 0&&(e.date=n.date),n.process!==void 0&&(e.process=n.process),n.item_name!==void 0&&(e.itemName=n.item_name),n.itemName!==void 0&&(e.itemName=n.itemName),n.material_cost!==void 0&&(e.materialCost=n.material_cost),n.materialCost!==void 0&&(e.materialCost=n.materialCost),n.labor_cost!==void 0&&(e.laborCost=n.labor_cost),n.laborCost!==void 0&&(e.laborCost=n.laborCost),n.vat_amount!==void 0&&(e.vatAmount=n.vat_amount),n.vatAmount!==void 0&&(e.vatAmount=n.vatAmount),n.total_amount!==void 0&&(e.totalAmount=n.total_amount),n.totalAmount!==void 0&&(e.totalAmount=n.totalAmount),n.notes!==void 0&&(e.notes=n.notes),n.images!==void 0&&(e.images=n.images),n.payment_id!==void 0&&(e.paymentId=n.payment_id),n.paymentId!==void 0&&(e.paymentId=n.paymentId),n.includes_tax_deduction!==void 0&&(e.includesTaxDeduction=n.includes_tax_deduction===!0||n.includes_tax_deduction===1),n.includesTaxDeduction!==void 0&&(e.includesTaxDeduction=n.includesTaxDeduction),n.includes_vat!==void 0&&(e.includesVAT=n.includes_vat===!0||n.includes_vat===1),n.includesVAT!==void 0&&(e.includesVAT=n.includesVAT),e}const cr={getAllRecords:async()=>{const n=Ge(ae,Ft.EXECUTION_RECORDS),e=_t(n,en("id","desc"));return(await It(e)).docs.map(s=>{const r=s.data();return No({...r,id:parseInt(s.id)||r.id})})},getRecordById:async n=>{const e=Te(ae,Ft.EXECUTION_RECORDS,n),t=await Rt(e);if(t.exists()){const s=t.data();return No({...s,id:parseInt(t.id)||s.id})}return null},createRecord:async n=>{await II();const e=Ge(ae,Ft.EXECUTION_RECORDS),t=await It(e);let s=0;t.docs.forEach(f=>{const p=parseInt(f.id);!isNaN(p)&&p>s&&(s=p)});const r=s+1,i=Qg(n),o=new Date().toISOString();let l=i.projectId||0;const u=i.projectName||"";if((!l||l===0)&&u){const f=Oc.get(u);f?(l=f,console.log("[executionRecordFirestoreService]  ID :",u,"->",l)):console.warn("[executionRecordFirestoreService]   ID   :",u)}const m={id:r,projectId:l,projectName:u,author:i.author||"",date:i.date||o.split("T")[0],process:i.process||"",itemName:i.itemName||"",materialCost:i.materialCost||0,laborCost:i.laborCost||0,vatAmount:i.vatAmount||0,totalAmount:i.totalAmount||0,notes:i.notes||"",paymentId:i.paymentId||null,includesTaxDeduction:i.includesTaxDeduction||!1,includesVAT:i.includesVAT||!1,createdAt:o,updatedAt:o,images:[],imageCount:0},d=Te(ae,Ft.EXECUTION_RECORDS,String(r));if(await qi(d,m),i.images&&i.images.length>0)if(i.images.some(p=>ea(p))){const p=await bu("execution_records",String(r),i.images);await Ot(d,{images:p,imageCount:p.length}),m.images=p,m.imageCount=p.length}else await Ot(d,{images:i.images,imageCount:i.images.length}),m.images=i.images,m.imageCount=i.images.length;return No(m)},updateRecord:async(n,e)=>{const t=Te(ae,Ft.EXECUTION_RECORDS,n),s=Qg(e);s.images!==void 0&&(s.images.some(o=>ea(o))&&(s.images=await bu("execution_records",n,s.images)),s.imageCount=s.images.length),await Ot(t,{...s,updatedAt:new Date().toISOString()});const r=await cr.getRecordById(n);if(!r)throw new Error("Execution record not found after update");return r},deleteRecord:async n=>{const e=Te(ae,Ft.EXECUTION_RECORDS,n),t=await Rt(e);if(t.exists()){const s=t.data();s.images&&s.images.length>0&&await Dx(s.images)}await Kn(e)},subscribeToRecords:n=>{const e=Ge(ae,Ft.EXECUTION_RECORDS),t=_t(e,en("id","desc"));return _s(t,s=>{const r=s.docs.map(i=>{const o=i.data();return No({...o,id:parseInt(i.id)||o.id})});n(r)})},getRecordsByProject:async n=>{const e=Ge(ae,Ft.EXECUTION_RECORDS),t=_t(e,qn("projectId","==",n),en("id","desc"));return(await It(t)).docs.map(r=>{const i=r.data();return No({...i,id:parseInt(r.id)||i.id})})},getRecordByPaymentId:async n=>{const e=Ge(ae,Ft.EXECUTION_RECORDS),t=_t(e,qn("paymentId","==",n)),s=await It(t);if(s.empty)return null;const r=s.docs[0],i=r.data();return No({...i,id:parseInt(r.id)||i.id})}},hc={getAllRecords:()=>cr.getAllRecords(),getRecordById:async n=>{const e=await cr.getRecordById(n);if(!e)throw new Error("Execution record not found");return e},createRecord:n=>cr.createRecord(n),updateRecord:(n,e)=>cr.updateRecord(n,e),deleteRecord:n=>cr.deleteRecord(n),subscribeToRecords:cr.subscribeToRecords,getRecordsByProject:cr.getRecordsByProject,getRecordByPaymentId:cr.getRecordByPaymentId},dr=zd()(Nx((n,e)=>({projects:[],schedules:[],payments:[],contractors:[],constructionPayments:[],asRequests:[],executionRecords:[],setProjects:t=>n({projects:t}),addProject:t=>n(s=>{const r={id:t.id,project:t.name,client:t.client,totalAmount:t.contractAmount,vatType:"percentage",vatPercentage:100,vatAmount:0,payments:[]};return{projects:[t,...s.projects],constructionPayments:[r,...s.constructionPayments]}}),updateProject:(t,s)=>n(r=>({projects:r.projects.map(i=>i.id===t?{...i,...s}:i)})),deleteProject:t=>n(s=>({projects:s.projects.filter(r=>r.id!==t),constructionPayments:s.constructionPayments.filter(r=>r.id!==t)})),setSchedules:t=>n({schedules:t}),addSchedule:t=>n(s=>({schedules:[t,...s.schedules]})),updateSchedule:(t,s)=>n(r=>({schedules:r.schedules.map(i=>i.id===t?{...i,...s}:i)})),deleteSchedule:t=>n(s=>({schedules:s.schedules.filter(r=>r.id!==t)})),setPayments:t=>n({payments:t}),addPayment:t=>n(s=>({payments:[t,...s.payments]})),updatePayment:(t,s)=>n(r=>({payments:r.payments.map(i=>i.id===t?{...i,...s}:i)})),deletePayment:t=>n(s=>({payments:s.payments.filter(r=>r.id!==t)})),setContractors:t=>n({contractors:t}),addContractor:t=>n(s=>({contractors:[t,...s.contractors]})),updateContractor:(t,s)=>n(r=>({contractors:r.contractors.map(i=>i.id===t?{...i,...s}:i)})),deleteContractor:t=>n(s=>({contractors:s.contractors.filter(r=>r.id!==t)})),setConstructionPayments:t=>n({constructionPayments:t}),addConstructionPayment:t=>n(s=>({constructionPayments:[t,...s.constructionPayments]})),updateConstructionPayment:(t,s)=>n(r=>({constructionPayments:r.constructionPayments.map(i=>i.id===t?{...i,...s}:i)})),deleteConstructionPayment:t=>n(s=>({constructionPayments:s.constructionPayments.filter(r=>r.id!==t)})),setASRequests:t=>n({asRequests:t}),addASRequest:t=>n(s=>({asRequests:[t,...s.asRequests]})),updateASRequest:(t,s)=>n(r=>({asRequests:r.asRequests.map(i=>i.id===t?{...i,...s}:i)})),deleteASRequest:t=>n(s=>({asRequests:s.asRequests.filter(r=>r.id!==t)})),setExecutionRecords:t=>n({executionRecords:t}),addExecutionRecord:t=>{console.log("[dataStore]  :",t.id,t.itemName),n(s=>{const r=[t,...s.executionRecords];return console.log("[dataStore]   :",r.length),{executionRecords:r}})},updateExecutionRecord:(t,s)=>n(r=>({executionRecords:r.executionRecords.map(i=>i.id===t?{...i,...s}:i)})),deleteExecutionRecord:t=>n(s=>({executionRecords:s.executionRecords.filter(r=>r.id!==t)})),loadPaymentsFromAPI:async()=>{try{const t=await gs.getAllPayments();console.log("[loadPaymentsFromAPI] Raw API response sample:",t[0]);const s=t.map(d=>{var f;return{id:String(d.id),project:typeof d.project=="object"&&((f=d.project)!=null&&f.name)?d.project.name:d.project_name||"",purpose:d.description,process:d.vendor_name,itemName:d.item_name||"",amount:d.amount,materialAmount:d.material_amount||0,laborAmount:d.labor_amount||0,originalMaterialAmount:d.original_material_amount||0,originalLaborAmount:d.original_labor_amount||0,applyTaxDeduction:d.apply_tax_deduction===1,includesVAT:d.includes_vat===1,quickText:d.quick_text||"",images:(()=>{if(!d.images)return[];if(Array.isArray(d.images))return d.images;try{const p=JSON.parse(d.images);return Array.isArray(p)?p:[]}catch(p){return console.error("  :",p),[]}})(),category:d.request_type,status:d.status,urgency:"normal",requestedBy:d.requester_name,requestDate:new Date(d.created_at),approvalDate:d.approved_at?new Date(d.approved_at):void 0,bankInfo:{accountHolder:d.account_holder||"",bankName:d.bank_name||"",accountNumber:d.account_number||""},attachments:[],notes:d.notes||"",completionDate:d.completionDate?new Date(d.completionDate):void 0}}),r=e().payments,i=new Map(r.map(d=>[d.id,d]));s.forEach(d=>{if(!d.completionDate&&d.status==="completed"){const f=i.get(d.id);f!=null&&f.completionDate?d.completionDate=f.completionDate:d.completionDate=new Date}});const o=new Set(s.map(d=>d.id)),l=3e4,u=Date.now();console.log("[loadPaymentsFromAPI] ===    ==="),console.log("[loadPaymentsFromAPI] API  :",s.length),console.log("[loadPaymentsFromAPI]   :",r.length),console.log("[loadPaymentsFromAPI]   ID :",r.map(d=>d.id));const m=r.filter(d=>{if(d.id.startsWith("temp_"))return console.log("[loadPaymentsFromAPI]     (temp ID):",d.id),!0;if(o.has(d.id))return!1;const f=d._addedAt;return f&&u-f<l?(console.log("[loadPaymentsFromAPI]    :",d.id,"",(u-f)/1e3,""),!0):(console.log("[loadPaymentsFromAPI]   (  _addedAt ):",d.id),!1)});if(console.log("[loadPaymentsFromAPI]   :",m.length),console.log("[loadPaymentsFromAPI]   ID:",m.map(d=>d.id)),m.length>0){console.log(`[loadPaymentsFromAPI]  ${m.length}  `);const d=new Set(m.map(C=>C.id)),f=s.filter(C=>!d.has(C.id)),y=[...m.map(C=>({...C,_addedAt:Date.now()})),...f];console.log("[loadPaymentsFromAPI]   :",y.length),n({payments:y})}else console.log("[loadPaymentsFromAPI]    - API  "),n({payments:s})}catch(t){throw console.error("Failed to load payments from API:",t),t}},addPaymentToAPI:async t=>{const s=`temp_${Date.now()}`,r={...t,id:s,_addedAt:Date.now(),_tempId:s};n(i=>({payments:[r,...i.payments]})),console.log("[addPaymentToAPI]   - temp ID:",s);try{const o=e().projects.find(f=>f.name===t.project),u={projectId:o?o.id:t.project,purpose:t.purpose,process:t.process,itemName:t.itemName,amount:t.amount,status:t.status||"pending",category:t.category,urgency:t.urgency,requestedBy:t.requestedBy,bankInfo:t.bankInfo,notes:t.notes,attachments:[],materialAmount:t.materialAmount||0,laborAmount:t.laborAmount||0,originalMaterialAmount:t.originalMaterialAmount||0,originalLaborAmount:t.originalLaborAmount||0,applyTaxDeduction:t.applyTaxDeduction||!1,includesVAT:t.includesVAT||!1,quickText:t.quickText||"",images:t.images||[]};console.log("[addPaymentToAPI] Sending payment data:",u);const m=await gs.createPayment(u),d=String(m.id);return n(f=>({payments:f.payments.map(p=>p._tempId===s?{...p,id:d,_addedAt:Date.now()}:p)})),console.log("[addPaymentToAPI]   -  ID:",d),d}catch(i){throw console.error("Failed to add payment to API:",i),n(o=>({payments:o.payments.filter(l=>l._tempId!==s)})),i}},updatePaymentInAPI:async(t,s)=>{try{if(s.status&&Object.keys(s).length===1)await gs.updatePaymentStatus(t,s.status);else{let r=s.project;if(s.project){const o=e().projects.find(l=>l.name===s.project);r=o?o.id:s.project}await gs.updatePayment(t,{projectId:r,purpose:s.purpose,process:s.process,itemName:s.itemName,amount:s.amount,materialAmount:s.materialAmount,laborAmount:s.laborAmount,originalMaterialAmount:s.originalMaterialAmount,originalLaborAmount:s.originalLaborAmount,category:s.category,urgency:s.urgency,bankInfo:s.bankInfo,notes:s.notes,requestDate:s.requestDate,includesVAT:s.includesVAT,applyTaxDeduction:s.applyTaxDeduction})}n(r=>({payments:r.payments.map(i=>i.id===t?{...i,...s}:i)}))}catch(r){throw console.error("Failed to update payment in API:",r),r}},deletePaymentFromAPI:async t=>{try{await gs.deletePayment(t),n(s=>({payments:s.payments.filter(r=>r.id!==t)}))}catch(s){throw console.error("Failed to delete payment from API:",s),s}},loadSchedulesFromAPI:async()=>{try{const t=await fc.getAllSchedules();console.log(" LOAD SCHEDULES - Raw API response sample:",t[0]);const s=t.map(r=>{var o;console.log(" Processing schedule:",{id:r._id,title:r.title,assigneeNames:r.assigneeNames,assignedTo:r.assignedTo,assignedToType:typeof r.assignedTo,assignedToLength:Array.isArray(r.assignedTo)?r.assignedTo.length:"not array"});const i=Array.isArray(r.assigneeNames)?r.assigneeNames:r.assigneeNames?typeof r.assigneeNames=="string"?r.assigneeNames.split(",").map(l=>l.trim()):[r.assigneeNames]:((o=r.assignedTo)==null?void 0:o.map(l=>typeof l=="object"?l.name:l))||[];return console.log(" Final attendees:",i),{id:r._id,title:r.title,start:new Date(r.startDate),end:new Date(r.endDate),type:r.type,project:typeof r.project=="object"?r.project.name:r.project,location:r.location,attendees:i,description:r.description,time:r.time}});s.sort((r,i)=>{const o=parseInt(r.id)||0,l=parseInt(i.id)||0;return o-l}),n({schedules:s})}catch(t){throw console.error("Failed to load schedules from API:",t),t}},addScheduleToAPI:async t=>{var i,o;const s=(i=t.id)!=null&&i.startsWith("temp_")?t.id:`temp_${Date.now()}`,r={...t,id:s};n(l=>({schedules:[...l.schedules,r]}));try{const l=await fc.createSchedule({project:t.project||"",title:t.title,type:t.type,startDate:t.start,endDate:t.end,allDay:!t.time||t.time==="-",location:t.location,assignedTo:t.attendees||[],description:t.description,asRequestId:t.asRequestId,time:t.time}),u=t.attendees||[];let m=l.assigneeNames||((o=l.assignedTo)==null?void 0:o.map(f=>typeof f=="object"?f.name:f))||[];u.length>0&&m.length>u.length&&(m=u);const d={id:l._id,title:l.title,start:new Date(l.startDate),end:new Date(l.endDate),type:l.type,project:typeof l.project=="object"?l.project.name:l.project,location:l.location,attendees:m,description:l.description,time:l.time};n(f=>({schedules:f.schedules.map(p=>p.id===s?d:p)}))}catch(l){throw console.error("Failed to add schedule to API:",l),n(u=>({schedules:u.schedules.filter(m=>m.id!==s)})),l}},updateScheduleInAPI:async(t,s)=>{var r,i,o;try{console.log(" updateScheduleInAPI called with:",{id:t,updatedSchedule:s});const l={};s.project!==void 0&&(l.project=s.project),s.title!==void 0&&(l.title=s.title),s.type!==void 0&&(l.type=s.type),s.start!==void 0&&(l.startDate=s.start),s.end!==void 0&&(l.endDate=s.end),s.location!==void 0&&(l.location=s.location),s.description!==void 0&&(l.description=s.description),s.attendees!==void 0&&(l.assignedTo=s.attendees),s.time!==void 0&&(l.time=s.time),console.log(" Sending update data:",l);const u=await fc.updateSchedule(t,l);console.log(" updateScheduleInAPI response:",u);const m={id:u._id,title:u.title,start:new Date(u.startDate),end:new Date(u.endDate),type:u.type,project:typeof u.project=="object"?u.project.name:u.project,location:u.location,attendees:u.assigneeNames||((r=u.assignedTo)==null?void 0:r.map(d=>typeof d=="object"?d.name:d))||[],description:u.description,time:u.time};n(d=>({schedules:d.schedules.map(f=>f.id===t?m:f)}))}catch(l){throw console.error("Failed to update schedule in API:",l),console.error("Error details:",{message:l instanceof Error?l.message:"Unknown error",response:l&&typeof l=="object"&&"response"in l?(i=l.response)==null?void 0:i.data:void 0,status:l&&typeof l=="object"&&"response"in l?(o=l.response)==null?void 0:o.status:void 0}),l}},deleteScheduleFromAPI:async t=>{var i;const{schedules:s}=e(),r=s.find(o=>o.id===t);if(r){n(o=>({schedules:o.schedules.filter(l=>l.id!==t)}));try{t.startsWith("temp_")||await fc.deleteSchedule(t)}catch(o){const l=o,u=(i=l==null?void 0:l.response)==null?void 0:i.status;if(u===404||u===502||u===503||u===504){console.log("Schedule delete - ignoring error (status:",u,"):",t);return}throw console.error("Failed to delete schedule from API:",o),r&&n(m=>({schedules:[...m.schedules,r]})),o}}},loadProjectsFromAPI:async()=>{try{const s=(await Io.getAllProjects()).map(r=>{var i,o;return{id:r._id||r.id,name:r.name,client:typeof r.client=="object"?r.client.name:r.client||"",location:typeof r.location=="object"?r.location.address:r.location||r.address||"",status:r.status==="inProgress"?"in-progress":r.status==="onHold"?"on-hold":r.status,progress:r.progress||0,startDate:r.startDate||r.start_date?new Date(r.startDate||r.start_date):void 0,endDate:r.endDate||r.end_date?new Date(r.endDate||r.end_date):void 0,contractAmount:r.budget||r.contractAmount||0,spent:r.actualCost||r.spent||0,manager:typeof r.manager=="object"&&r.manager!==null?r.manager.name||"":r.manager||"",team:[],description:r.description||"",meetingNotes:((i=r.meetingNotes)==null?void 0:i.map(l=>({id:l.id,content:l.content,date:new Date(l.date)})))||[],customerRequests:((o=r.customerRequests)==null?void 0:o.map(l=>({id:l.id,content:l.content,completed:l.completed,createdAt:new Date(l.createdAt)})))||[],entrancePassword:r.entrancePassword||"",sitePassword:r.sitePassword||""}});n({projects:s})}catch(t){throw console.error("Failed to load projects from API:",t),t}},addProjectToAPI:async t=>{var s,r;try{const i=await Io.createProject({name:t.name,client:t.client,location:t.location,startDate:t.startDate,endDate:t.endDate,status:t.status,contractAmount:t.contractAmount,spent:t.spent,manager:t.manager,team:t.team,progress:t.progress,description:t.description}),o={id:i._id||i.id,name:i.name,client:typeof i.client=="object"?i.client.name:i.client||"",location:typeof i.location=="object"?i.location.address:i.location||i.address||"",status:i.status==="inProgress"?"in-progress":i.status==="onHold"?"on-hold":i.status,progress:i.progress||0,startDate:i.startDate||i.start_date?new Date(i.startDate||i.start_date):void 0,endDate:i.endDate||i.end_date?new Date(i.endDate||i.end_date):void 0,contractAmount:i.budget||i.contractAmount||0,spent:i.actualCost||i.spent||0,manager:typeof i.manager=="object"&&i.manager!==null?i.manager.name||"":i.manager||"",team:[],description:i.description||"",meetingNotes:((s=i.meetingNotes)==null?void 0:s.map(l=>({id:l.id,content:l.content,date:new Date(l.date)})))||[],customerRequests:((r=i.customerRequests)==null?void 0:r.map(l=>({id:l.id,content:l.content,completed:l.completed,createdAt:new Date(l.createdAt)})))||[],entrancePassword:i.entrancePassword||"",sitePassword:i.sitePassword||""};n(l=>({projects:[o,...l.projects]}))}catch(i){throw console.error("Failed to add project to API:",i),i}},updateProjectInAPI:async(t,s)=>{var r,i;try{const o=await Io.updateProject(t,s),l={id:o._id||o.id,name:o.name,client:typeof o.client=="object"?o.client.name:o.client||"",location:typeof o.location=="object"?o.location.address:o.location||o.address||"",status:o.status==="inProgress"?"in-progress":o.status==="onHold"?"on-hold":o.status,progress:o.progress||0,startDate:o.startDate||o.start_date?new Date(o.startDate||o.start_date):void 0,endDate:o.endDate||o.end_date?new Date(o.endDate||o.end_date):void 0,contractAmount:o.budget||o.contractAmount||0,spent:o.actualCost||o.spent||0,manager:typeof o.manager=="object"&&o.manager!==null?o.manager.name||"":o.manager||"",team:[],description:o.description||"",meetingNotes:((r=o.meetingNotes)==null?void 0:r.map(u=>({id:u.id,content:u.content,date:new Date(u.date)})))||[],customerRequests:((i=o.customerRequests)==null?void 0:i.map(u=>({id:u.id,content:u.content,completed:u.completed,createdAt:new Date(u.createdAt)})))||[],entrancePassword:o.entrancePassword||"",sitePassword:o.sitePassword||""};n(u=>({projects:u.projects.map(m=>m.id===t?l:m)}))}catch(o){throw console.error("Failed to update project in API:",o),o}},deleteProjectFromAPI:async t=>{try{await Io.deleteProject(t),n(s=>({projects:s.projects.filter(r=>r.id!==t)}))}catch(s){throw console.error("Failed to delete project from API:",s),s}},loadContractorsFromAPI:async()=>{try{const s=(await mr.getAllContractors()).map(r=>({id:r._id,rank:r.rank,companyName:r.companyName,name:r.name,process:r.process,contact:r.contact,accountNumber:r.accountNumber,notes:r.notes,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt)}));n({contractors:s})}catch(t){throw console.error("Failed to load contractors from API:",t),t}},addContractorToAPI:async t=>{try{const s=await mr.createContractor({rank:t.rank,companyName:t.companyName,name:t.name,process:t.process,contact:t.contact,accountNumber:t.accountNumber,notes:t.notes}),r={id:s._id,rank:s.rank,companyName:s.companyName,name:s.name,process:s.process,contact:s.contact,accountNumber:s.accountNumber,notes:s.notes,createdAt:new Date(s.createdAt),updatedAt:new Date(s.updatedAt)};n(i=>({contractors:[r,...i.contractors]}))}catch(s){throw console.error("Failed to add contractor to API:",s),s}},updateContractorInAPI:async(t,s)=>{try{const r=await mr.updateContractor(t,{rank:s.rank,companyName:s.companyName,name:s.name,process:s.process,contact:s.contact,accountNumber:s.accountNumber,notes:s.notes}),i={id:r._id,rank:r.rank,companyName:r.companyName,name:r.name,process:r.process,contact:r.contact,accountNumber:r.accountNumber,notes:r.notes,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt)};n(o=>({contractors:o.contractors.map(l=>l.id===t?i:l)}))}catch(r){throw console.error("Failed to update contractor in API:",r),r}},deleteContractorFromAPI:async t=>{try{await mr.deleteContractor(t),n(s=>({contractors:s.contractors.filter(r=>r.id!==t)}))}catch(s){throw console.error("Failed to delete contractor from API:",s),s}},loadConstructionPaymentsFromAPI:async()=>{try{const s=(await pc.getAllConstructionPayments()).map(r=>{var o;let i;return r.expectedPaymentDates&&(i={contract:r.expectedPaymentDates.contract?new Date(r.expectedPaymentDates.contract):void 0,start:r.expectedPaymentDates.start?new Date(r.expectedPaymentDates.start):void 0,middle:r.expectedPaymentDates.middle?new Date(r.expectedPaymentDates.middle):void 0,final:r.expectedPaymentDates.final?new Date(r.expectedPaymentDates.final):void 0}),{id:r._id,project:r.project,client:r.client,totalAmount:r.totalAmount,vatType:r.vatType,vatPercentage:r.vatPercentage,vatAmount:r.vatAmount,expectedPaymentDates:i,payments:((o=r.payments)==null?void 0:o.map(l=>{var d;const u=l.date?new Date(l.date):new Date,m=isNaN(u.getTime())?new Date:u;return{type:l.type||((d=l.types)==null?void 0:d[0])||"",amount:l.amount,date:m,method:l.method,notes:l.notes}}))||[]}});n({constructionPayments:s})}catch(t){throw console.error("Failed to load construction payments from API:",t),t}},addConstructionPaymentToAPI:async t=>{var s;try{const r=await pc.createConstructionPayment(t),i={id:r._id,project:r.project,client:r.client,totalAmount:r.totalAmount,vatType:r.vatType,vatPercentage:r.vatPercentage,vatAmount:r.vatAmount,payments:((s=r.payments)==null?void 0:s.map(o=>{var m;const l=o.date?new Date(o.date):new Date,u=isNaN(l.getTime())?new Date:l;return{type:o.type||((m=o.types)==null?void 0:m[0])||"",amount:o.amount,date:u,method:o.method,notes:o.notes}}))||[]};n(o=>({constructionPayments:[i,...o.constructionPayments]}))}catch(r){throw console.error("Failed to add construction payment to API:",r),r}},updateConstructionPaymentInAPI:async(t,s)=>{var r;try{const i=await pc.updateConstructionPayment(t,s);let o;i.expectedPaymentDates&&(o={contract:i.expectedPaymentDates.contract?new Date(i.expectedPaymentDates.contract):void 0,start:i.expectedPaymentDates.start?new Date(i.expectedPaymentDates.start):void 0,middle:i.expectedPaymentDates.middle?new Date(i.expectedPaymentDates.middle):void 0,final:i.expectedPaymentDates.final?new Date(i.expectedPaymentDates.final):void 0});const l={id:i._id,project:i.project,client:i.client,totalAmount:i.totalAmount,vatType:i.vatType,vatPercentage:i.vatPercentage,vatAmount:i.vatAmount,expectedPaymentDates:o,payments:((r=i.payments)==null?void 0:r.map(u=>{var m;return{type:u.type||((m=u.types)==null?void 0:m[0])||"",amount:u.amount,date:new Date(u.date),method:u.method,notes:u.notes}}))||[]};n(u=>({constructionPayments:u.constructionPayments.map(m=>m.id===t?l:m)}))}catch(i){throw console.error("Failed to update construction payment in API:",i),i}},deleteConstructionPaymentFromAPI:async t=>{try{await pc.deleteConstructionPayment(t),n(s=>({constructionPayments:s.constructionPayments.filter(r=>r.id!==t)}))}catch(s){throw console.error("Failed to delete construction payment from API:",s),s}},loadASRequestsFromAPI:async()=>{try{const s=(await Wa.getAllASRequests()).map(r=>({id:r._id,project:r.project,client:r.client,requestDate:new Date(r.requestDate),siteAddress:r.siteAddress,entrancePassword:r.entrancePassword,description:r.description,scheduledVisitDate:r.scheduledVisitDate?new Date(r.scheduledVisitDate):void 0,scheduledVisitTime:r.scheduledVisitTime,assignedTo:r.assignedTo?Array.isArray(r.assignedTo)?r.assignedTo:[r.assignedTo]:[],completionDate:r.completionDate?new Date(r.completionDate):void 0,notes:r.notes,status:r.status||"pending"}));n({asRequests:s})}catch(t){throw console.error("Failed to load AS requests from API:",t),t}},addASRequestToAPI:async t=>{try{const s=await Wa.createASRequest(t),r={id:s._id,project:s.project,client:s.client,requestDate:new Date(s.requestDate),siteAddress:s.siteAddress,entrancePassword:s.entrancePassword,description:s.description,scheduledVisitDate:s.scheduledVisitDate?new Date(s.scheduledVisitDate):void 0,scheduledVisitTime:s.scheduledVisitTime,assignedTo:Array.isArray(s.assignedTo)?s.assignedTo:[],completionDate:s.completionDate?new Date(s.completionDate):void 0,notes:s.notes};return n(i=>({asRequests:[r,...i.asRequests]})),r}catch(s){throw console.error("Failed to add AS request to API:",s),s}},updateASRequestInAPI:async(t,s)=>{try{const r=await Wa.updateASRequest(t,s),i={id:r._id,project:r.project,client:r.client,requestDate:new Date(r.requestDate),siteAddress:r.siteAddress,entrancePassword:r.entrancePassword,description:r.description,scheduledVisitDate:r.scheduledVisitDate?new Date(r.scheduledVisitDate):void 0,scheduledVisitTime:r.scheduledVisitTime,assignedTo:Array.isArray(r.assignedTo)?r.assignedTo:[],completionDate:r.completionDate?new Date(r.completionDate):void 0,notes:r.notes,status:r.status||"pending"};n(o=>({asRequests:o.asRequests.map(l=>l.id===t?i:l)}))}catch(r){throw console.error("Failed to update AS request in API:",r),r}},deleteASRequestFromAPI:async t=>{try{await Wa.deleteASRequest(t),n(s=>({asRequests:s.asRequests.filter(r=>r.id!==t)}))}catch(s){throw console.error("Failed to delete AS request from API:",s),s}},loadExecutionRecordsFromAPI:async()=>{try{const t=await hc.getAllRecords();console.log("[loadExecutionRecordsFromAPI] Loaded",t.length,"records");const s=t.map(r=>({id:String(r.id),project:r.project_name,author:r.author||void 0,date:new Date(r.date),process:r.process||void 0,itemName:r.item_name,materialCost:r.material_cost||0,laborCost:r.labor_cost||0,vatAmount:r.vat_amount||0,totalAmount:r.total_amount||0,notes:r.notes||void 0,images:r.images||[],paymentId:r.payment_id?String(r.payment_id):void 0,includesTaxDeduction:r.includes_tax_deduction===1,includesVat:r.includes_vat===1,createdAt:new Date(r.created_at),updatedAt:new Date(r.updated_at)}));n({executionRecords:s})}catch(t){throw console.error("Failed to load execution records from API:",t),t}},addExecutionRecordToAPI:async t=>{try{console.log("[addExecutionRecordToAPI] Adding:",t.itemName,"includesTaxDeduction:",t.includesTaxDeduction,"includesVat:",t.includesVat);const s=await hc.createRecord({project_name:t.project,author:t.author,date:t.date.toISOString().split("T")[0],process:t.process,item_name:t.itemName,material_cost:t.materialCost,labor_cost:t.laborCost,vat_amount:t.vatAmount,total_amount:t.totalAmount,notes:t.notes,payment_id:t.paymentId,includes_tax_deduction:t.includesTaxDeduction,includes_vat:t.includesVat}),r={id:String(s.id),project:s.project_name,author:s.author||void 0,date:new Date(s.date),process:s.process||void 0,itemName:s.item_name,materialCost:s.material_cost||0,laborCost:s.labor_cost||0,vatAmount:s.vat_amount||0,totalAmount:s.total_amount||0,notes:s.notes||void 0,paymentId:s.payment_id?String(s.payment_id):void 0,includesTaxDeduction:s.includes_tax_deduction===1,includesVat:s.includes_vat===1,createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at)};return console.log("[addExecutionRecordToAPI] newRecord includesVat:",r.includesVat,"from API:",s.includes_vat),n(i=>({executionRecords:[r,...i.executionRecords]})),console.log("[addExecutionRecordToAPI] Added with ID:",r.id),r}catch(s){throw console.error("Failed to add execution record to API:",s),s}},updateExecutionRecordInAPI:async(t,s)=>{console.log("[updateExecutionRecordInAPI] Called with id:",t,"record:",s);try{let r;if(s.date){const i=s.date instanceof Date?s.date:new Date(s.date);console.log("[updateExecutionRecordInAPI] Date conversion:",{original:s.date,converted:i,isValid:!isNaN(i.getTime())}),isNaN(i.getTime())||(r=i.toISOString().split("T")[0])}console.log("[updateExecutionRecordInAPI] Calling API with dateStr:",r,"includesTaxDeduction:",s.includesTaxDeduction,"includesVat:",s.includesVat),await hc.updateRecord(t,{project_name:s.project,author:s.author,date:r,process:s.process,item_name:s.itemName,material_cost:s.materialCost,labor_cost:s.laborCost,vat_amount:s.vatAmount,total_amount:s.totalAmount,notes:s.notes,payment_id:s.paymentId,images:s.images,includes_tax_deduction:s.includesTaxDeduction,includes_vat:s.includesVat}),n(i=>({executionRecords:i.executionRecords.map(o=>o.id===t?{...o,...s,updatedAt:new Date}:o)}))}catch(r){throw console.error("Failed to update execution record in API:",r),r}},deleteExecutionRecordFromAPI:async t=>{try{await hc.deleteRecord(t),n(s=>({executionRecords:s.executionRecords.filter(r=>r.id!==t)}))}catch(s){throw console.error("Failed to delete execution record from API:",s),s}}}),{name:"interior-management-storage",partialize:n=>({...n,payments:n.payments.map(e=>{const{images:t,...s}=e;return s}),executionRecords:n.executionRecords.map(e=>{const{images:t,...s}=e;return s})}),storage:{getItem:n=>{var u,m,d,f,p,y,C;const e=localStorage.getItem(n);if(!e)return null;const{state:t}=JSON.parse(e),s=((u=t.projects)==null?void 0:u.map(v=>({...v,startDate:v.startDate?new Date(v.startDate):void 0,endDate:v.endDate?new Date(v.endDate):void 0,contractAmount:v.contractAmount!==void 0?v.contractAmount:v.budget||0})))||[],r=((m=t.constructionPayments)==null?void 0:m.map(v=>{var w;return{...v,vatType:v.vatType||"percentage",vatPercentage:v.vatPercentage??100,vatAmount:v.vatAmount??0,payments:((w=v.payments)==null?void 0:w.map(R=>({...R,date:new Date(R.date)})))||[]}}))||[],i=new Set(r.map(v=>v.id)),o=s.filter(v=>!i.has(v.id)).map(v=>({id:v.id,project:v.name,client:v.client,totalAmount:v.contractAmount||0,vatType:"percentage",vatPercentage:100,vatAmount:0,payments:[]})),l=[...r,...o];return{state:{...t,projects:s,schedules:((d=t.schedules)==null?void 0:d.map(v=>({...v,start:new Date(v.start),end:new Date(v.end)})))||[],payments:((f=t.payments)==null?void 0:f.map(v=>({...v,requestDate:new Date(v.requestDate),approvalDate:v.approvalDate?new Date(v.approvalDate):void 0})))||[],contractors:((p=t.contractors)==null?void 0:p.map(v=>({...v,createdAt:new Date(v.createdAt),updatedAt:new Date(v.updatedAt)})))||[],constructionPayments:l,asRequests:((y=t.asRequests)==null?void 0:y.map(v=>({...v,requestDate:new Date(v.requestDate),scheduledVisitDate:v.scheduledVisitDate?new Date(v.scheduledVisitDate):void 0,completionDate:v.completionDate?new Date(v.completionDate):void 0})))||[],executionRecords:((C=t.executionRecords)==null?void 0:C.map(v=>({...v,date:new Date(v.date),createdAt:new Date(v.createdAt),updatedAt:new Date(v.updatedAt)})))||[]}}},setItem:(n,e)=>{try{const t=JSON.stringify(e);localStorage.setItem(n,t)}catch(t){console.error("[dataStore] localStorage  :",t),t instanceof DOMException&&t.name==="QuotaExceededError"&&console.warn("[dataStore] localStorage   -    ")}},removeItem:n=>localStorage.removeItem(n)}}));var $l=n=>n.type==="checkbox",wi=n=>n instanceof Date,is=n=>n==null;const kx=n=>typeof n=="object";var Tn=n=>!is(n)&&!Array.isArray(n)&&kx(n)&&!wi(n),SI=n=>Tn(n)&&n.target?$l(n.target)?n.target.checked:n.target.value:n,TI=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,PI=(n,e)=>n.has(TI(e)),LI=n=>{const e=n.constructor&&n.constructor.prototype;return Tn(e)&&e.hasOwnProperty("isPrototypeOf")},pp=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Fn(n){let e;const t=Array.isArray(n),s=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(!(pp&&(n instanceof Blob||s))&&(t||Tn(n)))if(e=t?[]:Object.create(Object.getPrototypeOf(n)),!t&&!LI(n))e=n;else for(const r in n)n.hasOwnProperty(r)&&(e[r]=Fn(n[r]));else return n;return e}var Xu=n=>/^\w*$/.test(n),wn=n=>n===void 0,hp=n=>Array.isArray(n)?n.filter(Boolean):[],gp=n=>hp(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Ue=(n,e,t)=>{if(!e||!Tn(n))return t;const s=(Xu(e)?[e]:gp(e)).reduce((r,i)=>is(r)?r:r[i],n);return wn(s)||s===n?wn(n[e])?t:n[e]:s},Ws=n=>typeof n=="boolean",an=(n,e,t)=>{let s=-1;const r=Xu(e)?[e]:gp(e),i=r.length,o=i-1;for(;++s<i;){const l=r[s];let u=t;if(s!==o){const m=n[l];u=Tn(m)||Array.isArray(m)?m:isNaN(+r[s+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;n[l]=u,n=n[l]}};const Yg={BLUR:"blur",FOCUS_OUT:"focusout"},Rs={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ar={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},jI=mt.createContext(null);jI.displayName="HookFormContext";var RI=(n,e,t,s=!0)=>{const r={defaultValues:e._defaultValues};for(const i in n)Object.defineProperty(r,i,{get:()=>{const o=i;return e._proxyFormState[o]!==Rs.all&&(e._proxyFormState[o]=!s||Rs.all),n[o]}});return r};const BI=typeof window<"u"?mt.useLayoutEffect:mt.useEffect;var ys=n=>typeof n=="string",UI=(n,e,t,s,r)=>ys(n)?(s&&e.watch.add(n),Ue(t,n,r)):Array.isArray(n)?n.map(i=>(s&&e.watch.add(i),Ue(t,i))):(s&&(e.watchAll=!0),t),Ud=n=>is(n)||!kx(n);function Mr(n,e,t=new WeakSet){if(Ud(n)||Ud(e))return n===e;if(wi(n)&&wi(e))return n.getTime()===e.getTime();const s=Object.keys(n),r=Object.keys(e);if(s.length!==r.length)return!1;if(t.has(n)||t.has(e))return!0;t.add(n),t.add(e);for(const i of s){const o=n[i];if(!r.includes(i))return!1;if(i!=="ref"){const l=e[i];if(wi(o)&&wi(l)||Tn(o)&&Tn(l)||Array.isArray(o)&&Array.isArray(l)?!Mr(o,l,t):o!==l)return!1}}return!0}var HI=(n,e,t,s,r)=>e?{...t[n],types:{...t[n]&&t[n].types?t[n].types:{},[s]:r||!0}}:{},il=n=>Array.isArray(n)?n:[n],Xg=()=>{let n=[];return{get observers(){return n},next:r=>{for(const i of n)i.next&&i.next(r)},subscribe:r=>(n.push(r),{unsubscribe:()=>{n=n.filter(i=>i!==r)}}),unsubscribe:()=>{n=[]}}};function Ex(n,e){const t={};for(const s in n)if(n.hasOwnProperty(s)){const r=n[s],i=e[s];if(r&&Tn(r)&&i){const o=Ex(r,i);Tn(o)&&(t[s]=o)}else n[s]&&(t[s]=i)}return t}var cs=n=>Tn(n)&&!Object.keys(n).length,yp=n=>n.type==="file",Bs=n=>typeof n=="function",Nu=n=>{if(!pp)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Ax=n=>n.type==="select-multiple",bp=n=>n.type==="radio",MI=n=>bp(n)||$l(n),Mm=n=>Nu(n)&&n.isConnected;function FI(n,e){const t=e.slice(0,-1).length;let s=0;for(;s<t;)n=wn(n)?s++:n[e[s++]];return n}function OI(n){for(const e in n)if(n.hasOwnProperty(e)&&!wn(n[e]))return!1;return!0}function En(n,e){const t=Array.isArray(e)?e:Xu(e)?[e]:gp(e),s=t.length===1?n:FI(n,t),r=t.length-1,i=t[r];return s&&delete s[i],r!==0&&(Tn(s)&&cs(s)||Array.isArray(s)&&OI(s))&&En(n,t.slice(0,-1)),n}var qI=n=>{for(const e in n)if(Bs(n[e]))return!0;return!1};function wx(n){return Array.isArray(n)||Tn(n)&&!qI(n)}function Hd(n,e={}){for(const t in n)wx(n[t])?(e[t]=Array.isArray(n[t])?[]:{},Hd(n[t],e[t])):is(n[t])||(e[t]=!0);return e}function Co(n,e,t){t||(t=Hd(e));for(const s in n)wx(n[s])?wn(e)||Ud(t[s])?t[s]=Hd(n[s],Array.isArray(n[s])?[]:{}):Co(n[s],is(e)?{}:e[s],t[s]):t[s]=!Mr(n[s],e[s]);return t}const Jg={value:!1,isValid:!1},Zg={value:!0,isValid:!0};var Vx=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!wn(n[0].attributes.value)?wn(n[0].value)||n[0].value===""?Zg:{value:n[0].value,isValid:!0}:Zg:Jg}return Jg},Cx=(n,{valueAsNumber:e,valueAsDate:t,setValueAs:s})=>wn(n)?n:e?n===""?NaN:n&&+n:t&&ys(n)?new Date(n):s?s(n):n;const ey={isValid:!1,value:null};var Ix=n=>Array.isArray(n)?n.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,ey):ey;function ty(n){const e=n.ref;return yp(e)?e.files:bp(e)?Ix(n.refs).value:Ax(e)?[...e.selectedOptions].map(({value:t})=>t):$l(e)?Vx(n.refs).value:Cx(wn(e.value)?n.ref.value:e.value,n)}var $I=(n,e,t,s)=>{const r={};for(const i of n){const o=Ue(e,i);o&&an(r,i,o._f)}return{criteriaMode:t,names:[...n],fields:r,shouldUseNativeValidation:s}},xu=n=>n instanceof RegExp,ja=n=>wn(n)?n:xu(n)?n.source:Tn(n)?xu(n.value)?n.value.source:n.value:n,ny=n=>({isOnSubmit:!n||n===Rs.onSubmit,isOnBlur:n===Rs.onBlur,isOnChange:n===Rs.onChange,isOnAll:n===Rs.all,isOnTouch:n===Rs.onTouched});const sy="AsyncFunction";var zI=n=>!!n&&!!n.validate&&!!(Bs(n.validate)&&n.validate.constructor.name===sy||Tn(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===sy)),WI=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),ry=(n,e,t)=>!t&&(e.watchAll||e.watch.has(n)||[...e.watch].some(s=>n.startsWith(s)&&/^\.\w+/.test(n.slice(s.length))));const ol=(n,e,t,s)=>{for(const r of t||Object.keys(n)){const i=Ue(n,r);if(i){const{_f:o,...l}=i;if(o){if(o.refs&&o.refs[0]&&e(o.refs[0],r)&&!s)return!0;if(o.ref&&e(o.ref,o.name)&&!s)return!0;if(ol(l,e))break}else if(Tn(l)&&ol(l,e))break}}};function iy(n,e,t){const s=Ue(n,t);if(s||Xu(t))return{error:s,name:t};const r=t.split(".");for(;r.length;){const i=r.join("."),o=Ue(e,i),l=Ue(n,i);if(o&&!Array.isArray(o)&&t!==i)return{name:t};if(l&&l.type)return{name:i,error:l};if(l&&l.root&&l.root.type)return{name:`${i}.root`,error:l.root};r.pop()}return{name:t}}var KI=(n,e,t,s)=>{t(n);const{name:r,...i}=n;return cs(i)||Object.keys(i).length>=Object.keys(e).length||Object.keys(i).find(o=>e[o]===(!s||Rs.all))},GI=(n,e,t)=>!n||!e||n===e||il(n).some(s=>s&&(t?s===e:s.startsWith(e)||e.startsWith(s))),QI=(n,e,t,s,r)=>r.isOnAll?!1:!t&&r.isOnTouch?!(e||n):(t?s.isOnBlur:r.isOnBlur)?!n:(t?s.isOnChange:r.isOnChange)?n:!0,YI=(n,e)=>!hp(Ue(n,e)).length&&En(n,e),XI=(n,e,t)=>{const s=il(Ue(n,t));return an(s,"root",e[t]),an(n,t,s),n};function oy(n,e,t="validate"){if(ys(n)||Array.isArray(n)&&n.every(ys)||Ws(n)&&!n)return{type:t,message:ys(n)?n:"",ref:e}}var xo=n=>Tn(n)&&!xu(n)?n:{value:n,message:""},ay=async(n,e,t,s,r,i)=>{const{ref:o,refs:l,required:u,maxLength:m,minLength:d,min:f,max:p,pattern:y,validate:C,name:v,valueAsNumber:w,mount:R}=n._f,I=Ue(t,v);if(!R||e.has(v))return{};const F=l?l[0]:o,re=S=>{r&&F.reportValidity&&(F.setCustomValidity(Ws(S)?"":S||""),F.reportValidity())},ee={},M=bp(o),A=$l(o),N=M||A,V=(w||yp(o))&&wn(o.value)&&wn(I)||Nu(o)&&o.value===""||I===""||Array.isArray(I)&&!I.length,j=HI.bind(null,v,s,ee),T=(S,k,Ee,$e=ar.maxLength,ge=ar.minLength)=>{const He=S?k:Ee;ee[v]={type:S?$e:ge,message:He,ref:o,...j(S?$e:ge,He)}};if(i?!Array.isArray(I)||!I.length:u&&(!N&&(V||is(I))||Ws(I)&&!I||A&&!Vx(l).isValid||M&&!Ix(l).isValid)){const{value:S,message:k}=ys(u)?{value:!!u,message:u}:xo(u);if(S&&(ee[v]={type:ar.required,message:k,ref:F,...j(ar.required,k)},!s))return re(k),ee}if(!V&&(!is(f)||!is(p))){let S,k;const Ee=xo(p),$e=xo(f);if(!is(I)&&!isNaN(I)){const ge=o.valueAsNumber||I&&+I;is(Ee.value)||(S=ge>Ee.value),is($e.value)||(k=ge<$e.value)}else{const ge=o.valueAsDate||new Date(I),He=qt=>new Date(new Date().toDateString()+" "+qt),ht=o.type=="time",Kt=o.type=="week";ys(Ee.value)&&I&&(S=ht?He(I)>He(Ee.value):Kt?I>Ee.value:ge>new Date(Ee.value)),ys($e.value)&&I&&(k=ht?He(I)<He($e.value):Kt?I<$e.value:ge<new Date($e.value))}if((S||k)&&(T(!!S,Ee.message,$e.message,ar.max,ar.min),!s))return re(ee[v].message),ee}if((m||d)&&!V&&(ys(I)||i&&Array.isArray(I))){const S=xo(m),k=xo(d),Ee=!is(S.value)&&I.length>+S.value,$e=!is(k.value)&&I.length<+k.value;if((Ee||$e)&&(T(Ee,S.message,k.message),!s))return re(ee[v].message),ee}if(y&&!V&&ys(I)){const{value:S,message:k}=xo(y);if(xu(S)&&!I.match(S)&&(ee[v]={type:ar.pattern,message:k,ref:o,...j(ar.pattern,k)},!s))return re(k),ee}if(C){if(Bs(C)){const S=await C(I,t),k=oy(S,F);if(k&&(ee[v]={...k,...j(ar.validate,k.message)},!s))return re(k.message),ee}else if(Tn(C)){let S={};for(const k in C){if(!cs(S)&&!s)break;const Ee=oy(await C[k](I,t),F,k);Ee&&(S={...Ee,...j(k,Ee.message)},re(Ee.message),s&&(ee[v]=S))}if(!cs(S)&&(ee[v]={ref:F,...S},!s))return ee}}return re(!0),ee};const JI={mode:Rs.onSubmit,reValidateMode:Rs.onChange,shouldFocusError:!0};function ZI(n={}){let e={...JI,...n},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:Bs(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},s={},r=Tn(e.defaultValues)||Tn(e.values)?Fn(e.defaultValues||e.values)||{}:{},i=e.shouldUnregister?{}:Fn(r),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},u,m=0;const d={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let f={...d};const p={array:Xg(),state:Xg()},y=e.criteriaMode===Rs.all,C=P=>q=>{clearTimeout(m),m=setTimeout(P,q)},v=async P=>{if(!e.disabled&&(d.isValid||f.isValid||P)){const q=e.resolver?cs((await A()).errors):await V(s,!0);q!==t.isValid&&p.state.next({isValid:q})}},w=(P,q)=>{!e.disabled&&(d.isValidating||d.validatingFields||f.isValidating||f.validatingFields)&&((P||Array.from(l.mount)).forEach(te=>{te&&(q?an(t.validatingFields,te,q):En(t.validatingFields,te))}),p.state.next({validatingFields:t.validatingFields,isValidating:!cs(t.validatingFields)}))},R=(P,q=[],te,ve,ue=!0,fe=!0)=>{if(ve&&te&&!e.disabled){if(o.action=!0,fe&&Array.isArray(Ue(s,P))){const Ie=te(Ue(s,P),ve.argA,ve.argB);ue&&an(s,P,Ie)}if(fe&&Array.isArray(Ue(t.errors,P))){const Ie=te(Ue(t.errors,P),ve.argA,ve.argB);ue&&an(t.errors,P,Ie),YI(t.errors,P)}if((d.touchedFields||f.touchedFields)&&fe&&Array.isArray(Ue(t.touchedFields,P))){const Ie=te(Ue(t.touchedFields,P),ve.argA,ve.argB);ue&&an(t.touchedFields,P,Ie)}(d.dirtyFields||f.dirtyFields)&&(t.dirtyFields=Co(r,i)),p.state.next({name:P,isDirty:T(P,q),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else an(i,P,q)},I=(P,q)=>{an(t.errors,P,q),p.state.next({errors:t.errors})},F=P=>{t.errors=P,p.state.next({errors:t.errors,isValid:!1})},re=(P,q,te,ve)=>{const ue=Ue(s,P);if(ue){const fe=Ue(i,P,wn(te)?Ue(r,P):te);wn(fe)||ve&&ve.defaultChecked||q?an(i,P,q?fe:ty(ue._f)):Ee(P,fe),o.mount&&v()}},ee=(P,q,te,ve,ue)=>{let fe=!1,Ie=!1;const We={name:P};if(!e.disabled){if(!te||ve){(d.isDirty||f.isDirty)&&(Ie=t.isDirty,t.isDirty=We.isDirty=T(),fe=Ie!==We.isDirty);const st=Mr(Ue(r,P),q);Ie=!!Ue(t.dirtyFields,P),st?En(t.dirtyFields,P):an(t.dirtyFields,P,!0),We.dirtyFields=t.dirtyFields,fe=fe||(d.dirtyFields||f.dirtyFields)&&Ie!==!st}if(te){const st=Ue(t.touchedFields,P);st||(an(t.touchedFields,P,te),We.touchedFields=t.touchedFields,fe=fe||(d.touchedFields||f.touchedFields)&&st!==te)}fe&&ue&&p.state.next(We)}return fe?We:{}},M=(P,q,te,ve)=>{const ue=Ue(t.errors,P),fe=(d.isValid||f.isValid)&&Ws(q)&&t.isValid!==q;if(e.delayError&&te?(u=C(()=>I(P,te)),u(e.delayError)):(clearTimeout(m),u=null,te?an(t.errors,P,te):En(t.errors,P)),(te?!Mr(ue,te):ue)||!cs(ve)||fe){const Ie={...ve,...fe&&Ws(q)?{isValid:q}:{},errors:t.errors,name:P};t={...t,...Ie},p.state.next(Ie)}},A=async P=>{w(P,!0);const q=await e.resolver(i,e.context,$I(P||l.mount,s,e.criteriaMode,e.shouldUseNativeValidation));return w(P),q},N=async P=>{const{errors:q}=await A(P);if(P)for(const te of P){const ve=Ue(q,te);ve?an(t.errors,te,ve):En(t.errors,te)}else t.errors=q;return q},V=async(P,q,te={valid:!0})=>{for(const ve in P){const ue=P[ve];if(ue){const{_f:fe,...Ie}=ue;if(fe){const We=l.array.has(fe.name),st=ue._f&&zI(ue._f);st&&d.validatingFields&&w([fe.name],!0);const we=await ay(ue,l.disabled,i,y,e.shouldUseNativeValidation&&!q,We);if(st&&d.validatingFields&&w([fe.name]),we[fe.name]&&(te.valid=!1,q))break;!q&&(Ue(we,fe.name)?We?XI(t.errors,we,fe.name):an(t.errors,fe.name,we[fe.name]):En(t.errors,fe.name))}!cs(Ie)&&await V(Ie,q,te)}}return te.valid},j=()=>{for(const P of l.unMount){const q=Ue(s,P);q&&(q._f.refs?q._f.refs.every(te=>!Mm(te)):!Mm(q._f.ref))&&lt(P)}l.unMount=new Set},T=(P,q)=>!e.disabled&&(P&&q&&an(i,P,q),!Mr(qt(),r)),S=(P,q,te)=>UI(P,l,{...o.mount?i:wn(q)?r:ys(P)?{[P]:q}:q},te,q),k=P=>hp(Ue(o.mount?i:r,P,e.shouldUnregister?Ue(r,P,[]):[])),Ee=(P,q,te={})=>{const ve=Ue(s,P);let ue=q;if(ve){const fe=ve._f;fe&&(!fe.disabled&&an(i,P,Cx(q,fe)),ue=Nu(fe.ref)&&is(q)?"":q,Ax(fe.ref)?[...fe.ref.options].forEach(Ie=>Ie.selected=ue.includes(Ie.value)):fe.refs?$l(fe.ref)?fe.refs.forEach(Ie=>{(!Ie.defaultChecked||!Ie.disabled)&&(Array.isArray(ue)?Ie.checked=!!ue.find(We=>We===Ie.value):Ie.checked=ue===Ie.value||!!ue)}):fe.refs.forEach(Ie=>Ie.checked=Ie.value===ue):yp(fe.ref)?fe.ref.value="":(fe.ref.value=ue,fe.ref.type||p.state.next({name:P,values:Fn(i)})))}(te.shouldDirty||te.shouldTouch)&&ee(P,ue,te.shouldTouch,te.shouldDirty,!0),te.shouldValidate&&Kt(P)},$e=(P,q,te)=>{for(const ve in q){if(!q.hasOwnProperty(ve))return;const ue=q[ve],fe=P+"."+ve,Ie=Ue(s,fe);(l.array.has(P)||Tn(ue)||Ie&&!Ie._f)&&!wi(ue)?$e(fe,ue,te):Ee(fe,ue,te)}},ge=(P,q,te={})=>{const ve=Ue(s,P),ue=l.array.has(P),fe=Fn(q);an(i,P,fe),ue?(p.array.next({name:P,values:Fn(i)}),(d.isDirty||d.dirtyFields||f.isDirty||f.dirtyFields)&&te.shouldDirty&&p.state.next({name:P,dirtyFields:Co(r,i),isDirty:T(P,fe)})):ve&&!ve._f&&!is(fe)?$e(P,fe,te):Ee(P,fe,te),ry(P,l)&&p.state.next({...t,name:P}),p.state.next({name:o.mount?P:void 0,values:Fn(i)})},He=async P=>{o.mount=!0;const q=P.target;let te=q.name,ve=!0;const ue=Ue(s,te),fe=st=>{ve=Number.isNaN(st)||wi(st)&&isNaN(st.getTime())||Mr(st,Ue(i,te,st))},Ie=ny(e.mode),We=ny(e.reValidateMode);if(ue){let st,we;const $n=q.type?ty(ue._f):SI(P),Ht=P.type===Yg.BLUR||P.type===Yg.FOCUS_OUT,ne=!WI(ue._f)&&!e.resolver&&!Ue(t.errors,te)&&!ue._f.deps||QI(Ht,Ue(t.touchedFields,te),t.isSubmitted,We,Ie),Ze=ry(te,l,Ht);an(i,te,$n),Ht?(!q||!q.readOnly)&&(ue._f.onBlur&&ue._f.onBlur(P),u&&u(0)):ue._f.onChange&&ue._f.onChange(P);const O=ee(te,$n,Ht),_e=!cs(O)||Ze;if(!Ht&&p.state.next({name:te,type:P.type,values:Fn(i)}),ne)return(d.isValid||f.isValid)&&(e.mode==="onBlur"?Ht&&v():Ht||v()),_e&&p.state.next({name:te,...Ze?{}:O});if(!Ht&&Ze&&p.state.next({...t}),e.resolver){const{errors:ke}=await A([te]);if(fe($n),ve){const je=iy(t.errors,s,te),me=iy(ke,s,je.name||te);st=me.error,te=me.name,we=cs(ke)}}else w([te],!0),st=(await ay(ue,l.disabled,i,y,e.shouldUseNativeValidation))[te],w([te]),fe($n),ve&&(st?we=!1:(d.isValid||f.isValid)&&(we=await V(s,!0)));ve&&(ue._f.deps&&(!Array.isArray(ue._f.deps)||ue._f.deps.length>0)&&Kt(ue._f.deps),M(te,we,st,O))}},ht=(P,q)=>{if(Ue(t.errors,q)&&P.focus)return P.focus(),1},Kt=async(P,q={})=>{let te,ve;const ue=il(P);if(e.resolver){const fe=await N(wn(P)?P:ue);te=cs(fe),ve=P?!ue.some(Ie=>Ue(fe,Ie)):te}else P?(ve=(await Promise.all(ue.map(async fe=>{const Ie=Ue(s,fe);return await V(Ie&&Ie._f?{[fe]:Ie}:Ie)}))).every(Boolean),!(!ve&&!t.isValid)&&v()):ve=te=await V(s);return p.state.next({...!ys(P)||(d.isValid||f.isValid)&&te!==t.isValid?{}:{name:P},...e.resolver||!P?{isValid:te}:{},errors:t.errors}),q.shouldFocus&&!ve&&ol(s,ht,P?ue:l.mount),ve},qt=(P,q)=>{let te={...o.mount?i:r};return q&&(te=Ex(q.dirtyFields?t.dirtyFields:t.touchedFields,te)),wn(P)?te:ys(P)?Ue(te,P):P.map(ve=>Ue(te,ve))},le=(P,q)=>({invalid:!!Ue((q||t).errors,P),isDirty:!!Ue((q||t).dirtyFields,P),error:Ue((q||t).errors,P),isValidating:!!Ue(t.validatingFields,P),isTouched:!!Ue((q||t).touchedFields,P)}),ze=P=>{P&&il(P).forEach(q=>En(t.errors,q)),p.state.next({errors:P?t.errors:{}})},de=(P,q,te)=>{const ve=(Ue(s,P,{_f:{}})._f||{}).ref,ue=Ue(t.errors,P)||{},{ref:fe,message:Ie,type:We,...st}=ue;an(t.errors,P,{...st,...q,ref:ve}),p.state.next({name:P,errors:t.errors,isValid:!1}),te&&te.shouldFocus&&ve&&ve.focus&&ve.focus()},Be=(P,q)=>Bs(P)?p.state.subscribe({next:te=>"values"in te&&P(S(void 0,q),te)}):S(P,q,!0),Xe=P=>p.state.subscribe({next:q=>{GI(P.name,q.name,P.exact)&&KI(q,P.formState||d,Tt,P.reRenderRoot)&&P.callback({values:{...i},...t,...q,defaultValues:r})}}).unsubscribe,vt=P=>(o.mount=!0,f={...f,...P.formState},Xe({...P,formState:f})),lt=(P,q={})=>{for(const te of P?il(P):l.mount)l.mount.delete(te),l.array.delete(te),q.keepValue||(En(s,te),En(i,te)),!q.keepError&&En(t.errors,te),!q.keepDirty&&En(t.dirtyFields,te),!q.keepTouched&&En(t.touchedFields,te),!q.keepIsValidating&&En(t.validatingFields,te),!e.shouldUnregister&&!q.keepDefaultValue&&En(r,te);p.state.next({values:Fn(i)}),p.state.next({...t,...q.keepDirty?{isDirty:T()}:{}}),!q.keepIsValid&&v()},St=({disabled:P,name:q})=>{(Ws(P)&&o.mount||P||l.disabled.has(q))&&(P?l.disabled.add(q):l.disabled.delete(q))},at=(P,q={})=>{let te=Ue(s,P);const ve=Ws(q.disabled)||Ws(e.disabled);return an(s,P,{...te||{},_f:{...te&&te._f?te._f:{ref:{name:P}},name:P,mount:!0,...q}}),l.mount.add(P),te?St({disabled:Ws(q.disabled)?q.disabled:e.disabled,name:P}):re(P,!0,q.value),{...ve?{disabled:q.disabled||e.disabled}:{},...e.progressive?{required:!!q.required,min:ja(q.min),max:ja(q.max),minLength:ja(q.minLength),maxLength:ja(q.maxLength),pattern:ja(q.pattern)}:{},name:P,onChange:He,onBlur:He,ref:ue=>{if(ue){at(P,q),te=Ue(s,P);const fe=wn(ue.value)&&ue.querySelectorAll&&ue.querySelectorAll("input,select,textarea")[0]||ue,Ie=MI(fe),We=te._f.refs||[];if(Ie?We.find(st=>st===fe):fe===te._f.ref)return;an(s,P,{_f:{...te._f,...Ie?{refs:[...We.filter(Mm),fe,...Array.isArray(Ue(r,P))?[{}]:[]],ref:{type:fe.type,name:P}}:{ref:fe}}}),re(P,!1,void 0,fe)}else te=Ue(s,P,{}),te._f&&(te._f.mount=!1),(e.shouldUnregister||q.shouldUnregister)&&!(PI(l.array,P)&&o.action)&&l.unMount.add(P)}}},ft=()=>e.shouldFocusError&&ol(s,ht,l.mount),Nn=P=>{Ws(P)&&(p.state.next({disabled:P}),ol(s,(q,te)=>{const ve=Ue(s,te);ve&&(q.disabled=ve._f.disabled||P,Array.isArray(ve._f.refs)&&ve._f.refs.forEach(ue=>{ue.disabled=ve._f.disabled||P}))},0,!1))},K=(P,q)=>async te=>{let ve;te&&(te.preventDefault&&te.preventDefault(),te.persist&&te.persist());let ue=Fn(i);if(p.state.next({isSubmitting:!0}),e.resolver){const{errors:fe,values:Ie}=await A();t.errors=fe,ue=Fn(Ie)}else await V(s);if(l.disabled.size)for(const fe of l.disabled)En(ue,fe);if(En(t.errors,"root"),cs(t.errors)){p.state.next({errors:{}});try{await P(ue,te)}catch(fe){ve=fe}}else q&&await q({...t.errors},te),ft(),setTimeout(ft);if(p.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:cs(t.errors)&&!ve,submitCount:t.submitCount+1,errors:t.errors}),ve)throw ve},Le=(P,q={})=>{Ue(s,P)&&(wn(q.defaultValue)?ge(P,Fn(Ue(r,P))):(ge(P,q.defaultValue),an(r,P,Fn(q.defaultValue))),q.keepTouched||En(t.touchedFields,P),q.keepDirty||(En(t.dirtyFields,P),t.isDirty=q.defaultValue?T(P,Fn(Ue(r,P))):T()),q.keepError||(En(t.errors,P),d.isValid&&v()),p.state.next({...t}))},Fe=(P,q={})=>{const te=P?Fn(P):r,ve=Fn(te),ue=cs(P),fe=ue?r:ve;if(q.keepDefaultValues||(r=te),!q.keepValues){if(q.keepDirtyValues){const Ie=new Set([...l.mount,...Object.keys(Co(r,i))]);for(const We of Array.from(Ie))Ue(t.dirtyFields,We)?an(fe,We,Ue(i,We)):ge(We,Ue(fe,We))}else{if(pp&&wn(P))for(const Ie of l.mount){const We=Ue(s,Ie);if(We&&We._f){const st=Array.isArray(We._f.refs)?We._f.refs[0]:We._f.ref;if(Nu(st)){const we=st.closest("form");if(we){we.reset();break}}}}if(q.keepFieldsRef)for(const Ie of l.mount)ge(Ie,Ue(fe,Ie));else s={}}i=e.shouldUnregister?q.keepDefaultValues?Fn(r):{}:Fn(fe),p.array.next({values:{...fe}}),p.state.next({values:{...fe}})}l={mount:q.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!d.isValid||!!q.keepIsValid||!!q.keepDirtyValues,o.watch=!!e.shouldUnregister,p.state.next({submitCount:q.keepSubmitCount?t.submitCount:0,isDirty:ue?!1:q.keepDirty?t.isDirty:!!(q.keepDefaultValues&&!Mr(P,r)),isSubmitted:q.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:ue?{}:q.keepDirtyValues?q.keepDefaultValues&&i?Co(r,i):t.dirtyFields:q.keepDefaultValues&&P?Co(r,P):q.keepDirty?t.dirtyFields:{},touchedFields:q.keepTouched?t.touchedFields:{},errors:q.keepErrors?t.errors:{},isSubmitSuccessful:q.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:r})},Se=(P,q)=>Fe(Bs(P)?P(i):P,q),Je=(P,q={})=>{const te=Ue(s,P),ve=te&&te._f;if(ve){const ue=ve.refs?ve.refs[0]:ve.ref;ue.focus&&(ue.focus(),q.shouldSelect&&Bs(ue.select)&&ue.select())}},Tt=P=>{t={...t,...P}},dt={control:{register:at,unregister:lt,getFieldState:le,handleSubmit:K,setError:de,_subscribe:Xe,_runSchema:A,_focusError:ft,_getWatch:S,_getDirty:T,_setValid:v,_setFieldArray:R,_setDisabledField:St,_setErrors:F,_getFieldArray:k,_reset:Fe,_resetDefaultValues:()=>Bs(e.defaultValues)&&e.defaultValues().then(P=>{Se(P,e.resetOptions),p.state.next({isLoading:!1})}),_removeUnmounted:j,_disableForm:Nn,_subjects:p,_proxyFormState:d,get _fields(){return s},get _formValues(){return i},get _state(){return o},set _state(P){o=P},get _defaultValues(){return r},get _names(){return l},set _names(P){l=P},get _formState(){return t},get _options(){return e},set _options(P){e={...e,...P}}},subscribe:vt,trigger:Kt,register:at,handleSubmit:K,watch:Be,setValue:ge,getValues:qt,reset:Se,resetField:Le,clearErrors:ze,unregister:lt,setError:de,setFocus:Je,getFieldState:le};return{...dt,formControl:dt}}function Np(n={}){const e=mt.useRef(void 0),t=mt.useRef(void 0),[s,r]=mt.useState({isDirty:!1,isValidating:!1,isLoading:Bs(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:Bs(n.defaultValues)?void 0:n.defaultValues});if(!e.current)if(n.formControl)e.current={...n.formControl,formState:s},n.defaultValues&&!Bs(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:o,...l}=ZI(n);e.current={...l,formState:s}}const i=e.current.control;return i._options=n,BI(()=>{const o=i._subscribe({formState:i._proxyFormState,callback:()=>r({...i._formState}),reRenderRoot:!0});return r(l=>({...l,isReady:!0})),i._formState.isReady=!0,o},[i]),mt.useEffect(()=>i._disableForm(n.disabled),[i,n.disabled]),mt.useEffect(()=>{n.mode&&(i._options.mode=n.mode),n.reValidateMode&&(i._options.reValidateMode=n.reValidateMode)},[i,n.mode,n.reValidateMode]),mt.useEffect(()=>{n.errors&&(i._setErrors(n.errors),i._focusError())},[i,n.errors]),mt.useEffect(()=>{n.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,n.shouldUnregister]),mt.useEffect(()=>{if(i._proxyFormState.isDirty){const o=i._getDirty();o!==s.isDirty&&i._subjects.state.next({isDirty:o})}},[i,s.isDirty]),mt.useEffect(()=>{n.values&&!Mr(n.values,t.current)?(i._reset(n.values,{keepFieldsRef:!0,...i._options.resetOptions}),t.current=n.values,r(o=>({...o}))):i._resetDefaultValues()},[i,n.values]),mt.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),e.current.formState=RI(s,i),e.current}const ly=["","","","","","",""],Sx=({event:n,slotInfo:e,defaultProjectName:t,onClose:s,onSave:r,onDelete:i})=>{const[o,l]=E.useState(!1),{register:u,handleSubmit:m,setValue:d,watch:f,formState:{errors:p},reset:y}=Np({defaultValues:{projectId:"",title:"",date:"",description:""}}),{projects:C}=dr(),[v,w]=E.useState([]),[R,I]=E.useState(""),[F,re]=E.useState(!1),[ee,M]=E.useState(""),[A,N]=E.useState(9),[V,j]=E.useState(0),[T,S]=E.useState(""),k=f("projectId");E.useEffect(()=>{if(k){const le=C.find(ze=>ze.id===k||ze.id===parseInt(k)||ze.id.toString()===k.toString());console.log(" Selected project:",le==null?void 0:le.name),console.log(" Project team:",le==null?void 0:le.team),console.log(" Current selectedMembers:",v)}},[k,C,v]),E.useEffect(()=>{console.log(" Modal mount - initializing states"),w([]),S(""),I("")},[]),E.useEffect(()=>{if(console.log(" ScheduleModal useEffect triggered:",{hasEvent:!!n,eventId:n==null?void 0:n.id,hasSlotInfo:!!e,hasMergedEvents:!!(n!=null&&n.mergedEventIds)}),n&&n.id){console.log(" ScheduleModal processing event:",{title:n.title,projectId:n.projectId,projectName:n.projectName,start:n.start,assignedTo:n.assignedTo,time:n.time});const le=n.originalTitle||n.title,ze=/ - (|) \d{1,2}$/,de=le.replace(ze,"");if(d("title",de,{shouldValidate:!1,shouldDirty:!1}),d("date",$t(n.start,"yyyy-MM-dd"),{shouldValidate:!1,shouldDirty:!1}),d("description",n.description||"",{shouldValidate:!1,shouldDirty:!1}),n.projectId&&n.projectId!==""&&n.projectId!=="undefined")console.log(" Setting projectId from event:",n.projectId),d("projectId",n.projectId,{shouldValidate:!1,shouldDirty:!1}),S("");else if(n.projectName){const Xe=C.find(vt=>vt.name===n.projectName);console.log(" Finding project by name:",n.projectName,"found:",Xe),Xe?(console.log(" Setting projectId from found project:",Xe.id),d("projectId",Xe.id,{shouldValidate:!1,shouldDirty:!1}),S("")):(console.log(" Project not found, leaving empty"),d("projectId","",{shouldValidate:!1,shouldDirty:!1}),S(""))}else console.log(" No project info, leaving empty"),d("projectId","",{shouldValidate:!1,shouldDirty:!1}),S("");const Be=n.assignedTo||n.attendees||[];if(console.log(" Setting selectedMembers to:",Be),w(Array.isArray(Be)?Be:[]),n.time&&n.time!=="-"){console.log(" Setting time from event:",{eventTime:n.time,parsedHours:n.time.split(":")[0],parsedMinutes:n.time.split(":")[1]}),re(!0);const[Xe,vt]=n.time.split(":"),lt=parseInt(Xe,10),St=parseInt(vt,10);lt>=12?(M(""),N(lt===12?12:lt-12)):(M(""),N(lt===0?12:lt)),j(St),console.log(" Time state set:",{hasTime:!0,period:lt>=12?"":"",hour:lt>=12?lt===12?12:lt-12:lt===0?12:lt,minute:St})}else console.log(" No time in event, setting hasTime to false"),re(!1),M(""),N(9),j(0)}else if(e&&!n&&(console.log(" New schedule from slot:",e),y({projectId:"",title:"",date:$t(e.start,"yyyy-MM-dd"),description:""}),console.log(" New schedule - resetting selectedMembers to empty array"),w([]),S(""),t)){const le=C.find(ze=>ze.name===t);le&&d("projectId",le.id,{shouldValidate:!1,shouldDirty:!1})}},[n==null?void 0:n.id]);const Ee=le=>{console.log(" toggleMember called with:",le),console.log(" Current selectedMembers before toggle:",v),w(ze=>{console.log(" Previous members in setState:",ze);const de=ze.includes(le)?ze.filter(Be=>Be!==le):[...ze,le];return console.log(" Updated members after toggle:",de),de})},$e=()=>{const le="HV LAB";v.includes(le)?w(ze=>ze.filter(de=>de!==le)):w(ze=>[...ze.filter(de=>de!==""),le])},ge=()=>{const le="";v.includes(le)?w(ze=>ze.filter(de=>de!==le)):w(ze=>[...ze,le])},He=()=>{const le="";v.includes(le)?w(ze=>ze.filter(de=>de!==le)):w(ze=>[...ze,le])},ht=()=>{R.trim()&&!v.includes(R.trim())&&(w(le=>[...le,R.trim()]),I(""))},Kt=le=>{w(ze=>ze.filter(de=>de!==le))},qt=async le=>{console.log(" Form onSubmit called with data:",le),console.log(" selectedMembers:",v),console.log(" hasTime state:",F),console.log(" timePeriod:",ee,"timeHour:",A,"timeMinute:",V),console.log(" Available projects:",C.map(at=>({id:at.id,name:at.name,idType:typeof at.id}))),console.log(" Merged event IDs:",n==null?void 0:n.mergedEventIds);const ze=/ - (|) \d{1,2}$/,de=le.title.replace(ze,"").trim();let Be="",Xe="";if(le.projectId){const at=C.find(ft=>ft.id===le.projectId||ft.id===parseInt(le.projectId)||ft.id.toString()===le.projectId.toString());console.log(" Looking for project with id:",le.projectId,"type:",typeof le.projectId),console.log(" Found project:",at),Be=(at==null?void 0:at.name)||"",Xe=le.projectId}else Be="",Xe="";console.log(" Final projectId:",Xe,"projectName:",Be,"cleanedTitle:",de);const vt=new Date(le.date);let lt="-";if(F){let at=A;ee===""&&A!==12?at=A+12:ee===""&&A===12&&(at=0),lt=`${at.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}`,console.log(" Time calculated:",lt)}else console.log(" No time set (hasTime is false)");const St={...n,title:de,start:vt,end:vt,projectId:Xe,projectName:Be,assignedTo:v,description:le.description||"",time:lt,mergedEventIds:n==null?void 0:n.mergedEventIds};if(!o){l(!0),console.log(" Calling onSave with newEvent:",St);try{await r(St),console.log(" onSave completed successfully")}catch(at){throw console.error(" onSave failed:",at),at}finally{l(!1)}}};return console.log(" Rendering ScheduleModal with selectedMembers:",v),a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3 md:p-4",children:a.jsxDEV("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-4 md:p-6 border-b",children:[a.jsxDEV("h2",{className:"text-lg md:text-xl font-semibold",children:n?" ":"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:382,columnNumber:11},void 0),a.jsxDEV("button",{onClick:s,className:"p-1.5 md:p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsxDEV(Cn,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:389,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:385,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:381,columnNumber:9},void 0),a.jsxDEV("form",{onSubmit:m(qt),className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:397,columnNumber:13},void 0),a.jsxDEV("select",{...u("projectId"),className:"input w-full",children:[a.jsxDEV("option",{value:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:404,columnNumber:15},void 0),C.filter(le=>n!=null&&n.isASVisit?!0:le.status!=="completed").map(le=>a.jsxDEV("option",{value:le.id,children:le.name},le.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:414,columnNumber:19},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:400,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:396,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"  *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:423,columnNumber:13},void 0),a.jsxDEV("input",{...u("title",{required:" "}),type:"text",className:"input w-full"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:426,columnNumber:13},void 0),p.title&&a.jsxDEV("p",{className:"mt-1 text-sm text-red-600",children:String(p.title.message)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:432,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:422,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:438,columnNumber:13},void 0),a.jsxDEV("input",{...u("date",{required:" "}),type:"date",className:"input w-full"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:441,columnNumber:13},void 0),p.date&&a.jsxDEV("p",{className:"mt-1 text-sm text-red-600",children:String(p.date.message)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:447,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:437,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:453,columnNumber:13},void 0),a.jsxDEV("div",{className:"mb-2",children:a.jsxDEV("button",{type:"button",onClick:()=>re(!F),className:`px-3 py-1.5 text-xs rounded border transition-colors ${F?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:F?" ":"  (-)"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:459,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:458,columnNumber:13},void 0),F&&a.jsxDEV("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsxDEV("div",{className:"flex gap-1",children:[a.jsxDEV("button",{type:"button",onClick:()=>M(""),className:`px-3 py-1.5 text-xs rounded border transition-colors ${ee===""?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:477,columnNumber:19},void 0),a.jsxDEV("button",{type:"button",onClick:()=>M(""),className:`px-3 py-1.5 text-xs rounded border transition-colors ${ee===""?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:488,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:476,columnNumber:17},void 0),a.jsxDEV("select",{value:A,onChange:le=>N(parseInt(le.target.value)),className:"flex-1 min-w-[80px] max-w-[120px] px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500",children:[12,1,2,3,4,5,6,7,8,9,10,11].map(le=>a.jsxDEV("option",{value:le,children:[le,""]},le,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:508,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:502,columnNumber:17},void 0),a.jsxDEV("select",{value:V,onChange:le=>j(parseInt(le.target.value)),className:"flex-1 min-w-[80px] max-w-[120px] px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500",children:[0,10,20,30,40,50].map(le=>a.jsxDEV("option",{value:le,children:[le,""]},le,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:521,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:515,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:474,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:452,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" (  )"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:532,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[a.jsxDEV("button",{type:"button",onClick:$e,className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${v.includes("HV LAB")?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"HV LAB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:539,columnNumber:15},void 0),a.jsxDEV("button",{type:"button",onClick:ge,className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${v.includes("")?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:552,columnNumber:15},void 0),a.jsxDEV("button",{type:"button",onClick:He,className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${v.includes("")?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:565,columnNumber:15},void 0),ly.map(le=>a.jsxDEV("button",{type:"button",onClick:()=>Ee(le),className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${v.includes(le)?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:le},le,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:579,columnNumber:17},void 0)),v.filter(le=>!ly.includes(le)&&le!=="HV LAB"&&le!==""&&le!=="").map(le=>a.jsxDEV("button",{type:"button",onClick:()=>Kt(le),className:"px-2.5 py-1.5 rounded border transition-colors text-sm bg-gray-900 text-white border-gray-900 hover:bg-gray-800",children:[le," "]},le,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:597,columnNumber:19},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:537,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("input",{type:"text",value:R,onChange:le=>I(le.target.value),onKeyPress:le=>{le.key==="Enter"&&(le.preventDefault(),ht())},className:"flex-1 px-3 py-1.5 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:611,columnNumber:15},void 0),a.jsxDEV("button",{type:"button",onClick:ht,className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-xs font-medium hover:bg-gray-200 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:623,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:610,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:531,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:635,columnNumber:13},void 0),a.jsxDEV("textarea",{...u("description"),rows:2,className:"input w-full text-sm md:text-base"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:638,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:634,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 sm:gap-0 pt-4 border-t",children:[a.jsxDEV("div",{children:n&&a.jsxDEV("button",{type:"button",onClick:()=>{window.confirm("  ?")&&i(n.id)},className:"btn btn-outline text-red-600 hover:bg-red-50 flex items-center w-full sm:w-auto justify-center text-sm md:text-base",children:[a.jsxDEV(ji,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:658,columnNumber:19},void 0),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:649,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:647,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex gap-2 sm:space-x-3",children:[a.jsxDEV("button",{type:"button",onClick:s,className:"btn btn-outline flex-1 sm:flex-none text-sm md:text-base",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:664,columnNumber:15},void 0),a.jsxDEV("button",{type:"submit",disabled:o,className:"btn btn-primary flex-1 sm:flex-none text-sm md:text-base disabled:opacity-50",children:o?" ...":n?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:671,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:663,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:646,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:394,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:379,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ScheduleModal.tsx",lineNumber:378,columnNumber:5},void 0)},Md=n=>{if(!n||n==="-")return"";const[e,t]=n.split(":"),s=parseInt(e,10),r=parseInt(t,10),i=s>=12?"":"",o=s%12||12;return r>0?`${i} ${o} ${r}`:`${i} ${o}`},vu=["","","","","","","","","","","","","","","","","","","","","","","","","","",""],al=n=>{if(!n)return n;const e=n.replace(/$/g,"").trim(),t=e.split(" ");if(t.length>=2){const s=t[t.length-1];for(const r of vu)if(s===r)return t.slice(0,-1).join(" ").trim()}for(const s of vu)if(e.endsWith(s))return e.substring(0,e.length-s.length).trim()||e;return e},gc=n=>{const e=n.replace(/$/g,"").trim(),t=e.split(" ");if(t.length>=2){const s=t[t.length-1];for(const r of vu)if(s===r)return r}for(const s of vu)if(e.endsWith(s))return s;return""},e2=["","","","","","",""],t2=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","/","","","","","","","",""],Fm=["","","/","","","","","","","","","","","","",""],n2={KB:"004",:"004",:"088",:"020",:"081",IBK:"003",:"003",NH:"011",:"011",SC:"023",:"023",:"027",:"027",:"045",:"048",:"071",KDB:"002",:"002",:"007",:"031",:"032",:"039",:"034",:"037",:"035",:"090",:"089",K:"089",:"092"},s2={KB:"KB",:"KB",IBK:"",:"",NH:"",:"",SC:"SC",:"SC",:"",:"",KDB:"",:"",:"K"},cy=e2,r2=()=>{const{schedules:n,loadSchedulesFromAPI:e,addScheduleToAPI:t,deleteScheduleFromAPI:s}=dr(),{user:r}=oi(),[i,o]=E.useState(!1);E.useEffect(()=>{e().catch(d=>{console.error("Failed to load schedules:",d)})},[e]);const l=r!=null&&r.name?r.name.slice(-2):null,u=(r==null?void 0:r.name)===""?[""]:l?[l,...cy.filter(d=>d!==l)]:cy,m=d=>{const f=n.filter(v=>v.attendees?!!(v.attendees.includes(d)||v.attendees.includes("HV LAB")&&d!==""||v.attendees.includes("")&&["",""].includes(d)||v.attendees.includes("")&&["","",""].includes(d)):!1),p=v=>{const w=new Set;return v.filter(R=>{const F=`${$t(new Date(R.start),"yyyy-MM-dd")}|${R.project}|${R.title}`;return w.has(F)?!1:(w.add(F),!0)})},y=p(f.filter(v=>Gp(new Date(v.start)))),C=p(f.filter(v=>f_(new Date(v.start))&&!Gp(new Date(v.start))).sort((v,w)=>new Date(v.start).getTime()-new Date(w.start).getTime())).slice(0,3);return{todaySchedules:y,upcomingSchedules:C,member:d}};return a.jsxDEV("div",{className:"space-y-3 md:space-y-5 lg:space-y-4",children:[a.jsxDEV("div",{children:a.jsxDEV("div",{className:"dashboard-grid grid grid-cols-1 sm:grid-cols-2 ipad:grid-cols-2 ipad-lg:grid-cols-2 ipad-xl:grid-cols-3 ipad-2xl:grid-cols-3 2xl:grid-cols-4 gap-3 md:gap-4 lg:gap-4",children:u.map(d=>{const{todaySchedules:f,upcomingSchedules:p}=m(d),y=f.length+p.length,C=d===l;return a.jsxDEV("div",{className:`card p-3 sm:p-4 md:p-5 lg:p-4 ${C?"ring-1 ring-gray-300":""}`,children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-200",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("h3",{className:"font-bold text-lg md:text-lg text-gray-900",children:d},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:120,columnNumber:21},void 0),C&&a.jsxDEV("span",{className:"text-xs px-2 py-0.5 bg-gray-200 text-gray-600 rounded font-medium",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:122,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:119,columnNumber:19},void 0),a.jsxDEV("div",{className:"flex items-center gap-2",children:[C&&a.jsxDEV("button",{onClick:()=>o(!0),className:"p-1.5 hover:bg-gray-100 rounded-full transition-colors",title:" ",children:a.jsxDEV(So,{className:"h-4 w-4 text-gray-700"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:132,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:127,columnNumber:23},void 0),a.jsxDEV("span",{className:`text-xs px-2.5 py-1 ${C&&f.length>0?"bg-amber-100 text-gray-900":"bg-gray-100 text-gray-900"} rounded-full font-semibold whitespace-nowrap`,children:[f.length," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:135,columnNumber:21},void 0),a.jsxDEV("span",{className:"text-xs px-2.5 py-1 bg-gray-100 text-gray-700 rounded-full font-semibold whitespace-nowrap",children:[p.length," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:138,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:125,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:118,columnNumber:17},void 0),f.length>0&&a.jsxDEV("div",{className:"mb-4",children:[a.jsxDEV("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsxDEV(Iy,{className:"h-4 w-4 text-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:148,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-xs font-semibold text-gray-900 uppercase",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:149,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:147,columnNumber:21},void 0),a.jsxDEV("div",{className:"space-y-2",children:(()=>{const v=f.reduce((w,R)=>{const I=R.project||"-";return w[I]||(w[I]=[]),w[I].push(R),w},{});return Object.entries(v).map(([w,R])=>{const I=d===l;return a.jsxDEV("div",{className:`border-l-3 ${I?"border-gray-400":"border-gray-900"} ${I?"bg-amber-50":"bg-gray-50"} rounded-r overflow-hidden`,children:[a.jsxDEV("div",{className:`px-3 py-1 ${I?"bg-amber-100":"bg-gray-100"} border-b ${I?"border-amber-200":"border-gray-200"}`,children:a.jsxDEV("span",{className:"text-xs font-semibold text-gray-900",children:w},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:171,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:170,columnNumber:31},void 0),a.jsxDEV("div",{className:"px-3 py-1.5 space-y-0.5",children:R.map(F=>{const re=F.time&&F.time!=="-"?` - ${Md(F.time)}`:"";return a.jsxDEV("p",{className:"font-medium text-gray-900 text-sm leading-snug",children:[" ",F.title,re]},F.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:177,columnNumber:37},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:173,columnNumber:31},void 0)]},w,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:166,columnNumber:29},void 0)})})()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:151,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:146,columnNumber:19},void 0),p.length>0&&a.jsxDEV("div",{children:[a.jsxDEV("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsxDEV(t_,{className:"h-4 w-4 text-gray-600"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:195,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-xs font-semibold text-gray-600 uppercase",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:196,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:194,columnNumber:21},void 0),a.jsxDEV("div",{className:"space-y-2",children:(()=>{const v=p.reduce((w,R)=>{const I=$t(new Date(R.start),"MM.dd",{locale:Vn}),F=R.project||"-",re=`${I}|${F}`;return w[re]||(w[re]={date:I,project:F,schedules:[]}),w[re].schedules.push(R),w},{});return Object.values(v).map(({date:w,project:R,schedules:I})=>{const re=I.length>0&&d_(new Date(I[0].start))?`${w} ()`:w;return a.jsxDEV("div",{className:"border-l-3 border-gray-400 bg-gray-50 rounded-r overflow-hidden",children:[a.jsxDEV("div",{className:"px-3 py-1 bg-gray-100 border-b border-gray-200 flex items-center justify-between",children:[a.jsxDEV("span",{className:"text-xs font-semibold text-gray-700",children:R},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:218,columnNumber:33},void 0),a.jsxDEV("span",{className:"text-xs text-gray-500 font-medium",children:re},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:219,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:217,columnNumber:31},void 0),a.jsxDEV("div",{className:"px-3 py-1.5 space-y-0.5",children:I.map(ee=>{const M=ee.time&&ee.time!=="-"?` - ${Md(ee.time)}`:"";return a.jsxDEV("p",{className:"font-medium text-gray-900 text-sm leading-snug",children:[" ",ee.title,M]},ee.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:225,columnNumber:37},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:221,columnNumber:31},void 0)]},`${w}-${R}`,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:216,columnNumber:29},void 0)})})()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:198,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:193,columnNumber:19},void 0),y===0&&a.jsxDEV("div",{className:"text-center py-8 text-gray-400 text-sm",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:241,columnNumber:19},void 0)]},d,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:116,columnNumber:15},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:108,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:107,columnNumber:7},void 0),i&&a.jsxDEV(Sx,{event:null,slotInfo:{start:new Date,end:new Date},onClose:()=>o(!1),onSave:async d=>{try{console.log("Dashboard: Adding schedule...",d),await t({id:Date.now().toString(),title:d.title||"",start:d.start||new Date,end:d.end||new Date,type:"other",project:d.projectId||d.projectName||"",location:"",attendees:d.assignedTo||[],description:d.description||"",time:d.time}),console.log("Dashboard: Schedule added successfully"),await e(),console.log("Dashboard: Schedules fetched, closing modal"),o(!1)}catch(f){console.error("Failed to add schedule:",f),alert("  : "+(f instanceof Error?f.message:"   "))}},onDelete:async d=>{try{await s(d),await e(),o(!1)}catch(f){console.error("Failed to delete schedule:",f),alert("  : "+(f instanceof Error?f.message:"   "))}}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:253,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Dashboard.tsx",lineNumber:105,columnNumber:5},void 0)},Ju=()=>{const{user:n}=oi(),{projects:e}=dr();return E.useMemo(()=>n?n.name===""?e.filter(s=>{const i=(s.manager?s.manager.split(",").map(l=>l.trim()):[]).includes(""),o=s.team&&Array.isArray(s.team)&&s.team.includes("");return i||o}):e:[],[n,e])},i2=({value:n,detailValue:e="",onChange:t,onDetailChange:s,placeholder:r=" ",error:i})=>{const[o,l]=E.useState(!1),[u,m]=E.useState(n),[d,f]=E.useState(e),p=E.useRef(null);E.useEffect(()=>{const R=I=>{p.current&&!p.current.contains(I.target)&&l(!1)};return o&&document.addEventListener("mousedown",R),()=>{document.removeEventListener("mousedown",R)}},[o]),E.useEffect(()=>{m(n)},[n]),E.useEffect(()=>{f(e)},[e]);const y=()=>new Promise((R,I)=>{if(window.daum&&window.daum.Postcode){R(!0);return}const F=document.createElement("script");F.src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js",F.async=!0,F.onload=()=>R(!0),F.onerror=()=>I(new Error("Kakao Postcode   ")),document.head.appendChild(F)}),C=R=>{const I=R.roadAddr||R.jibunAddr;m(I),t(I,d),l(!1)},v=R=>{const I=R.target.value;f(I),s&&s(I),u&&t(u,I)},w=async()=>{try{(!window.daum||!window.daum.Postcode)&&await y(),window.daum&&new window.daum.Postcode({oncomplete:function(R){const I={roadAddr:R.roadAddress,jibunAddr:R.jibunAddress||R.autoJibunAddress||"",zipNo:R.zonecode,bdNm:R.buildingName,siNm:R.sido,sggNm:R.sigungu,emdNm:R.bname,rn:R.roadname};C(I)}}).open()}catch(R){console.error("  :",R),alert("     .  .")}};return a.jsxDEV("div",{className:"space-y-2",children:[a.jsxDEV("div",{className:"relative",children:[a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("div",{className:"relative flex-1",children:[a.jsxDEV("input",{type:"text",value:u,onClick:()=>w(),onChange:R=>{m(R.target.value),t(R.target.value,d)},placeholder:r,className:`input pr-8 cursor-pointer ${i?"border-red-500":""}`,readOnly:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:172,columnNumber:13},void 0),a.jsxDEV(Sy,{className:"absolute right-2 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:184,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:171,columnNumber:11},void 0),a.jsxDEV("button",{type:"button",onClick:w,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:188,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:170,columnNumber:9},void 0),i&&a.jsxDEV("p",{className:"mt-1 text-sm text-red-600",children:i},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:197,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:169,columnNumber:7},void 0),a.jsxDEV("div",{children:a.jsxDEV("input",{type:"text",value:d,onChange:v,placeholder:" (/ )",className:"input",disabled:!u},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:203,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:202,columnNumber:7},void 0),u&&a.jsxDEV("div",{className:"p-3 bg-gray-50 rounded-lg",children:a.jsxDEV("p",{className:"text-sm text-gray-600",children:[a.jsxDEV("span",{className:"font-medium",children:" :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:217,columnNumber:13},void 0)," ",u,d&&`, ${d}`]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:216,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:215,columnNumber:9},void 0),a.jsxDEV("div",{id:"address-search-container",style:{display:"none",width:"100%",height:"400px"}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:225,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/AddressSearch.tsx",lineNumber:167,columnNumber:5},void 0)},uy=["","","","","","",""],o2=({project:n,onClose:e,onSave:t})=>{const{register:s,handleSubmit:r,setValue:i,reset:o,formState:{errors:l}}=Np({defaultValues:{name:"",client:"",location:"",detailLocation:"",startDate:"",endDate:""}}),[u,m]=E.useState([]),[d,f]=E.useState(""),[p,y]=E.useState(""),[C,v]=E.useState(""),[w,R]=E.useState(!1);E.useEffect(()=>{var M;if(n){const A=n.location?n.location.split(","):["",""],N=((M=A[0])==null?void 0:M.trim())||n.location||"",V=A.length>1?A.slice(1).join(",").trim():"";o({name:n.name,client:n.client||"",location:N,detailLocation:V,startDate:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:"",endDate:n.endDate?new Date(n.endDate).toISOString().split("T")[0]:""}),y(N),v(V);const j=n.manager?n.manager.split(",").map(T=>T.trim()).filter(T=>T&&T!==""):[];m(j)}else o({name:"",client:"",location:"",detailLocation:"",startDate:"",endDate:""}),y(""),v(""),m([])},[n,o]);const I=M=>{m(A=>A.includes(M)?A.filter(N=>N!==M):[...A,M])},F=()=>{d.trim()&&!u.includes(d.trim())&&(m(M=>[...M,d.trim()]),f(""))},re=M=>{m(A=>A.filter(N=>N!==M))},ee=async M=>{if(w)return;R(!0),console.log(" ProjectModal onSubmit - Raw form data:",M);const A=p&&C?`${p}, ${C}`:p||M.location,N={name:M.name,client:M.client,location:A,manager:u.join(", "),contractAmount:(n==null?void 0:n.contractAmount)??0,spent:(n==null?void 0:n.spent)??0,status:(n==null?void 0:n.status)??"planning",progress:(n==null?void 0:n.progress)??0,description:(n==null?void 0:n.description)??"",meetingNotes:(n==null?void 0:n.meetingNotes)??[],customerRequests:(n==null?void 0:n.customerRequests)??[],entrancePassword:(n==null?void 0:n.entrancePassword)??"",sitePassword:(n==null?void 0:n.sitePassword)??""};if(M.startDate&&M.startDate!=="")N.startDate=M.startDate,console.log(" Setting startDate from form:",M.startDate);else if(n!=null&&n.startDate){const V=typeof n.startDate=="string"&&n.startDate.includes("T")?n.startDate.split("T")[0]:n.startDate;N.startDate=V,console.log(" Keeping existing startDate:",N.startDate)}if(M.endDate&&M.endDate!=="")N.endDate=M.endDate,console.log(" Setting endDate from form:",M.endDate);else if(n!=null&&n.endDate){const V=typeof n.endDate=="string"&&n.endDate.includes("T")?n.endDate.split("T")[0]:n.endDate;N.endDate=V,console.log(" Keeping existing endDate:",N.endDate)}console.log(" ProjectModal onSubmit - Final formData:",N);try{await t(N)}catch(V){throw R(!1),V}};return a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3 md:p-4",children:a.jsxDEV("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-4 md:p-6 border-b sticky top-0 bg-white z-10",children:[a.jsxDEV("h2",{className:"text-lg md:text-xl font-semibold",children:n?" ":" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:186,columnNumber:11},void 0),a.jsxDEV("button",{onClick:e,className:"p-1.5 md:p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsxDEV(Cn,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:193,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:189,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:185,columnNumber:9},void 0),a.jsxDEV("form",{onSubmit:r(ee),className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[a.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:202,columnNumber:15},void 0),a.jsxDEV("input",{...s("name",{required:" "}),type:"text",className:"input"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:205,columnNumber:15},void 0),l.name&&a.jsxDEV("p",{className:"mt-1 text-sm text-red-600",children:String(l.name.message)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:211,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:201,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:216,columnNumber:15},void 0),a.jsxDEV("input",{...s("client"),type:"text",className:"input"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:219,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:215,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:200,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:229,columnNumber:13},void 0),a.jsxDEV(i2,{value:p,detailValue:C,onChange:(M,A)=>{y(M),v(A||""),i("location",M),i("detailLocation",A||"")},onDetailChange:M=>{v(M),i("detailLocation",M)},placeholder:"  ",required:!0,error:l.location?String(l.location.message):void 0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:232,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:228,columnNumber:11},void 0),a.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:255,columnNumber:15},void 0),a.jsxDEV("input",{...s("startDate"),type:"date",className:"input"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:258,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:254,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:266,columnNumber:15},void 0),a.jsxDEV("input",{...s("endDate"),type:"date",className:"input"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:269,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:265,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:253,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" (  )"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:279,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[uy.map(M=>a.jsxDEV("button",{type:"button",onClick:()=>I(M),className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${u.includes(M)?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:M},M,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:287,columnNumber:17},void 0)),u.filter(M=>!uy.includes(M)).map(M=>a.jsxDEV("button",{type:"button",onClick:()=>re(M),className:"px-2.5 py-1.5 rounded border transition-colors text-sm bg-gray-900 text-white border-gray-900 hover:bg-gray-800",children:[M," "]},M,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:305,columnNumber:19},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:284,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("input",{type:"text",value:d,onChange:M=>f(M.target.value),onKeyPress:M=>{M.key==="Enter"&&(M.preventDefault(),F())},placeholder:"   ",className:"flex-1 px-3 py-1.5 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:319,columnNumber:15},void 0),a.jsxDEV("button",{type:"button",onClick:F,className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-xs font-medium hover:bg-gray-200 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:332,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:318,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:278,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex justify-end space-x-2 md:space-x-3 pt-4 border-t",children:[a.jsxDEV("button",{type:"button",onClick:e,className:"btn btn-outline text-sm md:text-base",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:345,columnNumber:13},void 0),a.jsxDEV("button",{type:"submit",disabled:w,className:"btn btn-primary text-sm md:text-base disabled:opacity-50",children:w?" ...":n?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:352,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:344,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:198,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:183,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/ProjectModal.tsx",lineNumber:182,columnNumber:5},void 0)},a2=({projectName:n,meetingNotes:e,onClose:t,onSave:s,onDelete:r})=>{const[i,o]=E.useState(""),[l,u]=E.useState(new Date().toISOString().split("T")[0]),[m,d]=E.useState(!1),[f,p]=E.useState(!1),y=()=>{d(!0),o(""),u(new Date().toISOString().split("T")[0])},C=async()=>{if(!f){if(!i.trim()){alert(" ");return}if(!l){alert(" ");return}p(!0);try{await s(i.trim(),new Date(l)),o(""),u(new Date().toISOString().split("T")[0]),d(!1)}finally{p(!1)}}},v=()=>{o(""),u(new Date().toISOString().split("T")[0]),d(!1)},w=R=>{window.confirm("   ?")&&r(R)};return a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:t,children:a.jsxDEV("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] flex flex-col shadow-xl",onClick:R=>R.stopPropagation(),children:[a.jsxDEV("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[a.jsxDEV("div",{children:[a.jsxDEV("h2",{className:"text-lg font-semibold text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:83,columnNumber:13},void 0),a.jsxDEV("p",{className:"text-sm text-gray-500 mt-0.5",children:n},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:84,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:82,columnNumber:11},void 0),a.jsxDEV("button",{onClick:t,className:"p-1 hover:bg-gray-100 rounded transition-colors",children:a.jsxDEV(Cn,{className:"h-5 w-5 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:90,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:86,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:81,columnNumber:9},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-6",children:[!m&&a.jsxDEV("button",{onClick:y,className:"w-full mb-4 px-4 py-2.5 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:"+ "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:98,columnNumber:13},void 0),m&&a.jsxDEV("div",{className:"mb-4 p-4 bg-gray-50 rounded border border-gray-200",children:[a.jsxDEV("div",{className:"mb-3",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:110,columnNumber:17},void 0),a.jsxDEV("input",{type:"date",value:l,onChange:R=>u(R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:113,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:109,columnNumber:15},void 0),a.jsxDEV("div",{className:"mb-3",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"  *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:121,columnNumber:17},void 0),a.jsxDEV("textarea",{value:i,onChange:R=>o(R.target.value),placeholder:"  ",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-900 resize-none",rows:4},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:124,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:120,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("button",{onClick:C,disabled:f,className:"px-4 py-1.5 bg-gray-900 text-white text-sm rounded hover:bg-gray-800 transition-colors disabled:opacity-50",children:f?" ...":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:133,columnNumber:17},void 0),a.jsxDEV("button",{onClick:v,disabled:f,className:"px-4 py-1.5 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300 transition-colors disabled:opacity-50",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:140,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:132,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:108,columnNumber:13},void 0),a.jsxDEV("div",{className:"space-y-3",children:e.length===0?a.jsxDEV("div",{className:"text-center py-12 text-gray-400 text-sm",children:"   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:154,columnNumber:15},void 0):e.map(R=>a.jsxDEV("div",{className:"p-4 bg-white border border-gray-200 rounded hover:border-gray-300 transition-colors group",children:a.jsxDEV("div",{className:"flex items-start justify-between gap-3",children:[a.jsxDEV("div",{className:"flex-1 min-w-0",children:[a.jsxDEV("p",{className:"text-sm text-gray-600 mb-2",children:$t(new Date(R.date),"yyyy.MM.dd (eee)",{locale:Vn})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:165,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-sm text-gray-900 whitespace-pre-wrap break-words",children:R.content},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:168,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:164,columnNumber:21},void 0),a.jsxDEV("button",{onClick:()=>w(R.id),className:"opacity-0 group-hover:opacity-100 px-2 py-1 text-xs text-gray-500 hover:text-red-600 transition-all",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:172,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:163,columnNumber:19},void 0)},R.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:159,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:152,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:95,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:76,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/MeetingNotesModal.tsx",lineNumber:72,columnNumber:5},void 0)},l2=({projectName:n,customerRequests:e,onClose:t,onSave:s,onToggleComplete:r,onDelete:i})=>{const[o,l]=E.useState(""),[u,m]=E.useState(new Date().toISOString().split("T")[0]),[d,f]=E.useState(!1),[p,y]=E.useState(!1),C=()=>{f(!0),l(""),m(new Date().toISOString().split("T")[0])},v=async()=>{if(!p){if(!o.trim()){alert(" ");return}if(!u){alert(" ");return}y(!0);try{await s(o.trim(),new Date(u)),l(""),m(new Date().toISOString().split("T")[0]),f(!1)}finally{y(!1)}}},w=()=>{l(""),m(new Date().toISOString().split("T")[0]),f(!1)},R=ee=>{window.confirm("  ?")&&i(ee)},I=ee=>{r(ee)},F=e.filter(ee=>!ee.completed),re=e.filter(ee=>ee.completed);return a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:t,children:a.jsxDEV("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] flex flex-col shadow-xl",onClick:ee=>ee.stopPropagation(),children:[a.jsxDEV("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[a.jsxDEV("div",{children:[a.jsxDEV("h2",{className:"text-lg font-semibold text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:93,columnNumber:13},void 0),a.jsxDEV("p",{className:"text-sm text-gray-500 mt-0.5",children:n},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:94,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:92,columnNumber:11},void 0),a.jsxDEV("button",{onClick:t,className:"p-1 hover:bg-gray-100 rounded transition-colors",children:a.jsxDEV(Cn,{className:"h-5 w-5 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:100,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:96,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:91,columnNumber:9},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-6",children:[!d&&a.jsxDEV("button",{onClick:C,className:"w-full mb-4 px-4 py-2.5 border border-gray-300 rounded text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:"+ "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:108,columnNumber:13},void 0),d&&a.jsxDEV("div",{className:"mb-4 p-4 bg-gray-50 rounded border border-gray-200",children:[a.jsxDEV("div",{className:"mb-3",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:120,columnNumber:17},void 0),a.jsxDEV("input",{type:"date",value:u,onChange:ee=>m(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:123,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:119,columnNumber:15},void 0),a.jsxDEV("div",{className:"mb-3",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"  *"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:131,columnNumber:17},void 0),a.jsxDEV("textarea",{value:o,onChange:ee=>l(ee.target.value),placeholder:"  ",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-900 resize-none",rows:3},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:134,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:130,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("button",{onClick:v,disabled:p,className:"px-4 py-1.5 bg-gray-900 text-white text-sm rounded hover:bg-gray-800 transition-colors disabled:opacity-50",children:p?" ...":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:143,columnNumber:17},void 0),a.jsxDEV("button",{onClick:w,disabled:p,className:"px-4 py-1.5 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300 transition-colors disabled:opacity-50",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:150,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:142,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:118,columnNumber:13},void 0),a.jsxDEV("div",{className:"space-y-2",children:e.length===0?a.jsxDEV("div",{className:"text-center py-12 text-gray-400 text-sm",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:164,columnNumber:15},void 0):a.jsxDEV(a.Fragment,{children:[F.map(ee=>a.jsxDEV("div",{className:"p-3 bg-white border border-gray-300 rounded hover:border-gray-400 transition-colors group",children:a.jsxDEV("div",{className:"flex items-start gap-3",children:[a.jsxDEV("button",{onClick:()=>I(ee.id),className:"mt-0.5 flex-shrink-0",children:a.jsxDEV(n_,{className:"h-4 w-4 text-gray-400"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:180,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:176,columnNumber:23},void 0),a.jsxDEV("div",{className:"flex-1 min-w-0",children:[a.jsxDEV("p",{className:"text-sm text-gray-900 whitespace-pre-wrap break-words",children:ee.content},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:183,columnNumber:25},void 0),a.jsxDEV("p",{className:"text-xs text-gray-500 mt-1",children:$t(new Date(ee.createdAt),"yyyy.MM.dd",{locale:Vn})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:186,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:182,columnNumber:23},void 0),a.jsxDEV("button",{onClick:()=>R(ee.id),className:"opacity-0 group-hover:opacity-100 px-2 py-1 text-xs text-gray-500 hover:text-red-600 transition-all",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:190,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:175,columnNumber:21},void 0)},ee.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:171,columnNumber:19},void 0)),re.map(ee=>a.jsxDEV("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded hover:border-gray-300 transition-colors group",children:a.jsxDEV("div",{className:"flex items-start gap-3",children:[a.jsxDEV("button",{onClick:()=>I(ee.id),className:"mt-0.5 flex-shrink-0",children:a.jsxDEV(s_,{className:"h-4 w-4 text-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:211,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:207,columnNumber:23},void 0),a.jsxDEV("div",{className:"flex-1 min-w-0",children:[a.jsxDEV("p",{className:"text-sm text-gray-500 line-through whitespace-pre-wrap break-words",children:ee.content},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:214,columnNumber:25},void 0),a.jsxDEV("p",{className:"text-xs text-gray-400 mt-1",children:$t(new Date(ee.createdAt),"yyyy.MM.dd",{locale:Vn})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:217,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:213,columnNumber:23},void 0),a.jsxDEV("button",{onClick:()=>R(ee.id),className:"opacity-0 group-hover:opacity-100 px-2 py-1 text-xs text-gray-500 hover:text-red-600 transition-all",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:221,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:206,columnNumber:21},void 0)},ee.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:202,columnNumber:19},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:168,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:162,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:105,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:86,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CustomerRequestsModal.tsx",lineNumber:82,columnNumber:5},void 0)},c2=({projectName:n,entrancePassword:e,sitePassword:t,onClose:s,onSave:r})=>{const[i,o]=E.useState(e||""),[l,u]=E.useState(t||""),[m,d]=E.useState(!1),[f,p]=E.useState(!1),y=()=>{d(!0)},C=async()=>{if(!f){p(!0);try{await r(i,l),d(!1)}finally{p(!1)}}},v=()=>{o(e||""),u(t||""),d(!1)};return a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:s,children:a.jsxDEV("div",{className:"bg-white rounded-lg max-w-md w-full shadow-xl",onClick:w=>w.stopPropagation(),children:[a.jsxDEV("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[a.jsxDEV("div",{children:[a.jsxDEV("h2",{className:"text-lg font-semibold text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:57,columnNumber:13},void 0),a.jsxDEV("p",{className:"text-sm text-gray-500 mt-0.5",children:n},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:58,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:56,columnNumber:11},void 0),a.jsxDEV("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded transition-colors",children:a.jsxDEV(Cn,{className:"h-5 w-5 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:64,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:60,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:55,columnNumber:9},void 0),a.jsxDEV("div",{className:"p-6 space-y-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:72,columnNumber:13},void 0),m?a.jsxDEV("input",{type:"text",value:i,onChange:w=>o(w.target.value),placeholder:"  ",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:76,columnNumber:15},void 0):a.jsxDEV("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded",children:i?a.jsxDEV("span",{className:"text-sm font-mono text-gray-900",children:i},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:86,columnNumber:19},void 0):a.jsxDEV("span",{className:"text-sm text-gray-400",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:88,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:84,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:71,columnNumber:11},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:96,columnNumber:13},void 0),m?a.jsxDEV("input",{type:"text",value:l,onChange:w=>u(w.target.value),placeholder:"  ",className:"w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:100,columnNumber:15},void 0):a.jsxDEV("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded",children:l?a.jsxDEV("span",{className:"text-sm font-mono text-gray-900",children:l},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:110,columnNumber:19},void 0):a.jsxDEV("span",{className:"text-sm text-gray-400",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:112,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:108,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:95,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:69,columnNumber:9},void 0),a.jsxDEV("div",{className:"border-t border-gray-200 px-6 py-4 flex gap-2",children:m?a.jsxDEV(a.Fragment,{children:[a.jsxDEV("button",{onClick:C,disabled:f,className:"flex-1 px-4 py-2 bg-gray-900 text-white text-sm rounded hover:bg-gray-800 transition-colors disabled:opacity-50",children:f?" ...":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:123,columnNumber:15},void 0),a.jsxDEV("button",{onClick:v,disabled:f,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300 transition-colors disabled:opacity-50",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:130,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:122,columnNumber:13},void 0):a.jsxDEV(a.Fragment,{children:[a.jsxDEV("button",{onClick:y,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:140,columnNumber:15},void 0),a.jsxDEV("button",{onClick:s,className:"flex-1 px-4 py-2 bg-gray-900 text-white text-sm rounded hover:bg-gray-800 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:146,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:139,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:120,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:50,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/SitePasswordModal.tsx",lineNumber:46,columnNumber:5},void 0)},u2=({projectName:n,onClose:e})=>{var o;const[t,s]=E.useState({clientName:"",phoneNumber:"",address:"",startDate:"",endDate:"",area:"",designFee:"",bankAccount:" 487102-01-264798 ",companyAddress:"  277  109",representative:"  "}),r=()=>{window.print()},i=l=>{const u=Number(l.replace(/,/g,""));return isNaN(u)?"":u.toLocaleString()};return a.jsxDEV(a.Fragment,{children:[a.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 print:relative print:bg-white",children:a.jsxDEV("div",{className:"bg-white rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto print:max-h-none print:mx-0 print:rounded-none",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b print:hidden",children:[a.jsxDEV("h2",{className:"text-lg font-bold text-gray-900",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:40,columnNumber:13},void 0),a.jsxDEV("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded-full",children:a.jsxDEV(Cn,{className:"h-5 w-5 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:45,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:41,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:39,columnNumber:11},void 0),a.jsxDEV("div",{className:"p-6 space-y-4 print:hidden",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:52,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:t.clientName,onChange:l=>s({...t,clientName:l.target.value}),placeholder:" ",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:53,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:51,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:63,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:t.phoneNumber,onChange:l=>s({...t,phoneNumber:l.target.value}),placeholder:"010-0000-0000",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:64,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:62,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:74,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:t.address,onChange:l=>s({...t,address:l.target.value}),placeholder:" ",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:75,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:73,columnNumber:13},void 0),a.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:86,columnNumber:17},void 0),a.jsxDEV("input",{type:"date",value:t.startDate,onChange:l=>s({...t,startDate:l.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:87,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:85,columnNumber:15},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:95,columnNumber:17},void 0),a.jsxDEV("input",{type:"date",value:t.endDate,onChange:l=>s({...t,endDate:l.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:96,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:94,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:84,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:106,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:t.area,onChange:l=>s({...t,area:l.target.value}),placeholder:": 21.9(72.37m2)",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:107,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:105,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:117,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:i(t.designFee),onChange:l=>{const u=l.target.value.replace(/,/g,"");/^\d*$/.test(u)&&s({...t,designFee:u})},placeholder:" ",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:118,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:116,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:133,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:t.bankAccount,onChange:l=>s({...t,bankAccount:l.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:134,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:132,columnNumber:13},void 0),a.jsxDEV("button",{onClick:r,disabled:!t.clientName||!t.phoneNumber||!t.address,className:"w-full py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[a.jsxDEV(Ty,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:147,columnNumber:15},void 0),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:142,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:50,columnNumber:11},void 0),a.jsxDEV("div",{className:"hidden print:block p-16",children:a.jsxDEV("div",{className:"space-y-16",children:[a.jsxDEV("h1",{className:"text-2xl font-bold text-gray-900",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:156,columnNumber:15},void 0),a.jsxDEV("div",{className:"space-y-8 text-base leading-relaxed",children:[a.jsxDEV("div",{className:"flex items-baseline",children:[a.jsxDEV("span",{className:"w-48",children:"1.  :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:161,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:t.clientName},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:162,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:160,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline",children:[a.jsxDEV("span",{className:"w-48",children:"2.  :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:166,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:t.phoneNumber},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:167,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:165,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline",children:[a.jsxDEV("span",{className:"w-48",children:"3.  :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:171,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:t.address},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:172,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:170,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline",children:[a.jsxDEV("span",{className:"w-48",children:"3.  :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:176,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:t.startDate&&t.endDate?a.jsxDEV(a.Fragment,{children:[$t(new Date(t.startDate),"yyyy",{locale:Vn}),"",$t(new Date(t.startDate),"MM",{locale:Vn}),"",$t(new Date(t.startDate),"dd",{locale:Vn})," ~ ",$t(new Date(t.endDate),"yyyy",{locale:Vn}),"",$t(new Date(t.endDate),"MM",{locale:Vn}),"",$t(new Date(t.endDate),"dd",{locale:Vn})," ()"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:179,columnNumber:23},void 0):""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:177,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:175,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline",children:[a.jsxDEV("span",{className:"w-48",children:"5.  :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:187,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:t.area},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:188,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:186,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex flex-col",children:[a.jsxDEV("div",{className:"flex items-baseline",children:[a.jsxDEV("span",{className:"w-48",children:"6.  :"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:193,columnNumber:21},void 0),a.jsxDEV("span",{className:"flex-1",children:[t.designFee?`${i(t.designFee)}`:""," ()"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:194,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:192,columnNumber:19},void 0),t.bankAccount&&a.jsxDEV("div",{className:"ml-48 mt-2 text-center",children:t.bankAccount},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:199,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:191,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:159,columnNumber:15},void 0),a.jsxDEV("div",{className:"mt-20 space-y-3",children:[a.jsxDEV("div",{className:"text-base font-bold",children:"*"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:206,columnNumber:17},void 0),a.jsxDEV("div",{className:"ml-8 space-y-2 text-base",children:[a.jsxDEV("div",{children:[" : ",t.address]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:208,columnNumber:19},void 0),a.jsxDEV("div",{className:"flex items-center",children:[a.jsxDEV("span",{children:[" : ",(o=t.clientName)==null?void 0:o.split("").join("    ")]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:210,columnNumber:21},void 0),a.jsxDEV("span",{className:"ml-8",children:"()"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:211,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:209,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:207,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:205,columnNumber:15},void 0),a.jsxDEV("div",{className:"mt-12 space-y-3",children:[a.jsxDEV("div",{className:"text-base font-bold",children:"*"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:218,columnNumber:17},void 0),a.jsxDEV("div",{className:"ml-8 space-y-2 text-base",children:[a.jsxDEV("div",{children:[" : ",t.companyAddress]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:220,columnNumber:19},void 0),a.jsxDEV("div",{children:" : HV LAB ()"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:221,columnNumber:19},void 0),a.jsxDEV("div",{className:"flex items-center",children:[a.jsxDEV("span",{children:[" : ",t.representative]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:223,columnNumber:21},void 0),a.jsxDEV("div",{className:"ml-8 inline-flex items-center justify-center w-14 h-14 border-2 border-red-600",children:a.jsxDEV("span",{className:"text-red-600 text-xs font-bold leading-tight text-center",children:["",a.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:226,columnNumber:28},void 0),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:225,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:224,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:222,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:219,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:217,columnNumber:15},void 0),a.jsxDEV("div",{className:"border-t-[3px] border-gray-900 mt-32 pt-12 flex justify-between items-end",children:[a.jsxDEV("div",{className:"flex items-center",children:[a.jsxDEV("span",{className:"text-4xl font-bold",children:"H"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:236,columnNumber:19},void 0),a.jsxDEV("span",{className:"inline-block w-12 h-1 bg-gray-900 mx-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:237,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:235,columnNumber:17},void 0),a.jsxDEV("div",{className:"text-right",children:[a.jsxDEV("div",{className:"text-xs tracking-widest mb-1",children:"ARCHITECTURE & INTERIOR"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:240,columnNumber:19},void 0),a.jsxDEV("div",{className:"text-3xl font-bold",children:"HV LAB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:241,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:239,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:234,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:154,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:153,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:37,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:36,columnNumber:7},void 0),a.jsxDEV("style",{children:`
        @media print {
          @page {
            size: A4;
            margin: 0;
          }
          body * {
            visibility: hidden;
          }
          .print\\:block, .print\\:block * {
            visibility: visible;
          }
          .print\\:hidden {
            display: none !important;
          }
          .print\\:relative {
            position: relative !important;
            background: white !important;
          }
        }
      `},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:250,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/DesignContractModal.tsx",lineNumber:35,columnNumber:5},void 0)},m2=()=>{const{loadProjectsFromAPI:n,addProjectToAPI:e,updateProjectInAPI:t,deleteProjectFromAPI:s}=dr(),{user:r}=oi(),i=Ju(),[o,l]=E.useState("in-progress"),[u,m]=E.useState("grid"),[d,f]=E.useState(!1),[p,y]=E.useState(null),[C,v]=E.useState(!1),[w,R]=E.useState(!1),[I,F]=E.useState(!1),[re,ee]=E.useState(!1),[M,A]=E.useState(null),N=(K,Le)=>`lastViewed_${r==null?void 0:r.id}_${K}_${Le}`,V=(K,Le)=>{const Fe=N(K,Le),Se=localStorage.getItem(Fe);return Se?parseInt(Se,10):0},j=(K,Le)=>{const Fe=N(K,Le);localStorage.setItem(Fe,Date.now().toString())},T=(K,Le)=>{const Fe=V(K.id,Le);return Le==="meeting"?(K.meetingNotes||[]).some(Je=>(Je.createdAt?new Date(Je.createdAt).getTime():new Date(Je.date).getTime())>Fe):(K.customerRequests||[]).some(Je=>!Je.completed)};E.useEffect(()=>{n().catch(K=>{console.error("Failed to load projects:",K),oe.error("   ")})},[n]),E.useEffect(()=>{const K=()=>{y(null),f(!0)};return window.addEventListener("headerAddButtonClick",K),()=>window.removeEventListener("headerAddButtonClick",K)},[]);const S=(K,Le)=>{if(!K||!Le)return 0;const Fe=new Date,Se=new Date(K),Je=new Date(Le);if(Fe<Se)return 0;if(Fe>Je)return 100;const Tt=Math.ceil((Je.getTime()-Se.getTime())/(1e3*60*60*24)),Gt=Math.ceil((Fe.getTime()-Se.getTime())/(1e3*60*60*24)),dt=Math.round(Gt/Tt*100);return Math.min(100,Math.max(0,dt))},k=K=>{y(K),f(!0)},Ee=async(K,Le)=>{if(window.confirm(`"${Le}"  ?

    .`))try{await s(K),oe.success(" ")}catch(Fe){console.error("Failed to delete project:",Fe),oe.error("  ")}},$e=async K=>{try{if(p)await t(p.id,K),oe.success(" ");else{const Le={id:"",...K,team:K.team||[]};await e(Le),oe.success(" "),l(K.status||"planning")}f(!1),y(null)}catch(Le){console.error("Failed to save project:",Le),oe.error("  ")}},ge=async(K,Le)=>{try{await t(K,{status:Le}),oe.success(" ")}catch(Fe){console.error("Failed to update project status:",Fe),oe.error("  ")}},He=K=>{A(K),v(!0),j(K.id,"meeting")},ht=K=>{A(K),R(!0),j(K.id,"request")},Kt=K=>{A(K),F(!0)},qt=K=>{A(K),ee(!0)},le=async(K,Le)=>{if(!M)return;const Fe=M.entrancePassword,Se=M.sitePassword;A({...M,entrancePassword:K,sitePassword:Le});try{await t(M.id,{entrancePassword:K,sitePassword:Le}),oe.success(" ")}catch(Je){console.error("Failed to save passwords:",Je),oe.error("  "),A({...M,entrancePassword:Fe,sitePassword:Se})}},ze=async(K,Le)=>{if(!M)return;const Fe={id:Date.now().toString(),content:K,date:Le,createdAt:new Date},Se=[...M.meetingNotes||[],Fe];A({...M,meetingNotes:Se});try{await t(M.id,{meetingNotes:Se}),oe.success("  ")}catch(Je){console.error("Failed to save meeting note:",Je),oe.error("   "),A({...M,meetingNotes:M.meetingNotes||[]})}},de=async(K,Le)=>{if(!M)return;const Fe={id:Date.now().toString(),content:K,completed:!1,createdAt:Le},Se=[...M.customerRequests||[],Fe];A({...M,customerRequests:Se});try{await t(M.id,{customerRequests:Se}),oe.success("  ")}catch(Je){console.error("Failed to save customer request:",Je),oe.error("   "),A({...M,customerRequests:M.customerRequests||[]})}},Be=async K=>{if(!M)return;const Le=M.customerRequests||[],Fe=Le.map(Se=>Se.id===K?{...Se,completed:!Se.completed}:Se);A({...M,customerRequests:Fe});try{await t(M.id,{customerRequests:Fe}),oe.success("  ")}catch(Se){console.error("Failed to toggle request:",Se),oe.error("  "),A({...M,customerRequests:Le})}},Xe=async K=>{if(!M)return;const Le=M.meetingNotes||[],Fe=Le.filter(Se=>Se.id!==K);A({...M,meetingNotes:Fe});try{await t(M.id,{meetingNotes:Fe}),oe.success("  ")}catch(Se){console.error("Failed to delete meeting note:",Se),oe.error(" "),A({...M,meetingNotes:Le})}},vt=async K=>{if(!M)return;const Le=M.customerRequests||[],Fe=Le.filter(Se=>Se.id!==K);A({...M,customerRequests:Fe});try{await t(M.id,{customerRequests:Fe}),oe.success("  ")}catch(Se){console.error("Failed to delete customer request:",Se),oe.error(" "),A({...M,customerRequests:Le})}},lt=({project:K})=>{const Fe={planning:{label:"",color:"bg-white text-gray-700 border-gray-300"},"in-progress":{label:"",color:"bg-white text-gray-900 border-gray-300"},completed:{label:"",color:"bg-gray-900 text-white border-gray-900"},"on-hold":{label:"",color:"bg-white text-gray-600 border-gray-300"}}[K.status];return a.jsxDEV("select",{value:K.status,onChange:Se=>ge(K.id,Se.target.value),className:Ls("px-2 py-1 text-xs font-medium border rounded cursor-pointer","focus:outline-none focus:ring-2 focus:ring-gray-500",Fe.color),onClick:Se=>Se.stopPropagation(),children:[a.jsxDEV("option",{value:"planning",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:395,columnNumber:9},void 0),a.jsxDEV("option",{value:"in-progress",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:396,columnNumber:9},void 0),a.jsxDEV("option",{value:"completed",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:397,columnNumber:9},void 0),a.jsxDEV("option",{value:"on-hold",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:398,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:385,columnNumber:7},void 0)},at=(()=>{let K=i;return o!=="all"&&(K=K.filter(Le=>Le.status===o)),r!=null&&r.name&&(K=[...K].sort((Le,Fe)=>{var Tt,Gt;const Se=Le.manager===r.name||((Tt=Le.team)==null?void 0:Tt.includes(r.name)),Je=Fe.manager===r.name||((Gt=Fe.team)==null?void 0:Gt.includes(r.name));return Se&&!Je?-1:!Se&&Je?1:0})),K})(),ft={planning:i.filter(K=>K.status==="planning").length,inProgress:i.filter(K=>K.status==="in-progress").length,completed:i.filter(K=>K.status==="completed").length,onHold:i.filter(K=>K.status==="on-hold").length},Nn=({project:K})=>{var Fe,Se,Je;const Le=S(K.startDate,K.endDate);return a.jsxDEV("div",{className:"card p-3 md:p-4 hover:border-gray-400 transition-colors",children:[a.jsxDEV("div",{className:"flex items-start justify-between mb-3 md:mb-4",children:[a.jsxDEV("div",{className:"flex-1",children:[a.jsxDEV("h3",{className:"font-bold text-base md:text-lg text-gray-900",children:K.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:444,columnNumber:13},void 0),a.jsxDEV("p",{className:"text-xs md:text-sm text-gray-600 mt-1",children:[K.client,""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:445,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:443,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex flex-col items-end gap-2",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:[K.status==="planning"&&a.jsxDEV("button",{onClick:()=>qt(K),className:"px-2 py-1 text-xs font-medium text-white bg-gray-700 hover:bg-gray-800 rounded transition-colors",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:450,columnNumber:17},void 0),a.jsxDEV(lt,{project:K},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:457,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:448,columnNumber:13},void 0),a.jsxDEV("button",{onClick:()=>k(K),className:"text-xs text-gray-600 hover:text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:459,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:447,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:442,columnNumber:9},void 0),a.jsxDEV("div",{className:"space-y-1.5 md:space-y-2 mb-3 md:mb-4 text-xs md:text-sm",children:[a.jsxDEV("div",{className:"text-gray-600",children:[": ",K.location]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:469,columnNumber:11},void 0),a.jsxDEV("div",{className:"text-gray-600",children:[": ",K.startDate&&K.endDate?`${$t(K.startDate,"MM.dd (eee)",{locale:Vn})} - ${$t(K.endDate,"MM.dd (eee)",{locale:Vn})}`:""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:472,columnNumber:11},void 0),a.jsxDEV("div",{className:"text-gray-600",children:[": ",K.manager]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:477,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:468,columnNumber:9},void 0),a.jsxDEV("div",{className:"mb-3 md:mb-4",children:[a.jsxDEV("div",{className:"flex items-center justify-end mb-2",children:a.jsxDEV("button",{onClick:()=>Kt(K),className:"px-2.5 py-1 text-[10px] md:text-xs font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded border border-gray-300 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:485,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:484,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex items-center justify-between mb-1.5 md:mb-2",children:[a.jsxDEV("span",{className:"text-[10px] md:text-xs text-gray-600",children:" ( )"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:493,columnNumber:13},void 0),a.jsxDEV("span",{className:"text-xs md:text-sm font-medium text-gray-900",children:[Le,"%"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:494,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:492,columnNumber:11},void 0),a.jsxDEV("div",{className:"w-full bg-gray-200 h-1",children:a.jsxDEV("div",{className:"bg-gray-900 h-1 transition-all",style:{width:`${Le}%`}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:497,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:496,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:482,columnNumber:9},void 0),a.jsxDEV("div",{className:"pt-3 border-t border-gray-200 space-y-2",children:[a.jsxDEV("div",{onClick:()=>He(K),className:"relative p-2.5 bg-gray-50 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors border border-gray-200",children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:[a.jsxDEV("span",{className:"text-xs font-semibold text-gray-700 flex items-center gap-1",children:["",(((Fe=K.meetingNotes)==null?void 0:Fe.length)||0)>0&&a.jsxDEV("span",{className:"text-gray-500",children:["(",(Se=K.meetingNotes)==null?void 0:Se.length,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:515,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:512,columnNumber:15},void 0),T(K,"meeting")&&a.jsxDEV("span",{className:"px-1.5 py-0.5 text-[9px] font-bold text-white bg-red-500 rounded-full",children:"NEW"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:519,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:511,columnNumber:13},void 0),K.meetingNotes&&K.meetingNotes.length>0?a.jsxDEV("p",{className:"text-xs text-gray-600 line-clamp-1",children:((Je=K.meetingNotes[K.meetingNotes.length-1])==null?void 0:Je.content)||" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:523,columnNumber:15},void 0):a.jsxDEV("p",{className:"text-xs text-gray-400 italic",children:"+   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:527,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:507,columnNumber:11},void 0),(()=>{var dt;const Tt=((dt=K.customerRequests)==null?void 0:dt.filter(P=>!P.completed))||[],Gt=Tt[Tt.length-1];return a.jsxDEV("div",{onClick:()=>ht(K),className:"relative p-2.5 bg-gray-50 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors border border-gray-200",children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:[a.jsxDEV("span",{className:"text-xs font-semibold text-gray-700 flex items-center gap-1",children:["",Tt.length>0&&a.jsxDEV("span",{className:"text-gray-500",children:["(",Tt.length,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:544,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:541,columnNumber:19},void 0),T(K,"request")&&a.jsxDEV("span",{className:"px-1.5 py-0.5 text-[9px] font-bold text-white bg-red-500 rounded-full",children:"NEW"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:548,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:540,columnNumber:17},void 0),Gt?a.jsxDEV("p",{className:"text-xs text-gray-600 line-clamp-1",children:Gt.content||" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:552,columnNumber:19},void 0):a.jsxDEV("p",{className:"text-xs text-gray-400 italic",children:"   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:556,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:536,columnNumber:15},void 0)})(),((r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="manager")&&a.jsxDEV("div",{className:"flex justify-end pt-1",children:a.jsxDEV("button",{onClick:()=>Ee(K.id,K.name),className:"text-xs text-rose-500 hover:text-rose-600",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:564,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:563,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:505,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:441,columnNumber:7},void 0)};return a.jsxDEV("div",{className:"space-y-3 md:space-y-4",children:[a.jsxDEV("div",{className:"border-b border-gray-200",children:a.jsxDEV("div",{className:"flex items-center justify-between",children:[a.jsxDEV("nav",{className:"flex space-x-4 md:space-x-8 overflow-x-auto",children:[{id:"planning",label:"",count:ft.planning,color:"text-gray-700"},{id:"in-progress",label:"",count:ft.inProgress,color:"text-gray-700"},{id:"completed",label:"",count:ft.completed,color:"text-gray-700"},{id:"all",label:"",count:i.length,color:"text-gray-600"}].map(K=>a.jsxDEV("button",{onClick:()=>l(K.id),className:Ls("py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm transition-colors whitespace-nowrap",o===K.id?`border-gray-700 ${K.color}`:"border-transparent text-gray-400 hover:text-gray-700 hover:border-gray-300"),children:[K.label,a.jsxDEV("span",{className:Ls("ml-1 md:ml-2 py-0.5 px-1.5 md:px-2 rounded-full text-[10px] md:text-xs font-semibold",o===K.id?"bg-gray-700 text-white":"bg-gray-200 text-gray-600"),children:K.count},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:601,columnNumber:17},void 0)]},K.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:590,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:583,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex items-center gap-6 mb-3 md:mb-4",children:[a.jsxDEV("div",{className:"hidden sm:flex border border-gray-300 overflow-hidden rounded",children:[a.jsxDEV("button",{onClick:()=>m("grid"),className:Ls("px-3 md:px-4 py-2 text-xs md:text-sm",u==="grid"?"bg-gray-100":"hover:bg-gray-50"),children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:615,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>m("list"),className:Ls("px-3 md:px-4 py-2 text-xs md:text-sm border-l border-gray-300",u==="list"?"bg-gray-100":"hover:bg-gray-50"),children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:624,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:614,columnNumber:13},void 0),a.jsxDEV("button",{onClick:()=>{y(null),f(!0)},className:"hidden lg:inline-flex btn btn-primary portrait:px-2 landscape:px-4 py-2 items-center gap-1",children:[a.jsxDEV(So,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:642,columnNumber:15},void 0),a.jsxDEV("span",{className:"portrait:hidden landscape:inline",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:643,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:635,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:612,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:581,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:580,columnNumber:7},void 0),u==="grid"||window.innerWidth<768?a.jsxDEV("div",{className:"projects-grid grid grid-cols-1 md:grid-cols-2 ipad:grid-cols-2 ipad-lg:grid-cols-2 ipad-xl:grid-cols-3 ipad-2xl:grid-cols-3 2xl:grid-cols-4 gap-3 md:gap-6",children:at.map(K=>a.jsxDEV(Nn,{project:K},K.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:652,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:650,columnNumber:9},void 0):a.jsxDEV("div",{className:"bg-white border border-gray-200 overflow-hidden",children:a.jsxDEV("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsxDEV("thead",{className:"bg-gray-50",children:a.jsxDEV("tr",{children:[a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:660,columnNumber:17},void 0),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:663,columnNumber:17},void 0),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:666,columnNumber:17},void 0),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:669,columnNumber:17},void 0),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:672,columnNumber:17},void 0),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:675,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:659,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:658,columnNumber:13},void 0),a.jsxDEV("tbody",{className:"bg-white divide-y divide-gray-200",children:at.map(K=>{var Fe,Se,Je,Tt;const Le=S(K.startDate,K.endDate);return a.jsxDEV("tr",{className:"hover:bg-gray-50",children:[a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{children:[a.jsxDEV("p",{className:"font-medium",children:K.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:687,columnNumber:25},void 0),a.jsxDEV("p",{className:"text-sm text-gray-500",children:K.location},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:688,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:686,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:685,columnNumber:21},void 0),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("p",{className:"text-sm",children:[K.client,""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:692,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:691,columnNumber:21},void 0),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:K.startDate&&K.endDate?a.jsxDEV(a.Fragment,{children:[$t(K.startDate,"yyyy.MM.dd (eee)",{locale:Vn})," -",a.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:698,columnNumber:27},void 0),$t(K.endDate,"yyyy.MM.dd (eee)",{locale:Vn})]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:696,columnNumber:25},void 0):""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:694,columnNumber:21},void 0),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"flex items-center gap-2",children:[K.status==="planning"&&a.jsxDEV("button",{onClick:()=>qt(K),className:"px-2 py-1 text-xs font-medium text-white bg-gray-700 hover:bg-gray-800 rounded transition-colors",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:706,columnNumber:27},void 0),a.jsxDEV(lt,{project:K},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:713,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:704,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:703,columnNumber:21},void 0),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"space-y-2",children:[a.jsxDEV("button",{onClick:()=>Kt(K),className:"px-2.5 py-1 text-xs font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded border border-gray-300 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:718,columnNumber:25},void 0),a.jsxDEV("div",{className:"flex items-center",children:[a.jsxDEV("div",{className:"w-24 bg-gray-200 h-1 mr-2",children:a.jsxDEV("div",{className:"bg-gray-900 h-1",style:{width:`${Le}%`}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:726,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:725,columnNumber:27},void 0),a.jsxDEV("span",{className:"text-sm",children:[Le,"%"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:731,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:724,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:717,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:716,columnNumber:21},void 0),a.jsxDEV("td",{className:"px-6 py-4",children:a.jsxDEV("div",{className:"flex flex-col gap-1.5 min-w-[280px]",children:[a.jsxDEV("div",{onClick:()=>He(K),className:"flex items-center gap-2 p-2 bg-gray-50 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[a.jsxDEV("span",{className:"text-xs font-medium text-gray-700 whitespace-nowrap flex items-center gap-1",children:["",(((Fe=K.meetingNotes)==null?void 0:Fe.length)||0)>0&&a.jsxDEV("span",{className:"text-gray-500",children:["(",(Se=K.meetingNotes)==null?void 0:Se.length,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:745,columnNumber:31},void 0),T(K,"meeting")&&a.jsxDEV("span",{className:"px-1 py-0.5 text-[9px] font-bold text-white bg-red-500 rounded",children:"N"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:748,columnNumber:31},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:742,columnNumber:27},void 0),a.jsxDEV("span",{className:"text-xs text-gray-600 truncate flex-1",children:(Je=K.meetingNotes)!=null&&Je.length?((Tt=K.meetingNotes[K.meetingNotes.length-1])==null?void 0:Tt.content)||"-":" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:751,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:738,columnNumber:25},void 0),(()=>{var P;const Gt=((P=K.customerRequests)==null?void 0:P.filter(q=>!q.completed))||[],dt=Gt[Gt.length-1];return a.jsxDEV("div",{onClick:()=>ht(K),className:"flex items-center gap-2 p-2 bg-gray-50 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[a.jsxDEV("span",{className:"text-xs font-medium text-gray-700 whitespace-nowrap flex items-center gap-1",children:["",Gt.length>0&&a.jsxDEV("span",{className:"text-gray-500",children:["(",Gt.length,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:767,columnNumber:35},void 0),T(K,"request")&&a.jsxDEV("span",{className:"px-1 py-0.5 text-[9px] font-bold text-white bg-red-500 rounded",children:"N"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:770,columnNumber:35},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:764,columnNumber:31},void 0),a.jsxDEV("span",{className:"text-xs text-gray-600 truncate flex-1",children:dt?dt.content||"-":"   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:773,columnNumber:31},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:760,columnNumber:29},void 0)})(),a.jsxDEV("div",{className:"flex space-x-2 pt-1",children:[a.jsxDEV("button",{onClick:()=>k(K),className:"text-xs text-gray-600 hover:text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:781,columnNumber:27},void 0),((r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="manager")&&a.jsxDEV("button",{onClick:()=>Ee(K.id,K.name),className:"text-xs text-rose-600 hover:text-rose-700",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:788,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:780,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:736,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:735,columnNumber:21},void 0)]},K.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:684,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:680,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:657,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:656,columnNumber:9},void 0),d&&a.jsxDEV(o2,{project:p,onClose:()=>{f(!1),y(null)},onSave:$e},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:807,columnNumber:9},void 0),C&&M&&a.jsxDEV(a2,{projectName:M.name,meetingNotes:M.meetingNotes||[],onClose:()=>{v(!1),A(null)},onSave:ze,onDelete:Xe},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:818,columnNumber:9},void 0),w&&M&&a.jsxDEV(l2,{projectName:M.name,customerRequests:M.customerRequests||[],onClose:()=>{R(!1),A(null)},onSave:de,onToggleComplete:Be,onDelete:vt},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:831,columnNumber:9},void 0),I&&M&&a.jsxDEV(c2,{projectName:M.name,entrancePassword:M.entrancePassword||"",sitePassword:M.sitePassword||"",onClose:()=>{F(!1),A(null)},onSave:le},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:845,columnNumber:9},void 0),re&&M&&a.jsxDEV(u2,{projectName:M.name,onClose:()=>{ee(!1),A(null)}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:858,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Projects.tsx",lineNumber:578,columnNumber:5},void 0)};var xp={},Tx={exports:{}};(function(n){function e(t){return t&&t.__esModule?t:{default:t}}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Tx);var ns=Tx.exports,vp={},Px={exports:{}},Lx={exports:{}},jx={exports:{}},Rx={exports:{}};(function(n){function e(t){"@babel/helpers - typeof";return n.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},n.exports.__esModule=!0,n.exports.default=n.exports,e(t)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Rx);var ca=Rx.exports,Bx={exports:{}};(function(n){var e=ca.default;function t(s,r){if(e(s)!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var o=i.call(s,r||"default");if(e(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(s)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Bx);var d2=Bx.exports;(function(n){var e=ca.default,t=d2;function s(r){var i=t(r,"string");return e(i)=="symbol"?i:i+""}n.exports=s,n.exports.__esModule=!0,n.exports.default=n.exports})(jx);var Ux=jx.exports;(function(n){var e=Ux;function t(s,r,i){return(r=e(r))in s?Object.defineProperty(s,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[r]=i,s}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Lx);var Hx=Lx.exports;(function(n){var e=Hx;function t(r,i){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),o.push.apply(o,l)}return o}function s(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?t(Object(o),!0).forEach(function(l){e(r,l,o[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(o,l))})}return r}n.exports=s,n.exports.__esModule=!0,n.exports.default=n.exports})(Px);var ai=Px.exports,Mx={exports:{}},Fx={exports:{}};(function(n){function e(t,s){if(t==null)return{};var r={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(s.indexOf(i)!==-1)continue;r[i]=t[i]}return r}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Fx);var f2=Fx.exports;(function(n){var e=f2;function t(s,r){if(s==null)return{};var i,o,l=e(s,r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(s);for(o=0;o<u.length;o++)i=u[o],r.indexOf(i)===-1&&{}.propertyIsEnumerable.call(s,i)&&(l[i]=s[i])}return l}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Mx);var _p=Mx.exports,Ox={exports:{}};(function(n){function e(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Ox);var Ki=Ox.exports,qx={exports:{}};(function(n){var e=Ux;function t(r,i){for(var o=0;o<i.length;o++){var l=i[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(r,e(l.key),l)}}function s(r,i,o){return i&&t(r.prototype,i),o&&t(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r}n.exports=s,n.exports.__esModule=!0,n.exports.default=n.exports})(qx);var Gi=qx.exports,$x={exports:{}},zx={exports:{}};(function(n){function e(t){return n.exports=e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},n.exports.__esModule=!0,n.exports.default=n.exports,e(t)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(zx);var p2=zx.exports,Wx={exports:{}};(function(n){function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(n.exports=e=function(){return!!t},n.exports.__esModule=!0,n.exports.default=n.exports)()}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Wx);var h2=Wx.exports,Kx={exports:{}},Gx={exports:{}};(function(n){function e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Gx);var g2=Gx.exports;(function(n){var e=ca.default,t=g2;function s(r,i){if(i&&(e(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return t(r)}n.exports=s,n.exports.__esModule=!0,n.exports.default=n.exports})(Kx);var y2=Kx.exports;(function(n){var e=p2,t=h2,s=y2;function r(i,o,l){return o=e(o),s(i,t()?Reflect.construct(o,l||[],e(i).constructor):o.apply(i,l))}n.exports=r,n.exports.__esModule=!0,n.exports.default=n.exports})($x);var ua=$x.exports,Qx={exports:{}},Yx={exports:{}};(function(n){function e(t,s){return n.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},n.exports.__esModule=!0,n.exports.default=n.exports,e(t,s)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Yx);var b2=Yx.exports;(function(n){var e=b2;function t(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(r&&r.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),r&&e(s,r)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Qx);var ma=Qx.exports;const zl=wl(p_);var Us={},ta={};Object.defineProperty(ta,"__esModule",{value:!0});ta.views=ta.navigate=void 0;ta.navigate={PREVIOUS:"PREV",NEXT:"NEXT",TODAY:"TODAY",DATE:"DATE"};ta.views={MONTH:"month",WEEK:"week",WORK_WEEK:"work_week",DAY:"day",AGENDA:"agenda"};var N2=ns.default;Object.defineProperty(Us,"__esModule",{value:!0});Us.views=Us.dateRangeFormat=Us.dateFormat=Us.accessor=Us.DayLayoutAlgorithmPropType=void 0;var us=N2(Py),my=ta,dy=Object.keys(my.views).map(function(n){return my.views[n]});Us.accessor=us.default.oneOfType([us.default.string,us.default.func]);Us.dateFormat=us.default.any;Us.dateRangeFormat=us.default.func;Us.views=us.default.oneOfType([us.default.arrayOf(us.default.oneOf(dy)),us.default.objectOf(function(n,e){var t=dy.indexOf(e)!==-1&&typeof n[e]=="boolean";if(t)return null;for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return us.default.elementType.apply(us.default,[n,e].concat(r))})]);Us.DayLayoutAlgorithmPropType=us.default.oneOfType([us.default.oneOf(["overlap","no-overlap"]),us.default.func]);var Zu={},da={},x2=ns.default;Object.defineProperty(da,"__esModule",{value:!0});da.accessor=Xx;da.wrapAccessor=void 0;var v2=x2(ca);function Xx(n,e){var t=null;return typeof e=="function"?t=e(n):typeof e=="string"&&(0,v2.default)(n)==="object"&&n!=null&&e in n&&(t=n[e]),t}da.wrapAccessor=function(e){return function(t){return Xx(t,e)}};var Qi={},_2=ns.default;Object.defineProperty(Qi,"__esModule",{value:!0});Qi.DnDContext=void 0;var D2=_2(E);Qi.DnDContext=D2.default.createContext();var Yi=ns.default;Object.defineProperty(Zu,"__esModule",{value:!0});Zu.default=void 0;var k2=Yi(ai),E2=Yi(Ki),A2=Yi(Gi),w2=Yi(ua),V2=Yi(ma),vo=Yi(E),fy=Yi(zl),py=da,C2=Qi,Jx=function(n){function e(){var t;(0,E2.default)(this,e);for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return t=(0,w2.default)(this,e,[].concat(r)),t.handleResizeUp=function(o){o.button===0&&t.context.draggable.onBeginAction(t.props.event,"resize","UP")},t.handleResizeDown=function(o){o.button===0&&t.context.draggable.onBeginAction(t.props.event,"resize","DOWN")},t.handleResizeLeft=function(o){o.button===0&&t.context.draggable.onBeginAction(t.props.event,"resize","LEFT")},t.handleResizeRight=function(o){o.button===0&&t.context.draggable.onBeginAction(t.props.event,"resize","RIGHT")},t.handleStartDragging=function(o){var l;if(o.button===0){var u=(l=o.target.getAttribute("class"))===null||l===void 0?void 0:l.includes("rbc-addons-dnd-resize");if(!u){var m=(0,k2.default)({},t.props.event);m.sourceResource=t.props.resource,t.context.draggable.onBeginAction(t.props.event,"move")}}},t}return(0,V2.default)(e,n),(0,A2.default)(e,[{key:"renderAnchor",value:function(s){var r=s==="Up"||s==="Down"?"ns":"ew";return vo.default.createElement("div",{className:"rbc-addons-dnd-resize-".concat(r,"-anchor"),onMouseDown:this["handleResize".concat(s)]},vo.default.createElement("div",{className:"rbc-addons-dnd-resize-".concat(r,"-icon")}))}},{key:"render",value:function(){var s=this.props,r=s.event,i=s.type,o=s.continuesPrior,l=s.continuesAfter,u=s.resizable,m=this.props.children;if(r.__isPreview)return vo.default.cloneElement(m,{className:(0,fy.default)(m.props.className,"rbc-addons-dnd-drag-preview")});var d=this.context.draggable,f=d.draggableAccessor,p=d.resizableAccessor,y=f?!!(0,py.accessor)(r,f):!0;if(!y)return m;var C=u&&(p?!!(0,py.accessor)(r,p):!0);if(C||y){var v={onMouseDown:this.handleStartDragging,onTouchStart:this.handleStartDragging};if(C){var w=null,R=null;i==="date"?(w=!o&&this.renderAnchor("Left"),R=!l&&this.renderAnchor("Right")):(w=!o&&this.renderAnchor("Up"),R=!l&&this.renderAnchor("Down")),v.children=vo.default.createElement("div",{className:"rbc-addons-dnd-resizable"},w,m.props.children,R)}d.dragAndDropAction.interacting&&d.dragAndDropAction.event===r&&(v.className=(0,fy.default)(m.props.className,"rbc-addons-dnd-dragged-event")),m=vo.default.cloneElement(m,v)}return m}}])}(vo.default.Component);Jx.contextType=C2.DnDContext;Zu.default=Jx;var em={},Zx={exports:{}};(function(n){var e=ca.default;function t(s,r){if(typeof WeakMap=="function")var i=new WeakMap,o=new WeakMap;return(n.exports=t=function(u,m){if(!m&&u&&u.__esModule)return u;var d,f,p={__proto__:null,default:u};if(u===null||e(u)!="object"&&typeof u!="function")return p;if(d=m?o:i){if(d.has(u))return d.get(u);d.set(u,p)}for(var y in u)y!=="default"&&{}.hasOwnProperty.call(u,y)&&((f=(d=Object.defineProperty)&&Object.getOwnPropertyDescriptor(u,y))&&(f.get||f.set)?d(p,y,f):p[y]=u[y]);return p},n.exports.__esModule=!0,n.exports.default=n.exports)(s,r)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Zx);var ev=Zx.exports;function Dp(n,e,t,s){if(t===void 0&&(t=!1),s===void 0&&(s=!0),n){var r=document.createEvent("HTMLEvents");r.initEvent(e,t,s),n.dispatchEvent(r)}}function I2(n){var e=js(n,"transitionDuration")||"",t=e.indexOf("ms")===-1?1e3:1;return parseFloat(e)*t}function S2(n,e,t){t===void 0&&(t=5);var s=!1,r=setTimeout(function(){s||Dp(n,"transitionend",!0)},e+t),i=_u(n,"transitionend",function(){s=!0},{once:!0});return function(){clearTimeout(r),i()}}function kp(n,e,t,s){t==null&&(t=I2(n)||0);var r=S2(n,t,s),i=_u(n,"transitionend",e);return function(){r(),i()}}var hy={transition:"","transition-duration":"","transition-delay":"","transition-timing-function":""};function gy(n){var e=n.node,t=n.properties,s=n.duration,r=s===void 0?200:s,i=n.easing,o=n.callback,l=[],u={},m="";Object.keys(t).forEach(function(p){var y=t[p];h_(p)?m+=p+"("+y+") ":(u[p]=y,l.push(g_(p)))}),m&&(u.transform=m,l.push("transform"));function d(p){p.target===p.currentTarget&&(js(e,hy),o&&o.call(this,p))}r>0&&(u.transition=l.join(", "),u["transition-duration"]=r/1e3+"s",u["transition-delay"]="0s",u["transition-timing-function"]=i||"linear");var f=kp(e,d,r);return e.clientLeft,js(e,u),{cancel:function(){f(),js(e,hy)}}}function tv(n,e,t,s,r){if(!("nodeType"in n))return gy(n);if(!e)throw new Error("must include properties to animate");return typeof s=="function"&&(r=s,s=""),gy({node:n,properties:e,duration:t,easing:s,callback:r})}function nv(n,e,t){if(n){if(typeof t>"u")return n.getAttribute(e);!t&&t!==""?n.removeAttribute(e):n.setAttribute(e,String(t))}}function sv(n){return n?Array.from(n.children):[]}function rv(n){if(n){for(;n.firstChild;)n.removeChild(n.firstChild);return n}return null}var T2=Function.prototype.bind.call(Function.prototype.call,[].slice);function iv(n){return n?T2(n.childNodes):[]}function ov(n,e){return function(s){var r=s.currentTarget,i=s.target,o=Wd(r,n);o.some(function(l){return Kd(l,i)})&&e.call(this,s)}}function av(n,e){return n&&e&&e.parentNode?(e.nextSibling?e.parentNode.insertBefore(n,e.nextSibling):e.parentNode.appendChild(n),n):null}var P2=/^(?:input|select|textarea|button)$/i;function lv(n){return n?P2.test(n.nodeName):!1}function cv(n){return n?!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length):!1}function uv(n,e,t){e===void 0&&(e=null),t===void 0&&(t=null);for(var s=[];n;n=n.nextElementSibling)if(n!==e){if(t&&Gd(n,t))break;s.push(n)}return s}function mv(n,e){return uv(n,n,e)}function L2(n,e){var t=null,s=[];for(t=n?n[e]:null;t&&t.nodeType!==9;)s.push(t),t=t[e]||null;return s}function dv(n){return L2(n,"parentElement")}function fv(n,e){return n&&e?(e.firstElementChild?e.insertBefore(n,e.firstElementChild):e.appendChild(n),n):null}function pv(n){return n&&n.parentNode?(n.parentNode.removeChild(n),n):null}function Ep(n,e){var t=js(n,"position"),s=t==="absolute",r=n.ownerDocument;if(t==="fixed")return r||document;for(;(n=n.parentNode)&&!y_(n);){var i=s&&js(n,"position")==="static",o=(js(n,"overflow")||"")+(js(n,"overflow-y")||"")+js(n,"overflow-x");if(!i&&/(auto|scroll)/.test(o)&&(e||Du(n)<n.scrollHeight))return n}return r||document}function hv(n,e){var t=$c(n),s={top:0,left:0};if(n){var r=e||Ep(n),i=b_(r),o=zc(r),l=Du(r,!0);i||(s=$c(r)),t={top:t.top-s.top,left:t.left-s.left,height:t.height,width:t.width};var u=t.height,m=t.top+(i?0:o),d=m+u;o=o>m?m:d>o+l?d-l:o;var f=Qd(function(){return zc(r,o)});return function(){return Yd(f)}}}function gv(n){return uv(n&&n.parentElement?n.parentElement.firstElementChild:null,n)}var j2=/&nbsp;/gi,R2=/\xA0/g,B2=/\s+([^\s])/gm;function yv(n,e,t){e===void 0&&(e=!0),t===void 0&&(t=!0);var s="";return n&&(s=(n.textContent||"").replace(j2," ").replace(R2," "),e&&(s=s.trim()),t&&(s=s.replace(B2," $1"))),s}function bv(n,e){n.classList?n.classList.toggle(e):Xd(n,e)?Jd(n,e):Zd(n,e)}const U2={addEventListener:zy,removeEventListener:$y,triggerEvent:Dp,animate:tv,filter:ov,listen:_u,style:js,getComputedStyle:qy,attribute:nv,activeElement:Oy,ownerDocument:Fy,ownerWindow:My,requestAnimationFrame:Qd,cancelAnimationFrame:Yd,matches:Gd,height:Du,width:Hy,offset:$c,offsetParent:Uy,position:By,contains:Kd,scrollbarSize:Ry,scrollLeft:jy,scrollParent:Ep,scrollTo:hv,scrollTop:zc,querySelectorAll:Wd,closest:Ly,addClass:Zd,removeClass:Jd,hasClass:Xd,toggleClass:bv,transitionEnd:kp,childNodes:iv,childElements:sv,nextUntil:mv,parents:dv,siblings:gv,clear:rv,insertAfter:av,isInput:lv,isVisible:cv,prepend:fv,remove:pv,text:yv},H2=Object.freeze(Object.defineProperty({__proto__:null,activeElement:Oy,addClass:Zd,addEventListener:zy,animate:tv,attribute:nv,cancelAnimationFrame:Yd,childElements:sv,childNodes:iv,clear:rv,closest:Ly,contains:Kd,default:U2,filter:ov,getComputedStyle:qy,hasClass:Xd,height:Du,insertAfter:av,isInput:lv,isVisible:cv,listen:_u,matches:Gd,nextUntil:mv,offset:$c,offsetParent:Uy,ownerDocument:Fy,ownerWindow:My,parents:dv,position:By,prepend:fv,querySelectorAll:Wd,remove:pv,removeClass:Jd,removeEventListener:$y,requestAnimationFrame:Qd,scrollLeft:jy,scrollParent:Ep,scrollTo:hv,scrollTop:zc,scrollbarSize:Ry,siblings:gv,style:js,text:yv,toggleClass:bv,transitionEnd:kp,triggerEvent:Dp,width:Hy},Symbol.toStringTag,{value:"Module"})),M2=wl(H2);var Fd={exports:{}};(function(n,e){e.__esModule=!0,e.default=s;var t=Function.prototype.bind.call(Function.prototype.call,[].slice);function s(r,i){return t(r.querySelectorAll(i))}n.exports=e.default})(Fd,Fd.exports);var F2=Fd.exports,Hs={};const O2=wl(N_),q2=wl(x_),$2=wl(v_);var fa=ns.default;Object.defineProperty(Hs,"__esModule",{value:!0});Hs.default=void 0;Hs.getBoundsForNode=Al;Hs.getEventNodeFromPoint=xv;Hs.getShowMoreNodeFromPoint=vv;Hs.isEvent=Y2;Hs.isShowMore=X2;Hs.objectsCollide=qd;var z2=fa(ca),W2=fa(Ki),K2=fa(Gi),Od=fa(O2),Nv=fa(q2),G2=fa($2);function Xn(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:document;return(0,G2.default)(t,n,e,{passive:!1})}function Q2(n,e,t){return!n||(0,Od.default)(n,document.elementFromPoint(e,t))}function xv(n,e){var t=e.clientX,s=e.clientY,r=document.elementFromPoint(t,s);return(0,Nv.default)(r,".rbc-event",n)}function vv(n,e){var t=e.clientX,s=e.clientY,r=document.elementFromPoint(t,s);return(0,Nv.default)(r,".rbc-show-more",n)}function Y2(n,e){return!!xv(n,e)}function X2(n,e){return!!vv(n,e)}function Ra(n){var e=n;return n.touches&&n.touches.length&&(e=n.touches[0]),{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}var yy=5,J2=250,Z2=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.global,r=s===void 0?!1:s,i=t.longPressThreshold,o=i===void 0?250:i,l=t.validContainers,u=l===void 0?[]:l;(0,W2.default)(this,n),this._initialEvent=null,this.selecting=!1,this.isDetached=!1,this.container=e,this.globalMouse=!e||r,this.longPressThreshold=o,this.validContainers=u,this._listeners=Object.create(null),this._handleInitialEvent=this._handleInitialEvent.bind(this),this._handleMoveEvent=this._handleMoveEvent.bind(this),this._handleTerminatingEvent=this._handleTerminatingEvent.bind(this),this._keyListener=this._keyListener.bind(this),this._dropFromOutsideListener=this._dropFromOutsideListener.bind(this),this._dragOverFromOutsideListener=this._dragOverFromOutsideListener.bind(this),this._removeTouchMoveWindowListener=Xn("touchmove",function(){},window),this._removeKeyDownListener=Xn("keydown",this._keyListener),this._removeKeyUpListener=Xn("keyup",this._keyListener),this._removeDropFromOutsideListener=Xn("drop",this._dropFromOutsideListener),this._removeDragOverFromOutsideListener=Xn("dragover",this._dragOverFromOutsideListener),this._addInitialEventListener()}return(0,K2.default)(n,[{key:"on",value:function(t,s){var r=this._listeners[t]||(this._listeners[t]=[]);return r.push(s),{remove:function(){var o=r.indexOf(s);o!==-1&&r.splice(o,1)}}}},{key:"emit",value:function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];var o,l=this._listeners[t]||[];return l.forEach(function(u){o===void 0&&(o=u.apply(void 0,r))}),o}},{key:"teardown",value:function(){this._initialEvent=null,this._initialEventData=null,this._selectRect=null,this.selecting=!1,this._lastClickData=null,this.isDetached=!0,this._listeners=Object.create(null),this._removeTouchMoveWindowListener&&this._removeTouchMoveWindowListener(),this._removeInitialEventListener&&this._removeInitialEventListener(),this._removeEndListener&&this._removeEndListener(),this._onEscListener&&this._onEscListener(),this._removeMoveListener&&this._removeMoveListener(),this._removeKeyUpListener&&this._removeKeyUpListener(),this._removeKeyDownListener&&this._removeKeyDownListener(),this._removeDropFromOutsideListener&&this._removeDropFromOutsideListener(),this._removeDragOverFromOutsideListener&&this._removeDragOverFromOutsideListener()}},{key:"isSelected",value:function(t){var s=this._selectRect;return!s||!this.selecting?!1:qd(s,Al(t))}},{key:"filter",value:function(t){var s=this._selectRect;return!s||!this.selecting?[]:t.filter(this.isSelected,this)}},{key:"_addLongPressListener",value:function(t,s){var r=this,i=null,o=null,l=null,u=function(p){i=setTimeout(function(){d(),t(p)},r.longPressThreshold),o=Xn("touchmove",function(){return d()}),l=Xn("touchend",function(){return d()})},m=Xn("touchstart",u),d=function(){i&&clearTimeout(i),o&&o(),l&&l(),i=null,o=null,l=null};return s&&u(s),function(){d(),m()}}},{key:"_addInitialEventListener",value:function(){var t=this,s=Xn("mousedown",function(i){t._removeInitialEventListener(),t._handleInitialEvent(i),t._removeInitialEventListener=Xn("mousedown",t._handleInitialEvent)}),r=Xn("touchstart",function(i){t._removeInitialEventListener(),t._removeInitialEventListener=t._addLongPressListener(t._handleInitialEvent,i)});this._removeInitialEventListener=function(){s(),r()}}},{key:"_dropFromOutsideListener",value:function(t){var s=Ra(t),r=s.pageX,i=s.pageY,o=s.clientX,l=s.clientY;this.emit("dropFromOutside",{x:r,y:i,clientX:o,clientY:l}),t.preventDefault()}},{key:"_dragOverFromOutsideListener",value:function(t){var s=Ra(t),r=s.pageX,i=s.pageY,o=s.clientX,l=s.clientY;this.emit("dragOverFromOutside",{x:r,y:i,clientX:o,clientY:l}),t.preventDefault()}},{key:"_handleInitialEvent",value:function(t){if(this._initialEvent=t,!this.isDetached){var s=Ra(t),r=s.clientX,i=s.clientY,o=s.pageX,l=s.pageY,u=this.container(),m,d;if(!(t.which===3||t.button===2||!Q2(u,r,i))){if(!this.globalMouse&&u&&!(0,Od.default)(u,t.target)){var f=eS(0),p=f.top,y=f.left,C=f.bottom,v=f.right;if(d=Al(u),m=qd({top:d.top-p,left:d.left-y,bottom:d.bottom+C,right:d.right+v},{top:l,left:o}),!m)return}var w=this.emit("beforeSelect",this._initialEventData={isTouch:/^touch/.test(t.type),x:o,y:l,clientX:r,clientY:i});if(w!==!1)switch(t.type){case"mousedown":this._removeEndListener=Xn("mouseup",this._handleTerminatingEvent),this._onEscListener=Xn("keydown",this._handleTerminatingEvent),this._removeMoveListener=Xn("mousemove",this._handleMoveEvent);break;case"touchstart":this._handleMoveEvent(t),this._removeEndListener=Xn("touchend",this._handleTerminatingEvent),this._removeMoveListener=Xn("touchmove",this._handleMoveEvent);break}}}}},{key:"_isWithinValidContainer",value:function(t){var s=t.target,r=this.validContainers;return!r||!r.length||!s?!0:r.some(function(i){return!!s.closest(i)})}},{key:"_handleTerminatingEvent",value:function(t){var s=this.selecting,r=this._selectRect;if(!s&&t.type.includes("key")&&(t=this._initialEvent),this.selecting=!1,this._removeEndListener&&this._removeEndListener(),this._removeMoveListener&&this._removeMoveListener(),this._selectRect=null,this._initialEvent=null,this._initialEventData=null,!!t){var i=!this.container||(0,Od.default)(this.container(),t.target),o=this._isWithinValidContainer(t);return t.key==="Escape"||!o?this.emit("reset"):!s&&i?this._handleClickEvent(t):s?this.emit("select",r):this.emit("reset")}}},{key:"_handleClickEvent",value:function(t){var s=Ra(t),r=s.pageX,i=s.pageY,o=s.clientX,l=s.clientY,u=new Date().getTime();return this._lastClickData&&u-this._lastClickData.timestamp<J2?(this._lastClickData=null,this.emit("doubleClick",{x:r,y:i,clientX:o,clientY:l})):(this._lastClickData={timestamp:u},this.emit("click",{x:r,y:i,clientX:o,clientY:l}))}},{key:"_handleMoveEvent",value:function(t){if(!(this._initialEventData===null||this.isDetached)){var s=this._initialEventData,r=s.x,i=s.y,o=Ra(t),l=o.pageX,u=o.pageY,m=Math.abs(r-l),d=Math.abs(i-u),f=Math.min(l,r),p=Math.min(u,i),y=this.selecting,C=this.isClick(l,u);C&&!y&&!(m||d)||(!y&&!C&&this.emit("selectStart",this._initialEventData),C||(this.selecting=!0,this._selectRect={top:p,left:f,x:l,y:u,right:f+m,bottom:p+d},this.emit("selecting",this._selectRect)),t.preventDefault())}}},{key:"_keyListener",value:function(t){this.ctrl=t.metaKey||t.ctrlKey}},{key:"isClick",value:function(t,s){var r=this._initialEventData,i=r.x,o=r.y,l=r.isTouch;return!l&&Math.abs(t-i)<=yy&&Math.abs(s-o)<=yy}}])}();function eS(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return(0,z2.default)(n)!=="object"&&(n={top:n,left:n,right:n,bottom:n}),n}function qd(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=Al(n),r=s.top,i=s.left,o=s.right,l=o===void 0?i:o,u=s.bottom,m=u===void 0?r:u,d=Al(e),f=d.top,p=d.left,y=d.right,C=y===void 0?p:y,v=d.bottom,w=v===void 0?f:v;return!(m-t<f||r+t>w||l-t<p||i+t>C)}function Al(n){if(!n.getBoundingClientRect)return n;var e=n.getBoundingClientRect(),t=e.left+by("left"),s=e.top+by("top");return{top:s,left:t,right:(n.offsetWidth||0)+t,bottom:(n.offsetHeight||0)+s}}function by(n){if(n==="left")return window.pageXOffset||document.body.scrollLeft||0;if(n==="top")return window.pageYOffset||document.body.scrollTop||0}Hs.default=Z2;var tm={},nm=ns.default;Object.defineProperty(tm,"__esModule",{value:!0});tm.default=void 0;var tS=nm(Hx),Ny=nm(ai),nS=nm(zl),Ba=nm(E);function yc(n){return typeof n=="string"?n:n+"%"}function sS(n){var e=n.style,t=n.className,s=n.event,r=n.accessors,i=n.rtl,o=n.selected,l=n.label,u=n.continuesPrior,m=n.continuesAfter,d=n.getters,f=n.onClick,p=n.onDoubleClick,y=n.isBackgroundEvent,C=n.onKeyPress,v=n.components,w=v.event,R=v.eventWrapper,I=r.title(s),F=r.tooltip(s),re=r.end(s),ee=r.start(s),M=d.eventProp(s,ee,re,o),A=[Ba.default.createElement("div",{key:"1",className:"rbc-event-label"},l),Ba.default.createElement("div",{key:"2",className:"rbc-event-content"},w?Ba.default.createElement(w,{event:s,title:I}):I)],N=e.height,V=e.top,j=e.width,T=e.xOffset,S=(0,Ny.default)((0,Ny.default)({},M.style),{},(0,tS.default)({top:yc(V),height:yc(N),width:yc(j)},i?"right":"left",yc(T)));return Ba.default.createElement(R,Object.assign({type:"time"},n),Ba.default.createElement("div",{role:"button",tabIndex:0,onClick:f,onDoubleClick:p,style:S,onKeyDown:C,title:F?(typeof l=="string"?l+": ":"")+F:void 0,className:(0,nS.default)(y?"rbc-background-event":"rbc-event",t,M.className,{"rbc-selected":o,"rbc-event-continues-earlier":u,"rbc-event-continues-later":m})},A))}tm.default=sS;var Nr={},_v=ns.default;Object.defineProperty(Nr,"__esModule",{value:!0});Nr.dragAccessors=void 0;Nr.eventTimes=mS;Nr.mergeComponents=cS;Nr.pointInColumn=uS;var rS=_v(ai),iS=_v(_p),xy=da,oS=E,aS=["children"];Nr.dragAccessors={start:(0,xy.wrapAccessor)(function(n){return n.start}),end:(0,xy.wrapAccessor)(function(n){return n.end})};function lS(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var s=function(i){var o=i.children,l=(0,iS.default)(i,aS);return e.filter(Boolean).reduceRight(function(u,m){return(0,oS.createElement)(m,l,u)},o)};return s}function cS(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,t=Object.keys(e),s=(0,rS.default)({},n);return t.forEach(function(r){s[r]=n[r]?lS(n[r],e[r]):e[r]}),s}function uS(n,e){var t=n.left,s=n.right,r=n.top,i=e.x,o=e.y;return i<s+10&&i>t&&o>r}function mS(n,e,t){var s=e.start(n),r=e.end(n),i=t.eq(s,r,"minutes")&&t.diff(s,r,"minutes")===0;i&&(r=t.add(r,1,"day"));var o=t.diff(s,r,"milliseconds");return{start:s,end:r,duration:o}}var dS=ev.default,li=ns.default;Object.defineProperty(em,"__esModule",{value:!0});em.default=void 0;var Sr=li(ai),fS=li(Ki),pS=li(Gi),hS=li(ua),gS=li(ma),Om=M2,yS=li(F2),yi=li(E),bS=Qi,Tr=dS(Hs),NS=li(tm),lr=Nr,Dv=function(n){function e(){var t;(0,fS.default)(this,e);for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return t=(0,hS.default)(this,e,[].concat(r)),t.handleMove=function(o,l){if(!(0,lr.pointInColumn)(l,o))return t.reset();var u=t.context.draggable.dragAndDropAction.event,m=t.props,d=m.accessors,f=m.slotMetrics,p=f.closestSlotFromPoint({y:o.y-t.eventOffsetTop,x:o.x},l),y=(0,lr.eventTimes)(u,d,t.props.localizer),C=y.duration,v=t.props.localizer.add(p,C,"milliseconds");t.update(u,f.getRange(p,v,!1,!0))},t.handleDropFromOutside=function(o,l){var u=t.props,m=u.slotMetrics,d=u.resource,f=m.closestSlotFromPoint({y:o.y,x:o.x},l),p=t._calculateDnDEnd(f);t.context.draggable.onDropFromOutside({start:f,end:p,allDay:!1,resource:d}),t.reset()},t.handleDragOverFromOutside=function(o,l){var u=t.props.slotMetrics,m=u.closestSlotFromPoint({y:o.y,x:o.x},l),d=t._calculateDnDEnd(m),f=t.context.draggable.dragFromOutsideItem();t.update(f,u.getRange(m,d,!1,!0))},t._calculateDnDEnd=function(o){var l=t.props,u=l.accessors,m=l.slotMetrics,d=l.localizer,f=t.context.draggable.dragFromOutsideItem(),p=(0,lr.eventTimes)(f,u,d),y=p.duration,C=m.nextSlot(o),v=!isNaN(y);if(v){var w=d.add(o,y,"milliseconds");C=new Date(Math.max(w,C))}return C},t.updateParentScroll=function(o,l){setTimeout(function(){var u=(0,yS.default)(l,".rbc-addons-dnd-drag-preview")[0];u&&(u.offsetTop<o.scrollTop?(0,Om.scrollTop)(o,Math.max(u.offsetTop,0)):u.offsetTop+u.offsetHeight>o.scrollTop+o.clientHeight&&(0,Om.scrollTop)(o,Math.min(u.offsetTop-o.offsetHeight+u.offsetHeight,o.scrollHeight)))})},t._selectable=function(){var o=t.ref.current,l=o.children[0],u=!1,m=t._selector=new Tr.default(function(){return o.closest(".rbc-time-view")}),d=(0,Om.scrollParent)(o);m.on("beforeSelect",function(f){var p=t.context.draggable.dragAndDropAction;if(!p.action)return!1;if(p.action==="resize")return(0,lr.pointInColumn)((0,Tr.getBoundsForNode)(l),f);var y=(0,Tr.getEventNodeFromPoint)(l,f);if(!y)return!1;t.eventOffsetTop=f.y-(0,Tr.getBoundsForNode)(y).top}),m.on("selecting",function(f){var p=(0,Tr.getBoundsForNode)(l),y=t.context.draggable.dragAndDropAction;y.action==="move"&&(t.updateParentScroll(d,l),t.handleMove(f,p)),y.action==="resize"&&(t.updateParentScroll(d,l),t.handleResize(f,p))}),m.on("dropFromOutside",function(f){if(t.context.draggable.onDropFromOutside){var p=(0,Tr.getBoundsForNode)(l);(0,lr.pointInColumn)(p,f)&&t.handleDropFromOutside(f,p)}}),m.on("dragOverFromOutside",function(f){var p=t.context.draggable.dragFromOutsideItem?t.context.draggable.dragFromOutsideItem():null;if(p){var y=(0,Tr.getBoundsForNode)(l);if(!(0,lr.pointInColumn)(y,f))return t.reset();t.handleDragOverFromOutside(f,y)}}),m.on("selectStart",function(){u=!0,t.context.draggable.onStart()}),m.on("select",function(f){var p=(0,Tr.getBoundsForNode)(l);u=!1;var y=t.context.draggable.dragAndDropAction;if(y.action==="resize")t.handleInteractionEnd();else{if(!t.state.event||!(0,lr.pointInColumn)(p,f))return;t.handleInteractionEnd()}}),m.on("click",function(){u&&t.reset(),t.context.draggable.onEnd(null)}),m.on("reset",function(){t.reset(),t.context.draggable.onEnd(null)})},t.handleInteractionEnd=function(){var o=t.props.resource,l=t.state.event;t.reset(),t.context.draggable.onEnd({start:l.start,end:l.end,resourceId:o})},t._teardownSelectable=function(){t._selector&&(t._selector.teardown(),t._selector=null)},t.state={},t.ref=yi.default.createRef(),t}return(0,gS.default)(e,n),(0,pS.default)(e,[{key:"componentDidMount",value:function(){this._selectable()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable()}},{key:"reset",value:function(){this.state.event&&this.setState({event:null,top:null,height:null})}},{key:"update",value:function(s,r){var i=r.startDate,o=r.endDate,l=r.top,u=r.height,m=this.state.event;m&&i===m.start&&o===m.end||this.setState({top:l,height:u,event:(0,Sr.default)((0,Sr.default)({},s),{},{start:i,end:o})})}},{key:"handleResize",value:function(s,r){var i=this.props,o=i.accessors,l=i.slotMetrics,u=i.localizer,m=this.context.draggable.dragAndDropAction,d=m.event,f=m.direction,p=l.closestSlotFromPoint(s,r),y=(0,lr.eventTimes)(d,o,u),C=y.start,v=y.end,w;if(f==="UP"){var R=u.min(p,l.closestSlotFromDate(v,-1));w=l.getRange(R,v),w=(0,Sr.default)((0,Sr.default)({},w),{},{endDate:v})}else if(f==="DOWN"){var I=u.max(p,l.closestSlotFromDate(C));w=l.getRange(C,I),w=(0,Sr.default)((0,Sr.default)({},w),{},{startDate:C})}this.update(d,w)}},{key:"renderContent",value:function(){var s=this.props,r=s.children,i=s.accessors,o=s.components,l=s.getters,u=s.slotMetrics,m=s.localizer,d=this.state,f=d.event,p=d.top,y=d.height;if(!f)return r;var C=r.props.children,v=f.start,w=f.end,R,I="eventTimeRangeFormat",F=u.startsBeforeDay(v),re=u.startsAfterDay(w);return F?I="eventTimeRangeEndFormat":re&&(I="eventTimeRangeStartFormat"),F&&re?R=m.messages.allDay:R=m.format({start:v,end:w},I),yi.default.cloneElement(r,{children:yi.default.createElement(yi.default.Fragment,null,C,f&&yi.default.createElement(NS.default,{event:f,label:R,className:"rbc-addons-dnd-drag-preview",style:{top:p,height:y,width:100},getters:l,components:o,accessors:(0,Sr.default)((0,Sr.default)({},i),lr.dragAccessors),continuesPrior:F,continuesAfter:re}))})}},{key:"render",value:function(){return yi.default.createElement("div",{ref:this.ref},this.renderContent())}}])}(yi.default.Component);Dv.contextType=bS.DnDContext;em.default=Dv;var sm={},kv={exports:{}},Ev={exports:{}},Av={exports:{}};(function(n){function e(t,s){(s==null||s>t.length)&&(s=t.length);for(var r=0,i=Array(s);r<s;r++)i[r]=t[r];return i}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Av);var wv=Av.exports;(function(n){var e=wv;function t(s){if(Array.isArray(s))return e(s)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Ev);var xS=Ev.exports,Vv={exports:{}};(function(n){function e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Vv);var vS=Vv.exports,Cv={exports:{}};(function(n){var e=wv;function t(s,r){if(s){if(typeof s=="string")return e(s,r);var i={}.toString.call(s).slice(8,-1);return i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set"?Array.from(s):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(s,r):void 0}}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(Cv);var _S=Cv.exports,Iv={exports:{}};(function(n){function e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(Iv);var DS=Iv.exports;(function(n){var e=xS,t=vS,s=_S,r=DS;function i(o){return e(o)||t(o)||s(o)||r()}n.exports=i,n.exports.__esModule=!0,n.exports.default=n.exports})(kv);var Sv=kv.exports,rm={},im={},om={},ci=ns.default;Object.defineProperty(om,"__esModule",{value:!0});om.default=void 0;var vy=ci(ai),kS=ci(_p),ES=ci(Ki),AS=ci(Gi),wS=ci(ua),VS=ci(ma),Ua=ci(E),CS=ci(zl),IS=["style","className","event","selected","isAllDay","onSelect","onDoubleClick","onKeyPress","localizer","continuesPrior","continuesAfter","accessors","getters","children","components","slotStart","slotEnd"],SS=function(n){function e(){return(0,ES.default)(this,e),(0,wS.default)(this,e,arguments)}return(0,VS.default)(e,n),(0,AS.default)(e,[{key:"render",value:function(){var s=this.props,r=s.style,i=s.className,o=s.event,l=s.selected,u=s.isAllDay,m=s.onSelect,d=s.onDoubleClick,f=s.onKeyPress,p=s.localizer,y=s.continuesPrior,C=s.continuesAfter,v=s.accessors,w=s.getters,R=s.children,I=s.components,F=I.event,re=I.eventWrapper,ee=s.slotStart,M=s.slotEnd,A=(0,kS.default)(s,IS);delete A.resizable;var N=v.title(o),V=v.tooltip(o),j=v.end(o),T=v.start(o),S=v.allDay(o),k=u||S||p.diff(T,p.ceil(j,"day"),"day")>1,Ee=w.eventProp(o,T,j,l),$e=Ua.default.createElement("div",{className:"rbc-event-content",title:V||void 0},F?Ua.default.createElement(F,{event:o,continuesPrior:y,continuesAfter:C,title:N,isAllDay:S,localizer:p,slotStart:ee,slotEnd:M}):N);return Ua.default.createElement(re,Object.assign({},this.props,{type:"date"}),Ua.default.createElement("div",Object.assign({},A,{style:(0,vy.default)((0,vy.default)({},Ee.style),r),className:(0,CS.default)("rbc-event",i,Ee.className,{"rbc-selected":l,"rbc-event-allday":k,"rbc-event-continues-prior":y,"rbc-event-continues-after":C}),onClick:function(He){return m&&m(o,He)},onDoubleClick:function(He){return d&&d(o,He)},onKeyDown:function(He){return f&&f(o,He)}}),typeof R=="function"?R($e):$e))}}])}(Ua.default.Component);om.default=SS;var ui={},TS=ns.default;Object.defineProperty(ui,"__esModule",{value:!0});ui.dateCellSelection=RS;ui.getSlotAtX=Tv;ui.isSelected=LS;ui.pointInBox=jS;ui.slotWidth=Ap;var PS=TS(__);function LS(n,e){return!n||e==null?!1:(0,PS.default)(n,e)}function Ap(n,e){var t=n.right-n.left,s=t/e;return s}function Tv(n,e,t,s){var r=Ap(n,s);return t?s-1-Math.floor((e-n.left)/r):Math.floor((e-n.left)/r)}function jS(n,e){var t=e.x,s=e.y;return s>=n.top&&s<=n.bottom&&t>=n.left&&t<=n.right}function RS(n,e,t,s,r){var i=-1,o=-1,l=s-1,u=Ap(e,s),m=Tv(e,t.x,r,s),d=e.top<t.y&&e.bottom>t.y,f=e.top<n.y&&e.bottom>n.y,p=n.y>e.bottom,y=e.top>n.y,C=t.top<e.top&&t.bottom>e.bottom;return C&&(i=0,o=l),d&&(y?(i=0,o=m):p&&(i=m,o=l)),f&&(i=o=r?l-Math.floor((n.x-e.left)/u):Math.floor((n.x-e.left)/u),d?m<i?i=m:o=m:n.y<t.y?o=l:i=0),{startIdx:i,endIdx:o}}var wp=ns.default;Object.defineProperty(im,"__esModule",{value:!0});im.default=void 0;var $s=wp(Py),_y=wp(E),BS=wp(om),US=ui;im.default={propTypes:{slotMetrics:$s.default.object.isRequired,selected:$s.default.object,isAllDay:$s.default.bool,accessors:$s.default.object.isRequired,localizer:$s.default.object.isRequired,components:$s.default.object.isRequired,getters:$s.default.object.isRequired,onSelect:$s.default.func,onDoubleClick:$s.default.func,onKeyPress:$s.default.func},defaultProps:{segments:[],selected:{}},renderEvent:function(e,t){var s=e.selected;e.isAllDay;var r=e.accessors,i=e.getters,o=e.onSelect,l=e.onDoubleClick,u=e.onKeyPress,m=e.localizer,d=e.slotMetrics,f=e.components,p=e.resizable,y=d.continuesPrior(t),C=d.continuesAfter(t);return _y.default.createElement(BS.default,{event:t,getters:i,localizer:m,accessors:r,components:f,onSelect:o,onDoubleClick:l,onKeyPress:u,continuesPrior:y,continuesAfter:C,slotStart:d.first,slotEnd:d.last,selected:(0,US.isSelected)(t,s),resizable:p})},renderSpan:function(e,t,s){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:" ",i=Math.abs(t)/e*100+"%";return _y.default.createElement("div",{key:s,className:"rbc-row-segment",style:{WebkitFlexBasis:i,flexBasis:i,maxWidth:i}},r)}};var mi=ns.default;Object.defineProperty(rm,"__esModule",{value:!0});rm.default=void 0;var HS=mi(ai),MS=mi(Ki),FS=mi(Gi),OS=mi(ua),qS=mi(ma),$S=mi(zl),Dy=mi(E),qc=mi(im),Pv=function(n){function e(){return(0,MS.default)(this,e),(0,OS.default)(this,e,arguments)}return(0,qS.default)(e,n),(0,FS.default)(e,[{key:"render",value:function(){var s=this,r=this.props,i=r.segments,o=r.slotMetrics.slots,l=r.className,u=1;return Dy.default.createElement("div",{className:(0,$S.default)(l,"rbc-row")},i.reduce(function(m,d,f){var p=d.event,y=d.left,C=d.right,v=d.span,w="_lvl_"+f,R=y-u,I=qc.default.renderEvent(s.props,p);return R&&m.push(qc.default.renderSpan(o,R,"".concat(w,"_gap"))),m.push(qc.default.renderSpan(o,v,w,I)),u=C+1,m},[]))}}])}(Dy.default.Component);Pv.defaultProps=(0,HS.default)({},qc.default.defaultProps);rm.default=Pv;var xr={},Lv=ns.default;Object.defineProperty(xr,"__esModule",{value:!0});xr.endOfRange=jv;xr.eventLevels=KS;xr.eventSegments=WS;xr.inRange=GS;xr.segsOverlap=Rv;xr.sortEvents=$d;xr.sortWeekEvents=QS;var qm=Lv(Sv),zS=Lv(D_);function jv(n){var e=n.dateRange,t=n.unit,s=t===void 0?"day":t,r=n.localizer;return{first:e[0],last:r.add(e[e.length-1],1,s)}}function WS(n,e,t,s){var r=jv({dateRange:e,localizer:s}),i=r.first,o=r.last,l=s.diff(i,o,"day"),u=s.max(s.startOf(t.start(n),"day"),i),m=s.min(s.ceil(t.end(n),"day"),o),d=(0,zS.default)(e,function(p){return s.isSameDate(p,u)}),f=s.diff(u,m,"day");return f=Math.min(f,l),f=Math.max(f-s.segmentOffset,1),{event:n,span:f,left:d+1,right:Math.max(d+f,1)}}function KS(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1/0,t,s,r,i=[],o=[];for(t=0;t<n.length;t++){for(r=n[t],s=0;s<i.length&&Rv(r,i[s]);s++);s>=e?o.push(r):(i[s]||(i[s]=[])).push(r)}for(t=0;t<i.length;t++)i[t].sort(function(l,u){return l.left-u.left});return{levels:i,extra:o}}function GS(n,e,t,s,r){var i={start:s.start(n),end:s.end(n)},o={start:e,end:t};return r.inEventRange({event:i,range:o})}function Rv(n,e){return e.some(function(t){return t.left<=n.right&&t.right>=n.left})}function QS(n,e,t){var s=(0,qm.default)(n),r=[],i=[];s.forEach(function(u){var m=e.start(u),d=e.end(u);t.daySpan(m,d)>1?r.push(u):i.push(u)});var o=r.sort(function(u,m){return $d(u,m,e,t)}),l=i.sort(function(u,m){return $d(u,m,e,t)});return[].concat((0,qm.default)(o),(0,qm.default)(l))}function $d(n,e,t,s){var r={start:t.start(n),end:t.end(n),allDay:t.allDay(n)},i={start:t.start(e),end:t.end(e),allDay:t.allDay(e)};return s.sortEvents({evtA:r,evtB:i})}var YS=ev.default,di=ns.default;Object.defineProperty(sm,"__esModule",{value:!0});sm.default=void 0;var bc=di(ai),XS=di(Sv),JS=di(Ki),ZS=di(Gi),eT=di(ua),tT=di(ma),Nc=di(E),nT=di(rm),_o=YS(Hs),sT=xr,Pr=ui,xc=Nr,rT=Qi,Bv=function(n){function e(){var t;(0,JS.default)(this,e);for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return t=(0,eT.default)(this,e,[].concat(r)),t.handleMove=function(o,l,u){if(!(0,Pr.pointInBox)(l,o))return t.reset();var m=t.context.draggable.dragAndDropAction.event||u,d=t.props,f=d.accessors,p=d.slotMetrics,y=d.rtl,C=d.localizer,v=(0,Pr.getSlotAtX)(l,o.x,y,p.slots),w=p.getDateForSlot(v),R=(0,xc.eventTimes)(m,f,C),I=R.start,F=R.duration;I=C.merge(w,I);var re=C.add(I,F,"milliseconds");t.update(m,I,re)},t.handleDropFromOutside=function(o,l){if(t.context.draggable.onDropFromOutside){var u=t.props,m=u.slotMetrics,d=u.rtl,f=u.localizer,p=(0,Pr.getSlotAtX)(l,o.x,d,m.slots),y=m.getDateForSlot(p);t.context.draggable.onDropFromOutside({start:y,end:f.add(y,1,"day"),allDay:!1})}},t.handleDragOverFromOutside=function(o,l){var u=t.context.draggable.dragFromOutsideItem?t.context.draggable.dragFromOutsideItem():null;u&&t.handleMove(o,l,u)},t._selectable=function(){var o=t.ref.current.closest(".rbc-month-row, .rbc-allday-cell"),l=o.closest(".rbc-month-view, .rbc-time-view"),u=o.classList.contains("rbc-month-row"),m=t._selector=new _o.default(function(){return l},{validContainers:(0,XS.default)(u?[]:[".rbc-day-slot",".rbc-allday-cell"])});m.on("beforeSelect",function(d){var f=t.props.isAllDay,p=t.context.draggable.dragAndDropAction.action,y=(0,_o.getBoundsForNode)(o),C=(0,Pr.pointInBox)(y,d);return p==="move"||p==="resize"&&(!f||C)}),m.on("selecting",function(d){var f=(0,_o.getBoundsForNode)(o),p=t.context.draggable.dragAndDropAction;p.action==="move"&&t.handleMove(d,f),p.action==="resize"&&t.handleResize(d,f)}),m.on("selectStart",function(){return t.context.draggable.onStart()}),m.on("select",function(d){var f=(0,_o.getBoundsForNode)(o);t.state.segment&&((0,Pr.pointInBox)(f,d)?t.handleInteractionEnd():t.reset())}),m.on("dropFromOutside",function(d){if(t.context.draggable.onDropFromOutside){var f=(0,_o.getBoundsForNode)(o);(0,Pr.pointInBox)(f,d)&&t.handleDropFromOutside(d,f)}}),m.on("dragOverFromOutside",function(d){if(t.context.draggable.dragFromOutsideItem){var f=(0,_o.getBoundsForNode)(o);t.handleDragOverFromOutside(d,f)}}),m.on("click",function(){return t.context.draggable.onEnd(null)}),m.on("reset",function(){t.reset(),t.context.draggable.onEnd(null)})},t.handleInteractionEnd=function(){var o=t.props,l=o.resourceId,u=o.isAllDay,m=t.state.segment.event;t.reset(),t.context.draggable.onEnd({start:m.start,end:m.end,resourceId:l,isAllDay:u})},t._teardownSelectable=function(){t._selector&&(t._selector.teardown(),t._selector=null)},t.state={},t.ref=Nc.default.createRef(),t}return(0,tT.default)(e,n),(0,ZS.default)(e,[{key:"componentDidMount",value:function(){this._selectable()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable()}},{key:"reset",value:function(){this.state.segment&&this.setState({segment:null})}},{key:"update",value:function(s,r,i){var o=(0,sT.eventSegments)((0,bc.default)((0,bc.default)({},s),{},{end:i,start:r,__isPreview:!0}),this.props.slotMetrics.range,xc.dragAccessors,this.props.localizer),l=this.state.segment;l&&o.span===l.span&&o.left===l.left&&o.right===l.right||this.setState({segment:o})}},{key:"handleResize",value:function(s,r){var i=this.context.draggable.dragAndDropAction,o=i.event,l=i.direction,u=this.props,m=u.accessors,d=u.slotMetrics,f=u.rtl,p=u.localizer,y=(0,xc.eventTimes)(o,m,p),C=y.start,v=y.end,w=(0,Pr.getSlotAtX)(r,s.x,f,d.slots),R=d.getDateForSlot(w),I=(0,Pr.pointInBox)(r,s);if(l==="RIGHT"){if(I){if(d.last<C)return this.reset();p.eq(p.startOf(v,"day"),v)?v=p.add(R,1,"day"):v=R}else if(p.inRange(C,d.first,d.last)||r.bottom<s.y&&+d.first>+C)v=p.add(d.last,1,"milliseconds");else{this.setState({segment:null});return}var F=m.end(o);v=p.merge(v,F),p.lt(v,C)&&(v=F)}else if(l==="LEFT"){if(I){if(d.first>v)return this.reset();C=R}else if(p.inRange(v,d.first,d.last)||r.top>s.y&&p.lt(d.last,v))C=p.add(d.first,-1,"milliseconds");else{this.reset();return}var re=m.start(o);C=p.merge(C,re),p.gt(C,v)&&(C=re)}this.update(o,C,v)}},{key:"render",value:function(){var s=this.props,r=s.children,i=s.accessors,o=this.state.segment;return Nc.default.createElement("div",{ref:this.ref,className:"rbc-addons-dnd-row-body"},r,o&&Nc.default.createElement(nT.default,Object.assign({},this.props,{selected:null,className:"rbc-addons-dnd-drag-row",segments:[o],accessors:(0,bc.default)((0,bc.default)({},i),xc.dragAccessors)})))}}])}(Nc.default.Component);Bv.contextType=rT.DnDContext;sm.default=Bv;var Ms=ns.default;Object.defineProperty(vp,"__esModule",{value:!0});vp.default=yT;var vc=Ms(ai),iT=Ms(_p),oT=Ms(Ki),aT=Ms(Gi),lT=Ms(ua),cT=Ms(ma),$m=Ms(E),uT=Ms(zl),mT=Ms(Zu),dT=Ms(em),fT=Ms(sm),pT=Nr,hT=Qi,gT=["selectable","elementProps","components"];function yT(n){var e=function(t){function s(){var r;(0,oT.default)(this,s);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return r=(0,lT.default)(this,s,[].concat(o)),r.defaultOnDragOver=function(u){u.preventDefault()},r.handleBeginAction=function(u,m,d){r.setState({event:u,action:m,direction:d});var f=r.props.onDragStart;f&&f({event:u,action:m,direction:d})},r.handleInteractionStart=function(){r.state.interacting===!1&&r.setState({interacting:!0})},r.handleInteractionEnd=function(u){var m=r.state,d=m.action,f=m.event;if(d&&(r.setState({action:null,event:null,interacting:!1,direction:null}),u!=null)){u.event=f;var p=r.props,y=p.onEventDrop,C=p.onEventResize;d==="move"&&y&&y(u),d==="resize"&&C&&C(u)}},r.state={interacting:!1},r}return(0,cT.default)(s,t),(0,aT.default)(s,[{key:"getDnDContextValue",value:function(){return{draggable:{onStart:this.handleInteractionStart,onEnd:this.handleInteractionEnd,onBeginAction:this.handleBeginAction,onDropFromOutside:this.props.onDropFromOutside,dragFromOutsideItem:this.props.dragFromOutsideItem,draggableAccessor:this.props.draggableAccessor,resizableAccessor:this.props.resizableAccessor,dragAndDropAction:this.state}}}},{key:"render",value:function(){var i=this.props,o=i.selectable,l=i.elementProps,u=i.components,m=(0,iT.default)(i,gT),d=this.state.interacting;delete m.onEventDrop,delete m.onEventResize,m.selectable=o?"ignoreEvents":!1,this.components=(0,pT.mergeComponents)(u,{eventWrapper:mT.default,eventContainerWrapper:dT.default,weekWrapper:fT.default});var f=this.props.onDropFromOutside?(0,vc.default)((0,vc.default)({},l),{},{onDragOver:this.props.onDragOver||this.defaultOnDragOver}):l;m.className=(0,uT.default)(m.className,"rbc-addons-dnd",!!d&&"rbc-addons-dnd-is-dragging");var p=this.getDnDContextValue();return $m.default.createElement(hT.DnDContext.Provider,{value:p},$m.default.createElement(n,Object.assign({},m,{elementProps:f,components:this.components})))}}])}($m.default.Component);return e.defaultProps=(0,vc.default)((0,vc.default)({},n.defaultProps),{},{draggableAccessor:null,resizableAccessor:null,resizable:!0}),e}var bT=ns.default;Object.defineProperty(xp,"__esModule",{value:!0});var Uv=xp.default=void 0,NT=bT(vp);Uv=xp.default=NT.default;const jr={async getAllProcesses(){try{const n=Ge(ae,"processes"),e=_t(n,en("order","asc")),t=await It(e);return t.empty?this.getDefaultProcesses():t.docs.map(s=>{const r=s.data();return{id:parseInt(s.id)||0,name:r.name||"",order:r.order||0,isDefault:r.isDefault||!1,createdAt:r.createdAt,updatedAt:r.updatedAt}})}catch(n){return console.error("[Firestore]    :",n),this.getDefaultProcesses()}},getDefaultProcesses(){return["","","","","","","","","","","","","","","",""].map((e,t)=>({id:t+1,name:e,order:t,isDefault:!0}))},async createProcess(n,e){try{const t=Ge(ae,"processes"),s=await It(t);let r=0;s.docs.forEach(u=>{const m=parseInt(u.id);!isNaN(m)&&m>r&&(r=m)});const i=r+1,o=Te(ae,"processes",String(i)),l=new Date().toISOString();return await qi(o,{name:n,order:e,isDefault:!1,createdAt:l,updatedAt:pn()}),console.log(" [Firestore]   :",i),{id:i,name:n,order:e,isDefault:!1,createdAt:l}}catch(t){throw console.error("[Firestore]   :",t),new Error(`  : ${t.message||"   "}`)}},async updateProcess(n,e){try{const t=Te(ae,"processes",String(n)),s=await Rt(t);if(!s.exists())throw new Error("   .");const r=s.data(),i={updatedAt:pn()};return e.name!==void 0&&(i.name=e.name),e.order!==void 0&&(i.order=e.order),await Ot(t,i),console.log(" [Firestore]   :",n),{id:n,name:e.name??r.name,order:e.order??r.order,isDefault:r.isDefault}}catch(t){throw console.error("[Firestore]   :",t),new Error(`  : ${t.message||"   "}`)}},async deleteProcess(n){try{const e=Te(ae,"processes",String(n));await Kn(e),console.log(" [Firestore]   :",n)}catch(e){throw console.error("[Firestore]   :",e),new Error(`  : ${e.message||"   "}`)}},async reorderProcesses(n){try{const e=n.map((t,s)=>{const r=Te(ae,"processes",String(t));return Ot(r,{order:s,updatedAt:pn()})});await Promise.all(e),console.log(" [Firestore]    ")}catch(e){throw console.error("[Firestore]    :",e),new Error(`  : ${e.message||"   "}`)}},subscribeToProcesses(n){const e=Ge(ae,"processes"),t=_t(e,en("order","asc"));return _s(t,r=>{if(r.empty){n(jr.getDefaultProcesses());return}const i=r.docs.map(o=>{const l=o.data();return{id:parseInt(o.id)||0,name:l.name||"",order:l.order||0,isDefault:l.isDefault||!1}});n(i)})}},xT={getAllProcesses:()=>jr.getAllProcesses(),createProcess:(n,e)=>jr.createProcess(n,e),updateProcess:(n,e)=>jr.updateProcess(n,e),deleteProcess:n=>jr.deleteProcess(n),reorderProcesses:n=>jr.reorderProcesses(n),subscribeToProcesses:jr.subscribeToProcesses,getDefaultProcesses:jr.getDefaultProcesses},vT=Uv(k_),_T=t2;ct.updateLocale("ko",{months:["1","2","3","4","5","6","7","8","9","10","11","12"],monthsShort:["1","2","3","4","5","6","7","8","9","10","11","12"],weekdays:["","","","","","",""],weekdaysShort:["","","","","","",""],weekdaysMin:["","","","","","",""],longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY MMMM D",LLL:"YYYY MMMM D A h:mm",LLLL:"YYYY MMMM D dddd A h:mm"},meridiem:n=>n<12?"":"",week:{dow:0,doy:1}});ct.locale("ko");const DT=E_(ct),ky=["#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6","#F3F4F6"],kT=mt.memo(({onSave:n,onCancel:e,processList:t})=>{const[s,r]=E.useState(""),i=()=>{const m=window.innerWidth,d=window.innerHeight;return m>=768&&m<1024||m>=1024&&d>m},[o,l]=E.useState(i);E.useEffect(()=>{const m=()=>l(i());return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]);const u=o?"16px":"18px";return a.jsxDEV("div",{className:"w-full",onClick:m=>m.stopPropagation(),style:{padding:o?"2px 3px":"6px 0",minHeight:o?"28px":"32px"},children:[a.jsxDEV("input",{type:"text",list:"process-suggestions",value:s,onChange:m=>r(m.target.value),onBlur:()=>{s.trim()?n(s.trim()):e()},onKeyDown:m=>{m.stopPropagation(),m.key==="Enter"?s.trim()?n(s.trim()):e():m.key==="Escape"&&e()},onClick:m=>m.stopPropagation(),placeholder:"",className:"w-full bg-transparent border-none outline-none focus:outline-none focus:ring-0",autoFocus:!0,style:{fontSize:u,fontWeight:500,color:"#374151",padding:0,margin:0,lineHeight:"1.3",caretColor:"#374151"}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:133,columnNumber:7},void 0),t&&a.jsxDEV("datalist",{id:"process-suggestions",children:t.map(m=>a.jsxDEV("option",{value:m},m,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:174,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:172,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:128,columnNumber:5},void 0)}),Ey=n=>n,ll={"2025-01-01":"","2025-01-28":" ","2025-01-29":"","2025-01-30":" ","2025-03-01":"","2025-03-03":"","2025-05-05":"","2025-05-06":"","2025-06-06":"","2025-08-15":"","2025-10-03":"","2025-10-05":" ","2025-10-06":"","2025-10-07":" ","2025-10-08":"","2025-10-09":"","2025-12-25":"","2026-01-01":"","2026-02-16":" ","2026-02-17":"","2026-02-18":" ","2026-03-01":"","2026-03-02":"","2026-05-05":"","2026-05-24":"","2026-06-06":"","2026-08-15":"","2026-08-17":"","2026-09-24":" ","2026-09-25":"","2026-09-26":" ","2026-10-03":"","2026-10-05":"","2026-10-09":"","2026-12-25":""},ET=mt.memo(({date:n,label:e,filteredEvents:t,selectedDate:s,user:r,isMobileView:i})=>{const o=ct(n).format("YYYY-MM-DD"),l=ll[o],u=!!ll[o],m=s&&ct(n).isSame(s,"day"),d=t.filter(M=>ct(M.start).isSame(n,"day")),f=d.length,p=d.filter(M=>M.assignedTo&&M.assignedTo.includes((r==null?void 0:r.name)||"")).length,y=f-p,C=e.replace(/^0/,""),v=n.getDay()===0,w=n.getDay()===6;let R="#000000";u||v?R="#dc2626":w&&(R="#3b82f6");const I=ct(n).isSame(ct(),"day");let F="#d1d5db";u||v?F="#fecaca":w&&(F="#bfdbfe");const re=C.length===2,ee=i?{backgroundColor:"transparent",color:R,borderRadius:"50%",width:"30px",height:"30px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontWeight:I?"700":"400",border:m?"1px solid #1f2937":"1px solid transparent",boxSizing:"border-box",gap:"1px"}:{color:R,fontWeight:I?"700":"400",paddingLeft:re?"0px":"4px",...I&&{backgroundColor:F,borderRadius:"50%",width:"21px",height:"21px",display:"inline-flex",alignItems:"center",justifyContent:"center",paddingLeft:"0px"}};return a.jsxDEV("div",{className:i?"flex flex-col items-center":"flex items-center gap-2",style:{overflow:"visible",position:"relative",zIndex:10},children:i?a.jsxDEV("span",{style:ee,children:[a.jsxDEV("span",{style:{fontSize:"13px",lineHeight:"1"},children:C},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:335,columnNumber:11},void 0),f>0&&a.jsxDEV("div",{className:"flex gap-0.5",style:{minHeight:"4px",marginTop:"1px"},children:[Array.from({length:p}).map((M,A)=>a.jsxDEV("div",{style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#66BB6A",flexShrink:0}},`user-${A}`,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:341,columnNumber:17},void 0)),Array.from({length:y}).map((M,A)=>a.jsxDEV("div",{style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#757575",flexShrink:0}},`other-${A}`,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:354,columnNumber:17},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:338,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:334,columnNumber:9},void 0):a.jsxDEV(a.Fragment,{children:[a.jsxDEV("span",{style:ee,children:C},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:371,columnNumber:11},void 0),l&&a.jsxDEV("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:l},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:373,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:370,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:328,columnNumber:5},void 0)}),AT=mt.memo(({event:n,user:e,filterProject:t,isEditing:s,editTitle:r,onEditTitleChange:i,onEditSave:o,onEditDelete:l,onEditCancel:u,onHoverDelete:m,onDeleteAction:d,processList:f})=>{const p=t&&t!=="all",y=n.assignedTo||[],[C,v]=E.useState(!1),w=mt.useRef(null),R=()=>{const ge=window.innerWidth,He=window.innerHeight;return ge>=768&&ge<1024||ge>=1024&&He>ge},[I,F]=E.useState(R),[re,ee]=E.useState(!1);mt.useRef(null),mt.useRef(!1);const[M,A]=E.useState(r||""),N=mt.useRef(s);E.useEffect(()=>{s&&!N.current&&r!==void 0&&A(r),N.current=s},[s,r]);const V=e!=null&&e.name?e.name.slice(-2):null,j=V&&["",""].includes(V),T=V&&["","",""].includes(V),S=(e==null?void 0:e.name)&&(y.includes(e.name)||y.includes("HV LAB")||y.includes("")&&T||y.includes("")&&j);E.useEffect(()=>{const ge=()=>{F(R())};return window.addEventListener("resize",ge),()=>window.removeEventListener("resize",ge)},[]);const k=ge=>{A(ge)},Ee=()=>{M!=null&&M.trim()&&o&&(i&&i(M),o()),u&&u()},$e=ge=>{ge.stopPropagation(),(ge.key==="Enter"||ge.key==="Escape")&&ge.currentTarget.blur()};return I?a.jsxDEV("div",{className:"w-full relative block",onMouseEnter:()=>{ee(!0),v(!0)},onMouseLeave:()=>{ee(!1),v(!1)},style:{padding:p?"2px 3px":"1px 3px",minHeight:p?"28px":"30px",display:"flex",flexDirection:"column",justifyContent:"flex-start"},children:[C&&p&&m&&!n.isASVisit&&!n.isExpectedPayment&&a.jsxDEV("div",{className:"absolute top-0 right-0 z-20",style:{padding:"4px"},children:a.jsxDEV("button",{ref:w,onMouseDown:ge=>{ge.stopPropagation(),ge.preventDefault(),d&&d(),m()},className:"p-1 text-gray-500 hover:text-red-500",style:{fontSize:"14px",lineHeight:1},title:" (Ctrl+Z )",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:512,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:511,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex items-center justify-between w-full",style:{fontSize:p?"13px":"10px",opacity:.8,marginBottom:"1px",lineHeight:"1.2"},children:[!p&&!n.isASVisit&&n.projectName?a.jsxDEV("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%",flexShrink:0},children:["[",Ey(n.projectName),"]"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:533,columnNumber:13},void 0):a.jsxDEV("span",{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:543,columnNumber:13},void 0),!p&&y.length>0&&a.jsxDEV("span",{style:{flexShrink:0,fontSize:"10px",marginLeft:"auto"},children:y.map((ge,He)=>{const ht=ge==="HV LAB"||ge===""&&j||ge===""&&T||ge===(e==null?void 0:e.name);return a.jsxDEV(mt.Fragment,{children:[a.jsxDEV("span",{style:{fontWeight:ht?"bold":"normal"},children:ge},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:554,columnNumber:21},void 0),He<y.length-1&&""]},ge,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:553,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:546,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:531,columnNumber:9},void 0),s?a.jsxDEV("input",{type:"text",list:"process-suggestions-edit",value:M,onChange:ge=>k(ge.target.value),onBlur:Ee,onKeyDown:$e,onClick:ge=>ge.stopPropagation(),autoFocus:!0,className:"w-full bg-transparent border-none outline-none",style:{fontWeight:500,fontSize:p?"16px":"11px",lineHeight:"1.3",color:"inherit",padding:0,margin:0}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:567,columnNumber:11},void 0):a.jsxDEV("div",{style:{fontWeight:500,fontSize:p?"16px":"11px",lineHeight:"1.3",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",wordBreak:"keep-all",textOverflow:"ellipsis",textDecoration:S?"underline":"none",textDecorationColor:S?"#e57373":"transparent",textDecorationThickness:"2px",textUnderlineOffset:"2px"},title:n.title,children:n.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:587,columnNumber:11},void 0),re&&a.jsxDEV("div",{className:"absolute z-50 bg-gray-900 text-white text-xs rounded p-2 shadow-lg",style:{bottom:"100%",left:"0",marginBottom:"4px",minWidth:"200px",maxWidth:"300px"},children:[a.jsxDEV("div",{className:"font-semibold mb-1",children:n.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:621,columnNumber:13},void 0),n.projectName&&a.jsxDEV("div",{className:"opacity-90",children:[": ",n.projectName]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:623,columnNumber:15},void 0),y.length>0&&a.jsxDEV("div",{className:"opacity-90 mt-1",children:[": ",y.join(", ")]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:626,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:611,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:497,columnNumber:7},void 0):a.jsxDEV("div",{className:"flex items-center justify-between w-full gap-1.5 overflow-hidden relative",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),style:{minHeight:p?"32px":"18px",padding:p?"6px 0":"0"},children:[a.jsxDEV("div",{className:"flex items-center gap-1.5 overflow-hidden flex-1",children:[!p&&!n.isASVisit&&n.projectName&&a.jsxDEV("span",{className:"text-xs opacity-70 flex-shrink-0",children:["[",Ey(n.projectName),"]"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:648,columnNumber:11},void 0),s?a.jsxDEV("input",{type:"text",list:"process-suggestions-edit",value:M,onChange:ge=>k(ge.target.value),onBlur:Ee,onKeyDown:$e,onClick:ge=>ge.stopPropagation(),autoFocus:!0,className:"font-medium bg-transparent border-none outline-none flex-1",style:{fontSize:p?"18px":"12px",color:"inherit",padding:0,margin:0,minWidth:0}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:653,columnNumber:11},void 0):a.jsxDEV("span",{className:"font-medium truncate",style:{fontSize:p?"18px":"12px",textDecoration:S?"underline":"none",textDecorationColor:S?"#e57373":"transparent",textDecorationThickness:"2px",textUnderlineOffset:"2px"},children:n.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:672,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:645,columnNumber:7},void 0),!p&&y.length>0&&a.jsxDEV("span",{className:"opacity-80 flex-shrink-0 ml-auto",style:{fontSize:"11px"},children:y.map((ge,He)=>{const ht=ge==="HV LAB"||ge===""&&j||ge===""&&T||ge===(e==null?void 0:e.name);return a.jsxDEV(mt.Fragment,{children:[a.jsxDEV("span",{className:ht?"font-bold":"",children:ge},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:699,columnNumber:17},void 0),He<y.length-1&&""]},ge,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:698,columnNumber:15},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:688,columnNumber:9},void 0),C&&p&&m&&!n.isASVisit&&!n.isExpectedPayment&&a.jsxDEV("div",{className:"absolute top-1/2 -translate-y-1/2 right-0 z-20",style:{padding:"2px"},children:a.jsxDEV("button",{ref:w,onMouseDown:ge=>{ge.stopPropagation(),ge.preventDefault(),d&&d(),m()},className:"p-1 text-gray-500 hover:text-red-500",style:{fontSize:"14px",lineHeight:1},title:" (Ctrl+Z )",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:711,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:710,columnNumber:9},void 0),f&&s&&a.jsxDEV("datalist",{id:"process-suggestions-edit",children:f.map(ge=>a.jsxDEV("option",{value:ge},ge,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:733,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:731,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:636,columnNumber:5},void 0)}),wT=()=>{const{schedules:n,setSchedules:e,addSchedule:t,deleteSchedule:s,loadSchedulesFromAPI:r,addScheduleToAPI:i,updateScheduleInAPI:o,deleteScheduleFromAPI:l,asRequests:u,updateASRequestInAPI:m,loadASRequestsFromAPI:d,constructionPayments:f,updateConstructionPaymentInAPI:p}=dr(),{user:y}=oi(),C=Ju(),[v,w]=E.useState(!1);E.useEffect(()=>{const b=()=>{const H=window.innerHeight>window.innerWidth&&window.innerWidth>=1024;w(H)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const R=b=>!b||b==="-"?"":v?b:Md(b),I=y!=null&&y.name?y.name.slice(-2):null;console.log(" Current user:",y==null?void 0:y.name,"Short name:",I);const F=mt.useRef(!1);E.useEffect(()=>{F.current||(F.current=!0,r().catch(b=>{console.error("Failed to load schedules:",b),oe.error("  ")}))},[r]);const[re,ee]=E.useState([]);E.useEffect(()=>{const b=async H=>{if((H.ctrlKey||H.metaKey)&&H.key==="z"){const Y=H.target;if(Y.tagName==="INPUT"||Y.tagName==="TEXTAREA"||Y.isContentEditable)return;if(re.length>0){H.preventDefault();const W=re[re.length-1];try{const ce=W.type==="as_visit"||W.type==="expected_payment"?"other":W.type;await i({id:"",title:W.originalTitle||W.title,start:W.start,end:W.end,type:ce,project:W.originalProjectName||W.projectName,attendees:W.assignedTo||[],time:W.time,description:W.description}),ee(Ne=>Ne.slice(0,-1)),oe.success(" ")}catch(ce){console.error("  :",ce),oe.error("  ")}}}};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[re,i]);const[M,A]=E.useState([]),[N,V]=E.useState(!1),[j,T]=E.useState(""),[S,k]=E.useState(null),[Ee,$e]=E.useState(""),[ge,He]=E.useState(!1),[ht,Kt]=E.useState(null),[qt,le]=E.useState(null),ze=E.useCallback(async()=>{He(!0);try{const b=await xT.getAllProcesses();A(b)}catch(b){console.error("   :",b),A([])}finally{He(!1)}},[]);E.useEffect(()=>{ze()},[ze]);const de=E.useMemo(()=>M.length>0?M.map(b=>b.name):_T,[M]),Be=async()=>{if(j.trim())try{const b=await fetch("/api/processes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:j.trim()})});if(b.ok)T(""),ze(),oe.success(" ");else{const H=await b.json();oe.error(H.error||"  ")}}catch(b){console.error("  :",b),oe.error("  ")}},Xe=async()=>{if(!(!S||!Ee.trim()))try{const b=await fetch(`/api/processes/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Ee.trim()})});if(b.ok)k(null),$e(""),ze(),oe.success(" ");else{const H=await b.json();oe.error(H.error||"  ")}}catch(b){console.error("  :",b),oe.error("  ")}},vt=async b=>{if(confirm("   ?"))try{const H=await fetch(`/api/processes/${b}`,{method:"DELETE"});if(H.ok)ze(),oe.success(" ");else{const Y=await H.json();oe.error(Y.error||"  ")}}catch(H){console.error("  :",H),oe.error("  ")}},lt=b=>{Kt(b)},St=(b,H)=>{b.preventDefault(),ht!==null&&ht!==H&&le(H)},at=async()=>{if(ht!==null&&qt!==null&&ht!==qt){const b=[...M],[H]=b.splice(ht,1);b.splice(qt,0,H),A(b);try{(await fetch("/api/processes/reorder/bulk",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({orders:b.map(W=>({id:W.id}))})})).ok||(ze(),oe.error("  "))}catch(Y){console.error("  :",Y),ze(),oe.error("  ")}}Kt(null),le(null)},ft=b=>{const H=C.findIndex(Y=>Y.name===b);return H>=0?ky[H%ky.length]:"#e8e2ea"},Nn=C.map(b=>b.name),K=n.filter(b=>!b.asRequestId).filter(b=>(y==null?void 0:y.name)===""?b.project===""||Nn.includes(b.project):!0).map(b=>{const H=C.find(ye=>ye.name===b.project);let Y=b.project===""?"[]":b.project;if(H&&b.project!==""){const ye=H.name.length>2?H.name.substring(0,2):H.name,gt=(H.location||"").match(/([A-Za-z]?\d+)/),kn=gt?gt[1]:"";Y=kn?`${ye}_${kn}`:ye}const W=b.time,ce=W&&W!=="-"?` - ${R(W)}`:"",Ne=b.attendees||[];return{id:b.id,title:b.title+ce,originalTitle:b.title,start:b.start,end:b.end,projectId:(H==null?void 0:H.id)||"",projectName:Y||"",originalProjectName:b.project||"",type:b.type||"other",phase:"",assignedTo:Ne,priority:"medium",allDay:!W||W==="-",color:ft(b.project||""),isASVisit:!1,time:W,description:b.description}}),Le=u.filter(b=>b.scheduledVisitDate).filter(b=>(y==null?void 0:y.name)===""?Nn.includes(b.project):!0).map(b=>{const H=b.scheduledVisitTime,Y=H&&H!=="-"?` - ${R(H)}`:"",W=C.find(ye=>ye.name===b.project);let ce=b.project;if(W){const ye=W.name.length>2?W.name.substring(0,2):W.name,gt=(W.location||"").match(/([A-Za-z]?\d+)/),kn=gt?gt[1]:"";ce=kn?`${ye}_${kn}`:ye}const Ne=`[AS] ${ce}`;return{id:`as-${b.id}`,title:Ne+Y,originalTitle:Ne,start:b.scheduledVisitDate,end:b.scheduledVisitDate,projectId:(W==null?void 0:W.id)||"",projectName:ce,originalProjectName:b.project,type:"as_visit",phase:"",assignedTo:b.assignedTo?Array.isArray(b.assignedTo)?b.assignedTo:b.assignedTo.split(",").map(ye=>ye.trim()):[],priority:"high",allDay:!H||H==="-",color:"#FEF3C7",isASVisit:!0,time:H,description:b.description}}),Fe=(y==null?void 0:y.role)==="manager"?f.flatMap(b=>{var Ne,ye,ut,gt,kn,Lt,jt,mn;const H=C.find(Pn=>Pn.name===b.project);if(!H){const Pn=[],wt=b.totalAmount+(b.vatType==="percentage"?b.totalAmount*(b.vatPercentage/100):b.vatAmount),on=new Set(b.payments.flatMap(vn=>{var Xt;return((Xt=vn.type)==null?void 0:Xt.split(", ").map(Jt=>Jt.trim()))||[]}));return!on.has("")&&((Ne=b.expectedPaymentDates)!=null&&Ne.contract)&&Pn.push({id:`payment-${b.id}-contract`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.contract),end:new Date(b.expectedPaymentDates.contract),projectId:"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (10%): ${Math.round(wt*.1).toLocaleString()}`}),!on.has("")&&((ye=b.expectedPaymentDates)!=null&&ye.start)&&Pn.push({id:`payment-${b.id}-start`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.start),end:new Date(b.expectedPaymentDates.start),projectId:"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (40%): ${Math.round(wt*.4).toLocaleString()}`}),!on.has("")&&((ut=b.expectedPaymentDates)!=null&&ut.middle)&&Pn.push({id:`payment-${b.id}-middle`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.middle),end:new Date(b.expectedPaymentDates.middle),projectId:"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (40%): ${Math.round(wt*.4).toLocaleString()}`}),!on.has("")&&((gt=b.expectedPaymentDates)!=null&&gt.final)&&Pn.push({id:`payment-${b.id}-final`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.final),end:new Date(b.expectedPaymentDates.final),projectId:"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (10%): ${Math.round(wt*.1).toLocaleString()}`}),Pn}if(!H.startDate||!H.endDate)return[];const Y=b.totalAmount+(b.vatType==="percentage"?b.totalAmount*(b.vatPercentage/100):b.vatAmount),W=new Set(b.payments.flatMap(Pn=>{var wt;return((wt=Pn.type)==null?void 0:wt.split(", ").map(on=>on.trim()))||[]})),ce=[];return!W.has("")&&((kn=b.expectedPaymentDates)!=null&&kn.contract)&&ce.push({id:`payment-${b.id}-contract`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.contract),end:new Date(b.expectedPaymentDates.contract),projectId:H.id||"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (10%): ${Math.round(Y*.1).toLocaleString()}`}),!W.has("")&&((Lt=b.expectedPaymentDates)!=null&&Lt.start)&&ce.push({id:`payment-${b.id}-start`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.start),end:new Date(b.expectedPaymentDates.start),projectId:H.id||"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (40%): ${Math.round(Y*.4).toLocaleString()}`}),!W.has("")&&((jt=b.expectedPaymentDates)!=null&&jt.middle)&&ce.push({id:`payment-${b.id}-middle`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.middle),end:new Date(b.expectedPaymentDates.middle),projectId:H.id||"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (40%): ${Math.round(Y*.4).toLocaleString()}`}),!W.has("")&&((mn=b.expectedPaymentDates)!=null&&mn.final)&&ce.push({id:`payment-${b.id}-final`,title:"[] ",originalTitle:"[] ",start:new Date(b.expectedPaymentDates.final),end:new Date(b.expectedPaymentDates.final),projectId:H.id||"",projectName:b.project,type:"expected_payment",phase:"",assignedTo:[],priority:"medium",allDay:!0,color:"#DBEAFE",isExpectedPayment:!0,description:` (10%): ${Math.round(Y*.1).toLocaleString()}`}),ce}):[],Se=[...K,...Le,...Fe],Je=E.useCallback(b=>{if(!(y!=null&&y.name))return!1;const H=b.assignedTo||[],Y=y.name.slice(-2),W=["",""].includes(Y),ce=["","",""].includes(Y);return H.includes(y.name)||H.includes("HV LAB")||H.includes("")&&ce||H.includes("")&&W},[y==null?void 0:y.name]),Tt=(b,H)=>{if(!H)return[...b].sort((ce,Ne)=>{const ye=Je(ce),ut=Je(Ne);return ye&&!ut?-1:!ye&&ut?1:ce.start.getTime()-Ne.start.getTime()});const Y=new Map;b.forEach(ce=>{const Ne=ce.time&&ce.time!=="-"&&ce.time.trim()!=="";if(ce.isASVisit||ce.isExpectedPayment||Ne){const ye=`single_${ce.id}`;Y.set(ye,[ce])}else{const ye=ce.start.toISOString().split("T")[0],ut=[...ce.assignedTo].sort().join(","),gt=`${ye}_${ce.projectName}_${ut}`;Y.has(gt)||Y.set(gt,[]),Y.get(gt).push(ce)}});const W=[];return Y.forEach(ce=>{if(ce.length===1)W.push(ce[0]);else{const Ne=ce[0],ye=ce.map(jt=>jt.originalTitle||jt.title),ut=[...new Set(ye)],gt=ce.map(jt=>{const mn=jt.originalTitle||jt.title;return mn.startsWith(Ne.projectName+" - ")?mn.substring(Ne.projectName.length+3):mn}),kn=[...new Set(gt)],Lt={...Ne,id:ce[0].id,title:kn.join(", "),originalTitle:ut.join(", "),description:ce.map(jt=>jt.description||jt.originalTitle||jt.title).join(`
`),assignedTo:[...new Set(ce.flatMap(jt=>jt.assignedTo))],mergedEventIds:ce.map(jt=>jt.id)};W.push(Lt)}}),W.sort((ce,Ne)=>{const ye=Je(ce),ut=Je(Ne);return ye&&!ut?-1:!ye&&ut?1:ce.start.getTime()-Ne.start.getTime()})},[Gt,dt]=E.useState("month"),[P,q]=E.useState(new Date),[te,ve]=E.useState(!1),[ue,fe]=E.useState(null),[Ie,We]=E.useState(null),st=`schedule_filterProject_${(y==null?void 0:y.id)||"guest"}`,[we,$n]=E.useState(()=>{const b=localStorage.getItem(st);return b||((y==null?void 0:y.name)===""&&C.length>0?C[0].name:"all")});E.useEffect(()=>{localStorage.setItem(st,we)},[we,st]),E.useCallback(()=>{document.body.classList.add("printing-schedule");const b=we==="all"?" ":we,H=ct(P).format("YYYY MM"),Y=document.title;document.title=`${b} - ${H} `,setTimeout(()=>{window.print(),document.body.classList.remove("printing-schedule"),document.title=Y},100)},[we,P]);const Ht=Tt(Se,we==="all"),[ne,Ze]=E.useState(window.innerWidth<768?new Date:null),[O,_e]=E.useState(null),ke=mt.useRef(null),je=mt.useRef(!1),[me,kt]=E.useState(null),xt=mt.useRef(!1),tn=mt.useRef(!1);E.useEffect(()=>{const b=W=>{W.key==="Control"&&(tn.current=!0)},H=W=>{W.key==="Control"&&(tn.current=!1)},Y=()=>{tn.current=!1};return window.addEventListener("keydown",b),window.addEventListener("keyup",H),window.addEventListener("blur",Y),()=>{window.removeEventListener("keydown",b),window.removeEventListener("keyup",H),window.removeEventListener("blur",Y)}},[]),E.useEffect(()=>{if(!O)return;let b=null;const H=Ne=>{Ne.preventDefault(),Ne.dataTransfer&&(Ne.dataTransfer.dropEffect="copy")},Y=Ne=>{Ne.preventDefault(),Ne.dataTransfer&&(Ne.dataTransfer.dropEffect="copy");const ut=Ne.target.closest(".rbc-day-bg");b&&b!==ut&&(b.style.backgroundColor=""),ut&&(ut.style.backgroundColor="rgba(59, 130, 246, 0.15)",b=ut)},W=()=>{b&&(b.style.backgroundColor="",b=null)},ce=Ne=>{Ne.preventDefault(),b&&(b.style.backgroundColor="",b=null)};return document.addEventListener("dragenter",H),document.addEventListener("dragover",Y),document.addEventListener("dragend",W),document.addEventListener("drop",ce),()=>{document.removeEventListener("dragenter",H),document.removeEventListener("dragover",Y),document.removeEventListener("dragend",W),document.removeEventListener("drop",ce),b&&(b.style.backgroundColor="")}},[O]);const[At,xn]=E.useState(null),[cn,Hn]=E.useState(null),[Ds,ss]=E.useState(""),[ks,fi]=E.useState(!1),[Fs,as]=E.useState(null),[_,G]=E.useState(!1),[B,x]=E.useState(""),[L,U]=E.useState(null),[X,Q]=E.useState({x:0,y:0}),[Z,ie]=E.useState({x:0,y:0}),[Ce,et]=E.useState(!1),Oe=8;E.useEffect(()=>{if(!L)return;const b=Y=>{Q({x:Y.clientX,y:Y.clientY});const W=Math.abs(Y.clientX-Z.x),ce=Math.abs(Y.clientY-Z.y);(W>Oe||ce>Oe)&&et(!0)},H=()=>{U(null),et(!1)};return window.addEventListener("mousemove",b),window.addEventListener("mouseup",H),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",H)}},[L,Z]);const he=mt.useRef(!1),Qe=E.useCallback(async({event:b,start:H,end:Y})=>{if(b.isASVisit||b.isExpectedPayment){oe.error("    ");return}const W=H instanceof Date?H:new Date(H),ce=Y instanceof Date?Y:new Date(Y);if(tn.current)try{const ye=b.mergedEventIds||[b.id],ut=n.filter(gt=>ye.includes(gt.id));for(const gt of ut)await i({id:Date.now().toString()+Math.random().toString(36).substr(2,9),title:gt.title,start:W,end:ce,project:gt.project,attendees:gt.attendees||[],time:gt.time,priority:gt.priority||"medium"});oe.success(" ")}catch(ye){console.error("  :",ye),oe.error("  ")}else{const ye=b.mergedEventIds||[b.id];try{for(const ut of ye)await o(ut,{start:W,end:ce})}catch(ut){console.error("  :",ut),oe.error("  "),r()}}},[n,o,i,r]),fn=E.useCallback(({event:b,action:H})=>{var W;if(b.isASVisit||b.isExpectedPayment||b.id==="__inline_add__")return;const Y=document.querySelectorAll(".rbc-event");for(const ce of Y)if((W=ce.textContent)!=null&&W.includes(b.originalTitle||b.title)){const Ne=ce.getBoundingClientRect();ie({x:Ne.left,y:Ne.top}),Q({x:Ne.left,y:Ne.top});break}et(!1),U(b)},[]),Qt=E.useCallback(async(b,H,Y=!1)=>{if(we==="all"){oe.error("  ");return}const W={id:"",title:b,start:H,end:H,project:we,attendees:y!=null&&y.name?[y.name]:[],type:"construction"};try{await i(W)}catch(ce){console.error("  :",ce),oe.error("  ")}},[we,i,y]),Mt=E.useCallback(({start:b})=>{const H=O||ke.current;H&&we!=="all"&&(je.current=!0,xt.current=!0,requestAnimationFrame(()=>{xt.current=!1}),xn(null),Hn(null),ss(""),Qt(H,b),requestAnimationFrame(()=>{_e(null),ke.current=null,je.current=!1}))},[O,we,Qt]),Bt=E.useCallback(()=>{const b=O||ke.current;return b?{title:b}:null},[O]),zn=E.useCallback(async b=>{if(!b.trim()||!At||we==="all"){xn(null);return}const H=At;xn(null);const Y={id:"",title:b.trim(),start:H,end:H,type:"construction",project:we,location:"",attendees:y!=null&&y.name?[y.name]:[],description:""};try{await i(Y)}catch(W){console.error("  :",W),oe.error("  ")}},[At,we,i,y]),Qn=E.useCallback(()=>{xn(null)},[]),Yt=E.useCallback(async()=>{var b;if(!cn||!Ds.trim()){Hn(null),ss("");return}try{const H=((b=cn.mergedEventIds)==null?void 0:b[0])||cn.id;await o(H,{title:Ds.trim()})}catch(H){console.error("  :",H),oe.error("  ")}Hn(null),ss("")},[cn,Ds,o]),Ye=E.useCallback(async b=>{ee(Y=>[...Y,b]);const H=b.mergedEventIds||[b.id];oe.success(" (Ctrl+Z )",{duration:2e3});try{await Promise.all(H.map(Y=>l(Y)))}catch(Y){console.error("  :",Y),oe.error("  "),ee(W=>W.slice(0,-1))}Hn(null),ss("")},[l]),Ve=we==="all"?Ht:Ht.filter(b=>(b.originalProjectName||b.projectName)===we),tt=mt.useMemo(()=>{const b=we!=="all",H=new Map;Ve.forEach(W=>{const ce=ct(W.start).format("YYYY-MM-DD");H.has(ce)||H.set(ce,[]),H.get(ce).push(W)});const Y=[];return H.forEach(W=>{if(b)W.forEach((ce,Ne)=>{const ye=ct(ce.start).startOf("day").add(Ne,"milliseconds").toDate();Y.push({...ce,start:ye,allDay:!1})});else{const ce=[],Ne=[];W.forEach(ye=>{Je(ye)?ce.push(ye):Ne.push(ye)}),ce.forEach((ye,ut)=>{const gt=ct(ye.start).startOf("day").add(ut,"milliseconds").toDate();Y.push({...ye,start:gt,allDay:!1})}),Ne.forEach((ye,ut)=>{const gt=ct(ye.start).startOf("day").add(1e3+ut,"milliseconds").toDate();Y.push({...ye,start:gt,allDay:!1})})}}),Y.sort((W,ce)=>W.start.getTime()-ce.start.getTime())},[Ve,Je,we]),rt=mt.useMemo(()=>{if(At&&we!=="all"){const b=ct(At).format("YYYY-MM-DD"),H=tt.filter(Ne=>ct(Ne.start).format("YYYY-MM-DD")===b),Y=H.length>0?Math.max(...H.map(Ne=>Ne.start.getTime())):ct(At).startOf("day").valueOf(),W=new Date(Y+1),ce={id:"__inline_add__",title:"",start:W,end:W,projectId:"",projectName:we,type:"other",phase:"",assignedTo:[],priority:"medium",allDay:!1};return[...tt,ce]}return tt},[tt,At,we]);E.useEffect(()=>{(y==null?void 0:y.name)===""&&C.length>0&&(we==="all"||!C.find(b=>b.name===we))&&$n(C[0].name)},[C,y]),E.useEffect(()=>{const b=()=>{document.querySelectorAll(".rbc-show-more, .rbc-button-link").forEach(ye=>{ye.style.display="none",ye.style.visibility="hidden",ye.style.pointerEvents="none"}),document.querySelectorAll('.rbc-overlay, .rbc-overlay-header, .rbc-popup, [class*="rbc-overlay"]').forEach(ye=>{ye.style.display="none",ye.style.visibility="hidden",ye.style.opacity="0",ye.style.pointerEvents="none",ye.style.position="absolute",ye.style.left="-9999px",ye.style.top="-9999px",ye.style.zIndex="-1"})};b();const H=new MutationObserver(b),Y=document.querySelector(".rbc-calendar");Y&&H.observe(Y,{childList:!0,subtree:!0});const W=new MutationObserver(b);return W.observe(document.body,{childList:!0,subtree:!0}),()=>{H.disconnect(),W.disconnect()}},[Gt,P]);const[it,qe]=E.useState({date:null,projectId:"",title:""}),ot=mt.useRef(!1),Pt=mt.useRef(null),un=b=>{if(he.current){he.current=!1;return}if(b.id==="__inline_add__")return;ot.current=!0,Pt.current&&clearTimeout(Pt.current);const H=we!=="all",Y=window.innerWidth<768;if(H&&!Y&&!b.isASVisit&&!b.isExpectedPayment)xn(null),Hn(b),ss(b.originalTitle||b.title);else{const W={...b,title:b.originalTitle||b.title};We(null),fe(W),ve(!0)}Pt.current=setTimeout(()=>{ot.current=!1,Pt.current=null},300)},nn=b=>{const H=window.innerWidth,Y=H<768,W=H>=768&&H<1024,ce=we==="all";if(xt.current)return;if(Y){if(b.start){Ze(b.start);const ye=document.querySelector(".md\\:hidden.mt-3.bg-white");ye&&ye.scrollIntoView({behavior:"smooth",block:"nearest"})}return}const Ne=b.action==="click"||b.action==="select";if(!(W&&!Ne)){if(ce){ot.current=!1,Hn(null),ss(""),xn(null),We(b),fe(null),ve(!0);return}if(!ot.current){if(me){Qt(me,b.start,!0);return}Hn(null),ss(""),xn(b.start)}}},Vs=async()=>{if(!it.projectId||!it.title.trim()){alert("  ");return}const b=C.find(H=>H.id===it.projectId);if(!(!b||!it.date))try{await i({id:Date.now().toString(),title:it.title,start:it.date,end:it.date,type:"other",project:b.name,location:"",attendees:[],description:""}),qe({date:null,projectId:"",title:""}),Ze(null)}catch(H){console.error("Failed to add schedule:",H),oe.error("  ")}},vr=b=>{if(b.id==="__inline_add__")return{style:{backgroundColor:"#ffffff",borderRadius:"6px",color:"#1f2937",border:"1px solid #d1d5db",display:"block",fontSize:"0.8125rem",padding:"0",fontWeight:"400",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",overflow:"visible"}};let H=b.color||"#E0E7FF",Y="#1f2937";if(b.isASVisit)H="#E8F5E9",Y="#1f2937";else{const W=b.assignedTo&&b.assignedTo.includes("HV LAB"),ce=b.assignedTo&&b.assignedTo.includes("")&&I&&["",""].includes(I),Ne=b.assignedTo&&b.assignedTo.includes("")&&I&&["","",""].includes(I);b.assignedTo&&b.assignedTo.includes((y==null?void 0:y.name)||"")||W||ce||Ne?(H="#FEF3C7",Y="#1f2937"):b.color||(H="#e8e2ea")}return{style:{backgroundColor:H,"--event-bg-color":H,borderRadius:"6px",color:Y,border:"none",display:"block",fontSize:"0.8125rem",padding:"4px 8px",fontWeight:"500",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",overflow:"hidden"}}},pa=mt.useCallback(b=>{const H=ct(b).format("YYYY-MM-DD"),Y=!!ll[H],W=ne&&ct(b).isSame(ne,"day"),ce=window.innerWidth<768;let Ne="";W&&(Ne+="selected-date "),Y&&(Ne+="holiday-date ");const ye=ce?{backgroundColor:"transparent",background:"transparent"}:{};return{className:Ne.trim(),style:ye}},[ne]),[Nt,Xi]=E.useState(window.innerWidth<768);E.useEffect(()=>{const b=()=>{Xi(window.innerWidth<768)};return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),E.useEffect(()=>{const b=()=>{const H=ne||new Date;We({start:H,end:H}),fe(null),ve(!0)};return window.addEventListener("headerAddButtonClick",b),()=>window.removeEventListener("headerAddButtonClick",b)},[ne]);const _r=mt.useCallback(({date:b,label:H})=>a.jsxDEV(ET,{date:b,label:H,filteredEvents:rt,selectedDate:ne,user:y,isMobileView:Nt},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2331,columnNumber:7},void 0),[rt,ne,y,Nt]),Dr=mt.useRef(Ds);Dr.current=Ds;const Wl=mt.useCallback(b=>{ss(b)},[]),ha=mt.useCallback(()=>{Hn(null),ss("")},[]),Kl=mt.useCallback(({event:b})=>{if(b.id==="__inline_add__")return a.jsxDEV(kT,{onSave:zn,onCancel:Qn,processList:de},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2361,columnNumber:9},void 0);const H=(cn==null?void 0:cn.id)===b.id||(cn==null?void 0:cn.mergedEventIds)&&cn.mergedEventIds.includes(b.id);return a.jsxDEV(AT,{event:b,user:y,filterProject:we,isEditing:H,editTitle:H?Dr.current:void 0,onEditTitleChange:H?Wl:void 0,onEditSave:H?Yt:void 0,onEditDelete:H?()=>Ye(b):void 0,onEditCancel:H?ha:void 0,onHoverDelete:()=>Ye(b),onDeleteAction:()=>{he.current=!0},processList:de},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2374,columnNumber:7},void 0)},[y,we,cn,Yt,Ye,zn,Qn,Wl,ha,de]),am=({onNavigate:b})=>{const[H,Y]=mt.useState(!1),[W,ce]=mt.useState(ct(P).year()),[Ne,ye]=mt.useState(ct(P).month()),ut=window.innerWidth<768,gt=()=>{ce(ct(P).year()),ye(ct(P).month()),Y(!0)},kn=()=>{q(ct().year(W).month(Ne).toDate()),Y(!1)};return a.jsxDEV(a.Fragment,{children:[a.jsxDEV("div",{className:`calendar-toolbar flex flex-col bg-white border-b border-gray-200 ${ut?"px-2 py-1":"px-3 md:px-5 py-2"}`,children:a.jsxDEV("div",{className:"flex items-center justify-between",children:[a.jsxDEV("div",{className:"flex items-center space-x-1",children:[a.jsxDEV("button",{onClick:()=>b("PREV"),className:"px-2 py-1.5 text-2xl md:text-3xl text-gray-700 hover:bg-gray-100 rounded-lg transition-colors font-bold print-hide",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2417,columnNumber:15},void 0),a.jsxDEV("div",{className:"text-base md:text-lg font-bold text-gray-900 hover:bg-gray-50 px-2 md:px-3 py-1 rounded-lg transition-colors cursor-pointer print-title",onClick:gt,children:[a.jsxDEV("span",{children:ct(P).format("YYYY MM")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2427,columnNumber:17},void 0),a.jsxDEV("span",{className:"print-project-name hidden",children:[" - ",we==="all"?" ":we]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2429,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2423,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>b("NEXT"),className:"px-2 py-1.5 text-2xl md:text-3xl text-gray-700 hover:bg-gray-100 rounded-lg transition-colors font-bold print-hide",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2431,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2416,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex items-center space-x-2",children:a.jsxDEV("select",{className:"px-3 md:px-4 py-1.5 md:py-2 bg-white text-gray-700 rounded-lg text-xs md:text-sm font-medium focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300 print-hide",value:we,onChange:Lt=>{$n(Lt.target.value),kt(null)},style:{appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.25rem",paddingRight:"2.5rem"},children:[(y==null?void 0:y.name)!==""&&a.jsxDEV("option",{value:"all",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2458,columnNumber:41},void 0),C.filter(Lt=>Lt.status!=="completed").map(Lt=>a.jsxDEV("option",{value:Lt.name,children:Lt.name},Lt.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2462,columnNumber:21},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2441,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2439,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2415,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2413,columnNumber:9},void 0),H&&a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:a.jsxDEV("div",{className:"bg-white rounded-lg w-full max-w-sm shadow-xl",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxDEV("h3",{className:"text-lg font-bold text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2477,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>Y(!1),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsxDEV("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2483,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2482,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2478,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2476,columnNumber:15},void 0),a.jsxDEV("div",{className:"p-4 border-b border-gray-200",children:a.jsxDEV("div",{className:"flex items-center justify-between",children:[a.jsxDEV("button",{onClick:()=>ce(W-1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsxDEV("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2496,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2495,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2491,columnNumber:19},void 0),a.jsxDEV("span",{className:"text-xl font-bold text-gray-900",children:[W,""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2499,columnNumber:19},void 0),a.jsxDEV("button",{onClick:()=>ce(W+1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsxDEV("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2507,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2506,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2502,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2490,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2489,columnNumber:15},void 0),a.jsxDEV("div",{className:"p-4",children:a.jsxDEV("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(Lt=>{const jt=Ne===Lt-1,mn=ct().year()===W&&ct().month()===Lt-1;return a.jsxDEV("button",{onClick:()=>ye(Lt-1),className:`py-3 px-4 rounded-lg text-sm font-medium transition-colors ${jt?"bg-gray-900 text-white":mn?"bg-gray-100 text-gray-900 border-2 border-gray-900":"bg-gray-50 text-gray-700 hover:bg-gray-100"}`,children:[Lt,""]},Lt,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2520,columnNumber:23},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2515,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2514,columnNumber:15},void 0),a.jsxDEV("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[a.jsxDEV("button",{onClick:()=>{q(new Date),Y(!1)},className:"flex-1 py-2 px-4 bg-gray-100 text-gray-900 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2540,columnNumber:17},void 0),a.jsxDEV("button",{onClick:kn,className:"flex-1 py-2 px-4 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2549,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2539,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2474,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2473,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2412,columnNumber:7},void 0)},lm=()=>null,cm=E.useMemo(()=>({toolbar:am,event:Kl,month:{dateHeader:_r,showMore:lm}}),[_r,Kl]),kr=mt.useMemo(()=>{if(!ne)return[];let b;if(Nt)b=rt.filter(Y=>ct(Y.start).isSame(ne,"day"));else{const Y=ct(ne).startOf("week"),W=ct(ne).endOf("week");b=rt.filter(ce=>{const Ne=ct(ce.start);return Ne.isSameOrAfter(Y,"day")&&Ne.isSameOrBefore(W,"day")})}const H=[...b].sort((Y,W)=>{const ce=Y.assignedTo&&Y.assignedTo.includes("HV LAB"),Ne=Y.assignedTo&&Y.assignedTo.includes("")&&I&&["",""].includes(I),ye=Y.assignedTo&&Y.assignedTo.includes("")&&I&&["","",""].includes(I),ut=Y.assignedTo&&I&&Y.assignedTo.includes(I)||Y.assignedTo&&(y==null?void 0:y.name)&&Y.assignedTo.includes(y.name)||ce||Ne||ye,gt=W.assignedTo&&W.assignedTo.includes("HV LAB"),kn=W.assignedTo&&W.assignedTo.includes("")&&I&&["",""].includes(I),Lt=W.assignedTo&&W.assignedTo.includes("")&&I&&["","",""].includes(I),jt=W.assignedTo&&I&&W.assignedTo.includes(I)||W.assignedTo&&(y==null?void 0:y.name)&&W.assignedTo.includes(y.name)||gt||kn||Lt;return ut&&!jt?-1:!ut&&jt?1:new Date(Y.start).getTime()-new Date(W.start).getTime()});return console.log("Sorted events:",H.map(Y=>({title:Y.title,assignedTo:Y.assignedTo,user:y==null?void 0:y.name,userShort:I}))),H},[ne,rt,y,I,Nt]);return E.useEffect(()=>{const H=setTimeout(()=>{const Y=Nt?document.querySelectorAll(".rbc-month-view td.rbc-date-cell"):document.querySelectorAll(".rbc-date-cell"),W=document.querySelectorAll(".rbc-month-row"),ce=[];W.forEach((wt,on)=>{const vn=wt.querySelectorAll(".rbc-date-cell");let Xt=0;vn.forEach(Jt=>{const yt=Jt.querySelector("button");let rn=yt==null?void 0:yt.textContent;if(!rn){const Cs=Jt.querySelector("span");rn=Cs==null?void 0:Cs.textContent}if(rn&&!isNaN(parseInt(rn))){const Cs=ct(P).date(parseInt(rn)),Os=rt.filter(Ji=>ct(Ji.start).isSame(Cs,"day"));Xt=Math.max(Xt,Os.length)}}),ce.push(Xt)});const Ne=we&&we!=="all",ye=100,ut=Ne?60:18,gt=25,kn=Math.floor((ye-gt)/ut),Lt=ce.length,jt=ye*Lt,mn=ce.map(wt=>wt<=kn?ye:gt+wt*ut+10),Pn=mn.reduce((wt,on)=>wt+on,0);if(Pn>jt){const wt=mn.map((Xt,Jt)=>({index:Jt,height:Xt,overflow:Xt>ye})),on=wt.filter(Xt=>Xt.overflow).reduce((Xt,Jt)=>Xt+(Jt.height-ye),0),vn=wt.filter(Xt=>!Xt.overflow);if(vn.length>0){const Xt=jt-on-vn.length*ye,Jt=Math.max(50,ye+Xt/vn.length);W.forEach((yt,rn)=>{const Os=mn[rn]>ye?mn[rn]:Jt;yt.style.height=`${Os}px`,yt.style.minHeight=`${Os}px`})}else{const Xt=jt/Pn;W.forEach((Jt,yt)=>{const rn=Math.max(80,mn[yt]*Xt);Jt.style.height=`${rn}px`,Jt.style.minHeight=`${rn}px`})}}else{const wt=mn.reduce((Jt,yt)=>Jt+(yt>ye?yt:0),0),on=mn.filter(Jt=>Jt<=ye).length,vn=jt-wt,Xt=on>0?vn/on:ye;W.forEach((Jt,yt)=>{const rn=mn[yt]>ye?mn[yt]:Xt;Jt.style.height=`${rn}px`,Jt.style.minHeight=`${rn}px`})}Y.forEach(wt=>{const on=wt.querySelector("button");let vn=on==null?void 0:on.textContent;if(!vn){const rn=wt.querySelector("span");vn=rn==null?void 0:rn.textContent}if(!vn||isNaN(parseInt(vn)))return;const Xt=ct(P).date(parseInt(vn)),Jt=rt.filter(rn=>ct(rn.start).isSame(Xt,"day"));Jt.length>0?wt.setAttribute("data-event-count",Jt.length.toString()):wt.removeAttribute("data-event-count");const yt=Xt.clone().toDate();if(ne&&ct(yt).isSame(ne,"day")?wt.classList.add("selected-date"):wt.classList.remove("selected-date"),Nt){const rn=wt,Cs=rn._mobileClickHandler;Cs&&wt.removeEventListener("click",Cs);const Os=Ji=>{if(Ji.target.closest(".rbc-event"))return;const Zi=Xt.clone().toDate();Ze(Zi);const Is=document.querySelector(".md\\:hidden.mt-3.bg-white");Is&&Is.scrollIntoView({behavior:"smooth",block:"nearest"})};rn._mobileClickHandler=Os,wt.addEventListener("click",Os,!0),wt.style.cursor="pointer",wt.style.touchAction="manipulation"}})},200);return()=>{clearTimeout(H),Nt&&document.querySelectorAll(".rbc-month-view td.rbc-date-cell").forEach(W=>{const ce=W,Ne=ce._mobileClickHandler;Ne&&(W.removeEventListener("click",Ne),delete ce._mobileClickHandler)})}},[rt,P,Nt,ne,we]),a.jsxDEV("div",{className:"schedule-container space-y-3 md:space-y-2",children:[it.date&&a.jsxDEV("div",{className:"bg-white border border-gray-200 rounded-lg p-3 md:p-4 shadow-sm",children:a.jsxDEV("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-2 md:gap-3",children:[a.jsxDEV("div",{className:"text-xs md:text-sm font-semibold text-gray-900 md:min-w-[80px]",children:ct(it.date).format("MM DD")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2838,columnNumber:15},void 0),a.jsxDEV("select",{value:it.projectId,onChange:b=>qe({...it,projectId:b.target.value}),className:"px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-gray-500",children:C.filter(b=>b.status!=="completed").map(b=>a.jsxDEV("option",{value:b.id,children:b.name},b.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2849,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2841,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:it.title,onChange:b=>qe({...it,title:b.target.value}),onKeyPress:b=>{b.key==="Enter"&&Vs()},placeholder:"  ...",className:"flex-1 px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-gray-500",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2854,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("button",{onClick:Vs,className:"flex-1 md:flex-none px-4 md:px-5 py-2 bg-gray-900 text-white text-xs md:text-sm font-medium rounded-lg hover:bg-gray-800 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2868,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{qe({date:null,projectId:"",title:""}),Ze(null)},className:"flex-1 md:flex-none px-4 md:px-5 py-2 bg-white border border-gray-300 text-gray-700 text-xs md:text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2874,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2867,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2837,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2836,columnNumber:11},void 0),a.jsxDEV("div",{className:"schedule-main flex flex-col md:block",children:[a.jsxDEV("div",{className:"flex gap-3",children:[we!=="all"&&!Nt&&a.jsxDEV("div",{className:"hidden md:block flex-shrink-0 print-hide",children:a.jsxDEV("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-2 sticky top-4",children:[a.jsxDEV("button",{onClick:()=>V(!0),className:"w-full mb-2 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors flex items-center justify-center gap-1",children:[a.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsxDEV("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2901,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2900,columnNumber:21},void 0)," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2896,columnNumber:19},void 0),me&&a.jsxDEV("div",{className:"mb-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded text-center",children:[a.jsxDEV("span",{className:"font-medium",children:me},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2908,columnNumber:23},void 0)," ",a.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2909,columnNumber:23},void 0),a.jsxDEV("span",{className:"text-blue-600",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2910,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2907,columnNumber:21},void 0),a.jsxDEV("div",{className:"flex flex-col gap-0.5",children:de.map(b=>a.jsxDEV("div",{draggable:!0,onClick:()=>{kt(me===b?null:b)},onDragStart:H=>{je.current=!1,kt(null),_e(b),ke.current=b,H.dataTransfer.setData("text/plain",b),H.dataTransfer.effectAllowed="copy"},onDragEnd:()=>{je.current||(_e(null),ke.current=null)},className:`px-3 py-1 text-xs rounded cursor-pointer transition-colors text-center font-medium whitespace-nowrap ${me===b?"bg-blue-500 text-white ring-2 ring-blue-300":O===b?"bg-blue-100 text-blue-800":"bg-gray-50 text-gray-700 hover:bg-gray-100"}`,children:b},b,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2915,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2913,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2894,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2893,columnNumber:15},void 0),a.jsxDEV("div",{className:`schedule-calendar bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm calendar-container flex-1 ${we!=="all"?"specific-project-view":""}`,style:{paddingBottom:0},children:a.jsxDEV(vT,{localizer:DT,events:rt,startAccessor:"start",endAccessor:"end",view:Gt,onView:dt,date:P,onNavigate:q,onSelectEvent:un,onSelectSlot:nn,onEventDrop:we!=="all"?Qe:void 0,onDragStart:we!=="all"?fn:void 0,onDropFromOutside:we!=="all"?Mt:void 0,dragFromOutsideItem:we!=="all"?Bt:void 0,draggableAccessor:b=>we!=="all"&&b.id!=="__inline_add__",resizable:!1,selectable:!0,longPressThreshold:1,eventPropGetter:vr,dayPropGetter:pa,components:cm,popup:!1,doShowMoreDrillDown:!1,onShowMore:()=>{},showAllEvents:!0,messages:{today:"",previous:"",next:"",month:"",week:"",day:"",agenda:"",date:"",time:"",event:"",noEventsInRange:"   ",showMore:b=>`+${b} `}},`calendar-${we}-${(ne==null?void 0:ne.getTime())||"no-selection"}`,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2965,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2961,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2890,columnNumber:11},void 0),ne&&a.jsxDEV("div",{className:"schedule-events-list desktop:hidden mt-3 bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 bg-gray-50",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("p",{className:"text-sm font-semibold text-gray-900",children:Nt?ct(ne).format("MM DD (ddd)"):`${ct(ne).startOf("week").format("MM DD")} - ${ct(ne).endOf("week").format("MM DD")}`},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3016,columnNumber:19},void 0),ll[ct(ne).format("YYYY-MM-DD")]&&a.jsxDEV("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full bg-red-50 text-red-600",children:ll[ct(ne).format("YYYY-MM-DD")]},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3024,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3015,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-center gap-1",children:[we!=="all"&&a.jsxDEV("button",{onClick:()=>G(!0),className:"px-2 py-1 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",children:"+"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3032,columnNumber:21},void 0),a.jsxDEV("button",{onClick:()=>{Ze(null),as(null),G(!1),x("")},className:"p-1 hover:bg-gray-200 rounded-full transition-colors",children:a.jsxDEV("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3049,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3048,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3039,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3029,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3014,columnNumber:15},void 0),a.jsxDEV("div",{children:kr.length===0?a.jsxDEV("div",{className:"p-4",children:we!=="all"&&_?a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("input",{type:"text",value:B,onChange:b=>x(b.target.value),onKeyDown:b=>{if(b.key==="Enter"&&B.trim()){const H=ne||new Date,Y={id:"",title:B.trim(),start:H,end:H,project:we,attendees:y!=null&&y.name?[y.name]:[],type:"construction"};i(Y).then(()=>{G(!1),x("")}).catch(W=>{console.error("  :",W),oe.error("  ")})}else b.key==="Escape"&&(G(!1),x(""))},placeholder:"  ",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3062,columnNumber:25},void 0),a.jsxDEV("button",{onClick:()=>{if(B.trim()){const b=ne||new Date,H={id:"",title:B.trim(),start:b,end:b,project:we,attendees:y!=null&&y.name?[y.name]:[],type:"construction"};i(H).then(()=>{G(!1),x("")}).catch(Y=>{console.error("  :",Y),oe.error("  ")})}},className:"px-3 py-2 text-sm font-medium text-white bg-gray-700 rounded-lg hover:bg-gray-800 active:bg-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3095,columnNumber:25},void 0),a.jsxDEV("button",{onClick:()=>{G(!1),x("")},className:"p-2 text-gray-400 hover:text-gray-600",children:a.jsxDEV("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3130,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3129,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3122,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3061,columnNumber:23},void 0):a.jsxDEV("p",{className:"text-sm text-gray-500 text-center",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3135,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3058,columnNumber:19},void 0):a.jsxDEV("div",{children:[(()=>{const b=kr.reduce((Y,W)=>{const ce=ct(W.start).format("YYYY-MM-DD");return Y[ce]||(Y[ce]=[]),Y[ce].push(W),Y},{});return Object.keys(b).sort().map(Y=>a.jsxDEV("div",{className:"border-b border-gray-100 last:border-b-0",children:[!Nt&&a.jsxDEV("div",{className:"px-3 py-2 bg-gray-50 sticky top-0 z-10",children:a.jsxDEV("p",{className:"text-xs font-semibold text-gray-700",children:ct(Y).format("MM DD (ddd)")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3159,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3158,columnNumber:29},void 0),a.jsxDEV("div",{className:"divide-y divide-gray-100",children:b[Y].map(W=>{const ce=W.assignedTo&&W.assignedTo.includes("HV LAB"),Ne=W.assignedTo&&W.assignedTo.includes("")&&I&&["",""].includes(I),ye=W.assignedTo&&W.assignedTo.includes("")&&I&&["","",""].includes(I),gt=W.assignedTo&&(W.assignedTo.includes((y==null?void 0:y.name)||"")||I&&W.assignedTo.includes(I))||ce||Ne||ye,kn=!W.color&&!gt,Lt=!W.isASVisit&&!W.isExpectedPayment;return a.jsxDEV("div",{onClick:()=>{const jt={...W,title:W.originalTitle||W.title};un(jt)},className:`p-3 cursor-pointer ${gt?"bg-yellow-50":""}`,style:kn?{backgroundColor:"#f3f0f5"}:void 0,children:a.jsxDEV("div",{className:"flex items-start gap-2",children:[a.jsxDEV("div",{className:"w-1 h-full rounded-full flex-shrink-0",style:{backgroundColor:gt?"#FEF3C7":W.color||"#e8e2ea",minHeight:"28px"}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3205,columnNumber:27},void 0),a.jsxDEV("div",{className:"flex-1 min-w-0",children:[a.jsxDEV("div",{className:"flex items-center justify-between gap-2",children:[a.jsxDEV("p",{className:"text-sm font-semibold text-gray-900 truncate",children:W.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3216,columnNumber:31},void 0),W.assignedTo&&W.assignedTo.length>0&&a.jsxDEV("p",{className:"text-xs text-gray-500 flex-shrink-0",children:["","",""].every(Pn=>W.assignedTo.includes(Pn))?"":W.assignedTo.join(", ")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3221,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3215,columnNumber:29},void 0),W.projectName&&we==="all"&&a.jsxDEV("p",{className:"text-xs text-gray-600 mt-0.5",children:W.projectName},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3233,columnNumber:31},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3214,columnNumber:27},void 0),Lt?a.jsxDEV("button",{onClick:jt=>{jt.stopPropagation(),as(W)},className:"p-0.5 text-gray-400 hover:text-red-500 flex-shrink-0 active:text-red-600",children:a.jsxDEV("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3248,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3247,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3240,columnNumber:29},void 0):a.jsxDEV("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3253,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3252,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3204,columnNumber:25},void 0)},W.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3187,columnNumber:25},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3165,columnNumber:27},void 0)]},Y,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3155,columnNumber:25},void 0))})(),we!=="all"&&_&&a.jsxDEV("div",{className:"p-3 border-t border-gray-100",children:a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("input",{type:"text",value:B,onChange:b=>x(b.target.value),onKeyDown:b=>{if(b.key==="Enter"&&B.trim()){const H=ne||new Date,Y={id:"",title:B.trim(),start:H,end:H,project:we,attendees:y!=null&&y.name?[y.name]:[],type:"construction"};i(Y).then(()=>{G(!1),x("")}).catch(W=>{console.error("  :",W),oe.error("  ")})}else b.key==="Escape"&&(G(!1),x(""))},placeholder:"  ",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3268,columnNumber:27},void 0),a.jsxDEV("button",{onClick:()=>{if(B.trim()){const b=ne||new Date,H={id:"",title:B.trim(),start:b,end:b,project:we,attendees:y!=null&&y.name?[y.name]:[],type:"construction"};i(H).then(()=>{G(!1),x("")}).catch(Y=>{console.error("  :",Y),oe.error("  ")})}},className:"px-3 py-2 text-sm font-medium text-white bg-gray-700 rounded-lg hover:bg-gray-800 active:bg-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3301,columnNumber:27},void 0),a.jsxDEV("button",{onClick:()=>{G(!1),x("")},className:"p-2 text-gray-400 hover:text-gray-600",children:a.jsxDEV("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3336,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3335,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3328,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3267,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3266,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3139,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3056,columnNumber:15},void 0),Nt&&we!=="all"&&a.jsxDEV("div",{className:"border-t border-gray-200 p-3 bg-gray-50",children:[a.jsxDEV("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3349,columnNumber:19},void 0),a.jsxDEV("div",{className:"flex flex-wrap gap-1.5",children:de.map(b=>a.jsxDEV("button",{onClick:async()=>{const H=ne||new Date;if(we!=="all"){const Y={id:"",title:b,start:H,end:H,project:we,attendees:y!=null&&y.name?[y.name]:[],type:"construction"};try{await i(Y)}catch(W){console.error("  :",W),oe.error("  ")}}},className:"px-2.5 py-1.5 text-xs rounded-lg bg-white border border-gray-200 text-gray-700 hover:bg-gray-100 active:bg-gray-200 transition-colors font-medium",children:b},b,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3352,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3350,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3348,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3012,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2889,columnNumber:9},void 0),te&&a.jsxDEV(Sx,{event:ue,slotInfo:Ie,defaultProjectName:we!=="all"?we:void 0,onClose:()=>{ve(!1),fe(null),We(null)},onSave:async b=>{console.log(" Schedule.tsx onSave called with newEvent:",b);try{if(ue)if(ue.id.startsWith("as-")){const H=ue.id.replace("as-","");let Y="";b.assignedTo&&Array.isArray(b.assignedTo)&&b.assignedTo.length>0?Y=b.assignedTo.join(", "):ue.assignedTo&&Array.isArray(ue.assignedTo)?Y=ue.assignedTo.join(", "):typeof ue.assignedTo=="string"&&(Y=ue.assignedTo),await m(H,{project:b.title||ue.title,assignedTo:Y,scheduledVisitDate:b.start,scheduledVisitTime:b.time||ue.time}),await d(),ve(!1)}else if(ue.id.startsWith("payment-")){const H=ue.id.split("-"),Y=H[1],W=H[2],ce=f.find(Ne=>Ne.id===Y);if(ce){const Ne={...ce.expectedPaymentDates};Ne[W]=b.start,await p(Y,{expectedPaymentDates:Ne})}}else{console.log(" Updating schedule with projectId:",b.projectId,"projectName:",b.projectName);let H=b.title;const Y=/ - (|) \d{1,2}( \d{1,2})?$/;if(H=H.replace(Y,""),ue.mergedEventIds&&ue.mergedEventIds.length>0){console.log(" Updating merged schedules:",ue.mergedEventIds);const W=(ue.originalTitle||ue.title).split(", "),ce=H.split(", ");for(let Ne=0;Ne<ue.mergedEventIds.length;Ne++){const ye=ue.mergedEventIds[Ne],ut=ce[Ne]||W[Ne]||H;await o(ye,{title:ut.trim(),start:b.start,end:b.end,type:"other",project:b.projectId||b.projectName,location:"",attendees:b.assignedTo||[],description:b.description,time:b.time})}}else await o(ue.id,{title:H,start:b.start,end:b.end,type:"other",project:b.projectId||b.projectName,location:"",attendees:b.assignedTo||[],description:b.description,time:b.time})}else{console.log(" Adding schedule with projectId:",b.projectId,"projectName:",b.projectName);const H={id:Date.now().toString(),title:b.title,start:b.start,end:b.end,type:"other",project:b.projectId||b.projectName||"",location:"",attendees:b.assignedTo||[],description:b.description||"",time:b.time||"-"};await i(H)}ve(!1)}catch(H){console.error("Failed to save schedule:",H),oe.error("  ")}},onDelete:async b=>{try{if(b.startsWith("payment-")){const H=b.split("-"),Y=H[1],W=H[2],ce=f.find(Ne=>Ne.id===Y);if(ce){const Ne={...ce.expectedPaymentDates};delete Ne[W],await p(Y,{expectedPaymentDates:Ne})}}else if(b.startsWith("as-")){const H=b.replace("as-","");await m(H,{scheduledVisitDate:null,scheduledVisitTime:null})}else{const H=Ht.find(Y=>Y.id===b);if(H!=null&&H.mergedEventIds&&H.mergedEventIds.length>0){console.log("Deleting merged schedules:",H.mergedEventIds);for(const Y of H.mergedEventIds)await l(Y)}else await l(b)}ve(!1)}catch(H){console.error("Failed to delete schedule:",H),oe.error("  ")}}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3390,columnNumber:11},void 0),L&&Ce&&a.jsxDEV("div",{className:"fixed pointer-events-none z-[9999]",style:{left:X.x-50,top:X.y-15,backgroundColor:L.color||"#F3F4F6",borderRadius:"6px",color:"#1f2937",padding:"4px 8px",fontWeight:500,fontSize:"16px",maxWidth:"250px"},children:L.originalTitle||L.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3578,columnNumber:11},void 0),Fs&&a.jsxDEV("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[9999]",onClick:()=>as(null),children:a.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl w-[280px] overflow-hidden mx-4",onClick:b=>b.stopPropagation(),children:[a.jsxDEV("div",{className:"p-4 text-center",children:[a.jsxDEV("div",{className:"w-12 h-12 mx-auto mb-3 bg-red-100 rounded-full flex items-center justify-center",children:a.jsxDEV("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3609,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3608,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3607,columnNumber:17},void 0),a.jsxDEV("p",{className:"text-base font-semibold text-gray-900 mb-1",children:" ?"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3612,columnNumber:17},void 0),a.jsxDEV("p",{className:"text-sm text-gray-500 truncate",children:Fs.title},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3613,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3606,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex border-t border-gray-100",children:[a.jsxDEV("button",{onClick:()=>as(null),className:"flex-1 py-3 text-sm font-medium text-gray-600 hover:bg-gray-50 active:bg-gray-100 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3616,columnNumber:17},void 0),a.jsxDEV("button",{onClick:async()=>{try{const b=Fs.mergedEventIds||[Fs.id];await Promise.all(b.map(H=>l(H)))}catch(b){console.error("  :",b),oe.error(" ")}as(null)},className:"flex-1 py-3 text-sm font-medium text-red-600 hover:bg-red-50 active:bg-red-100 border-l border-gray-100 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3622,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3615,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3602,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3598,columnNumber:11},void 0),N&&a.jsxDEV("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[9999]",onClick:()=>{V(!1),k(null),T("")},children:a.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[80vh] overflow-hidden mx-4",onClick:b=>b.stopPropagation(),children:[a.jsxDEV("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center",children:[a.jsxDEV("h2",{className:"text-lg font-bold text-gray-800",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3660,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{V(!1),k(null),T("")},className:"text-gray-400 hover:text-gray-600 p-1 hover:bg-gray-100 rounded",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3661,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3659,columnNumber:15},void 0),a.jsxDEV("div",{className:"p-4 border-b border-gray-100 bg-gray-50",children:[a.jsxDEV("label",{className:"block text-xs text-gray-500 mb-2",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3675,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("input",{type:"text",value:j,onChange:b=>T(b.target.value),onKeyDown:b=>b.key==="Enter"&&Be(),placeholder:" ",className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-gray-300 focus:border-gray-400 bg-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3677,columnNumber:19},void 0),a.jsxDEV("button",{onClick:Be,disabled:!j.trim(),className:"px-4 py-2 bg-gray-800 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3685,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3676,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3674,columnNumber:15},void 0),a.jsxDEV("div",{className:"overflow-y-auto max-h-[50vh]",children:ge?a.jsxDEV("div",{className:"p-8 text-center text-gray-500",children:[a.jsxDEV("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-gray-200 border-t-gray-600 rounded-full mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3699,columnNumber:21},void 0),a.jsxDEV("p",{children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3700,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3698,columnNumber:19},void 0):M.length===0?a.jsxDEV("div",{className:"p-8 text-center text-gray-400",children:[a.jsxDEV("p",{className:"mb-2",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3704,columnNumber:21},void 0),a.jsxDEV("p",{className:"text-xs",children:"   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3705,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3703,columnNumber:19},void 0):a.jsxDEV("div",{className:"divide-y divide-gray-50",children:M.map((b,H)=>a.jsxDEV("div",{draggable:(S==null?void 0:S.id)!==b.id,onDragStart:()=>lt(H),onDragOver:Y=>St(Y,H),onDragEnd:at,onDragLeave:()=>le(null),className:`flex items-center gap-3 px-4 py-3 hover:bg-gray-50 group transition-all ${ht===H?"opacity-50 bg-gray-100":""} ${qt===H?"border-t-2 border-gray-400":""} ${(S==null?void 0:S.id)!==b.id?"cursor-grab active:cursor-grabbing":""}`,children:(S==null?void 0:S.id)===b.id?a.jsxDEV(a.Fragment,{children:[a.jsxDEV("input",{type:"text",value:Ee,onChange:Y=>$e(Y.target.value),onKeyDown:Y=>{Y.key==="Enter"&&Xe(),Y.key==="Escape"&&(k(null),$e(""))},className:"flex-1 px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-300 focus:border-gray-400",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3727,columnNumber:29},void 0),a.jsxDEV("button",{onClick:Xe,className:"px-3 py-1.5 bg-gray-800 text-white text-xs rounded-lg hover:bg-gray-700",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3741,columnNumber:29},void 0),a.jsxDEV("button",{onClick:()=>{k(null),$e("")},className:"px-3 py-1.5 bg-gray-100 text-gray-600 text-xs rounded-lg hover:bg-gray-200",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3747,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3726,columnNumber:27},void 0):a.jsxDEV(a.Fragment,{children:[a.jsxDEV("span",{className:"text-gray-300 text-xs select-none",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3759,columnNumber:29},void 0),a.jsxDEV("span",{className:"text-gray-300 text-xs w-5 text-right select-none",children:H+1},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3760,columnNumber:29},void 0),a.jsxDEV("span",{className:"flex-1 text-sm text-gray-700 select-none",children:b.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3761,columnNumber:29},void 0),a.jsxDEV("button",{onClick:()=>{k(b),$e(b.name)},className:"px-2 py-1 text-gray-400 hover:text-gray-700 text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3762,columnNumber:29},void 0),a.jsxDEV("button",{onClick:()=>vt(b.id),className:"px-2 py-1 text-gray-400 hover:text-red-500 text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3771,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3758,columnNumber:27},void 0)},b.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3710,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3708,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3696,columnNumber:15},void 0),M.length>0&&a.jsxDEV("div",{className:"p-3 border-t border-gray-100 bg-gray-50 text-center text-xs text-gray-400",children:"     /"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3787,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3654,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:3646,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Schedule.tsx",lineNumber:2833,columnNumber:7},void 0)},VT=({projectName:n,onClose:e,type:t="cash"})=>{const s=t==="cash",r=s?"":"",i=s?"      .":"      .",[o,l]=E.useState({receiptDate:$t(new Date,"yyyy-MM-dd"),customerName:"",amount:"",purpose:" ",receivedBy:""}),u=()=>{window.print()},m=f=>{const p=Number(f.replace(/,/g,""));return isNaN(p)?"":p.toLocaleString()},d=f=>{if(f===0)return"";const p=["","","",""],y=["","","",""],C=["","","","","","","","","",""];let v="",w=0;for(;f>0;){const R=f%1e4;if(R>0){let I="",F=R,re=0;for(;F>0;){const ee=F%10;ee>0&&(I=C[ee]+y[re]+I),F=Math.floor(F/10),re++}v=I+p[w]+v}f=Math.floor(f/1e4),w++}return v+""};return a.jsxDEV(a.Fragment,{children:[a.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 print:relative print:bg-white",children:a.jsxDEV("div",{className:"bg-white rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto print:max-h-none print:mx-0 print:rounded-none",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b print:hidden",children:[a.jsxDEV("h2",{className:"text-lg font-bold text-gray-900",children:r},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:76,columnNumber:13},void 0),a.jsxDEV("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded-full",children:a.jsxDEV(Cn,{className:"h-5 w-5 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:81,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:77,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:75,columnNumber:11},void 0),a.jsxDEV("div",{className:"p-6 space-y-4 print:hidden",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:88,columnNumber:15},void 0),a.jsxDEV("input",{type:"date",value:o.receiptDate,onChange:f=>l({...o,receiptDate:f.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:89,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:87,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:98,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:o.customerName,onChange:f=>l({...o,customerName:f.target.value}),placeholder:" ",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:99,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:97,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:109,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:m(o.amount),onChange:f=>{const p=f.target.value.replace(/,/g,"");/^\d*$/.test(p)&&l({...o,amount:p})},placeholder:" ",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:110,columnNumber:15},void 0),o.amount&&a.jsxDEV("p",{className:"text-sm text-gray-600 mt-1",children:d(Number(o.amount))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:123,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:108,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:130,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:o.purpose,onChange:f=>l({...o,purpose:f.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:131,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:129,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:140,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:o.receivedBy,onChange:f=>l({...o,receivedBy:f.target.value}),placeholder:" ",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:141,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:139,columnNumber:13},void 0),a.jsxDEV("button",{onClick:u,disabled:!o.customerName||!o.amount||!o.receivedBy,className:"w-full py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[a.jsxDEV(Ty,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:155,columnNumber:15},void 0),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:150,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:86,columnNumber:11},void 0),a.jsxDEV("div",{className:"hidden print:block p-12",children:a.jsxDEV("div",{className:"border-4 border-double border-gray-900 p-8",children:[a.jsxDEV("h1",{className:"text-center text-3xl font-bold mb-8",children:s?"    ":"    "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:163,columnNumber:15},void 0),a.jsxDEV("div",{className:"space-y-6 text-lg",children:[a.jsxDEV("div",{className:"flex items-baseline border-b border-gray-300 pb-2",children:[a.jsxDEV("span",{className:"font-medium w-32",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:169,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1 receipt-date",children:$t(new Date(o.receiptDate),"yyyy MM dd",{locale:Vn})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:170,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:168,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline border-b border-gray-300 pb-2",children:[a.jsxDEV("span",{className:"font-medium w-32",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:174,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:o.customerName},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:175,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:173,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline border-b border-gray-300 pb-2",children:[a.jsxDEV("span",{className:"font-medium w-32",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:179,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:n},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:180,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:178,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline border-b border-gray-300 pb-2",children:[a.jsxDEV("span",{className:"font-medium w-32",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:184,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1 font-bold receipt-amount",children:["",Number(o.amount).toLocaleString(),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:185,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:183,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline border-b border-gray-300 pb-2",children:[a.jsxDEV("span",{className:"font-medium w-32",children:"():"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:191,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:d(Number(o.amount))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:192,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:190,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex items-baseline border-b border-gray-300 pb-2",children:[a.jsxDEV("span",{className:"font-medium w-32",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:196,columnNumber:19},void 0),a.jsxDEV("span",{className:"flex-1",children:o.purpose},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:197,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:195,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:167,columnNumber:15},void 0),a.jsxDEV("div",{className:"mt-12 text-center",children:[a.jsxDEV("p",{className:"text-lg mb-8",children:i},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:202,columnNumber:17},void 0),a.jsxDEV("div",{className:"space-y-2",children:[a.jsxDEV("p",{className:"text-lg receipt-date",children:$t(new Date(o.receiptDate),"yyyy MM dd",{locale:Vn})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:205,columnNumber:19},void 0),a.jsxDEV("p",{className:"text-xl font-medium mt-8",children:[": ",o.receivedBy," ",a.jsxDEV("span",{className:"ml-4",children:"()"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:207,columnNumber:48},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:206,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:204,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:201,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:162,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:161,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:73,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:72,columnNumber:7},void 0),a.jsxDEV("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .print\\:block, .print\\:block * {
            visibility: visible;
          }
          .print\\:hidden {
            display: none !important;
          }
        }
      `},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:217,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/components/CashReceiptModal.tsx",lineNumber:71,columnNumber:5},void 0)},CT="HVLabImageDB",IT=1,Zr="paymentRecordImages";let _c=null;const Vp=()=>new Promise((n,e)=>{if(_c){n(_c);return}const t=indexedDB.open(CT,IT);t.onerror=()=>{console.error("IndexedDB  :",t.error),e(t.error)},t.onsuccess=()=>{_c=t.result,n(_c)},t.onupgradeneeded=s=>{const r=s.target.result;r.objectStoreNames.contains(Zr)||r.createObjectStore(Zr,{keyPath:"id"})}}),ST=async()=>{try{const n=await Vp();return new Promise((e,t)=>{const i=n.transaction(Zr,"readonly").objectStore(Zr).getAll();i.onsuccess=()=>{const o={};i.result.forEach(l=>{o[l.id]=l.images}),e(o)},i.onerror=()=>{console.error("  :",i.error),t(i.error)}})}catch(n){console.error("IndexedDB , localStorage :",n);const e=localStorage.getItem("paymentRecordImages");return e?JSON.parse(e):{}}},TT=async(n,e)=>{try{const t=await Vp();return new Promise((s,r)=>{const l=t.transaction(Zr,"readwrite").objectStore(Zr).put({id:n,images:e});l.onsuccess=()=>s(),l.onerror=()=>{console.error("  :",l.error),r(l.error)}})}catch(t){throw console.error("IndexedDB  :",t),t}},PT=async n=>{try{const e=await Vp();return new Promise((t,s)=>{const r=e.transaction(Zr,"readwrite"),i=r.objectStore(Zr);i.clear(),Object.entries(n).forEach(([o,l])=>{i.put({id:o,images:l})}),r.oncomplete=()=>t(),r.onerror=()=>{console.error("  :",r.error),s(r.error)}})}catch(e){throw console.error("IndexedDB   :",e),e}},LT=async()=>{try{const n=localStorage.getItem("paymentRecordImages");if(n){const e=JSON.parse(n);Object.keys(e).length>0&&(await PT(e),localStorage.removeItem("paymentRecordImages"),console.log("localStorage IndexedDB  "))}}catch(n){console.error(" :",n)}},Dc=n=>{if(!n)return 0;try{const t=new Date(n).getTime();return isNaN(t)?0:t}catch{return 0}},Ay=(n,e,t)=>{if(!n)return null;try{const s=new Date(n);return isNaN(s.getTime())?null:$t(s,e,t)}catch{return null}},jT=()=>{const{payments:n,loadPaymentsFromAPI:e,loadProjectsFromAPI:t,addPaymentToAPI:s,deletePaymentFromAPI:r,updatePaymentInAPI:i,updatePayment:o}=dr(),{user:l}=oi(),u=Ju(),[m,d]=E.useState(""),[f,p]=E.useState(null),[y,C]=E.useState(null),[v,w]=E.useState(!1),[R,I]=E.useState(!1),[F,re]=E.useState(!1),[ee,M]=E.useState(!1),[A,N]=E.useState(""),[V,j]=E.useState("form"),[T,S]=E.useState(!1),[k,Ee]=E.useState(!1),$e=E.useRef(null),[ge,He]=E.useState("pending"),[ht,Kt]=E.useState("all"),[qt,le]=E.useState(()=>localStorage.getItem("payments_showMyRequestsOnly")==="true"),[ze,de]=E.useState(!1),[Be,Xe]=E.useState(null),[vt,lt]=E.useState(!1),[St,at]=E.useState(""),[ft,Nn]=E.useState(!1),K=E.useRef(!1),Le=E.useRef(!1),Fe=E.useRef(null),[Se,Je]=E.useState([]),[Tt,Gt]=E.useState([]),[dt,P]=E.useState(null),[q,te]=E.useState([]),[ve,ue]=E.useState([]),[fe,Ie]=E.useState(!1),[We,st]=E.useState({}),[we,$n]=E.useState(!1),Ht=()=>{const _=localStorage.getItem("lastSelectedProject"),G=u.filter(B=>B.status!=="completed");return _&&G.some(B=>B.name===_)?_:G.length>0?G[0].name:""},[ne,Ze]=E.useState({project:"",date:$t(new Date,"yyyy-MM-dd"),process:"",itemName:"",amount:"",accountHolder:"",bankName:"",accountNumber:"",images:[],quickText:"",quickImages:[]});E.useEffect(()=>{(async()=>{try{const G=await mr.getAllContractors();Je(G.map(B=>({id:B._id||B.id,rank:B.rank,companyName:B.companyName,name:B.name,process:B.process,contact:B.contact,accountNumber:B.accountNumber,bankName:B.bankName,notes:B.notes,createdAt:new Date(B.createdAt),updatedAt:new Date(B.updatedAt)})))}catch(G){console.error("Failed to load contractors:",G)}})()},[]),E.useEffect(()=>{Kt("all"),t().catch(G=>{console.error("Failed to load projects:",G)}),e().catch(G=>{console.error("Failed to load payments:",G)});const _=()=>{S(window.innerWidth<1024)};if(_(),window.addEventListener("resize",_),u.length>0&&!ne.project&&!Le.current){const G=Ht();G&&(Ze(B=>({...B,project:G})),localStorage.setItem("lastSelectedProject",G))}return()=>window.removeEventListener("resize",_)},[]),E.useEffect(()=>{console.log("[ ] Firestore  ...");const _=gs.subscribeToPayments(G=>{console.log("[ ]  :",G.length,"");const B=G.map(x=>({id:String(x.id),project:x.project_name||"",purpose:x.description,process:x.vendor_name,itemName:x.item_name||"",amount:x.amount,materialAmount:x.material_amount||0,laborAmount:x.labor_amount||0,originalMaterialAmount:x.original_material_amount||0,originalLaborAmount:x.original_labor_amount||0,applyTaxDeduction:x.apply_tax_deduction===1,includesVAT:x.includes_vat===1,quickText:x.quick_text||"",images:(()=>{if(!x.images)return[];if(Array.isArray(x.images))return x.images;try{const L=JSON.parse(x.images);return Array.isArray(L)?L:[]}catch{return[]}})(),category:x.request_type,status:x.status,urgency:"normal",requestedBy:x.requester_name,requestDate:new Date(x.created_at),approvalDate:x.approved_at?new Date(x.approved_at):void 0,bankInfo:{accountHolder:x.account_holder||"",bankName:x.bank_name||"",accountNumber:x.account_number||""},attachments:[],notes:x.notes||"",completionDate:x.completionDate?new Date(x.completionDate):void 0}));Fe.current||dr.setState({payments:B})});return()=>{console.log("[ ] Firestore  "),_()}},[]),E.useEffect(()=>{const _=()=>{if(document.visibilityState==="visible"){if(Fe.current){console.log("[ ]     - ");return}console.log("[ ]   -    ..."),e().catch(G=>{console.error("[ ] :",G)})}};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},[e]),E.useEffect(()=>{let _=Rr.getSocket(),G=0,B=null;const x=U=>{if(console.log(" [ ]    :",U),Fe.current&&String(U.paymentId)===Fe.current){console.log(" [ ]    -  ");return}console.log(" [ ] loadPaymentsFromAPI  (  )"),e().catch(X=>{console.error("[ ]  :",X)})},L=()=>(_=Rr.getSocket(),_?(console.log(" [Payments] Socket  , payment:refresh  "),_.on("payment:refresh",x),B&&(clearInterval(B),B=null),!0):!1);return L()||(console.log(" [Payments] Socket  ..."),B=setInterval(()=>{G++,(L()||G>=10)&&(B&&(clearInterval(B),B=null),G>=10&&!Rr.getSocket()&&console.warn(" [Payments] Socket   -   "))},500)),()=>{B&&clearInterval(B);const U=Rr.getSocket();U&&U.off("payment:refresh",x)}},[e]),E.useEffect(()=>{(async()=>{var x,L,U,X;if(K.current)return;const G=new URLSearchParams(window.location.search),B=G.get("complete")||G.get("c");if(B){if(!l){console.log("[ ]   -  ");return}K.current=!0,console.log("[ ]  :",B),window.history.replaceState({},"","/payments"),Le.current=!0,j("list"),He("completed"),Kt("all"),Ze(Q=>({...Q,project:""})),o(String(B),{status:"completed",completionDate:new Date}),oe.success(" "),window.dispatchEvent(new CustomEvent("paymentCompleted"));try{await i(String(B),{status:"completed"}),await e();const Q=Rr.getSocket();Q&&Q.emit("payment:refresh",{paymentId:B,status:"completed",updatedAt:new Date().toISOString()})}catch(Q){console.error("[ ]  :",Q),o(String(B),{status:"pending",completionDate:void 0}),He("pending");let Z="  ";((x=Q.response)==null?void 0:x.status)===401?Z=" .  ":((L=Q.response)==null?void 0:L.status)===404?Z="     (ID: "+B+")":(X=(U=Q.response)==null?void 0:U.data)!=null&&X.error?Z=Q.response.data.error:Q.message&&(Z+=": "+Q.message),oe.error(Z)}}})()},[e,i,o,l]),E.useEffect(()=>{if(ne.process){const _=new Set(n.filter(L=>{var U;return L.status==="completed"&&((U=L.bankInfo)==null?void 0:U.accountHolder)}).map(L=>L.bankInfo.accountHolder.trim().toLowerCase())),G=(L,U)=>{const X=L.toLowerCase(),Q=U.toLowerCase();if(X.includes(Q)||Q.includes(X))return!0;const Z=X.split("/").map(Ce=>Ce.trim()),ie=Q.replace(/$/,"").trim();for(const Ce of Z)if(Ce===ie||ie.includes(Ce)||Ce.includes(ie))return!0;return!1},x=Se.filter(L=>{if(!G(ne.process,L.process))return!1;const X=L.accountNumber&&L.accountNumber.trim()!=="",Q=L.name.trim().toLowerCase(),Z=_.has(Q);return X||Z}).sort((L,U)=>{const X=L.accountNumber&&L.accountNumber.trim()!=="",Q=U.accountNumber&&U.accountNumber.trim()!=="";return X&&!Q?-1:!X&&Q?1:0});Gt(x)}else Gt([])},[ne.process,Se,n]),E.useEffect(()=>{if(ne.process){const _=(x,L)=>{if(!L)return!1;const U=x.toLowerCase(),X=L.toLowerCase();if(U.includes(X)||X.includes(U))return!0;const Q=U.split("/").map(ie=>ie.trim()),Z=X.replace(/$/,"").trim();for(const ie of Q)if(ie===Z||Z.includes(ie)||ie.includes(Z))return!0;return!1},G=n.filter(x=>{var L,U,X;return x.status==="completed"&&x.process&&_(ne.process,x.process)&&((L=x.bankInfo)==null?void 0:L.accountHolder)&&((U=x.bankInfo)==null?void 0:U.bankName)&&((X=x.bankInfo)==null?void 0:X.accountNumber)}),B=new Map;G.forEach(x=>{const L=`${x.bankInfo.accountHolder}_${x.bankInfo.bankName}_${x.bankInfo.accountNumber}`;B.has(L)||B.set(L,{accountHolder:x.bankInfo.accountHolder,bankName:x.bankInfo.bankName,accountNumber:x.bankInfo.accountNumber,itemName:x.itemName||"",amount:x.amount||0})}),te(Array.from(B.values()))}else te([])},[ne.process,n]),E.useEffect(()=>{var G;const _=((G=ne.accountHolder)==null?void 0:G.trim())||"";if(_.length>=1&&fe){const B=[],x=new Set;Se.filter(L=>L.accountNumber&&L.accountNumber.trim()!=="").forEach(L=>{const U=L.name.trim(),X=U.toLowerCase(),Q=_.toLowerCase();X.startsWith(Q)&&!x.has(X)&&(x.add(X),B.push({name:U,bankName:L.bankName||"",accountNumber:L.accountNumber||"",source:"contractor"}))}),n.filter(L=>{var U;return L.status==="completed"&&((U=L.bankInfo)==null?void 0:U.accountHolder)}).forEach(L=>{const U=L.bankInfo.accountHolder.trim(),X=U.toLowerCase(),Q=_.toLowerCase();X.startsWith(Q)&&!x.has(X)&&(x.add(X),B.push({name:U,bankName:L.bankInfo.bankName||"",accountNumber:L.bankInfo.accountNumber||"",source:"payment"}))}),ue(B)}else ue([])},[ne.accountHolder,fe,Se,n]);const O=_=>{const G=_.split(`
`).map(Q=>Q.trim()).filter(Q=>Q),B={amounts:{},bankInfo:{},vendor:null,itemName:void 0,includeVat:!1},x=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],L=Q=>{const Z=["","","","","","","",""];for(const ie of Z)if(Q.endsWith(ie)&&Q.length>ie.length+1)return Q.slice(0,-ie.length);return Q},U=Q=>{if(!Q||Q.length<2||Q.length>5||!/^[-]{2,5}$/.test(Q)||["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""].includes(Q)||["","","","","","","","","","","","","","","","","","","","","","","","","",""].includes(Q))return!1;if(Q.length>=2){const Ce=Q.charAt(0),et=Q.substring(0,2);if(["","","","","","",""].includes(et)||x.includes(Ce))return!0}return Q.length>=2&&Q.length<=4},X=G.some(Q=>Q.includes(" ")||Q.includes(""));if(G.forEach((Q,Z)=>{if(Q.includes("")&&Q.includes(":")){const ie=Q.match(/\s*:\s*(.+)/);ie&&(B.itemName=ie[1].trim())}if(Q.includes("")&&Q.includes(":")){const ie=Q.match(/\s*:\s*(.+)/);ie&&(B.bankInfo.accountHolder=ie[1].trim())}if(Q.includes("")&&Q.includes(":")){const ie=Q.match(/\s*:\s*(.+)/);ie&&(B.bankInfo.bankName=ie[1].trim())}if(Q.includes("")&&Q.includes(":")){const ie=Q.match(/\s*:\s*(.+)/);ie&&(B.bankInfo.accountNumber=ie[1].trim())}if(Q.includes("")&&Q.includes(":")){const ie=Q.match(/\s*:\s*([\d,]+)?/);ie&&(B.amounts.total=parseInt(ie[1].replace(/,/g,"")))}}),!X){let Q=-1;if(G.forEach(Z=>{const ie=Z.match(/\[([^\]]+)\]/);ie&&!B.itemName&&(B.itemName=ie[1].trim())}),G.forEach((Z,ie)=>{if(Z.includes("")||Z.includes(" ")||Z.includes("()")){B.includeVat=!0;const Ye=Z.match(/(\d+)\s*\s*(\d+)\s*\s*?/),Ve=Z.match(/(\d+)\s*\s*?/),tt=Z.match(/([\d,]+)\s*/);if(Ye){const rt=parseInt(Ye[1])*1e4+parseInt(Ye[2])*1e3;B.amounts.total=rt}else if(Ve){const rt=parseInt(Ve[1])*1e4;B.amounts.total=rt}else if(tt){const rt=parseInt(tt[1].replace(/,/g,""));rt>=1e3&&(B.amounts.total=rt)}return}const et=Z.match(/=\s*([\d,]+)\s*?/);let Oe=null;if(et){const Ye=parseInt(et[1].replace(/,/g,""));Ye>=1e3&&(B.amounts.total=Ye)}else{const Ye=Z.match(/(\d+)\s*\s*(\d+)\s*\s*?/);if(Ye){const Ve=parseInt(Ye[1])*1e4,tt=parseInt(Ye[2])*1e3,rt=Ve+tt;Z.includes("")||Z.includes("")?B.amounts.material=rt:Z.includes("")||Z.includes("")?B.amounts.labor=rt:B.amounts.total||(B.amounts.total=rt),Z=Z.replace(/(\d+)\s*\s*(\d+)\s*\s*?/g,""),Oe=Ye}else if(Oe=Z.match(/(\d+)\s*\s*?/),Oe){const Ve=parseInt(Oe[1])*1e4;Z.includes("")||Z.includes("")?B.amounts.material=Ve:Z.includes("")||Z.includes("")?B.amounts.labor=Ve:B.amounts.total||(B.amounts.total=Ve),Z=Z.replace(/(\d+)\s*\s*?/g,"")}}Z.includes("/")&&Z.split("/").forEach(Ve=>{const tt=Ve.trim();tt.startsWith("[")||tt.endsWith("]")||(/^[\d\-]+$/.test(tt)&&tt.replace(/\-/g,"").length>=10?B.bankInfo.accountNumber||(B.bankInfo.accountNumber=tt):U(tt)&&!B.bankInfo.accountHolder&&(B.bankInfo.accountHolder=tt))});const he=[/\d{6}[\s\-]+\d{8}/,/\d{6}[\s\-]+\d{2}[\s\-]+\d{6}/,/\d{5,7}[\s\-]+\d{2}[\s\-]+\d{5,7}/,/\d{4}[\s\-]+\d{3}[\s\-]+\d{6}/,/\d{3}[\s\-]+\d{4}[\s\-]+\d{4}[\s\-]+\d{2}/,/\d{3}[\s\-]+\d{4}[\s\-]+\d{2}[\s\-]+\d{5,6}/,/\d{2,4}[\s\-]+\d{2,5}[\s\-]+\d{2,4}[\s\-]+\d{2,6}/,/\d{3}[\s\-]+\d{2}[\s\-]+\d{6}/,/\d{3}[\s\-]+\d{4}[\s\-]+\d{7}/,/\d{4}[\s\-]+\d{4}[\s\-]+\d{5}/,/\d{3,4}[\s\-]+\d{2,6}[\s\-]+\d{4,7}/,/\d{5,6}[\s\-]+\d{6,8}/,/\d{10,}/];let Qe="",fn=-1;for(const Ye of he){const Ve=Z.match(Ye);if(Ve&&!B.bankInfo.accountNumber){Qe=Ve[0],fn=Ve.index||-1,B.bankInfo.accountNumber=Ve[0].trim().replace(/\s+/g,"-");const rt=Z.substring(fn+Qe.length).trim().split(/\s+/);for(const it of rt){if(it.startsWith("[")||it.endsWith("]"))continue;const qe=L(it);if(U(qe)){B.bankInfo.accountHolder=qe;break}}if(!B.bankInfo.accountHolder&&ie>0){const qe=G[ie-1].split(/\s+/);for(const ot of qe){if(ot.startsWith("[")||ot.endsWith("]"))continue;const Pt=L(ot);if(U(Pt)){B.bankInfo.accountHolder=Pt;break}}}if(!B.bankInfo.accountHolder&&ie+1<G.length){const it=G[ie+1],qe=it.split(/\s+/);for(const ot of qe){if(ot.startsWith("[")||ot.endsWith("]"))continue;const Pt=L(ot);if(U(Pt)){B.bankInfo.accountHolder=Pt;break}}if(!B.bankInfo.accountHolder){const ot=it.match(/^([-]{2,6})/);if(ot){const Pt=L(ot[1].trim());U(Pt)&&(B.bankInfo.accountHolder=Pt)}}}break}}const Qt=Z.match(/[\d,]+/g);if(Qt){const Ye=Qe?Qe.split(/[\s\-]+/).filter(Ve=>Ve):[];Qt.forEach(Ve=>{const tt=parseInt(Ve.replace(/,/g,"")),rt=Ve.replace(/,/g,""),it=Ye.some(qe=>qe===rt);!B.bankInfo.accountNumber&&rt.length>=10&&rt.length<=20?(B.bankInfo.accountNumber=rt,Qe=rt):tt>=1e3&&!Oe&&!it&&(Z.includes("")||Z.includes("")?B.amounts.material=tt:Z.includes("")||Z.includes("")?B.amounts.labor=tt:B.amounts.total||(B.amounts.total=tt))})}const Mt={:"KB",KB:"KB",:"",:"",:"",:"IBK",IBK:"IBK",:"NH",NH:"NH",:"",:"",:"",:"",K:"",:"KDB",KDB:"KDB",:"",:"",:"",:"",:"",:"",SC:"SC",SC:"SC",:"SC",SC:"SC",:"",:"",:"",:""},Bt=Object.keys(Mt).sort((Ye,Ve)=>Ve.length-Ye.length);for(const Ye of Bt)if(Z.includes(Ye)){const Ve=Mt[Ye];B.bankInfo.bankName=Ve,Q=ie;const tt=new RegExp(`${Ye}(?:|)?\\s+([-a-zA-Z0-9]{2,10})`),rt=Z.match(tt);if(rt){const it=L(rt[1]);it&&!/^\d+$/.test(it)&&it!==""&&(B.bankInfo.accountHolder=it)}break}if(!B.bankInfo.bankName){const Ye=Z.match(/([-]+)(|)/);Ye&&(B.bankInfo.bankName=Ye[0])}const zn=[/\(\)[-a-zA-Z0-9]+/,/\(\)[-a-zA-Z0-9]+/,/\(\)[-a-zA-Z0-9]+/,/\s*[-a-zA-Z0-9]+/,/\s*[-a-zA-Z0-9]+/];for(const Ye of zn){const Ve=Z.match(Ye);if(Ve&&!B.bankInfo.accountHolder){B.bankInfo.accountHolder=Ve[0].trim();break}}const Qn=Z.match(/\(([-]{2,5})\)/);if(Qn&&!B.bankInfo.accountHolder){const Ye=Qn[1];U(Ye)&&!["","",""].includes(Ye)&&(B.bankInfo.accountHolder=Ye)}if(!B.bankInfo.accountHolder){const Ye=/[-]{2,6}/g,Ve=Z.match(Ye);if(Ve){const tt=Z.match(/\d{10,}/)||Z.match(/\d{3,4}[\s\-]+\d{3,4}[\s\-]+\d{3,4}[\s\-]+\d{3,4}/),rt=Z.match(/||||/);Ve.forEach(it=>{const qe=L(it),ot=_.split(`
`)[ie];if(ot&&ot.includes(`[${it}]`)||!U(qe)||["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""].includes(qe))return;const un=Z.indexOf(it);if(un>0){const nn=Z[un-1];if(/[-]/.test(nn))return}if(un+it.length<Z.length){const nn=Z[un+it.length];if(/[-]/.test(nn))return}if(!(Qn&&qe===Qn[1])){if((tt||rt)&&!B.bankInfo.accountHolder)B.bankInfo.accountHolder=qe;else if(!B.bankInfo.accountHolder){const nn=/||||/,Vs=/\d{6,}/;(ie>0&&(Vs.test(G[ie-1])||nn.test(G[ie-1]))||ie<G.length-1&&(Vs.test(G[ie+1])||nn.test(G[ie+1]))||nn.test(Z))&&(B.bankInfo.accountHolder=qe)}}})}}const Yt={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};for(const[Ye,Ve]of Object.entries(Yt))if(Z.includes(Ye)){B.vendor=Ve;break}if(ie===0&&!B.itemName){const Ye=Z.replace(/[\[\]{}()<>]/g,"").trim();Ye&&!Ye.includes(" ")&&(U(Ye)||(B.itemName=Ye.substring(0,50)))}}),Q>=0&&Q+1<G.length){const Z=G[Q+1],ie=Z.trim();if(/^[-]{2,5}$/.test(ie)&&U(ie))B.bankInfo.accountHolder=ie;else{const Ce=Z.split(/\s+/);for(const et of Ce){const Oe=L(et);if(U(Oe)){B.bankInfo.accountHolder=Oe;break}}}}}if(B.itemName&&B.itemName.includes("")&&(B.vendor=""),B.itemName){const Q=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","KB","NH","IBK","SC","","",""],Z=B.itemName.toLowerCase(),ie=Q.some(he=>Z===he.toLowerCase()||Z.startsWith(he.toLowerCase()+" ")||Z.replace(/\s+/g,"").match(/^[\d\-\s]+$/)),Ce=/^[\d\-\s]/.test(B.itemName),et=/^\d{2,}[\s\-]?\d+/.test(B.itemName.replace(/[-]/g,"").trim()),Oe=B.bankInfo.accountHolder&&(B.itemName===B.bankInfo.accountHolder||B.itemName.includes(B.bankInfo.accountHolder));(ie||Ce||et||Oe)&&(B.itemName=void 0)}return B},_e=async()=>{var _,G,B,x,L,U,X,Q,Z,ie,Ce;try{const et=ne.quickText;if(!et.trim())return;let Oe=n;n.length===0&&(console.log("payments  ,  ..."),await e(),await new Promise(Ve=>setTimeout(Ve,100)),Oe=dr.getState().payments,console.log("payments  :",Oe.length,""));const he=O(et);console.log("  :",he);const Qe={project:ne.project,date:ne.date,quickText:ne.quickText,quickImages:ne.quickImages||[],process:"",itemName:"",amount:"",accountHolder:"",bankName:"",accountNumber:"",images:[]};P(null),I(!1),re(!1);let fn=0;he.amounts.material&&(fn+=he.amounts.material),he.amounts.labor&&(fn+=he.amounts.labor),he.amounts.total&&!he.amounts.material&&!he.amounts.labor&&(fn=he.amounts.total),fn>0&&(Qe.amount=fn),he.bankInfo.bankName&&(Qe.bankName=he.bankInfo.bankName),he.bankInfo.accountHolder&&(Qe.accountHolder=he.bankInfo.accountHolder),he.bankInfo.accountNumber&&(Qe.accountNumber=he.bankInfo.accountNumber);const Qt=Ve=>Ve?Ve.replace(/[^0-9]/g,""):"",Mt=(Ve,tt)=>{if(!Ve||!tt)return!1;const rt=Qt(Ve),it=Qt(tt);if(!rt||!it)return!1;const qe=6;return rt.length<qe||it.length<qe?rt===it:it.includes(rt)||rt.includes(it)},Bt=Qt(he.bankInfo.accountNumber||""),zn=he.bankInfo.accountHolder||"";let Qn=!1;console.log("===    ==="),console.log(" :",he.bankInfo.accountNumber),console.log(" :",Bt),console.log(" :",zn),console.log(" :",Se.length),console.log("  :",Oe.filter(Ve=>Ve.status==="completed").length);let Yt=Se.find(Ve=>{const tt=Qt(Ve.accountNumber||"");return tt&&tt===Bt});if(!Yt&&Bt&&(Yt=Se.find(Ve=>{const tt=Qt(Ve.accountNumber||"");return Mt(Bt,tt)})),Yt&&(Qn=!0),!Yt&&zn&&(Yt=Se.find(Ve=>Ve.name===zn),Yt)){console.log("  :",Yt.name);const Ve=((_=Yt.accountNumber)==null?void 0:_.replace(/[-\s]/g,""))||"";Bt&&!Mt(Bt,Ve)?(console.log("    ( ) -  "),Qn=!1):Qn=!0}if(Yt&&(Yt.name&&(Qe.accountHolder=Yt.name,console.log("  :",Yt.name)),Yt.bankName?Qe.bankName=Yt.bankName:he.bankInfo.bankName&&(Qe.bankName=he.bankInfo.bankName),Qn&&(Qe.accountNumber=Yt.accountNumber||he.bankInfo.accountNumber),P(Yt.id||Yt._id||null),Yt.process&&(Qe.process=Yt.process)),!Yt){let Ve=!1;console.log("===     ==="),console.log("  payments :",Oe.length,""),console.log(" :",Bt),console.log(" :",zn);const tt=Oe.filter(ot=>ot.status==="completed");console.log(" :",tt.length);const rt=[...new Set(tt.map(ot=>{var Pt;return(Pt=ot.bankInfo)==null?void 0:Pt.accountHolder}).filter(Boolean))];console.log("   ( 20):",rt.slice(0,20)),console.log("  ():",Bt);const it=tt.filter(ot=>{var Pt;return(Pt=ot.bankInfo)==null?void 0:Pt.accountNumber}).map(ot=>{var Pt,un,nn;return{holder:(Pt=ot.bankInfo)==null?void 0:Pt.accountHolder,account:(un=ot.bankInfo)==null?void 0:un.accountNumber,clean:Qt(((nn=ot.bankInfo)==null?void 0:nn.accountNumber)||"")}}).filter(ot=>ot.clean.includes(Bt.substring(0,6))||Bt.includes(ot.clean.substring(0,6)));console.log("  :",it);let qe=Oe.find(ot=>{var nn;const Pt=Qt(((nn=ot.bankInfo)==null?void 0:nn.accountNumber)||"");return Pt&&Pt===Bt&&ot.status==="completed"});if(qe&&console.log("   :",(G=qe.bankInfo)==null?void 0:G.accountHolder,qe.process),!qe&&Bt&&(qe=Oe.find(ot=>{var un;const Pt=Qt(((un=ot.bankInfo)==null?void 0:un.accountNumber)||"");return Mt(Bt,Pt)&&ot.status==="completed"}),qe&&console.log("   :",(B=qe.bankInfo)==null?void 0:B.accountHolder,qe.process)),qe&&(Ve=!0),!qe&&zn&&(qe=Oe.find(ot=>{var Pt;return((Pt=ot.bankInfo)==null?void 0:Pt.accountHolder)===zn&&ot.status==="completed"}),qe)){console.log("    :",(x=qe.bankInfo)==null?void 0:x.accountHolder,":",qe.process);const ot=Qt(((L=qe.bankInfo)==null?void 0:L.accountNumber)||"");Bt&&!Mt(Bt,ot)?(console.log("    ( ) -  "),Ve=!1):Ve=!0}qe?(console.log(" :",{accountHolder:(U=qe.bankInfo)==null?void 0:U.accountHolder,accountNumber:(X=qe.bankInfo)==null?void 0:X.accountNumber,bankName:(Q=qe.bankInfo)==null?void 0:Q.bankName,process:qe.process,status:qe.status,paymentMatchedByAccountNumber:Ve}),(Z=qe.bankInfo)!=null&&Z.accountHolder&&(Qe.accountHolder=qe.bankInfo.accountHolder,console.log("  :",qe.bankInfo.accountHolder)),(ie=qe.bankInfo)!=null&&ie.bankName?Qe.bankName=qe.bankInfo.bankName:he.bankInfo.bankName&&(Qe.bankName=he.bankInfo.bankName),Ve&&(Qe.accountNumber=((Ce=qe.bankInfo)==null?void 0:Ce.accountNumber)||he.bankInfo.accountNumber),qe.process&&!Qe.process?(Qe.process=qe.process,console.log("    :",qe.process)):console.log("   - process:",qe.process,"updatedFormData.process:",Qe.process)):console.log("  ")}if(he.vendor&&(Qe.process=he.vendor),!Qe.process){const Ve=et.toLowerCase();for(const tt of Fm)if(Ve.includes(tt.toLowerCase())){Qe.process=tt;break}}he.itemName&&(Qe.itemName=he.itemName),Ze(Qe),he.includeVat&&(I(!0),re(!1));const Ye=[];if(he.amounts.material||he.amounts.labor||he.amounts.total){const Ve=[];he.amounts.material&&Ve.push(`: ${he.amounts.material.toLocaleString()}`),he.amounts.labor&&Ve.push(`: ${he.amounts.labor.toLocaleString()}`),he.amounts.total&&!he.amounts.material&&!he.amounts.labor&&Ve.push(`: ${he.amounts.total.toLocaleString()}`),Ye.push(Ve.join(", "))}if(he.bankInfo.bankName||he.bankInfo.accountHolder){const Ve=[];he.bankInfo.bankName&&Ve.push(he.bankInfo.bankName),he.bankInfo.accountHolder&&Ve.push(he.bankInfo.accountHolder),he.bankInfo.accountNumber&&Ve.push(he.bankInfo.accountNumber),Ve.length>0&&Ye.push(`: ${Ve.join(" ")}`)}he.vendor&&Ye.push(`: ${he.vendor}`),he.includeVat&&Ye.push("  "),Ye.length>0?oe.success(`  !
${Ye.join(`
`)}`,{duration:4e3,style:{whiteSpace:"pre-line"}}):oe.info("  ...    .")}catch(et){console.error(" :",et),oe.error("   .")}};E.useEffect(()=>{(async()=>{try{await LT();const G=await ST();st(G),$n(!0)}catch(G){console.error("  :",G),$n(!0)}})()},[]);const ke=E.useRef({});E.useEffect(()=>{we&&(Object.entries(We).forEach(([_,G])=>{JSON.stringify(ke.current[_])!==JSON.stringify(G)&&TT(_,G).catch(B=>{console.error("  :",B),oe.error("  ")})}),ke.current={...We})},[We,we]);const je=E.useCallback(async _=>{var x;const G=(x=_.clipboardData)==null?void 0:x.items;if(!G)return;let B=!1;for(let L=0;L<G.length;L++)if(G[L].type.indexOf("image")!==-1){B=!0;break}if(B){if(!f){const L=document.activeElement;(L==null?void 0:L.tagName)==="INPUT"||(L==null?void 0:L.tagName)==="TEXTAREA"||(L==null?void 0:L.classList.contains("form-input"))||oe.error("  ");return}for(let L=0;L<G.length;L++)if(G[L].type.indexOf("image")!==-1){_.preventDefault();const U=G[L].getAsFile();if(U){const X=new FileReader;X.onload=async Q=>{var ie;const Z=(ie=Q.target)==null?void 0:ie.result;if(Z)try{const Ce=n.find(he=>he.id===f),Oe=[...(Ce==null?void 0:Ce.images)||We[f]||[],Z];await gs.updatePaymentImages(f,Oe),st(he=>({...he,[f]:Oe})),await e(),oe.success(" ")}catch(Ce){console.error("  :",Ce),oe.error("  ")}},X.readAsDataURL(U)}}}},[f,n,We,e]);E.useEffect(()=>(document.addEventListener("paste",je),()=>document.removeEventListener("paste",je)),[je]);const kt=[...(l==null?void 0:l.name)===""?n.filter(_=>u.some(G=>G.name===_.project)):n].sort((_,G)=>new Date(G.requestDate).getTime()-new Date(_.requestDate).getTime()),xt=kt.filter(_=>{var U,X,Q;if(!_||!_.id)return!1;const G=m===""||((U=_.purpose)==null?void 0:U.toLowerCase().includes(m.toLowerCase()))||((X=_.itemName)==null?void 0:X.toLowerCase().includes(m.toLowerCase()))||((Q=_.process)==null?void 0:Q.toLowerCase().includes(m.toLowerCase())),B=ge==="pending"?_.status!=="completed":_.status==="completed",x=ht==="all"||!ht||_.project===ht,L=!qt||ge!=="completed"||_.requestedBy===(l==null?void 0:l.name);return G&&B&&x&&L}).sort((_,G)=>!_&&!G?0:_?G?ge==="completed"?Dc(G.completionDate)-Dc(_.completionDate):Dc(G.requestDate)-Dc(_.requestDate):-1:1),tn=_=>{const G=_.id||_._id||null;if(dt===G){P(null);const U=document.querySelector('input[placeholder=" "]');U&&setTimeout(()=>{U.focus()},100);return}P(G);const B=al(_.name);let x=_.bankName||"",L=_.accountNumber||"";if(L&&!x){const U=L.trim().split(/\s+/);if(U.length>=2){const X=U[0];(X.includes("")||X.includes("")||X.includes("")||X.includes("")||X.includes(""))&&(x=X,L=U.slice(1).join(""))}}Ze(U=>({...U,accountHolder:B,bankName:x,accountNumber:L}))};xt.reduce((_,G)=>{const B=G.materialAmount||0,x=G.laborAmount||0,L=G.amount||0;let U=B,X=x,Q=0;return B===0&&x===0&&L>0?G.includesVAT?(U=Math.round(L/1.1),Q=L-U):(U=L,Q=0):G.includesVAT?(B>0&&(U=Math.round(B/1.1)),x>0&&(X=Math.round(x/1.1)),Q=L-(U+X)):Q=0,_.material+=U,_.labor+=X,_.vat+=Q,_.total+=L,_},{material:0,labor:0,vat:0,total:0});const At=async()=>{var G;if(ft){console.log(" Already submitting, ignoring click");return}if(console.log(" handleSave called"),console.log(" Current user:",l),console.log(" Form data:",ne),!ne.project){oe.error(" ");return}if(!ne.itemName){oe.error(" ");return}const _=Number(ne.amount)||0;if(_===0){oe.error(" ");return}Nn(!0);try{const B=F?Math.round(_*.967):_,x=new Date;if(y){const L={project:ne.project,requestDate:new Date(ne.date),purpose:ne.itemName,amount:B,category:"material",urgency:"normal",process:ne.process,itemName:ne.itemName,includesVAT:R,applyTaxDeduction:F,materialAmount:B,laborAmount:0,originalLaborAmount:0,accountHolder:ne.accountHolder,bank:ne.bankName,accountNumber:ne.accountNumber,bankInfo:ne.accountHolder||ne.bankName||ne.accountNumber?{accountHolder:ne.accountHolder,bankName:ne.bankName,accountNumber:ne.accountNumber}:void 0,updatedAt:x};console.log(" Updating payment:",L),await i(y,L),oe.success(" "),C(null)}else{const L=ne.project||"",U={id:`payment_${Date.now()}`,project:L,requestDate:new Date(ne.date),requestedBy:(l==null?void 0:l.name)||"  ",purpose:ne.itemName,amount:B,status:"pending",category:"material",urgency:"normal",process:ne.process,itemName:ne.itemName,includesVAT:R,applyTaxDeduction:F,materialAmount:B,laborAmount:0,originalLaborAmount:0,accountHolder:ne.accountHolder,bank:ne.bankName,accountNumber:ne.accountNumber,bankInfo:ne.accountHolder||ne.bankName||ne.accountNumber?{accountHolder:ne.accountHolder,bankName:ne.bankName,accountNumber:ne.accountNumber}:void 0,quickText:ne.quickText||"",images:ne.quickImages,attachments:[],createdAt:x,updatedAt:x};console.log(" Creating payment:",U),console.log(" Images in payment:",((G=ne.quickImages)==null?void 0:G.length)||0,"");const X=await s(U);if(Fe.current=X,setTimeout(()=>{Fe.current=null},1e4),oe.success(" "),ne.accountHolder&&ne.bankName&&ne.accountNumber){const Q=R||F?"01074088864":"01089423283";try{await gs.sendTossPaymentSms({recipientPhone:Q,accountHolder:ne.accountHolder,bankName:ne.bankName,accountNumber:ne.accountNumber,amount:B,projectName:L,itemName:ne.itemName,process:ne.process,paymentId:X}),oe.success("   ")}catch(Z){console.error("SMS  :",Z)}}}Ze(L=>({project:L.project,date:$t(new Date,"yyyy-MM-dd"),process:"",itemName:"",materialCost:"",laborCost:"",amount:"",accountHolder:"",bankName:"",accountNumber:"",images:[],quickText:"",quickImages:[]})),I(!1),re(!1),P(null),window.innerWidth<768&&j("list")}catch(B){console.error(" Payment save error:",B),oe.error("  : "+B.message)}finally{Nn(!1)}},xn=_=>{var G,B,x,L;try{console.log("[handleEdit] Starting edit for payment:",_.id);const U=_.originalMaterialAmount!==void 0?_.originalMaterialAmount:_.materialAmount||0,X=_.originalLaborAmount!==void 0?_.originalLaborAmount:_.laborAmount||0,Q={project:_.project||"",date:_.requestDate?$t(new Date(_.requestDate),"yyyy-MM-dd"):$t(new Date,"yyyy-MM-dd"),process:_.process||"",itemName:_.itemName||_.purpose||"",materialCost:U>0?U.toString():"",laborCost:X>0?X.toString():"",amount:((G=_.amount)==null?void 0:G.toString())||"",accountHolder:((B=_.bankInfo)==null?void 0:B.accountHolder)||"",bankName:((x=_.bankInfo)==null?void 0:x.bankName)||"",accountNumber:((L=_.bankInfo)==null?void 0:L.accountNumber)||"",images:_.attachments||[],quickText:_.quickText||"",quickImages:_.images||[]};console.log("[handleEdit] Setting form data:",Q),Ze(Q),I(_.includesVAT||!1),re(_.applyTaxDeduction||!1),p(_.id),C(_.id),T&&j("form"),console.log("[handleEdit] Edit setup complete"),oe.success("  ")}catch(U){console.error("[handleEdit] Error:",U),oe.error("     ")}},cn=async _=>{var G,B,x;try{const L=((G=_.bankInfo)==null?void 0:G.accountHolder)||_.accountHolder,U=((B=_.bankInfo)==null?void 0:B.bankName)||_.bank,X=((x=_.bankInfo)==null?void 0:x.accountNumber)||_.accountNumber;if(!L||!U||!X){oe.error("  .    .");return}if(!window.confirm(`  ?

: 
: ${U}
: ${X}
: ${_.amount.toLocaleString()}`))return;const Z=X.replace(/[-\s]/g,""),ie=s2[U]||U,Ce=n2[U]||"004",et="",Oe=`supertoss://send?amount=${_.amount}&bankCode=${Ce}&bank=${encodeURIComponent(ie)}&accountNo=${Z}&receiverName=${encodeURIComponent(et)}&toName=${encodeURIComponent(et)}`;let he=!1;try{window.location.href=Oe,he=!0,oe.success("  ...",{duration:3e3}),setTimeout(()=>{const Qe=/iPhone|iPad|iPod/i.test(navigator.userAgent),fn=/Android/i.test(navigator.userAgent);(Qe||fn)&&oe(`      .

: 
: ${X}
: ${_.amount.toLocaleString()}

    .`,{icon:"",duration:8e3})},2e3)}catch(Qe){console.error("   :",Qe),oe(`   .

: 
: ${U}
: ${X}
: ${_.amount.toLocaleString()}

    .`,{icon:"",duration:1e4})}}catch(L){console.error(" :",L),oe.error(`   : ${L.message}`)}},Hn=async _=>{const G=n.find(B=>B.id===_);if(G&&G.quickText){const B=localStorage.getItem("executionMemos"),x=B?JSON.parse(B):{};x[_]=G.quickText,localStorage.setItem("executionMemos",JSON.stringify(x))}o(_,{status:"completed",completionDate:new Date}),de(!1),He("completed"),oe.success(" "),window.dispatchEvent(new CustomEvent("paymentCompleted"));try{await i(_,{status:"completed"});const B=Rr.getSocket();B&&B.emit("payment:refresh",{paymentId:_,status:"completed"})}catch(B){console.error(" API :",B),o(_,{status:"pending",completionDate:void 0}),He("pending"),oe.error("   -  ")}},Ds=async _=>{var x;if(!f){oe.error("  ");return}const B=Array.from(((x=_.target)==null?void 0:x.files)||[]).filter(L=>L.type.startsWith("image/"));if(B.length!==0){try{const L=await Promise.all(B.map(Z=>new Promise((ie,Ce)=>{const et=new FileReader;et.onload=Oe=>{var Qe;const he=(Qe=Oe.target)==null?void 0:Qe.result;he?ie(he):Ce(new Error("  "))},et.onerror=()=>Ce(new Error("FileReader ")),et.readAsDataURL(Z)}))),U=n.find(Z=>Z.id===f),Q=[...(U==null?void 0:U.images)||We[f]||[],...L];await gs.updatePaymentImages(f,Q),st(Z=>({...Z,[f]:Q})),await e(),oe.success(`${L.length}  `)}catch(L){console.error("  :",L),oe.error("  ")}_.target.value=""}},ss=async _=>{if(f)try{const G=n.find(L=>L.id===f),x=((G==null?void 0:G.images)||We[f]||[]).filter((L,U)=>U!==_);await gs.updatePaymentImages(f,x),st(L=>({...L,[f]:x})),await e()}catch(G){console.error("  :",G),oe.error("  ")}},ks=_=>{N(_),M(!0)},fi=_=>{_.preventDefault(),w(!0)},Fs=_=>{_.preventDefault(),w(!1)},as=async _=>{if(_.preventDefault(),w(!1),!f){oe.error("  ");return}const B=Array.from(_.dataTransfer.files).filter(x=>x.type.startsWith("image/"));if(B.length!==0)try{const x=await Promise.all(B.map(Q=>new Promise((Z,ie)=>{const Ce=new FileReader;Ce.onload=et=>{var he;const Oe=(he=et.target)==null?void 0:he.result;Oe?Z(Oe):ie(new Error("  "))},Ce.onerror=()=>ie(new Error("FileReader ")),Ce.readAsDataURL(Q)}))),L=n.find(Q=>Q.id===f),X=[...(L==null?void 0:L.images)||We[f]||[],...x];await gs.updatePaymentImages(f,X),st(Q=>({...Q,[f]:X})),await e(),oe.success(`${x.length}  `)}catch(x){console.error("  :",x),oe.error("  ")}};return a.jsxDEV("div",{className:"space-y-3 md:space-y-4",children:[a.jsxDEV("div",{className:"lg:hidden mb-4",children:a.jsxDEV("select",{value:ne.project,onChange:_=>{Ze({...ne,project:_.target.value}),_.target.value&&localStorage.setItem("lastSelectedProject",_.target.value)},className:"w-full px-3 py-2.5 md:py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-10",children:[(l==null?void 0:l.name)!==""&&a.jsxDEV("option",{value:"",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2511,columnNumber:35},void 0),u.filter(_=>_.status!=="completed").map(_=>a.jsxDEV("option",{value:_.name,children:_.name},_.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2513,columnNumber:13},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2501,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2500,columnNumber:7},void 0),a.jsxDEV("div",{className:"lg:hidden border-b border-gray-200 mb-4",children:a.jsxDEV("div",{className:"flex items-center justify-between",children:a.jsxDEV("nav",{className:"flex space-x-4",children:[a.jsxDEV("button",{onClick:()=>j("form"),className:`py-2 px-1 border-b-2 font-medium text-sm ${V==="form"?"border-gray-900 text-gray-900":"border-transparent text-gray-500"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2522,columnNumber:13},void 0),a.jsxDEV("button",{onClick:()=>j("list"),className:`py-2 px-1 border-b-2 font-medium text-sm ${V==="list"?"border-gray-900 text-gray-900":"border-transparent text-gray-500"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2532,columnNumber:13},void 0),a.jsxDEV("button",{onClick:()=>j("image"),className:`py-2 px-1 border-b-2 font-medium text-sm ${V==="image"?"border-gray-900 text-gray-900":"border-transparent text-gray-500"}`,children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2542,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2521,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2520,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2519,columnNumber:7},void 0),a.jsxDEV("div",{className:"payment-container grid grid-cols-1 md:grid-cols-6 ipad:grid-cols-6 ipad-lg:grid-cols-6 ipad-xl:grid-cols-12 ipad-2xl:grid-cols-12 gap-3 md:gap-4",children:[a.jsxDEV("div",{className:`payment-form md:col-span-2 ipad:col-span-2 ipad-lg:col-span-2 ipad-xl:col-span-2 ipad-2xl:col-span-2 bg-white rounded-lg border p-3 md:p-4 overflow-y-auto h-[calc(100vh-180px)] ${V!=="form"?"hidden md:block":""}`,children:a.jsxDEV("div",{className:"space-y-4",children:[a.jsxDEV("div",{className:"hidden lg:block payment-project-row",children:a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("select",{value:ne.project,onChange:_=>{Ze({...ne,project:_.target.value}),_.target.value&&localStorage.setItem("lastSelectedProject",_.target.value)},className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-10",children:[(l==null?void 0:l.name)!==""&&a.jsxDEV("option",{value:"",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2577,columnNumber:43},void 0),u.filter(_=>_.status!=="completed").map(_=>a.jsxDEV("option",{value:_.name,children:_.name},_.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2579,columnNumber:21},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2567,columnNumber:17},void 0),a.jsxDEV("select",{value:ne.bankName,onChange:_=>Ze({...ne,bankName:_.target.value}),className:"payment-bank-select hidden px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-8",children:[a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2587,columnNumber:19},void 0),a.jsxDEV("option",{value:"KB",children:"KB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2588,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2589,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2590,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2591,columnNumber:19},void 0),a.jsxDEV("option",{value:"NH",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2592,columnNumber:19},void 0),a.jsxDEV("option",{value:"IBK",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2593,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2594,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2595,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2596,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2597,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2598,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2599,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2582,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2566,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2565,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("textarea",{value:ne.quickText,onChange:_=>Ze({...ne,quickText:_.target.value}),onPaste:_=>{var B;const G=(B=_.clipboardData)==null?void 0:B.items;if(G){for(let x=0;x<G.length;x++)if(G[x].type.indexOf("image")!==-1){_.preventDefault();const L=G[x].getAsFile();if(L){const U=new FileReader;U.onload=X=>{var Z;const Q=(Z=X.target)==null?void 0:Z.result;Ze(ie=>({...ie,quickImages:[...ie.quickImages,Q]}))},U.readAsDataURL(L)}break}}},onDragOver:_=>{_.preventDefault(),_.stopPropagation()},onDrop:_=>{_.preventDefault(),_.stopPropagation(),Array.from(_.dataTransfer.files).filter(x=>x.type.startsWith("image/")).forEach(x=>{const L=new FileReader;L.onload=U=>{var Q;const X=(Q=U.target)==null?void 0:Q.result;Ze(Z=>({...Z,quickImages:[...Z.quickImages,X]}))},L.readAsDataURL(x)})},rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:T?"  ":"   (   Ctrl+V)"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2606,columnNumber:15},void 0),ne.quickImages.length>0&&a.jsxDEV("div",{className:"mt-2 mb-2 grid grid-cols-3 gap-2",children:ne.quickImages.map((_,G)=>a.jsxDEV("div",{className:"relative group",children:[a.jsxDEV("img",{src:_,alt:` ${G+1}`,className:"w-full h-20 object-cover rounded-lg border"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2661,columnNumber:23},void 0),a.jsxDEV("button",{type:"button",onClick:()=>{Ze(B=>({...B,quickImages:B.quickImages.filter((x,L)=>L!==G)}))},className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2666,columnNumber:23},void 0)]},G,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2660,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2658,columnNumber:17},void 0),a.jsxDEV("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[a.jsxDEV("label",{className:"cursor-pointer",children:[a.jsxDEV("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:_=>{Array.from(_.target.files||[]).forEach(B=>{const x=new FileReader;x.onload=L=>{var X;const U=(X=L.target)==null?void 0:X.result;Ze(Q=>({...Q,quickImages:[...Q.quickImages,U]}))},x.readAsDataURL(B)}),_.target.value=""}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2685,columnNumber:19},void 0),a.jsxDEV("div",{className:"w-full h-10 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium border border-gray-300",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2706,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2684,columnNumber:17},void 0),a.jsxDEV("button",{type:"button",onClick:_e,className:"h-10 flex items-center justify-center bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors text-sm font-medium",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2710,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2683,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2605,columnNumber:13},void 0),a.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[" ",ne.date&&`(${$t(new Date(ne.date),"E",{locale:Vn})})`]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2723,columnNumber:17},void 0),a.jsxDEV("input",{type:"date",value:ne.date,onChange:_=>Ze({...ne,date:_.target.value}),className:"w-full px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 cursor-pointer text-gray-900",style:{WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundColor:"white",backgroundImage:"none"}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2726,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2722,columnNumber:15},void 0),a.jsxDEV("div",{className:"relative",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2742,columnNumber:17},void 0),a.jsxDEV("button",{ref:$e,type:"button",onClick:()=>Ee(!0),className:"w-full px-3 py-2 border rounded-lg text-left bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",children:ne.process||a.jsxDEV("span",{className:"text-gray-400",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2749,columnNumber:40},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2743,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2741,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2721,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2756,columnNumber:15},void 0),a.jsxDEV("input",{type:"text",value:ne.itemName,onChange:_=>Ze({...ne,itemName:_.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2757,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2755,columnNumber:13},void 0),a.jsxDEV("div",{className:"space-y-2 payment-amount-section",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2768,columnNumber:17},void 0),a.jsxDEV("div",{className:"relative",children:[a.jsxDEV("input",{type:"text",value:ne.amount?Number(ne.amount).toLocaleString():"",onChange:_=>{const G=_.target.value.replace(/[^0-9]/g,"");Ze({...ne,amount:G})},className:"w-full px-3 py-2 pr-8 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2770,columnNumber:19},void 0),a.jsxDEV("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2781,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2769,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2767,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex items-center gap-4",children:[a.jsxDEV("button",{type:"button",className:"flex items-center cursor-pointer",onMouseDown:_=>_.preventDefault(),onClick:()=>{R||re(!1),I(!R)},children:[a.jsxDEV("div",{className:`h-4 w-4 border rounded flex items-center justify-center ${R?"bg-gray-600 border-gray-600":"border-gray-300"}`,children:R&&a.jsxDEV("span",{className:"text-white text-xs",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2799,columnNumber:36},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2798,columnNumber:19},void 0),a.jsxDEV("span",{className:"ml-2 text-sm text-gray-700",children:"  (10%)"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2801,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2787,columnNumber:17},void 0),a.jsxDEV("button",{type:"button",className:"flex items-center cursor-pointer",onMouseDown:_=>_.preventDefault(),onClick:()=>{F||I(!1),re(!F)},children:[a.jsxDEV("div",{className:`h-4 w-4 border rounded flex items-center justify-center ${F?"bg-gray-600 border-gray-600":"border-gray-300"}`,children:F&&a.jsxDEV("span",{className:"text-white text-xs",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2817,columnNumber:45},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2816,columnNumber:19},void 0),a.jsxDEV("span",{className:"ml-2 text-sm text-gray-700",children:"3.3% "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2819,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2805,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2786,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2766,columnNumber:13},void 0),a.jsxDEV("div",{className:"payment-account-section border-t pt-3 space-y-2",children:[(Tt.length>0||q.length>0&&!dt)&&a.jsxDEV("div",{className:"payment-suggestions-row grid grid-cols-2 gap-2",children:[a.jsxDEV("div",{className:`payment-contractor-suggestions bg-amber-50 border border-amber-200 rounded-lg p-2 ${Tt.length===0?"hidden":""}`,children:[a.jsxDEV("label",{className:"block text-xs font-medium text-amber-900 mb-1",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2835,columnNumber:21},void 0),a.jsxDEV("div",{className:"space-y-1 max-h-56 overflow-y-auto",children:Tt.map(_=>{const G=_.id||_._id,B=dt===G;return a.jsxDEV("button",{type:"button",onClick:()=>tn(_),className:`w-full text-left px-2 py-1.5 rounded border transition-colors ${B?"border-gray-900 bg-gray-50":"border-gray-200 hover:border-gray-400 hover:bg-gray-50"}`,children:[a.jsxDEV("div",{className:"font-medium text-xs text-gray-900",children:al(_.name)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2851,columnNumber:29},void 0),a.jsxDEV("div",{className:"text-[10px] text-gray-500 truncate",children:[_.bankName||""," ",_.accountNumber||""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2854,columnNumber:29},void 0)]},G,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2841,columnNumber:27},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2836,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2832,columnNumber:19},void 0),a.jsxDEV("div",{className:`payment-history-suggestions bg-blue-50 border border-blue-200 rounded-lg p-2 ${q.length===0||dt?"hidden":""}`,children:[a.jsxDEV("label",{className:"block text-xs font-medium text-blue-900 mb-1",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2867,columnNumber:21},void 0),a.jsxDEV("div",{className:"space-y-1 max-h-56 overflow-y-auto",children:q.map((_,G)=>a.jsxDEV("button",{type:"button",onClick:()=>{Ze(B=>({...B,accountHolder:_.accountHolder,bankName:_.bankName,accountNumber:_.accountNumber})),te([])},className:"w-full text-left px-2 py-1.5 rounded border border-blue-200 bg-white hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[a.jsxDEV("div",{className:"font-medium text-xs text-gray-900",children:_.accountHolder},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2884,columnNumber:27},void 0),a.jsxDEV("div",{className:"text-[10px] text-gray-500 truncate",children:[_.bankName," ",_.accountNumber]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2887,columnNumber:27},void 0)]},G,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2870,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2868,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2864,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2830,columnNumber:17},void 0),a.jsxDEV("div",{className:"relative",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2899,columnNumber:17},void 0),a.jsxDEV("input",{type:"text",value:ne.accountHolder,onChange:_=>Ze({...ne,accountHolder:_.target.value}),onFocus:()=>Ie(!0),onBlur:()=>setTimeout(()=>Ie(!1),150),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2900,columnNumber:17},void 0),fe&&ve.length>0&&a.jsxDEV("div",{className:"absolute z-20 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-48 overflow-y-auto",children:ve.map((_,G)=>a.jsxDEV("button",{type:"button",className:"w-full px-3 py-2 text-left hover:bg-gray-100 border-b last:border-b-0 flex justify-between items-center",onMouseDown:B=>B.preventDefault(),onClick:()=>{let B=_.bankName||"",x=_.accountNumber||"";const L=["KB","","","","","","","","","NH","","","IBK","","","SC","","","","","","","","","","","","","KDB","","","","","","","","",""],U={:"KB",:"KB",:"",:"",:"",:"NH",:"NH",:"IBK",:"IBK",:"SC",:"",:"",:"",:"",:"KDB",:""};for(const X of L)if(x.includes(X)){B||(B=U[X]||X),x=x.replace(X,"").trim();break}for(const X of L)if(B.includes(X)){const Q=U[X]||X,Z=B.replace(X,"").trim();Z&&/\d/.test(Z)&&(x=Z),B=Q;break}x=x.replace(/[^\d\-]/g,"").trim(),Ze({...ne,accountHolder:_.name,bankName:B||ne.bankName,accountNumber:x||ne.accountNumber}),Ie(!1)},children:[a.jsxDEV("span",{className:"font-medium",children:_.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3e3,columnNumber:25},void 0),a.jsxDEV("span",{className:"text-xs text-gray-500",children:_.source==="contractor"?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3001,columnNumber:25},void 0)]},`${_.name}-${G}`,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2913,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2911,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2898,columnNumber:15},void 0),a.jsxDEV("div",{className:"payment-bank-field",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3012,columnNumber:17},void 0),a.jsxDEV("select",{value:ne.bankName,onChange:_=>Ze({...ne,bankName:_.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:[a.jsxDEV("option",{value:"",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3018,columnNumber:19},void 0),a.jsxDEV("option",{value:"KB",children:"KB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3019,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3020,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3021,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3022,columnNumber:19},void 0),a.jsxDEV("option",{value:"NH",children:"NH"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3023,columnNumber:19},void 0),a.jsxDEV("option",{value:"IBK",children:"IBK"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3024,columnNumber:19},void 0),a.jsxDEV("option",{value:"SC",children:"SC"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3025,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3026,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3027,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3028,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3029,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3030,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3031,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3032,columnNumber:19},void 0),a.jsxDEV("option",{value:"KDB",children:"KDB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3033,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3034,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3035,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3036,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3037,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3038,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3039,columnNumber:19},void 0),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3040,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3013,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3011,columnNumber:15},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3045,columnNumber:17},void 0),a.jsxDEV("input",{type:"text",value:ne.accountNumber,onChange:_=>Ze({...ne,accountNumber:_.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3046,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3044,columnNumber:15},void 0),a.jsxDEV("div",{className:"pt-2 border-t",children:a.jsxDEV("div",{className:"flex justify-between items-baseline",children:[a.jsxDEV("span",{className:"font-medium",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3057,columnNumber:19},void 0),a.jsxDEV("div",{className:"text-right",children:[(R||F)&&a.jsxDEV("span",{className:"text-xs text-gray-500 mr-2",children:["(",R&&" ",F&&"3.3% ",")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3060,columnNumber:23},void 0),a.jsxDEV("span",{className:"font-semibold",children:[(()=>{const _=Number(ne.amount)||0;let G=_;return F&&(G=Math.round(_*.967)),G.toLocaleString()})(),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3064,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3058,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3056,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3055,columnNumber:15},void 0),a.jsxDEV("div",{className:"mt-6 lg:my-[50px]",children:[y&&a.jsxDEV("button",{onClick:()=>{C(null),Ze(_=>({project:_.project,date:$t(new Date,"yyyy-MM-dd"),process:"",itemName:"",materialCost:"",laborCost:"",amount:"",accountHolder:"",bankName:"",accountNumber:"",images:[],quickText:"",quickImages:[]})),I(!1),re(!1),P(null),oe.info(" ")},className:"w-full py-2 mb-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 touch-manipulation",style:{minHeight:"48px"},children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3083,columnNumber:19},void 0),a.jsxDEV("button",{onClick:_=>{console.log(" Payment button clicked!",_),console.log(" Button element:",_.currentTarget),console.log(" Form data:",ne),At()},disabled:ft,className:`w-full py-3 rounded-lg touch-manipulation font-medium text-base ${ft?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800 active:bg-gray-950"}`,style:{minHeight:"48px",WebkitTapHighlightColor:"transparent"},children:ft?"...":y?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3112,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3081,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2827,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2563,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2560,columnNumber:9},void 0),a.jsxDEV("div",{className:`payment-list md:col-span-4 ipad:col-span-4 ipad-lg:col-span-4 ipad-xl:col-span-4 ipad-2xl:col-span-4 bg-white rounded-lg border overflow-hidden flex flex-col h-[calc(100vh-180px)] ${V!=="list"?"hidden md:flex":""}`,children:[a.jsxDEV("div",{className:"bg-gray-50 px-4 pt-3 pb-0 flex-shrink-0",children:a.jsxDEV("div",{className:"flex items-center justify-between gap-4",children:a.jsxDEV("nav",{className:"flex gap-2 overflow-x-auto flex-1",children:[a.jsxDEV("button",{onClick:()=>He("pending"),className:`px-4 py-2.5 rounded-t-lg font-medium text-sm transition-all whitespace-nowrap flex items-center gap-2 ${ge==="pending"?"bg-white text-gray-900 shadow-sm border-b-2 border-gray-900":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:["",a.jsxDEV("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${ge==="pending"?"bg-gray-900 text-white":"bg-gray-300 text-gray-600"}`,children:kt.filter(_=>_&&_.id&&_.status!=="completed").length},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3151,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3142,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{He("completed"),Ze(_=>({..._,project:""}))},className:`px-4 py-2.5 rounded-t-lg font-medium text-sm transition-all whitespace-nowrap flex items-center gap-2 ${ge==="completed"?"bg-white text-gray-900 shadow-sm border-b-2 border-gray-900":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:["",a.jsxDEV("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${ge==="completed"?"bg-gray-900 text-white":"bg-gray-300 text-gray-600"}`,children:kt.filter(_=>_&&_.id&&_.status==="completed").length},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3170,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3157,columnNumber:17},void 0),ge==="completed"&&a.jsxDEV("label",{className:"ml-3 flex items-center gap-1.5 cursor-pointer text-xs text-gray-600",children:[a.jsxDEV("input",{type:"checkbox",checked:qt,onChange:_=>{le(_.target.checked),localStorage.setItem("payments_showMyRequestsOnly",String(_.target.checked))},className:"w-3.5 h-3.5 rounded border-gray-300 text-gray-600 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3179,columnNumber:21},void 0)," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3178,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3141,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3140,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3139,columnNumber:11},void 0),a.jsxDEV("div",{className:"border-b border-gray-200"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3194,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex-1 overflow-auto p-4",children:xt.length>0?a.jsxDEV("div",{className:"space-y-4",children:xt.map(_=>{var X,Q,Z;const G=_.amount||0,B=((X=_.bankInfo)==null?void 0:X.accountHolder)||_.accountHolder||"",x=((Q=_.bankInfo)==null?void 0:Q.bankName)||_.bank||"",L=((Z=_.bankInfo)==null?void 0:Z.accountNumber)||_.accountNumber||"",U=B&&x&&L?`${B} | ${x} ${L}`:" ";return a.jsxDEV("div",{onClick:()=>p(_.id),className:`border rounded-lg p-3 cursor-pointer transition-colors ${f===_.id?"border-gray-900 bg-gray-50":"border-gray-200 bg-white hover:border-gray-400"}`,children:[a.jsxDEV("div",{className:"flex justify-between items-start mb-2.5",children:[a.jsxDEV("div",{className:"flex-1 min-w-0",children:[a.jsxDEV("div",{className:"flex items-baseline gap-2",children:[_.process&&a.jsxDEV("span",{className:"text-xs text-gray-500 shrink-0",children:["[",_.process,"]"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3226,columnNumber:31},void 0),a.jsxDEV("h3",{className:"font-semibold text-gray-900 text-sm truncate",children:_.purpose||_.itemName||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3228,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3224,columnNumber:27},void 0),a.jsxDEV("p",{className:"text-xs text-gray-500 mt-0.5",children:_.project||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3232,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3223,columnNumber:25},void 0),a.jsxDEV("div",{className:"text-right ml-3 shrink-0",children:[a.jsxDEV("p",{className:"text-base font-bold text-gray-900",children:[G.toLocaleString(),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3235,columnNumber:27},void 0),a.jsxDEV("p",{className:"text-[10px] text-gray-400",children:[_.requestedBy||"-","  ",Ay(_.requestDate,"MM/dd",{locale:Vn})||"-"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3238,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3234,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3222,columnNumber:23},void 0),a.jsxDEV("div",{className:"flex items-center gap-2 mb-2.5 text-xs",children:[a.jsxDEV("span",{className:"text-gray-400",children:[" ",(_.materialAmount||0).toLocaleString()]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3246,columnNumber:25},void 0),a.jsxDEV("span",{className:"text-gray-300",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3247,columnNumber:25},void 0),a.jsxDEV("span",{className:"text-gray-400",children:[" ",(_.laborAmount||0).toLocaleString()]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3248,columnNumber:25},void 0),_.includesVAT&&a.jsxDEV(a.Fragment,{children:[a.jsxDEV("span",{className:"text-gray-300",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3251,columnNumber:29},void 0),a.jsxDEV("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-700 text-[10px] rounded",children:"VAT"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3252,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3250,columnNumber:27},void 0),_.applyTaxDeduction&&a.jsxDEV(a.Fragment,{children:[a.jsxDEV("span",{className:"text-gray-300",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3257,columnNumber:29},void 0),a.jsxDEV("span",{className:"px-1.5 py-0.5 bg-purple-50 text-purple-700 text-[10px] rounded",children:"3.3%"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3258,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3256,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3245,columnNumber:23},void 0),a.jsxDEV("div",{className:"flex items-center justify-between mb-2.5",children:[a.jsxDEV("div",{className:"text-xs text-gray-500 truncate flex-1",children:U},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3265,columnNumber:25},void 0),a.jsxDEV("div",{className:"flex items-center gap-1 ml-2 flex-shrink-0",children:[a.jsxDEV("button",{onClick:ie=>{ie.stopPropagation(),xn(_)},className:"p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors",title:"",children:a.jsxDEV(r_,{className:"h-3.5 w-3.5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3277,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3269,columnNumber:27},void 0),a.jsxDEV("button",{onClick:async ie=>{ie.stopPropagation(),window.confirm("  ?")&&(await r(_.id),oe.success(""))},className:"p-1 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:a.jsxDEV(ji,{className:"h-3.5 w-3.5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3290,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3279,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3268,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3264,columnNumber:23},void 0),ge==="pending"&&(l==null?void 0:l.role)&&["manager","admin"].includes(l.role)&&a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("button",{onClick:ie=>{if(ie.stopPropagation(),_.status==="completed"){oe.info("   ");return}cn(_)},disabled:_.status==="completed",className:`flex-1 py-1.5 px-2 rounded text-xs font-medium transition-colors ${_.status==="completed"?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-800"}`,children:_.status==="completed"?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3299,columnNumber:27},void 0),a.jsxDEV("button",{onClick:ie=>{ie.stopPropagation(),Hn(_.id)},disabled:_.status==="completed",className:`flex-1 py-1.5 px-2 text-white rounded text-xs font-medium transition-colors ${_.status==="completed"?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:_.status==="completed"?"#9ca3af":"#5f81a5"},onMouseEnter:ie=>{_.status!=="completed"&&(ie.currentTarget.style.backgroundColor="#4a6b8a")},onMouseLeave:ie=>{_.status!=="completed"&&(ie.currentTarget.style.backgroundColor="#5f81a5")},children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3317,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3298,columnNumber:25},void 0)]},_.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3212,columnNumber:21},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3198,columnNumber:15},void 0):a.jsxDEV("div",{className:"flex items-center justify-center h-full text-gray-500",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3348,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3196,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3135,columnNumber:9},void 0),a.jsxDEV("div",{className:`payment-images md:col-span-6 ipad:col-span-6 ipad-lg:col-span-6 ipad-xl:col-span-6 ipad-2xl:col-span-6 bg-white rounded-lg border flex flex-col overflow-hidden h-[calc(100vh-180px)] ${V!=="image"?"hidden lg:flex":""}`,onDragOver:fi,onDragLeave:Fs,onDrop:as,children:[a.jsxDEV("input",{type:"file",multiple:!0,accept:"image/*",onChange:Ds,className:"hidden",id:"image-file-input"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3364,columnNumber:11},void 0),T&&f&&V==="image"&&(()=>{const _=kt.find(G=>G.id===f);return _?a.jsxDEV("div",{className:"border-b bg-gray-50 p-3",children:a.jsxDEV("div",{className:"flex justify-between items-start",children:[a.jsxDEV("div",{className:"flex-1",children:[a.jsxDEV("p",{className:"font-medium text-gray-900 text-sm",children:_.purpose||_.itemName},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3381,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-xs text-gray-500 mt-0.5",children:[_.process||"-","  ",Ay(_.requestDate,"yyyy.MM.dd",{locale:Vn})||"-"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3382,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3380,columnNumber:21},void 0),a.jsxDEV("p",{className:"text-sm font-bold text-gray-900",children:["",(_.amount||0).toLocaleString()]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3386,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3379,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3378,columnNumber:17},void 0):null})(),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 relative",onClick:_=>{var B;const G=_.target;if(!G.closest("img")&&!G.closest("button")&&f){const x=kt.find(Q=>Q.id===f),L=(x==null?void 0:x.images)||[],U=We[f]||[];(L.length>0?L:U).length>0&&((B=document.getElementById("image-file-input"))==null||B.click())}},children:f?(()=>{const _=kt.find(L=>L.id===f),G=(_==null?void 0:_.images)||[],B=We[f]||[],x=G.length>0?G:B;return a.jsxDEV("div",{className:"h-full flex flex-col",children:[a.jsxDEV("div",{className:"mb-3",children:[a.jsxDEV("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3422,columnNumber:21},void 0),a.jsxDEV("textarea",{value:(_==null?void 0:_.quickText)||(_==null?void 0:_.notes)||"",readOnly:!0,placeholder:" ",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-gray-50 resize-none",rows:8},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3423,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3421,columnNumber:19},void 0),x.length>0&&a.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mb-3",children:x.map((L,U)=>a.jsxDEV("div",{className:"relative group",children:[a.jsxDEV("img",{src:L,alt:` ${U+1}`,className:"w-full aspect-square object-contain rounded-lg cursor-pointer hover:opacity-90 transition-opacity border bg-gray-100",onClick:X=>{X.stopPropagation(),ks(L)}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3437,columnNumber:27},void 0),a.jsxDEV("button",{onClick:X=>{X.stopPropagation(),ss(U)},className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity",children:a.jsxDEV(Cn,{className:"h-3 w-3"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3453,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3446,columnNumber:27},void 0),a.jsxDEV("div",{className:"absolute bottom-1 left-1 bg-black bg-opacity-50 text-white text-xs px-1.5 py-0.5 rounded",children:[U+1,"/",x.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3455,columnNumber:27},void 0)]},U,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3436,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3434,columnNumber:21},void 0),a.jsxDEV("label",{htmlFor:"image-file-input",className:`block cursor-pointer ${x.length>0?"":"flex-1"}`,onClick:L=>L.stopPropagation(),children:a.jsxDEV("div",{className:`w-full border-2 border-dashed rounded-lg p-4 text-center transition-colors flex flex-col items-center justify-center ${v?"border-gray-500 bg-gray-50":"border-gray-300 hover:border-gray-400"} ${x.length>0?"min-h-[80px]":"min-h-[200px]"}`,children:[a.jsxDEV(zm,{className:`mx-auto text-gray-400 mb-1 ${x.length>0?"h-6 w-6":"h-10 w-10 mb-2"}`},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3474,columnNumber:23},void 0),a.jsxDEV("p",{className:"text-sm font-medium text-gray-700",children:x.length>0?" ":" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3475,columnNumber:23},void 0),x.length===0&&a.jsxDEV("p",{className:"text-xs text-gray-500 mt-1",children:"   Ctrl+V "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3479,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3469,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3464,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3419,columnNumber:17},void 0)})():a.jsxDEV("div",{className:"h-full flex items-center justify-center min-h-[200px]",children:a.jsxDEV("div",{className:"text-center text-gray-400",children:[a.jsxDEV(Ha,{className:"h-12 w-12 mx-auto mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3488,columnNumber:19},void 0),a.jsxDEV("p",{className:"text-sm",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3489,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3487,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3486,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3396,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3356,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2557,columnNumber:7},void 0),k&&a.jsxDEV(a.Fragment,{children:[a.jsxDEV("div",{className:"lg:hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:a.jsxDEV("div",{className:"bg-white rounded-lg w-full max-w-md mx-4 max-h-[80vh] overflow-hidden",children:[a.jsxDEV("div",{className:"flex items-center justify-between p-3 border-b",children:[a.jsxDEV("h2",{className:"text-base font-bold text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3504,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>Ee(!1),className:"p-1 hover:bg-gray-100 rounded-full",children:a.jsxDEV(Cn,{className:"h-4 w-4 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3509,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3505,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3503,columnNumber:15},void 0),a.jsxDEV("div",{className:"p-3 overflow-y-auto max-h-[calc(80vh-100px)]",children:[a.jsxDEV("div",{className:"grid grid-cols-2 gap-2 mb-2",children:Fm.map(_=>a.jsxDEV("button",{onClick:()=>{Ze({...ne,process:_}),Ee(!1)},className:`p-2 text-sm text-center border rounded-lg transition-all ${ne.process===_?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,children:_},_,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3516,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3514,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{Ze({...ne,process:""}),Ee(!1)},className:"w-full p-2 text-sm text-center border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 text-gray-500",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3533,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3513,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3502,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3501,columnNumber:11},void 0),a.jsxDEV("div",{className:"hidden lg:block fixed inset-0 z-40",onClick:()=>Ee(!1),children:a.jsxDEV("div",{onClick:_=>_.stopPropagation(),className:"absolute bg-white rounded-lg shadow-xl border border-gray-200",style:{top:$e.current?`${$e.current.getBoundingClientRect().bottom+window.scrollY+4}px`:"50%",left:$e.current?`${$e.current.getBoundingClientRect().left+window.scrollX}px`:"50%"},children:[a.jsxDEV("div",{className:"flex items-center justify-between p-2 border-b",children:[a.jsxDEV("h2",{className:"text-sm font-bold text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3557,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>Ee(!1),className:"p-1 hover:bg-gray-100 rounded-full",children:a.jsxDEV(Cn,{className:"h-3 w-3 text-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3562,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3558,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3556,columnNumber:15},void 0),a.jsxDEV("div",{className:"p-2",children:[a.jsxDEV("div",{className:"grid grid-cols-4 gap-1.5 mb-2",children:Fm.map(_=>a.jsxDEV("button",{onClick:()=>{Ze({...ne,process:_}),Ee(!1)},className:`p-1.5 text-xs text-center border rounded-lg transition-all whitespace-nowrap ${ne.process===_?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,children:_},_,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3569,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3567,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{Ze({...ne,process:""}),Ee(!1)},className:"w-full p-1.5 text-xs text-center border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 text-gray-500",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3586,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3566,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3548,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3547,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3499,columnNumber:9},void 0),ee&&a.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",onClick:()=>M(!1),children:a.jsxDEV("div",{className:"relative max-w-[90vw] max-h-[90vh]",children:[a.jsxDEV("button",{onClick:_=>{_.stopPropagation(),M(!1)},className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors",children:a.jsxDEV(Cn,{className:"h-8 w-8"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3615,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3608,columnNumber:13},void 0),a.jsxDEV("img",{src:A,alt:" ",className:"max-w-full max-h-[90vh] object-contain",onClick:_=>_.stopPropagation()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3617,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3607,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3603,columnNumber:9},void 0),vt&&a.jsxDEV(VT,{projectName:St,onClose:()=>lt(!1)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:3629,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Payments.tsx",lineNumber:2498,columnNumber:5},void 0)},bi=n=>n?typeof n=="string"?n:n instanceof be?n.toDate().toISOString():new Date().toISOString():new Date().toISOString(),Es={async getSpaces(n){const e=Ge(ae,"finish_check_spaces");let t;n?t=_t(e,qn("project_id","==",n),en("display_order")):t=_t(e,en("display_order"));const s=await It(t),r=[];for(const i of s.docs){const o=i.data(),l=Ge(ae,"finish_check_items"),u=_t(l,qn("space_id","==",i.id),en("display_order")),m=await It(u),d=[];for(const f of m.docs){const p=f.data(),y=Ge(ae,"finish_check_images"),C=_t(y,qn("item_id","==",f.id)),w=(await It(C)).docs.map(R=>({id:R.id,item_id:f.id,filename:R.data().filename||null,created_at:bi(R.data().created_at)}));d.push({id:f.id,space_id:i.id,content:p.content||"",is_completed:p.is_completed||0,is_priority:p.is_priority||0,completed_at:p.completed_at?bi(p.completed_at):null,display_order:p.display_order||0,created_at:bi(p.created_at),updated_at:bi(p.updated_at),images:w})}r.push({id:i.id,name:o.name||"",project_id:o.project_id||null,display_order:o.display_order||0,created_at:bi(o.created_at),updated_at:bi(o.updated_at),items:d})}return r},async createSpace(n,e){const t=Ge(ae,"finish_check_spaces"),s=_t(t,qn("project_id","==",e),en("display_order","desc")),r=await It(s),i=r.docs.length>0&&r.docs[0].data().display_order||0,o={name:n,project_id:e,display_order:i+1,created_at:pn(),updated_at:pn()};return{id:(await tr(t,o)).id,name:n,project_id:e,display_order:i+1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),items:[]}},async updateSpace(n,e){const t=Te(ae,"finish_check_spaces",n);await Ot(t,{name:e,updated_at:pn()})},async deleteSpace(n){const e=Ge(ae,"finish_check_items"),t=_t(e,qn("space_id","==",n)),s=await It(t);for(const r of s.docs){const i=Ge(ae,"finish_check_images"),o=_t(i,qn("item_id","==",r.id)),l=await It(o);for(const u of l.docs)await Kn(Te(ae,"finish_check_images",u.id));await Kn(Te(ae,"finish_check_items",r.id))}await Kn(Te(ae,"finish_check_spaces",n))},async createItem(n,e){const t=Ge(ae,"finish_check_items"),s=_t(t,qn("space_id","==",n),en("display_order","desc")),r=await It(s),i=r.docs.length>0&&r.docs[0].data().display_order||0,o={space_id:n,content:e,is_completed:0,is_priority:0,completed_at:null,display_order:i+1,created_at:pn(),updated_at:pn()};return{id:(await tr(t,o)).id,space_id:n,content:e,is_completed:0,is_priority:0,completed_at:null,display_order:i+1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),images:[]}},async updateItem(n,e){const t=Te(ae,"finish_check_items",n);await Ot(t,{content:e,updated_at:pn()})},async deleteItem(n){const e=Ge(ae,"finish_check_images"),t=_t(e,qn("item_id","==",n)),s=await It(t);for(const r of s.docs)await Kn(Te(ae,"finish_check_images",r.id));await Kn(Te(ae,"finish_check_items",n))},async toggleItem(n){const e=Te(ae,"finish_check_items",n),t=await Rt(e);if(!t.exists())throw new Error("   .");const s=t.data(),r=s.is_completed?0:1;return await Ot(e,{is_completed:r,completed_at:r?pn():null,updated_at:pn()}),{id:n,space_id:s.space_id,content:s.content,is_completed:r,is_priority:s.is_priority||0,completed_at:r?new Date().toISOString():null,display_order:s.display_order||0,created_at:bi(s.created_at),updated_at:new Date().toISOString(),images:[]}},async togglePriority(n){const e=Te(ae,"finish_check_items",n),t=await Rt(e);if(!t.exists())throw new Error("   .");const r=t.data().is_priority||0?0:1;return await Ot(e,{is_priority:r,updated_at:pn()}),{is_priority:r}},async getImageData(n){const e=Te(ae,"finish_check_images",n),t=await Rt(e);if(!t.exists())return null;const s=t.data();return{image_data:s.image_url||s.image_data||""}},async uploadImage(n,e,t){const s=Ge(ae,"finish_check_images"),r={item_id:n,image_data:"",image_url:"",filename:t,created_at:pn()},i=await tr(s,r);let o=e;if(ea(e)){const l=await vx("finish_check",i.id,e);await Ot(i,{image_url:l,image_data:""}),o=l}else await Ot(i,{image_data:e});return{id:i.id,item_id:n,image_data:o,filename:t,created_at:new Date().toISOString()}},async deleteImage(n){const e=Te(ae,"finish_check_images",n),t=await Rt(e);if(t.exists()){const s=t.data();s.image_url&&await _x(s.image_url)}await Kn(e)}},Ss={getSpaces:n=>Es.getSpaces(n),createSpace:(n,e)=>Es.createSpace(n,e),updateSpace:(n,e)=>Es.updateSpace(String(n),e),deleteSpace:n=>Es.deleteSpace(String(n)),createItem:(n,e)=>Es.createItem(String(n),e),updateItem:(n,e)=>Es.updateItem(String(n),e),deleteItem:n=>Es.deleteItem(String(n)),toggleItem:n=>Es.toggleItem(String(n)),togglePriority:n=>Es.togglePriority(String(n)),getImageData:n=>Es.getImageData(String(n)),uploadImage:(n,e,t)=>Es.uploadImage(String(n),e,t),deleteImage:n=>Es.deleteImage(String(n))},RT=()=>{var ne,Ze;const{user:n}=oi(),{loadProjectsFromAPI:e,projects:t}=dr(),s=Ju(),[r,i]=E.useState([]),[o,l]=E.useState(!0),[u,m]=E.useState(null),[d,f]=E.useState([]),[p,y]=E.useState(!1),[C,v]=E.useState(""),[w,R]=E.useState(""),[I,F]=E.useState(null),[re,ee]=E.useState(null),[M,A]=E.useState(""),[N,V]=E.useState(null),[j,T]=E.useState(""),[S,k]=E.useState(null),[Ee,$e]=E.useState(new Set),ge=E.useRef(null),[He,ht]=E.useState(window.innerWidth<768),[Kt,qt]=E.useState(!1),[le,ze]=E.useState(null),[de,Be]=E.useState(new Set),[Xe,vt]=E.useState(()=>localStorage.getItem("finishCheck_showOnlyIncomplete")==="true"),[lt,St]=E.useState(!1),[at,ft]=E.useState(!1),[Nn,K]=E.useState(new Set);E.useEffect(()=>{localStorage.setItem("finishCheck_showOnlyIncomplete",String(Xe))},[Xe]),E.useEffect(()=>{(async()=>{t.length===0&&await e(),l(!1)})();const _e=()=>{ht(window.innerWidth<768)};return window.addEventListener("resize",_e),()=>window.removeEventListener("resize",_e)},[]),E.useEffect(()=>{o||Le()},[s,o]),E.useEffect(()=>{u!==null&&Fe()},[u]),E.useEffect(()=>{u!==null&&(n!=null&&n.id)&&localStorage.setItem(`finishCheck_selectedProject_${n.id}`,u.toString())},[u,n==null?void 0:n.id]),E.useEffect(()=>{if(!He&&S){const O=async _e=>{var je;const ke=(je=_e.clipboardData)==null?void 0:je.items;if(ke){for(let me=0;me<ke.length;me++)if(ke[me].type.indexOf("image")!==-1){_e.preventDefault();const kt=ke[me].getAsFile();kt&&await Ie(S,kt)}}};return document.addEventListener("paste",O),()=>document.removeEventListener("paste",O)}},[S,He]);const Le=async()=>{try{const O=s.map(ke=>({id:ke.id,title:ke.name}));i(O);const _e=n!=null&&n.id?localStorage.getItem(`finishCheck_selectedProject_${n.id}`):null;_e&&O.some(ke=>ke.id===Number(_e))?m(Number(_e)):O.length>0&&m(O[0].id)}catch(O){console.error("Failed to load projects:",O),oe.error("   ")}},Fe=async()=>{try{d.length===0&&y(!0);const _e=(await Ss.getSpaces(u||void 0)).map(ke=>({...ke,items:ke.items.map(je=>({...je,images:je.images||[]}))}));f(_e)}catch(O){console.error("Failed to load spaces:",O),oe.error("   ")}finally{y(!1)}},Se=async O=>{if(Nn.has(Number(O)))return null;try{K(je=>new Set(je).add(Number(O)));const _e=await Ss.getImageData(O),ke=(_e==null?void 0:_e.image_data)||null;return f(je=>je.map(me=>({...me,items:me.items.map(kt=>({...kt,images:kt.images.map(xt=>String(xt.id)===String(O)?{...xt,image_data:ke}:xt)}))}))),ke}catch(_e){return console.error("   :",_e),null}finally{K(_e=>{const ke=new Set(_e);return ke.delete(Number(O)),ke})}},Je=async O=>{const _e=d.find(me=>me.items.some(kt=>kt.id===O)),ke=_e==null?void 0:_e.items.find(me=>me.id===O);if(!ke)return;const je=ke.images.filter(me=>!me.image_data);await Promise.all(je.map(me=>Se(me.id)))},Tt=async()=>{if(!at){if(!C.trim()){oe.error("  ");return}if(!u){oe.error(" ");return}ft(!0);try{const O=await Ss.createSpace(C.trim(),u),_e={...O,items:O.items||[]};f([...d,_e]),v(""),St(!1),oe.success(" ")}catch(O){console.error("Failed to add space:",O),oe.error("  ")}finally{ft(!1)}}},Gt=async(O,_e)=>{if(!_e.trim()){oe.error("  ");return}try{await Ss.updateSpace(O,_e.trim()),f(d.map(ke=>String(ke.id)===String(O)?{...ke,name:_e.trim()}:ke)),ee(null),A(""),oe.success("  ")}catch(ke){console.error("Failed to update space:",ke),oe.error("  ")}},dt=O=>{ze(O),Be(new Set)},P=async()=>{if(le!==null){if(de.size===0){oe.error("  ");return}try{await Promise.all(Array.from(de).map(O=>Ss.deleteItem(O))),f(d.map(O=>String(O.id)===String(le)?{...O,items:O.items.filter(_e=>!de.has(_e.id))}:O)),oe.success(`${de.size}  `),ze(null),Be(new Set)}catch(O){console.error("Failed to delete items:",O),oe.error("  ")}}},q=async()=>{if(le===null)return;const O=d.find(_e=>String(_e.id)===String(le));if(O&&confirm(`"${O.name}"  ?

        .`))try{await Ss.deleteSpace(le),f(d.filter(_e=>String(_e.id)!==String(le))),oe.success(" "),ze(null),Be(new Set)}catch(_e){console.error("Failed to delete space:",_e),oe.error("  ")}},te=async O=>{if(!w.trim()){oe.error("  ");return}const _e=-Date.now(),ke={id:_e,space_id:O,content:w.trim(),is_checked:!1,is_priority:!1,images:[]};f(d.map(me=>String(me.id)===String(O)?{...me,items:[...me.items,ke]}:me));const je=w.trim();R(""),F(null);try{const me=await Ss.createItem(O,je);f(kt=>kt.map(xt=>String(xt.id)===String(O)?{...xt,items:xt.items.map(tn=>tn.id===_e?{...me,images:[]}:tn)}:xt))}catch(me){console.error("Failed to add item:",me),f(kt=>kt.map(xt=>String(xt.id)===String(O)?{...xt,items:xt.items.filter(tn=>tn.id!==_e)}:xt)),oe.error("  ")}},ve=async O=>{try{const _e=await Ss.toggleItem(O);f(d.map(ke=>({...ke,items:ke.items.map(je=>String(je.id)===String(O)?{...je,..._e}:je)})))}catch(_e){console.error("Failed to toggle item:",_e),oe.error("   ")}},ue=async O=>{try{const _e=await Ss.togglePriority(O);f(d.map(ke=>({...ke,items:ke.items.map(je=>String(je.id)===String(O)?{...je,is_priority:_e.is_priority}:je)})))}catch(_e){console.error("Failed to toggle priority:",_e),oe.error("  ")}},fe=O=>new Promise((_e,ke)=>{const je=new FileReader;je.readAsDataURL(O),je.onload=()=>_e(je.result),je.onerror=me=>ke(me)}),Ie=async(O,_e)=>{var me,kt;if(!["image/jpeg","image/png","image/webp"].includes(_e.type)){oe.error("JPEG, PNG, WebP    ");return}const je=5*1024*1024;if(_e.size>je){oe.error("  5MB  ");return}try{$e(At=>new Set([...At,Number(O)]));const xt=await fe(_e),tn=await Ss.uploadImage(O,xt,_e.name);f(d.map(At=>({...At,items:At.items.map(xn=>String(xn.id)===String(O)?{...xn,images:[...xn.images,tn]}:xn)}))),oe.success(" ")}catch(xt){console.error("Failed to upload image:",xt),oe.error(((kt=(me=xt.response)==null?void 0:me.data)==null?void 0:kt.error)||"  ")}finally{$e(xt=>{const tn=new Set(xt);return tn.delete(Number(O)),tn})}},We=async(O,_e)=>{const ke=_e.target.files;if(!(!ke||ke.length===0)){for(let je=0;je<ke.length;je++)await Ie(O,ke[je]);ge.current&&(ge.current.value="")}},st=async(O,_e)=>{if(confirm("  ?"))try{await Ss.deleteImage(_e),f(d.map(ke=>({...ke,items:ke.items.map(je=>String(je.id)===String(O)?{...je,images:je.images.filter(me=>String(me.id)!==String(_e))}:je)}))),oe.success(" ")}catch(ke){console.error("Failed to delete image:",ke),oe.error("  ")}},we=async(O,_e)=>{O.preventDefault(),O.stopPropagation();const ke=O.dataTransfer.files;if(!(!ke||ke.length===0))for(let je=0;je<ke.length;je++)ke[je].type.startsWith("image/")&&await Ie(_e,ke[je])},$n=O=>{O.preventDefault(),O.stopPropagation()};if(p)return a.jsxDEV("div",{className:"flex items-center justify-center h-[calc(100vh-120px)]",children:a.jsxDEV("div",{className:"text-gray-500",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:570,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:569,columnNumber:7},void 0);const Ht=S?d.flatMap(O=>O.items).find(O=>O.id===S):null;return a.jsxDEV("div",{className:"h-[calc(100vh-120px)] flex flex-col md:flex-row gap-4 overflow-hidden",children:[a.jsxDEV("input",{ref:ge,type:"file",accept:"image/jpeg,image/png,image/webp",multiple:!0,className:"hidden",onChange:O=>{S&&We(S,O)}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:582,columnNumber:7},void 0),a.jsxDEV("div",{className:"flex-1 bg-white border border-gray-200 rounded-lg overflow-hidden flex flex-col",children:[a.jsxDEV("div",{className:"p-4 border-b border-gray-200",children:He?a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("div",{className:"flex-1",children:a.jsxDEV("select",{value:u||"",onChange:O=>{const _e=O.target.value?Number(O.target.value):null;m(_e)},className:"w-full px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-10",children:[(n==null?void 0:n.name)!==""&&a.jsxDEV("option",{value:"",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:612,columnNumber:43},void 0),r.map(O=>a.jsxDEV("option",{value:O.id,children:O.title},O.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:614,columnNumber:21},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:604,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:603,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>vt(!Xe),className:`px-3 py-2.5 text-xs font-medium rounded-lg transition-colors whitespace-nowrap ${Xe?"bg-gray-800 text-white hover:bg-gray-900":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:Xe?" ":" ",children:Xe?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:622,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>St(!0),className:"p-2.5 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors flex items-center justify-center",title:" ",children:a.jsxDEV(So,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:640,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:635,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:601,columnNumber:13},void 0):a.jsxDEV("div",{className:"flex gap-3",children:[a.jsxDEV("div",{className:"flex-1",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:648,columnNumber:17},void 0),a.jsxDEV("select",{value:u||"",onChange:O=>{const _e=O.target.value?Number(O.target.value):null;m(_e)},className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-10",children:[(n==null?void 0:n.name)!==""&&a.jsxDEV("option",{value:"",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:657,columnNumber:43},void 0),r.map(O=>a.jsxDEV("option",{value:O.id,children:O.title},O.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:659,columnNumber:21},void 0))]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:649,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:647,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex-1",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:668,columnNumber:17},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("input",{type:"text",value:C,onChange:O=>v(O.target.value),onKeyPress:O=>{O.key==="Enter"&&Tt()},placeholder:"  ",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:670,columnNumber:19},void 0),a.jsxDEV("button",{onClick:Tt,disabled:at,className:"p-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors flex items-center justify-center min-w-[44px] disabled:opacity-50",title:" ",children:a.jsxDEV(So,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:688,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:682,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:669,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:667,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex items-end",children:a.jsxDEV("button",{onClick:()=>vt(!Xe),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors whitespace-nowrap ${Xe?"bg-gray-800 text-white hover:bg-gray-900":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:Xe?" ":" ",children:Xe?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:695,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:694,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:645,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:598,columnNumber:9},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4",children:d.length===0?a.jsxDEV("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:714,columnNumber:13},void 0):a.jsxDEV("div",{className:"columns-1 portrait:md:columns-2 landscape:md:columns-3 desktop:columns-4 column-gap-4",children:d.map((O,_e)=>{const ke=O.items.filter(me=>!me.is_completed).sort((me,kt)=>(kt.is_priority||0)-(me.is_priority||0)),je=O.items.filter(me=>me.is_completed);return Xe&&ke.length===0?null:a.jsxDEV("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50 mb-4 break-inside-avoid",children:[re===O.id?a.jsxDEV("div",{className:"flex gap-2 mb-4",children:[a.jsxDEV("input",{type:"text",value:M,onChange:me=>A(me.target.value),onKeyPress:me=>{me.key==="Enter"?Gt(O.id,M):me.key==="Escape"&&(ee(null),A(""))},className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:733,columnNumber:25},void 0),a.jsxDEV("button",{onClick:()=>Gt(O.id,M),className:"p-1 text-green-600 hover:text-green-700",children:a.jsxDEV(Cy,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:752,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:748,columnNumber:25},void 0),a.jsxDEV("button",{onClick:()=>{ee(null),A("")},className:"p-1 text-gray-600 hover:text-gray-700",children:a.jsxDEV(Cn,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:761,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:754,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:732,columnNumber:23},void 0):a.jsxDEV("div",{className:"flex items-center justify-between mb-4 pb-2 border-b border-gray-300",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("h3",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[a.jsxDEV("span",{className:"inline-flex items-center justify-center w-6 h-6 bg-gray-800 text-white text-xs font-bold rounded-full",children:_e+1},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:768,columnNumber:29},void 0),O.name]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:767,columnNumber:27},void 0),a.jsxDEV("span",{className:"text-xs text-gray-500",children:[je.length,"/",O.items.length," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:773,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:766,columnNumber:25},void 0),a.jsxDEV("div",{className:"flex items-center gap-1",children:[a.jsxDEV("button",{onClick:()=>{I===O.id?(F(null),R("")):F(O.id)},className:`p-1 transition-colors ${I===O.id?"text-gray-900 bg-gray-100 rounded":"text-gray-600 hover:text-gray-800"}`,title:" ",children:a.jsxDEV(So,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:794,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:778,columnNumber:27},void 0),a.jsxDEV("button",{onClick:()=>{ee(O.id),A(O.name)},className:"p-1 text-gray-600 hover:text-gray-800 transition-colors",title:"",children:a.jsxDEV(Wm,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:804,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:796,columnNumber:27},void 0),a.jsxDEV("button",{onClick:()=>dt(O.id),className:"p-1 text-red-500 hover:text-red-700 transition-colors",title:"",children:a.jsxDEV(ji,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:811,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:806,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:777,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:765,columnNumber:23},void 0),I===O.id&&a.jsxDEV("div",{className:"mb-4 p-3 bg-white border border-gray-300 rounded-lg",children:a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("input",{type:"text",value:w,onChange:me=>R(me.target.value),onKeyPress:me=>{me.key==="Enter"&&w.trim()&&te(O.id)},placeholder:"  ",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:821,columnNumber:27},void 0),a.jsxDEV("button",{onClick:()=>te(O.id),disabled:!w.trim(),className:"px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:834,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:820,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:819,columnNumber:23},void 0),ke.length>0&&a.jsxDEV("div",{className:"mb-4",children:a.jsxDEV("div",{className:"space-y-2",children:ke.map(me=>a.jsxDEV("div",{className:"flex items-start gap-3 p-3 bg-white border border-gray-200 rounded-lg",children:[a.jsxDEV("input",{type:"checkbox",checked:!1,onChange:()=>ve(me.id),className:"mt-1 w-5 h-5 rounded border-gray-300 text-gray-800 focus:ring-gray-500 cursor-pointer"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:854,columnNumber:31},void 0),a.jsxDEV("span",{className:`flex-1 text-sm text-gray-900 ${!He&&S===me.id?"font-semibold":""}`,onClick:async()=>{He||(k(me.id),me.images&&me.images.length>0&&await Je(me.id))},style:{cursor:He?"default":"pointer"},children:[me.content,me.images&&me.images.length>0&&a.jsxDEV("span",{className:"ml-2 text-xs text-gray-500",children:["(",me.images.length,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:875,columnNumber:35},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:861,columnNumber:31},void 0),a.jsxDEV("div",{className:"flex items-center gap-1",children:[a.jsxDEV("button",{onClick:async()=>{k(me.id),He&&qt(!0),me.images&&me.images.length>0&&await Je(me.id)},className:`p-1 transition-colors ${me.images&&me.images.length>0?"text-blue-600 hover:text-blue-800":"text-gray-300 hover:text-gray-400"}`,title:"",children:a.jsxDEV(Ha,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:899,columnNumber:35},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:881,columnNumber:33},void 0),a.jsxDEV("button",{onClick:()=>ue(me.id),className:`p-1 transition-colors ${me.is_priority?"text-yellow-500 hover:text-yellow-600":"text-gray-300 hover:text-gray-400"}`,title:"",children:a.jsxDEV(zp,{className:`w-4 h-4 ${me.is_priority?"fill-current":""}`},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:910,columnNumber:35},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:901,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:880,columnNumber:31},void 0)]},me.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:850,columnNumber:29},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:848,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:847,columnNumber:23},void 0),!Xe&&je.length>0&&a.jsxDEV("div",{children:a.jsxDEV("div",{className:"space-y-2",children:je.map(me=>a.jsxDEV("div",{className:"flex items-start gap-3 p-3 bg-white border border-gray-200 rounded-lg opacity-40",children:[a.jsxDEV("input",{type:"checkbox",checked:!0,onChange:()=>ve(me.id),className:"mt-1 w-5 h-5 rounded border-gray-300 text-gray-800 focus:ring-gray-500 cursor-pointer"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:928,columnNumber:31},void 0),a.jsxDEV("span",{className:`flex-1 text-sm text-gray-500 line-through ${!He&&S===me.id?"font-semibold":""}`,onClick:async()=>{He||(k(me.id),me.images&&me.images.length>0&&await Je(me.id))},style:{cursor:He?"default":"pointer"},children:[me.content,me.images&&me.images.length>0&&a.jsxDEV("span",{className:"ml-2 text-xs text-gray-500",children:["(",me.images.length,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:949,columnNumber:35},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:935,columnNumber:31},void 0),a.jsxDEV("div",{className:"flex items-center gap-1",children:[a.jsxDEV("button",{onClick:async()=>{k(me.id),He&&qt(!0),me.images&&me.images.length>0&&await Je(me.id)},className:`p-1 transition-colors ${me.images&&me.images.length>0?"text-blue-600 hover:text-blue-800":"text-gray-300 hover:text-gray-400"}`,title:"",children:a.jsxDEV(Ha,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:973,columnNumber:35},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:955,columnNumber:33},void 0),a.jsxDEV("button",{onClick:()=>ue(me.id),className:`p-1 transition-colors ${me.is_priority?"text-yellow-500 hover:text-yellow-600":"text-gray-300 hover:text-gray-400"}`,title:"",children:a.jsxDEV(zp,{className:`w-4 h-4 ${me.is_priority?"fill-current":""}`},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:984,columnNumber:35},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:975,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:954,columnNumber:31},void 0)]},me.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:924,columnNumber:29},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:922,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:921,columnNumber:23},void 0)]},O.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:729,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:718,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:712,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:596,columnNumber:7},void 0),!He&&S&&Ht&&a.jsxDEV("div",{className:"w-80 bg-white border border-gray-200 rounded-lg overflow-hidden flex flex-col",children:[a.jsxDEV("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[a.jsxDEV("h3",{className:"font-semibold text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1005,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>k(null),className:"p-1 text-gray-600 hover:text-gray-900 transition-colors",title:"",children:a.jsxDEV(Cn,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1011,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1006,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1004,columnNumber:13},void 0),a.jsxDEV("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:Ht.content},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1014,columnNumber:13},void 0),a.jsxDEV("button",{onClick:()=>{var O;return(O=ge.current)==null?void 0:O.click()},disabled:Ee.has(S),className:"w-full px-3 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm font-medium flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsxDEV(zm,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1020,columnNumber:15},void 0),Ee.has(S)?" ...":" "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1015,columnNumber:13},void 0),a.jsxDEV("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"    , Ctrl+V "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1023,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1003,columnNumber:11},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4",onDrop:O=>we(O,S),onDragOver:$n,children:Ht.images.length===0?a.jsxDEV("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 text-sm",children:[a.jsxDEV(Ha,{className:"w-12 h-12 mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1035,columnNumber:17},void 0),a.jsxDEV("p",{children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1036,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1034,columnNumber:15},void 0):a.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:Ht.images.map(O=>a.jsxDEV("div",{className:"relative group",children:[O.image_data?a.jsxDEV("img",{src:O.image_data,alt:O.filename||"",className:"w-full h-32 object-cover rounded-lg border border-gray-200"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1043,columnNumber:23},void 0):a.jsxDEV("div",{className:"w-full h-32 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center",children:a.jsxDEV("span",{className:"text-gray-400 text-sm",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1050,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1049,columnNumber:23},void 0),a.jsxDEV("button",{onClick:()=>st(S,O.id),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600",title:"",children:a.jsxDEV(Wp,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1058,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1053,columnNumber:21},void 0),O.filename&&a.jsxDEV("p",{className:"text-xs text-gray-500 mt-1 truncate",title:O.filename,children:O.filename},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1061,columnNumber:23},void 0)]},O.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1041,columnNumber:19},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1039,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1028,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1002,columnNumber:9},void 0),He&&Kt&&S&&Ht&&a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:a.jsxDEV("div",{className:"bg-white rounded-t-2xl w-full max-h-[80vh] flex flex-col",children:[a.jsxDEV("div",{className:"p-4 border-b border-gray-200",children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[a.jsxDEV("h3",{className:"font-semibold text-gray-900",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1079,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{qt(!1),k(null)},className:"p-1 text-gray-600 hover:text-gray-900",children:a.jsxDEV(Cn,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1087,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1080,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1078,columnNumber:15},void 0),a.jsxDEV("p",{className:"text-sm text-gray-600 mb-3",children:Ht.content},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1090,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>{var O;return(O=ge.current)==null?void 0:O.click()},disabled:Ee.has(S),className:"w-full px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm font-medium flex items-center justify-center gap-2 disabled:opacity-50",children:[a.jsxDEV(zm,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1096,columnNumber:17},void 0),Ee.has(S)?" ...":" "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1091,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1077,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4",children:Ht.images.length===0?a.jsxDEV("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[a.jsxDEV(Ha,{className:"w-16 h-16 mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1104,columnNumber:19},void 0),a.jsxDEV("p",{className:"text-sm",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1105,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1103,columnNumber:17},void 0):a.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:Ht.images.map(O=>a.jsxDEV("div",{className:"relative",children:[O.image_data?a.jsxDEV("img",{src:O.image_data,alt:O.filename||"",className:"w-full h-40 object-cover rounded-lg border border-gray-200"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1112,columnNumber:25},void 0):a.jsxDEV("div",{className:"w-full h-40 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center",children:a.jsxDEV("span",{className:"text-gray-400 text-sm",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1119,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1118,columnNumber:25},void 0),a.jsxDEV("button",{onClick:()=>st(S,O.id),className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600",children:a.jsxDEV(Wp,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1126,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1122,columnNumber:23},void 0),O.filename&&a.jsxDEV("p",{className:"text-xs text-gray-500 mt-1 truncate",title:O.filename,children:O.filename},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1129,columnNumber:25},void 0)]},O.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1110,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1108,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1101,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1076,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1075,columnNumber:9},void 0),le!==null&&a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxDEV("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[a.jsxDEV("div",{className:"p-4 border-b border-gray-200",children:a.jsxDEV("div",{className:"flex items-center justify-between",children:[a.jsxDEV("h3",{className:"text-lg font-bold text-gray-900",children:[(ne=d.find(O=>O.id===le))==null?void 0:ne.name," - "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1148,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{ze(null),Be(new Set)},className:"p-1 text-gray-600 hover:text-gray-900",children:a.jsxDEV(Cn,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1158,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1151,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1147,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1146,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4",children:[a.jsxDEV("p",{className:"text-sm text-gray-600 mb-4",children:"  .    ."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1164,columnNumber:15},void 0),a.jsxDEV("div",{className:"space-y-2",children:(Ze=d.find(O=>O.id===le))==null?void 0:Ze.items.map(O=>a.jsxDEV("div",{className:"flex items-start gap-3 p-3 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>{const _e=new Set(de);_e.has(O.id)?_e.delete(O.id):_e.add(O.id),Be(_e)},children:[a.jsxDEV("input",{type:"checkbox",checked:de.has(O.id),onChange:()=>{},className:"mt-1 w-5 h-5 rounded border-gray-300 text-gray-800 focus:ring-gray-500 cursor-pointer"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1184,columnNumber:23},void 0),a.jsxDEV("span",{className:`flex-1 text-sm ${O.is_completed?"text-gray-500 line-through":"text-gray-900"}`,children:O.content},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1190,columnNumber:23},void 0)]},O.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1171,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1167,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1163,columnNumber:13},void 0),a.jsxDEV("div",{className:"p-4 border-t border-gray-200 flex gap-2",children:[a.jsxDEV("button",{onClick:P,disabled:de.size===0,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:["   (",de.size,")"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1199,columnNumber:15},void 0),a.jsxDEV("button",{onClick:q,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1206,columnNumber:15},void 0),a.jsxDEV("button",{onClick:()=>{ze(null),Be(new Set)},className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1212,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1198,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1145,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1144,columnNumber:9},void 0),lt&&a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end md:items-center justify-center z-50",children:a.jsxDEV("div",{className:"bg-white rounded-t-2xl md:rounded-lg w-full md:max-w-md",children:[a.jsxDEV("div",{className:"p-4 border-b border-gray-200",children:a.jsxDEV("div",{className:"flex items-center justify-between",children:[a.jsxDEV("h3",{className:"text-lg font-bold text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1232,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>{St(!1),v("")},className:"p-1 text-gray-600 hover:text-gray-900",children:a.jsxDEV(Cn,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1240,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1233,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1231,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1230,columnNumber:13},void 0),a.jsxDEV("div",{className:"p-4",children:[a.jsxDEV("div",{className:"mb-4",children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1247,columnNumber:17},void 0),a.jsxDEV("input",{type:"text",value:C,onChange:O=>v(O.target.value),onKeyPress:O=>{O.key==="Enter"&&C.trim()&&Tt()},placeholder:"  ",className:"w-full px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1248,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1246,columnNumber:15},void 0),a.jsxDEV("div",{className:"flex gap-2",children:[a.jsxDEV("button",{onClick:()=>{St(!1),v("")},className:"flex-1 px-4 py-2.5 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1264,columnNumber:17},void 0),a.jsxDEV("button",{onClick:Tt,disabled:!C.trim()||at,className:"flex-1 px-4 py-2.5 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:at?" ...":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1273,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1263,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1245,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1229,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:1228,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/FinishCheck.tsx",lineNumber:580,columnNumber:5},void 0)};function BT(){const[n,e]=E.useState([]),[t,s]=E.useState(!1),[r,i]=E.useState(null),[o,l]=E.useState(!1),[u,m]=E.useState(null),[d,f]=E.useState(""),[p,y]=E.useState({rank:"",companyName:"",name:"",position:"",process:"",contact:"",bankName:"",accountNumber:"",notes:""}),[C,v]=E.useState(!1);E.useEffect(()=>{w()},[]),E.useEffect(()=>{const N=()=>{R()};return window.addEventListener("headerAddButtonClick",N),()=>window.removeEventListener("headerAddButtonClick",N)},[]);const w=async()=>{var N,V;try{n.length===0&&s(!0),i(null);const j=await mr.getAllContractors();e(j.map(T=>({id:T._id,rank:T.rank,companyName:T.companyName,name:T.name,position:T.position,process:T.process,contact:T.contact,accountNumber:T.accountNumber,notes:T.notes,createdAt:new Date(T.createdAt),updatedAt:new Date(T.updatedAt)})))}catch(j){console.error("Failed to load contractors:",j);const T=j instanceof Error&&((V=(N=j.response)==null?void 0:N.data)==null?void 0:V.message);i(T||"   .")}finally{s(!1)}},R=N=>{if(N){m(N);let V="",j=N.accountNumber||"";if(N.accountNumber){const k=["KB","","","","NH","IBK","KEB","SC","","","","","","","","","","","","","","","","","NH","","","","","KB","",""];for(const Ee of k)if(N.accountNumber.startsWith(Ee)){V=Ee,j=N.accountNumber.substring(Ee.length).trim();break}}let T=N.name,S=N.position||"";S||(S=gc(N.name),T=al(N.name)),y({rank:N.rank||"",companyName:N.companyName||"",name:T,position:S,process:N.process,contact:N.contact||"",bankName:V,accountNumber:j,notes:N.notes||""})}else m(null),y({rank:"",companyName:"",name:"",position:"",process:"",contact:"",bankName:"",accountNumber:"",notes:""});l(!0)},I=()=>{l(!1),m(null),y({rank:"",companyName:"",name:"",position:"",process:"",contact:"",bankName:"",accountNumber:"",notes:""})},F=async N=>{var j,T;if(N.preventDefault(),C)return;v(!0);const V=p.bankName&&p.accountNumber?`${p.bankName} ${p.accountNumber}`:p.accountNumber;try{const S={rank:p.rank,companyName:p.companyName,name:p.name,position:p.position,process:p.process,contact:p.contact,accountNumber:V,notes:p.notes};u?await mr.updateContractor(u.id,S):await mr.createContractor(S),await w(),I()}catch(S){console.error("Failed to save contractor:",S);const k=S instanceof Error&&((T=(j=S.response)==null?void 0:j.data)==null?void 0:T.message);alert(k||"  .")}finally{v(!1)}},re=async N=>{var V,j;if(window.confirm("   ?"))try{await mr.deleteContractor(N),await w()}catch(T){console.error("Failed to delete contractor:",T);const S=T instanceof Error&&((j=(V=T.response)==null?void 0:V.data)==null?void 0:j.message);alert(S||"  .")}},ee=()=>"border-gray-200 text-gray-600 bg-gray-50",M=N=>N?N==="1"?1:N==="1()"?2:N==="2"?3:N==="2()"?4:N==="3"?5:N==="3()"?6:N===""?100:N===""?200:999:999,A=n.filter(N=>N.name.toLowerCase().includes(d.toLowerCase())||N.process.toLowerCase().includes(d.toLowerCase())||N.accountNumber.toLowerCase().includes(d.toLowerCase())||N.contact&&N.contact.toLowerCase().includes(d.toLowerCase())||N.rank&&N.rank.toLowerCase().includes(d.toLowerCase())||N.companyName&&N.companyName.toLowerCase().includes(d.toLowerCase())).sort((N,V)=>{const j=M(N.rank)-M(V.rank);if(j!==0)return j;const T=N.process.localeCompare(V.process,"ko");return T!==0?T:N.name.localeCompare(V.name,"ko")});return a.jsxDEV("div",{className:"space-y-3 md:space-y-4",children:[a.jsxDEV("div",{className:"flex items-center justify-end",children:a.jsxDEV("button",{onClick:()=>R(),className:"hidden md:inline-flex btn btn-primary px-3 md:px-4 py-2",children:"+  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:290,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:289,columnNumber:7},this),a.jsxDEV("div",{className:"relative",children:[a.jsxDEV(Sy,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 md:w-5 md:h-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:300,columnNumber:9},this),a.jsxDEV("input",{type:"text",placeholder:", ,  ...",value:d,onChange:N=>f(N.target.value),className:"w-full pl-9 md:pl-10 pr-4 py-2 text-sm md:text-base border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:301,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:299,columnNumber:7},this),a.jsxDEV("div",{className:"contractors-table hidden md:block bg-white rounded-lg border border-gray-200 overflow-hidden",children:a.jsxDEV("div",{className:"overflow-x-auto",children:a.jsxDEV("table",{className:"w-full",children:[a.jsxDEV("thead",{className:"bg-gray-50 border-b border-gray-200",children:a.jsxDEV("tr",{children:[a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:316,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:319,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:322,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:325,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:328,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:331,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:334,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:337,columnNumber:17},this),a.jsxDEV("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:340,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:315,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:314,columnNumber:13},this),a.jsxDEV("tbody",{className:"bg-white divide-y divide-gray-200",children:t?a.jsxDEV("tr",{children:a.jsxDEV("td",{colSpan:9,className:"px-6 py-12 text-center",children:a.jsxDEV("p",{className:"text-gray-500",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:349,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:348,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:347,columnNumber:17},this):r?a.jsxDEV("tr",{children:a.jsxDEV("td",{colSpan:9,className:"px-6 py-12 text-center",children:a.jsxDEV("div",{className:"space-y-4",children:[a.jsxDEV("p",{className:"text-red-500",children:r},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:356,columnNumber:23},this),a.jsxDEV("button",{onClick:w,className:"inline-block px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:357,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:355,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:354,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:353,columnNumber:17},this):A.length===0?a.jsxDEV("tr",{children:a.jsxDEV("td",{colSpan:9,className:"px-6 py-12 text-center",children:a.jsxDEV("p",{className:"text-gray-500",children:d?"  .":"  ."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:369,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:368,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:367,columnNumber:17},this):A.map(N=>a.jsxDEV("tr",{className:"hover:bg-gray-50 transition-colors",children:[a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("span",{className:`px-2 py-1 text-xs font-medium border rounded ${ee(N.rank)}`,children:N.rank||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:378,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:377,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("span",{className:"text-xs font-medium text-gray-700",children:N.process},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:383,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:382,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"text-sm text-gray-900",children:N.companyName||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:388,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:387,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"font-medium text-gray-900",children:al(N.name)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:391,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:390,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"text-sm text-gray-900",children:N.position||gc(N.name)||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:394,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:393,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"text-sm text-gray-900",children:N.contact||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:397,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:396,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxDEV("div",{className:"text-sm text-gray-900",children:N.accountNumber},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:400,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:399,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4",children:a.jsxDEV("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:N.notes||"-"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:403,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:402,columnNumber:21},this),a.jsxDEV("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[a.jsxDEV("button",{onClick:()=>R(N),className:"text-gray-600 hover:text-gray-900 mr-3",children:a.jsxDEV(Wm,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:412,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:408,columnNumber:23},this),a.jsxDEV("button",{onClick:()=>re(N.id),className:"text-red-600 hover:text-red-900",children:a.jsxDEV(ji,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:418,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:414,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:407,columnNumber:21},this)]},N.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:376,columnNumber:19},this))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:345,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:313,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:312,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:311,columnNumber:7},this),a.jsxDEV("div",{className:"md:hidden space-y-3",children:t?a.jsxDEV("div",{className:"text-center py-12 text-gray-500 text-sm",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:432,columnNumber:11},this):r?a.jsxDEV("div",{className:"text-center py-12 space-y-4",children:[a.jsxDEV("p",{className:"text-red-500 text-sm",children:r},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:435,columnNumber:13},this),a.jsxDEV("button",{onClick:w,className:"inline-block px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:436,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:434,columnNumber:11},this):A.length===0?a.jsxDEV("div",{className:"text-center py-12 text-gray-500 text-sm",children:d?"  .":"  ."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:444,columnNumber:11},this):A.map(N=>a.jsxDEV("div",{className:"card p-3 space-y-2",children:[a.jsxDEV("div",{className:"flex items-start justify-between mb-2",children:[a.jsxDEV("div",{className:"flex-1",children:[a.jsxDEV("div",{className:"flex items-center gap-2 mb-1",children:[N.rank&&a.jsxDEV("span",{className:`px-1.5 py-0.5 text-[10px] font-medium border rounded ${ee(N.rank)}`,children:N.rank},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:455,columnNumber:23},this),a.jsxDEV("span",{className:"px-1.5 py-0.5 text-[10px] font-medium text-gray-700 bg-gray-100 rounded",children:N.process},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:459,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:453,columnNumber:19},this),N.companyName&&a.jsxDEV("p",{className:"text-xs text-gray-600 mb-0.5",children:N.companyName},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:464,columnNumber:21},this),a.jsxDEV("p",{className:"font-semibold text-gray-900 text-sm",children:al(N.name)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:466,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:452,columnNumber:17},this),a.jsxDEV("div",{className:"flex items-center gap-2 ml-2",children:[a.jsxDEV("button",{onClick:()=>R(N),className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded",children:a.jsxDEV(Wm,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:473,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:469,columnNumber:19},this),a.jsxDEV("button",{onClick:()=>re(N.id),className:"p-1.5 text-red-600 hover:text-red-900 hover:bg-red-50 rounded",children:a.jsxDEV(ji,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:479,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:475,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:468,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:451,columnNumber:15},this),a.jsxDEV("div",{className:"space-y-1 text-xs",children:[(N.position||gc(N.name))&&a.jsxDEV("div",{className:"flex items-start",children:[a.jsxDEV("span",{className:"text-gray-500 w-14 flex-shrink-0",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:488,columnNumber:21},this),a.jsxDEV("span",{className:"text-gray-900",children:N.position||gc(N.name)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:489,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:487,columnNumber:19},this),N.contact&&a.jsxDEV("div",{className:"flex items-start",children:[a.jsxDEV("span",{className:"text-gray-500 w-14 flex-shrink-0",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:494,columnNumber:21},this),a.jsxDEV("span",{className:"text-gray-900",children:N.contact},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:495,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:493,columnNumber:19},this),a.jsxDEV("div",{className:"flex items-start",children:[a.jsxDEV("span",{className:"text-gray-500 w-14 flex-shrink-0",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:499,columnNumber:19},this),a.jsxDEV("span",{className:"text-gray-900 break-all",children:N.accountNumber},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:500,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:498,columnNumber:17},this),N.notes&&a.jsxDEV("div",{className:"flex items-start",children:[a.jsxDEV("span",{className:"text-gray-500 w-14 flex-shrink-0",children:":"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:504,columnNumber:21},this),a.jsxDEV("span",{className:"text-gray-600",children:N.notes},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:505,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:503,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:485,columnNumber:15},this)]},N.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:449,columnNumber:13},this))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:430,columnNumber:7},this),o&&a.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxDEV("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:a.jsxDEV("div",{className:"p-6",children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-6",children:[a.jsxDEV("h2",{className:"text-xl font-bold text-gray-900",children:u?" ":"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:520,columnNumber:17},this),a.jsxDEV("button",{onClick:I,className:"text-gray-400 hover:text-gray-600",children:a.jsxDEV(Cn,{className:"w-6 h-6"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:527,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:523,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:519,columnNumber:15},this),a.jsxDEV("form",{onSubmit:F,className:"space-y-4",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:533,columnNumber:19},this),a.jsxDEV("select",{value:p.rank,onChange:N=>y({...p,rank:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent",children:[a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:541,columnNumber:21},this),a.jsxDEV("option",{value:"1",children:"1"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:542,columnNumber:21},this),a.jsxDEV("option",{value:"2",children:"2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:543,columnNumber:21},this),a.jsxDEV("option",{value:"3",children:"3"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:544,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:536,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:532,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:549,columnNumber:19},this),a.jsxDEV("input",{type:"text",value:p.companyName,onChange:N=>y({...p,companyName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:552,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:548,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[" ",a.jsxDEV("span",{className:"text-red-500",children:"*"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:562,columnNumber:24},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:561,columnNumber:19},this),a.jsxDEV("input",{type:"text",required:!0,value:p.name,onChange:N=>y({...p,name:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:564,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:560,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:574,columnNumber:19},this),a.jsxDEV("input",{type:"text",value:p.position,onChange:N=>y({...p,position:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:577,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:573,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[" ",a.jsxDEV("span",{className:"text-red-500",children:"*"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:587,columnNumber:24},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:586,columnNumber:19},this),a.jsxDEV("input",{type:"text",required:!0,value:p.process,onChange:N=>y({...p,process:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:589,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:585,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:599,columnNumber:19},this),a.jsxDEV("input",{type:"text",value:p.contact,onChange:N=>y({...p,contact:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:602,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:598,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:611,columnNumber:19},this),a.jsxDEV("select",{value:p.bankName,onChange:N=>y({...p,bankName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent",children:[a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:619,columnNumber:21},this),a.jsxDEV("optgroup",{label:"",children:[a.jsxDEV("option",{value:"KB",children:"KB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:621,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:622,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:623,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:624,columnNumber:23},this),a.jsxDEV("option",{value:"NH",children:"NH"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:625,columnNumber:23},this),a.jsxDEV("option",{value:"IBK",children:"IBK"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:626,columnNumber:23},this),a.jsxDEV("option",{value:"KEB",children:"KEB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:627,columnNumber:23},this),a.jsxDEV("option",{value:"SC",children:"SC"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:628,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:629,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:620,columnNumber:21},this),a.jsxDEV("optgroup",{label:"",children:[a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:632,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:633,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:634,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:635,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:636,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:637,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:631,columnNumber:21},this),a.jsxDEV("optgroup",{label:"",children:[a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:640,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:641,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:642,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:643,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:644,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:645,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:639,columnNumber:21},this),a.jsxDEV("optgroup",{label:"",children:[a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:648,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:649,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:650,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:647,columnNumber:21},this),a.jsxDEV("optgroup",{label:"",children:[a.jsxDEV("option",{value:"NH",children:"NH"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:653,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:654,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:655,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:656,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:657,columnNumber:23},this),a.jsxDEV("option",{value:"KB",children:"KB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:658,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:659,columnNumber:23},this),a.jsxDEV("option",{value:"",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:660,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:652,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:614,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:610,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:666,columnNumber:19},this),a.jsxDEV("input",{type:"text",value:p.accountNumber,onChange:N=>y({...p,accountNumber:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:669,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:665,columnNumber:17},this),a.jsxDEV("div",{children:[a.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:678,columnNumber:19},this),a.jsxDEV("textarea",{value:p.notes,onChange:N=>y({...p,notes:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent",rows:3},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:681,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:677,columnNumber:17},this),a.jsxDEV("div",{className:"flex space-x-3 pt-4",children:[a.jsxDEV("button",{type:"button",onClick:I,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:690,columnNumber:19},this),a.jsxDEV("button",{type:"submit",disabled:C,className:"flex-1 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50",children:C?" ...":u?"":""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:697,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:689,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:531,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:518,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:517,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:516,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Contractors.tsx",lineNumber:287,columnNumber:5},this)}const UT=()=>{const[n,e]=E.useState([]),[t,s]=E.useState(null),[r,i]=E.useState(!1),o=E.useRef(null);E.useEffect(()=>(o.current=Fc.subscribeToQuoteInquiries(f=>{e(f),i(!1)}),i(!0),()=>{o.current&&o.current()}),[]);const l=async f=>{try{await Fc.markAsRead(f),window.dispatchEvent(new CustomEvent("quoteInquiryRead"))}catch(p){console.error("Failed to mark as read:",p)}},u=f=>{s(f),f.isRead||l(f.id)},m=async(f,p)=>{if(p.stopPropagation(),!!confirm("  ?"))try{await Fc.deleteQuoteInquiry(f),(t==null?void 0:t.id)===f&&s(null),oe.success(" ")}catch(y){console.error("Failed to delete inquiry:",y),oe.error("  ")}},d=n.filter(f=>!f.isRead).length;return r?a.jsxDEV("div",{className:"flex items-center justify-center h-full",children:a.jsxDEV("div",{className:"text-gray-500",children:" ..."},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:74,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:73,columnNumber:7},void 0):a.jsxDEV("div",{className:"h-full flex flex-col md:flex-row gap-4 p-4",children:[a.jsxDEV("div",{className:`w-full md:w-1/3 bg-white rounded-lg shadow overflow-hidden flex flex-col ${t?"hidden md:flex":"flex"}`,children:[a.jsxDEV("div",{className:"p-4 border-b bg-gray-50",children:a.jsxDEV("h2",{className:"text-lg font-semibold text-gray-900",children:[" ",d>0&&a.jsxDEV("span",{className:"ml-2 px-2 py-1 text-xs bg-red-500 text-white rounded-full",children:d},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:87,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:84,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:83,columnNumber:9},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto",children:n.length===0?a.jsxDEV("div",{className:"p-4 text-center text-gray-500",children:"  "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:96,columnNumber:13},void 0):a.jsxDEV("div",{className:"divide-y",children:n.map(f=>a.jsxDEV("div",{className:`relative group ${(t==null?void 0:t.id)===f.id?"bg-blue-50 border-l-4 border-blue-500":""} ${f.isRead?"":"bg-yellow-50"}`,children:a.jsxDEV("button",{onClick:()=>u(f),className:"w-full p-4 text-left hover:bg-gray-50 transition-colors",children:[a.jsxDEV("div",{className:"flex justify-between items-start mb-2",children:[a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("span",{className:"font-medium text-gray-900",children:f.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:114,columnNumber:25},void 0),!f.isRead&&a.jsxDEV("span",{className:"w-2 h-2 bg-red-500 rounded-full"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:116,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:113,columnNumber:23},void 0),a.jsxDEV("div",{className:"flex items-center gap-2",children:[a.jsxDEV("span",{className:"text-xs text-gray-500",children:$t(new Date(f.createdAt),"MM/dd HH:mm")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:120,columnNumber:25},void 0),a.jsxDEV("button",{onClick:p=>m(f.id,p),className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"",children:a.jsxDEV(ji,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:128,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:123,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:119,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:112,columnNumber:21},void 0),a.jsxDEV("div",{className:"text-sm text-gray-600 flex items-center gap-1 mb-1",children:[a.jsxDEV(Kp,{className:"w-3 h-3"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:134,columnNumber:23},void 0),f.phone]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:133,columnNumber:21},void 0),a.jsxDEV("div",{className:"text-sm text-gray-500 line-clamp-2",children:f.message},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:138,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:108,columnNumber:19},void 0)},f.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:102,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:100,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:94,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:82,columnNumber:7},void 0),a.jsxDEV("div",{className:`flex-1 bg-white rounded-lg shadow overflow-hidden ${t?"flex flex-col":"hidden md:flex md:flex-col"}`,children:t?a.jsxDEV("div",{className:"h-full flex flex-col",children:[a.jsxDEV("div",{className:"p-6 border-b bg-gray-50",children:[a.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[a.jsxDEV("h3",{className:"text-xl font-semibold text-gray-900",children:t.name},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:155,columnNumber:17},void 0),a.jsxDEV("button",{onClick:()=>s(null),className:"md:hidden px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded transition-colors",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:159,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:154,columnNumber:15},void 0),a.jsxDEV("div",{className:"text-sm text-gray-500",children:$t(new Date(t.createdAt),"yyyy MM dd HH:mm")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:166,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:153,columnNumber:13},void 0),a.jsxDEV("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[a.jsxDEV("div",{className:"space-y-3",children:[a.jsxDEV("h4",{className:"font-medium text-gray-900 flex items-center gap-2",children:[a.jsxDEV(i_,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:175,columnNumber:19},void 0)," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:174,columnNumber:17},void 0),a.jsxDEV("div",{className:"pl-6 space-y-2",children:[a.jsxDEV("div",{className:"flex items-center gap-2 text-gray-700",children:[a.jsxDEV(Kp,{className:"w-4 h-4 text-gray-400"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:180,columnNumber:21},void 0),a.jsxDEV("span",{children:t.phone},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:181,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:179,columnNumber:19},void 0),a.jsxDEV("div",{className:"flex items-center gap-2 text-gray-700",children:[a.jsxDEV(o_,{className:"w-4 h-4 text-gray-400"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:184,columnNumber:21},void 0),a.jsxDEV("span",{children:t.email},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:185,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:183,columnNumber:19},void 0),t.address&&a.jsxDEV("div",{className:"flex items-center gap-2 text-gray-700",children:[a.jsxDEV(a_,{className:"w-4 h-4 text-gray-400"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:189,columnNumber:23},void 0),a.jsxDEV("span",{children:t.address},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:190,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:188,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:178,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:173,columnNumber:15},void 0),(t.projectType||t.budget)&&a.jsxDEV("div",{className:"space-y-3",children:[a.jsxDEV("h4",{className:"font-medium text-gray-900 flex items-center gap-2",children:[a.jsxDEV(l_,{className:"w-4 h-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:200,columnNumber:21},void 0)," "]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:199,columnNumber:19},void 0),a.jsxDEV("div",{className:"pl-6 space-y-2",children:[t.projectType&&a.jsxDEV("div",{className:"text-gray-700",children:[a.jsxDEV("span",{className:"text-gray-500",children:" : "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:206,columnNumber:25},void 0),t.projectType]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:205,columnNumber:23},void 0),t.budget&&a.jsxDEV("div",{className:"text-gray-700",children:[a.jsxDEV("span",{className:"text-gray-500",children:": "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:212,columnNumber:25},void 0),t.budget]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:211,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:203,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:198,columnNumber:17},void 0),a.jsxDEV("div",{className:"space-y-3",children:[a.jsxDEV("h4",{className:"font-medium text-gray-900",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:222,columnNumber:17},void 0),a.jsxDEV("div",{className:"pl-6 text-gray-700 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg",children:t.message},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:223,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:221,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:171,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:152,columnNumber:11},void 0):a.jsxDEV("div",{className:"h-full flex items-center justify-center text-gray-500",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:230,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:150,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/QuoteInquiry.tsx",lineNumber:80,columnNumber:5},void 0)},HT=()=>{const{login:n}=oi(),[e,t]=E.useState(!1),{register:s,handleSubmit:r,setValue:i,formState:{errors:o}}=Np(),l=async m=>{t(!0);try{await n(m.username,m.password)}finally{t(!1)}},u=m=>{i("username",m)};return a.jsxDEV("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxDEV("div",{className:"max-w-md w-full",children:a.jsxDEV("div",{className:"bg-white border border-gray-200 rounded-lg p-8",children:[a.jsxDEV("div",{className:"text-center mb-8",children:[a.jsxDEV("h2",{className:"text-3xl font-bold text-gray-900",children:"HV LAB"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:39,columnNumber:13},void 0),a.jsxDEV("p",{className:"mt-2 text-sm text-gray-600",children:"   "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:40,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:38,columnNumber:11},void 0),a.jsxDEV("form",{onSubmit:r(l),className:"space-y-6",children:[a.jsxDEV("div",{children:[a.jsxDEV("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:47,columnNumber:15},void 0),a.jsxDEV("input",{...s("username",{required:" "}),type:"text",className:"input",placeholder:" ",autoFocus:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:50,columnNumber:15},void 0),o.username&&a.jsxDEV("p",{className:"mt-1 text-sm text-red-600",children:o.username.message},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:60,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:46,columnNumber:13},void 0),a.jsxDEV("div",{children:[a.jsxDEV("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:65,columnNumber:15},void 0),a.jsxDEV("input",{...s("password",{required:" "}),type:"password",className:"input",placeholder:""},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:68,columnNumber:15},void 0),o.password&&a.jsxDEV("p",{className:"mt-1 text-sm text-red-600",children:o.password.message},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:77,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:64,columnNumber:13},void 0),a.jsxDEV("button",{type:"submit",disabled:e,className:"w-full btn btn-primary flex items-center justify-center",children:e?a.jsxDEV("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:87,columnNumber:17},void 0):a.jsxDEV(a.Fragment,{children:[a.jsxDEV(c_,{className:"mr-2 h-5 w-5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:90,columnNumber:19},void 0),""]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:89,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:81,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:45,columnNumber:11},void 0),a.jsxDEV("div",{className:"mt-6 border-t pt-6",children:[a.jsxDEV("p",{className:"text-sm text-gray-600 text-center mb-4",children:" "},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:98,columnNumber:13},void 0),a.jsxDEV("div",{className:"grid grid-cols-3 gap-2",children:["","","","","","",""].map(m=>a.jsxDEV("button",{onClick:()=>u(m),className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",type:"button",children:m},m,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:101,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:99,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:97,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:37,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:36,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/Login.tsx",lineNumber:35,columnNumber:5},void 0)},MT=E.lazy(()=>ir(()=>import("./Drawings-DkAfJJBY.js"),__vite__mapDeps([0,1,2,3,4,5]))),FT=E.lazy(()=>ir(()=>import("./SiteLog-B9L5fjNM.js"),__vite__mapDeps([6,1,4,2,3,5]))),OT=E.lazy(()=>ir(()=>import("./AfterService-OHMUd5vW.js"),__vite__mapDeps([7,1,2,4,3,5]))),qT=E.lazy(()=>ir(()=>import("./AdditionalWork-BCzVs6Cs.js"),__vite__mapDeps([8,1,2,9,4,3,5]))),$T=E.lazy(()=>ir(()=>import("./ConstructionPayment-N_POUJ9q.js"),__vite__mapDeps([10,1,9,4,2,3,5]))),zT=E.lazy(()=>ir(()=>import("./WorkRequest-DNvJElc6.js"),__vite__mapDeps([11,1,2,4,3,5]))),WT=E.lazy(()=>ir(()=>import("./Specbook-DPpady9m.js"),__vite__mapDeps([12,1,2,3,4,5]))),KT=E.lazy(()=>ir(()=>import("./EstimatePreview-DNcct48S.js"),__vite__mapDeps([13,1,2,3,4,5]))),GT=E.lazy(()=>ir(()=>import("./ExecutionHistory-B2fZ26Jt.js"),__vite__mapDeps([14,1,4,2,3,5]))),QT=()=>a.jsxDEV("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:a.jsxDEV("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:37,columnNumber:5},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:36,columnNumber:3},void 0),YT=new Qv({defaultOptions:{queries:{staleTime:1e3*60*5,refetchOnWindowFocus:!1}}});function XT(){const[n,e]=E.useState(!1);return E.useEffect(()=>{const t=ck({immediate:!0,onNeedRefresh(){console.log("   ."),e(!0),oe.loading("   ...",{duration:2e3}),setTimeout(()=>{t(!0).then(()=>{oe.dismiss(),oe.success(" !",{duration:2e3,icon:""}),setTimeout(()=>{window.location.reload()},1e3)})},1500)},onOfflineReady(){console.log("    ")},onRegisteredSW(u,m){console.log(" Service Worker :",u),m&&setInterval(()=>{console.log("   ..."),m.update()},6e4)},onRegisterError(u){console.error(" Service Worker  :",u)}});CI();const s=async()=>{try{const m=await(await fetch("/version.json?t="+Date.now())).json(),d=localStorage.getItem("app_version");d&&d!==m.version?(console.log("   :",m.version),localStorage.setItem("app_version",m.version),"serviceWorker"in navigator&&(await navigator.serviceWorker.ready).update()):d||localStorage.setItem("app_version",m.version)}catch(u){console.error("  :",u)}};setTimeout(s,5e3);const r=setInterval(s,3e4),i=window.location.hostname,o=i==="hvlab.app"||i.includes("hv-lab-app")||i.includes("firebaseapp.com");let l=null;if(o)console.log("  : Socket.IO  (HTTP  )");else{const u=window.location.origin;l=Ka(u,{transports:["websocket","polling"]}),Rr.setSocket(l),l.on("connect",()=>{console.log(" Socket.IO ")}),l.on("urgent-payment",m=>{console.log("    :",m);const d=`${m.project}  ${m.amount.toLocaleString()}  `;VI(m.urgency,d)}),l.on("disconnect",()=>{console.log(" Socket.IO  ")})}return()=>{l&&l.disconnect(),clearInterval(r)}},[]),a.jsxDEV(Yv,{client:YT,children:a.jsxDEV(Wv,{children:a.jsxDEV(R1,{children:[a.jsxDEV(E.Suspense,{fallback:a.jsxDEV(QT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:179,columnNumber:31},this),children:a.jsxDEV(Kv,{children:[a.jsxDEV(jn,{path:"/login",element:a.jsxDEV(HT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:181,columnNumber:45},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:181,columnNumber:15},this),a.jsxDEV(jn,{path:"/",element:a.jsxDEV(EI,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:182,columnNumber:40},this),children:[a.jsxDEV(jn,{index:!0,element:a.jsxDEV(Vy,{to:"/dashboard",replace:!0},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:183,columnNumber:39},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:183,columnNumber:17},this),a.jsxDEV(jn,{path:"dashboard",element:a.jsxDEV(r2,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:184,columnNumber:50},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:184,columnNumber:17},this),a.jsxDEV(jn,{path:"projects",element:a.jsxDEV(m2,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:185,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:185,columnNumber:17},this),a.jsxDEV(jn,{path:"schedule",element:a.jsxDEV(wT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:186,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:186,columnNumber:17},this),a.jsxDEV(jn,{path:"drawings",element:a.jsxDEV(MT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:187,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:187,columnNumber:17},this),a.jsxDEV(jn,{path:"site-log",element:a.jsxDEV(FT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:188,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:188,columnNumber:17},this),a.jsxDEV(jn,{path:"after-service",element:a.jsxDEV(OT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:189,columnNumber:54},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:189,columnNumber:17},this),a.jsxDEV(jn,{path:"additional-work",element:a.jsxDEV(qT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:190,columnNumber:56},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:190,columnNumber:17},this),a.jsxDEV(jn,{path:"construction-payment",element:a.jsxDEV($T,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:191,columnNumber:61},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:191,columnNumber:17},this),a.jsxDEV(jn,{path:"contractors",element:a.jsxDEV(BT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:192,columnNumber:52},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:192,columnNumber:17},this),a.jsxDEV(jn,{path:"work-request",element:a.jsxDEV(zT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:193,columnNumber:53},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:193,columnNumber:17},this),a.jsxDEV(jn,{path:"finish-check",element:a.jsxDEV(RT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:194,columnNumber:53},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:194,columnNumber:17},this),a.jsxDEV(jn,{path:"specbook",element:a.jsxDEV(WT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:195,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:195,columnNumber:17},this),a.jsxDEV(jn,{path:"estimate-preview",element:a.jsxDEV(KT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:196,columnNumber:57},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:196,columnNumber:17},this),a.jsxDEV(jn,{path:"execution-history",element:a.jsxDEV(GT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:197,columnNumber:58},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:197,columnNumber:17},this),a.jsxDEV(jn,{path:"payments",element:a.jsxDEV(jT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:198,columnNumber:49},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:198,columnNumber:17},this),a.jsxDEV(jn,{path:"quote-inquiry",element:a.jsxDEV(UT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:199,columnNumber:54},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:199,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:182,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:180,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:179,columnNumber:11},this),a.jsxDEV(hD,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#fff",color:"#363636",border:"1px solid #e5e5e5"}}},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:203,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:178,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:177,columnNumber:7},this)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/App.tsx",lineNumber:176,columnNumber:5},this)}"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(n){for(const e of n)e.update()});Ky(document.getElementById("root")).render(a.jsxDEV(E.StrictMode,{children:a.jsxDEV(XT,{},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/main.tsx",lineNumber:18,columnNumber:5},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/main.tsx",lineNumber:17,columnNumber:3},void 0));export{Np as A,Vn as B,Md as C,bI as D,Um as E,j1 as F,oP as G,Ft as H,TT as I,gs as J,LT as K,ST as L,Fm as P,be as T,ae as a,Kn as b,pn as c,Te as d,yu as e,Bd as f,Rt as g,oi as h,Ju as i,a as j,Ge as k,_s as l,It as m,Dx as n,en as o,ea as p,_t as q,gu as r,qi as s,bu as t,Rd as u,Ot as v,qn as w,tr as x,dr as y,oe as z};
