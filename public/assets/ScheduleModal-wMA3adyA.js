import{j as s}from"./vendor-data-DG_4MGb7.js";import{r as c}from"./vendor-react-D-r2Cqeg.js";import{u as Q}from"./index.esm-D9ojv-r8.js";import{u as W}from"./dataStore-ByVzUXWH.js";import{p as F}from"./vendor-date-9Cl9d1sr.js";import{X as Y,T as Z}from"./vendor-ui-DTwhhNuH.js";const B=["ìƒì¤€","ì‹ ì• ","ì¬ì²œ","ë¯¼ê¸°","ì¬ì„±","ì¬í˜„","ì•ˆíŒ€"],ae=({event:t,slotInfo:w,defaultProjectName:H,onClose:A,onSave:R,onDelete:q})=>{const[k,P]=c.useState(!1),{register:S,handleSubmit:z,setValue:g,watch:U,formState:{errors:I},reset:v}=Q({defaultValues:{projectId:"",title:"",date:"",description:""}}),{projects:u}=W(),[l,n]=c.useState([]),[M,C]=c.useState(""),[x,E]=c.useState(!1),[h,y]=c.useState("ì˜¤ì „"),[p,T]=c.useState(9),[V,D]=c.useState(0),[ee,b]=c.useState(""),j=U("projectId");c.useEffect(()=>{if(j){const e=u.find(o=>o.id===j||o.id===parseInt(j)||o.id.toString()===j.toString());console.log("ğŸ”´ Selected project:",e==null?void 0:e.name),console.log("ğŸ”´ Project team:",e==null?void 0:e.team),console.log("ğŸ”´ Current selectedMembers:",l)}},[j,u,l]),c.useEffect(()=>{console.log("ğŸŸ¡ Modal mount - initializing states"),n([]),b(""),C("")},[]),c.useEffect(()=>{if(console.log("ğŸŸ¢ ScheduleModal useEffect triggered:",{hasEvent:!!t,eventId:t==null?void 0:t.id,hasSlotInfo:!!w,hasMergedEvents:!!(t!=null&&t.mergedEventIds)}),t&&t.id){console.log("ğŸŸ¢ ScheduleModal processing event:",{title:t.title,projectId:t.projectId,projectName:t.projectName,start:t.start,assignedTo:t.assignedTo,time:t.time});const e=t.originalTitle||t.title,o=/ - (ì˜¤ì „|ì˜¤í›„) \d{1,2}ì‹œ$/,r=e.replace(o,"");if(g("title",r,{shouldValidate:!1,shouldDirty:!1}),g("date",F(t.start,"yyyy-MM-dd"),{shouldValidate:!1,shouldDirty:!1}),g("description",t.description||"",{shouldValidate:!1,shouldDirty:!1}),t.projectId&&t.projectId!==""&&t.projectId!=="undefined")console.log("ğŸ”µ Setting projectId from event:",t.projectId),g("projectId",t.projectId,{shouldValidate:!1,shouldDirty:!1}),b("");else if(t.projectName){const d=u.find(f=>f.name===t.projectName);console.log("ğŸ”µ Finding project by name:",t.projectName,"found:",d),d?(console.log("ğŸ”µ Setting projectId from found project:",d.id),g("projectId",d.id,{shouldValidate:!1,shouldDirty:!1}),b("")):(console.log("ğŸ”µ Project not found, leaving empty"),g("projectId","",{shouldValidate:!1,shouldDirty:!1}),b(""))}else console.log("ğŸ”µ No project info, leaving empty"),g("projectId","",{shouldValidate:!1,shouldDirty:!1}),b("");const m=t.assignedTo||t.attendees||[];if(console.log("ğŸŸ¢ Setting selectedMembers to:",m),n(Array.isArray(m)?m:[]),t.time&&t.time!=="-"){console.log("ğŸŸ¢ Setting time from event:",{eventTime:t.time,parsedHours:t.time.split(":")[0],parsedMinutes:t.time.split(":")[1]}),E(!0);const[d,f]=t.time.split(":"),i=parseInt(d,10),N=parseInt(f,10);i>=12?(y("ì˜¤í›„"),T(i===12?12:i-12)):(y("ì˜¤ì „"),T(i===0?12:i)),D(N),console.log("ğŸŸ¢ Time state set:",{hasTime:!0,period:i>=12?"ì˜¤í›„":"ì˜¤ì „",hour:i>=12?i===12?12:i-12:i===0?12:i,minute:N})}else console.log("ğŸŸ¢ No time in event, setting hasTime to false"),E(!1),y("ì˜¤ì „"),T(9),D(0)}else if(w&&!t&&(console.log("ğŸŸ¢ New schedule from slot:",w),v({projectId:"",title:"",date:F(w.start,"yyyy-MM-dd"),description:""}),console.log("ğŸŸ¡ New schedule - resetting selectedMembers to empty array"),n([]),b(""),H)){const e=u.find(o=>o.name===H);e&&g("projectId",e.id,{shouldValidate:!1,shouldDirty:!1})}},[t==null?void 0:t.id]);const K=e=>{console.log("ğŸ”µ toggleMember called with:",e),console.log("ğŸ”µ Current selectedMembers before toggle:",l),n(o=>{console.log("ğŸ”µ Previous members in setState:",o);const r=o.includes(e)?o.filter(m=>m!==e):[...o,e];return console.log("ğŸ”µ Updated members after toggle:",r),r})},X=()=>{const e="HV LAB";l.includes(e)?n(o=>o.filter(r=>r!==e)):n(o=>[...o.filter(r=>r!=="ì•ˆíŒ€"),e])},_=()=>{const e="í˜„ì¥íŒ€";l.includes(e)?n(o=>o.filter(r=>r!==e)):n(o=>[...o,e])},G=()=>{const e="ë””ìì¸íŒ€";l.includes(e)?n(o=>o.filter(r=>r!==e)):n(o=>[...o,e])},L=()=>{M.trim()&&!l.includes(M.trim())&&(n(e=>[...e,M.trim()]),C(""))},J=e=>{n(o=>o.filter(r=>r!==e))},O=async e=>{console.log("ğŸ”´ Form onSubmit called with data:",e),console.log("ğŸ”´ selectedMembers:",l),console.log("ğŸ”´ hasTime state:",x),console.log("ğŸ”´ timePeriod:",h,"timeHour:",p,"timeMinute:",V),console.log("ğŸ”´ Available projects:",u.map(a=>({id:a.id,name:a.name,idType:typeof a.id}))),console.log("ğŸ”´ Merged event IDs:",t==null?void 0:t.mergedEventIds);const o=/ - (ì˜¤ì „|ì˜¤í›„) \d{1,2}ì‹œ$/,r=e.title.replace(o,"").trim();let m="",d="";if(e.projectId){const a=u.find($=>$.id===e.projectId||$.id===parseInt(e.projectId)||$.id.toString()===e.projectId.toString());console.log("ğŸ”´ Looking for project with id:",e.projectId,"type:",typeof e.projectId),console.log("ğŸ”´ Found project:",a),m=(a==null?void 0:a.name)||"",d=e.projectId}else m="",d="";console.log("ğŸ”´ Final projectId:",d,"projectName:",m,"cleanedTitle:",r);const f=new Date(e.date);let i="-";if(x){let a=p;h==="ì˜¤í›„"&&p!==12?a=p+12:h==="ì˜¤ì „"&&p===12&&(a=0),i=`${a.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}`,console.log("ğŸ”´ Time calculated:",i)}else console.log("ğŸ”´ No time set (hasTime is false)");const N={...t,title:r,start:f,end:f,projectId:d,projectName:m,assignedTo:l,description:e.description||"",time:i,mergedEventIds:t==null?void 0:t.mergedEventIds};if(!k){P(!0),console.log("ğŸ”´ Calling onSave with newEvent:",N);try{await R(N),console.log("ğŸ”´ onSave completed successfully")}catch(a){throw console.error("ğŸ”´ onSave failed:",a),a}finally{P(!1)}}};return console.log("ğŸ”¶ Rendering ScheduleModal with selectedMembers:",l),s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3 md:p-4",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b",children:[s.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:t?"ì¼ì • ìˆ˜ì •":"ìƒˆ ì¼ì • ì¶”ê°€"}),s.jsx("button",{onClick:A,className:"p-1.5 md:p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(Y,{className:"h-5 w-5"})})]}),s.jsxs("form",{onSubmit:z(O),className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"í”„ë¡œì íŠ¸"}),s.jsxs("select",{...S("projectId"),className:"input w-full",children:[s.jsx("option",{value:""}),u.filter(e=>t!=null&&t.isASVisit?!0:e.status!=="completed").map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ì¼ì • ì œëª© *"}),s.jsx("input",{...S("title",{required:"ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"}),type:"text",className:"input w-full"}),I.title&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:String(I.title.message)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ë‚ ì§œ *"}),s.jsx("input",{...S("date",{required:"ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”"}),type:"date",className:"input w-full"}),I.date&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:String(I.date.message)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ì‹œê°„"}),s.jsx("div",{className:"mb-2",children:s.jsx("button",{type:"button",onClick:()=>E(!x),className:`px-3 py-1.5 text-xs rounded border transition-colors ${x?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:x?"ì‹œê°„ ì„¤ì •ë¨":"ì‹œê°„ ë¯¸ì„¤ì • (-)"})}),x&&s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{type:"button",onClick:()=>y("ì˜¤ì „"),className:`px-3 py-1.5 text-xs rounded border transition-colors ${h==="ì˜¤ì „"?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"ì˜¤ì „"}),s.jsx("button",{type:"button",onClick:()=>y("ì˜¤í›„"),className:`px-3 py-1.5 text-xs rounded border transition-colors ${h==="ì˜¤í›„"?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"ì˜¤í›„"})]}),s.jsx("select",{value:p,onChange:e=>T(parseInt(e.target.value)),className:"flex-1 min-w-[80px] max-w-[120px] px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500",children:[12,1,2,3,4,5,6,7,8,9,10,11].map(e=>s.jsxs("option",{value:e,children:[e,"ì‹œ"]},e))}),s.jsx("select",{value:V,onChange:e=>D(parseInt(e.target.value)),className:"flex-1 min-w-[80px] max-w-[120px] px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500",children:[0,10,20,30,40,50].map(e=>s.jsxs("option",{value:e,children:[e,"ë¶„"]},e))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ë‹´ë‹¹ì (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)"}),s.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[s.jsx("button",{type:"button",onClick:X,className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${l.includes("HV LAB")?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"HV LAB"}),s.jsx("button",{type:"button",onClick:_,className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${l.includes("í˜„ì¥íŒ€")?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"í˜„ì¥íŒ€"}),s.jsx("button",{type:"button",onClick:G,className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${l.includes("ë””ìì¸íŒ€")?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"ë””ìì¸íŒ€"}),B.map(e=>s.jsx("button",{type:"button",onClick:()=>K(e),className:`px-2.5 py-1.5 rounded border transition-colors text-sm ${l.includes(e)?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:e},e)),l.filter(e=>!B.includes(e)&&e!=="HV LAB"&&e!=="í˜„ì¥íŒ€"&&e!=="ë””ìì¸íŒ€").map(e=>s.jsxs("button",{type:"button",onClick:()=>J(e),className:"px-2.5 py-1.5 rounded border transition-colors text-sm bg-gray-900 text-white border-gray-900 hover:bg-gray-800",children:[e," Ã—"]},e))]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:M,onChange:e=>C(e.target.value),onKeyPress:e=>{e.key==="Enter"&&(e.preventDefault(),L())},className:"flex-1 px-3 py-1.5 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-gray-500"}),s.jsx("button",{type:"button",onClick:L,className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-xs font-medium hover:bg-gray-200 transition-colors",children:"ì¶”ê°€"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ì„¤ëª…"}),s.jsx("textarea",{...S("description"),rows:2,className:"input w-full text-sm md:text-base"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-2 sm:gap-0 pt-4 border-t",children:[s.jsx("div",{children:t&&s.jsxs("button",{type:"button",onClick:()=>{window.confirm("ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&q(t.id)},className:"btn btn-outline text-red-600 hover:bg-red-50 flex items-center w-full sm:w-auto justify-center text-sm md:text-base",children:[s.jsx(Z,{className:"h-4 w-4 mr-2"}),"ì‚­ì œ"]})}),s.jsxs("div",{className:"flex gap-2 sm:space-x-3",children:[s.jsx("button",{type:"button",onClick:A,className:"btn btn-outline flex-1 sm:flex-none text-sm md:text-base",children:"ì·¨ì†Œ"}),s.jsx("button",{type:"submit",disabled:k,className:"btn btn-primary flex-1 sm:flex-none text-sm md:text-base disabled:opacity-50",children:k?"ì €ì¥ ì¤‘...":t?"ìˆ˜ì •":"ì¶”ê°€"})]})]})]})]})})};export{ae as S};
