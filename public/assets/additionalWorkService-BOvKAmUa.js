import{q as A,o as k,k as g,a as s,l as D,d as p,g as l,n as S,b as y,T as i,p as f,t as w,v as u,x as h,m as v}from"./index-DFqrEf2N.js";const n="additional_works",c=e=>{const t=e.data();return{_id:e.id,project:t.project||"",description:t.description||"",amount:t.amount||0,date:t.date instanceof i?t.date.toDate().toISOString().split("T")[0]:t.date||t.work_date||"",notes:t.notes||"",images:t.images||[],createdAt:t.createdAt instanceof i?t.createdAt.toDate().toISOString():t.createdAt||"",updatedAt:t.updatedAt instanceof i?t.updatedAt.toDate().toISOString():t.updatedAt||""}},d={getAllAdditionalWorks:async()=>{const e=A(g(s,n),k("createdAt","desc"));return(await v(e)).docs.map(c)},getAdditionalWorkById:async e=>{const t=p(s,n,e),a=await l(t);return a.exists()?c(a):null},createAdditionalWork:async e=>{const t=i.now(),a={project:e.project,description:e.description,amount:e.amount,date:e.date instanceof Date?i.fromDate(e.date):e.date,notes:e.notes||"",images:[],createdAt:t,updatedAt:t},o=await h(g(s,n),a);if(e.images&&e.images.length>0)if(e.images.some(r=>f(r))){const r=await w("additional_works",o.id,e.images);await u(o,{images:r})}else await u(o,{images:e.images});const m=await l(o);return c(m)},updateAdditionalWork:async(e,t)=>{const a=p(s,n,e),o={updatedAt:i.now()};t.project!==void 0&&(o.project=t.project),t.description!==void 0&&(o.description=t.description),t.amount!==void 0&&(o.amount=t.amount),t.date!==void 0&&(o.date=t.date instanceof Date?i.fromDate(t.date):t.date),t.notes!==void 0&&(o.notes=t.notes),t.images!==void 0&&(t.images.some(r=>f(r))?o.images=await w("additional_works",e,t.images):o.images=t.images),await u(a,o);const m=await l(a);return c(m)},deleteAdditionalWork:async e=>{const t=p(s,n,e),a=await l(t);if(a.exists()){const o=a.data();o.images&&o.images.length>0&&await S(o.images)}await y(t)},subscribeToAdditionalWorks:e=>{const t=A(g(s,n),k("createdAt","desc"));return D(t,a=>{const o=a.docs.map(c);e(o)})}},B={getAllAdditionalWorks:()=>d.getAllAdditionalWorks(),getAdditionalWorkById:async e=>{const t=await d.getAdditionalWorkById(e);if(!t)throw new Error("Additional work not found");return t},createAdditionalWork:e=>d.createAdditionalWork(e),updateAdditionalWork:(e,t)=>d.updateAdditionalWork(e,t),deleteAdditionalWork:e=>d.deleteAdditionalWork(e),subscribeToAdditionalWorks:d.subscribeToAdditionalWorks};export{B as a};
