import{q as ee,o as te,k as q,a as _,l as Oe,w as se,T as E,m as ue,d as Se,g as ge,n as qe,b as Ke,p as Ce,t as je,v as pe,x as We,h as Ze,i as Je,z as h,j as n}from"./index-V2zSaZTT.js";import{r as m}from"./vendor-react-DN7YJcfR.js";import{p}from"./vendor-date-DbWJ9m7c.js";import{r as Ae,s as Ee,P as Ge,T as Be,t as Qe,U as _e,u as et,X as tt}from"./vendor-ui-D8A9iq7X.js";import"./vendor-data-DrLf5NIQ.js";import"./vendor-calendar-DjAQlTCo.js";const U="site_logs",I=r=>{const o=r.data();return{_id:r.id,project:o.project||"",date:o.date instanceof E?o.date.toDate().toISOString():o.date||"",images:o.images||[],notes:o.notes||"",createdBy:o.createdBy||"",createdAt:o.createdAt instanceof E?o.createdAt.toDate().toISOString():o.createdAt||"",updatedAt:o.updatedAt instanceof E?o.updatedAt.toDate().toISOString():o.updatedAt||""}},H={getAllLogs:async()=>{const r=ee(q(_,U),te("date","desc"));return(await ue(r)).docs.map(I)},getProjectLogs:async r=>{const o=ee(q(_,U),se("project","==",r),te("date","desc"));return(await ue(o)).docs.map(I)},createLog:async r=>{const o=E.now(),N={project:r.project,date:r.date instanceof Date?E.fromDate(r.date):r.date,images:[],notes:r.notes||"",createdBy:r.createdBy,createdAt:o,updatedAt:o},f=await We(q(_,U),N);let L=[];r.images&&r.images.length>0&&(r.images.some(d=>Ce(d))?(L=await je("site_logs",f.id,r.images),await pe(f,{images:L})):(L=r.images,await pe(f,{images:L})));const x=await ge(f);return I(x)},updateLog:async(r,o)=>{const N=Se(_,U,r),f={updatedAt:E.now()};o.project!==void 0&&(f.project=o.project),o.date!==void 0&&(f.date=o.date instanceof Date?E.fromDate(o.date):o.date),o.notes!==void 0&&(f.notes=o.notes),o.images!==void 0&&(o.images.some(B=>Ce(B))?f.images=await je("site_logs",r,o.images):f.images=o.images),await pe(N,f);const L=await ge(N);return I(L)},deleteLog:async r=>{const o=Se(_,U,r),N=await ge(o);if(N.exists()){const f=N.data();f.images&&f.images.length>0&&await qe(f.images)}await Ke(o)},getLogsByDateRange:async(r,o,N)=>{const f=ee(q(_,U),se("project","==",r),se("date",">=",E.fromDate(o)),se("date","<=",E.fromDate(N)),te("date","desc"));return(await ue(f)).docs.map(I)},subscribeToLogs:r=>{const o=ee(q(_,U),te("date","desc"));return Oe(o,N=>{const f=N.docs.map(I);r(f)})}},S={getProjectLogs:r=>H.getProjectLogs(r),getAllLogs:()=>H.getAllLogs(),createLog:r=>H.createLog(r),updateLog:(r,o)=>H.updateLog(r,o),deleteLog:r=>H.deleteLog(r),getLogsByDateRange:(r,o,N)=>H.getLogsByDateRange(r,o,N),subscribeToLogs:H.subscribeToLogs},gt=()=>{const{user:r}=Ze(),o=Je(),[N,f]=m.useState(()=>localStorage.getItem("siteLog_includeCompleted")==="true"),L=N?o:o.filter(e=>e.status!=="completed"),[x,B]=m.useState([]),[d,K]=m.useState(""),P=m.useRef(null),[b,Ue]=m.useState(new Date),[He,ne]=m.useState(!1),[y,$]=m.useState({show:!1,url:null}),[st,fe]=m.useState(!1),[ae,ye]=m.useState(0),[R,Me]=m.useState(new Date),[v,w]=m.useState(1),[C,V]=m.useState({x:0,y:0}),[re,ie]=m.useState(!1),[W,oe]=m.useState({x:0,y:0}),[me,F]=m.useState(null),[le,Y]=m.useState(null),[Z,X]=m.useState(!1),[Te,he]=m.useState(0),[ce,Ne]=m.useState(null),[z,J]=m.useState({notes:"",images:[]}),[G,xe]=m.useState(()=>{const e=localStorage.getItem("siteLogNotes");return e?JSON.parse(e):{}});m.useRef(null);const[nt,Ie]=m.useState(null);m.useRef(null);const[at,rt]=m.useState(!1),[it,Pe]=m.useState("saved"),be=m.useRef([]);m.useEffect(()=>{be.current=x},[x]),m.useEffect(()=>{localStorage.setItem("siteLogNotes",JSON.stringify(G))},[G]),m.useEffect(()=>{localStorage.setItem("siteLog_includeCompleted",String(N))},[N]),m.useEffect(()=>{if(L.length>0&&!d){const e=`siteLog_lastProject_${(r==null?void 0:r.id)||(r==null?void 0:r.name)}`,t=localStorage.getItem(e);t&&L.find(s=>s.name===t)?K(t):K(L[0].name)}},[L,r]),m.useEffect(()=>{if(d&&r){const e=`siteLog_lastProject_${r.id||r.name}`;localStorage.setItem(e,d)}},[d,r]),m.useEffect(()=>()=>{P.current&&clearTimeout(P.current)},[]),m.useEffect(()=>{M()},[d]),m.useEffect(()=>{const e=p(b,"yyyy-MM-dd"),t=`${d}_${e}`,s=G[t];J(s!==void 0?a=>({...a,notes:s}):a=>({...a,notes:""})),Pe("saved")},[b,d]),m.useEffect(()=>{if(x.length===0)return;const e=p(b,"yyyy-MM-dd"),t=`${d}_${e}`;if(G[t]!==void 0)return;const s=x.find(a=>{try{const i=a.date?new Date(a.date):null;return i&&!isNaN(i.getTime())&&p(i,"yyyy-MM-dd")===e&&a.project===d}catch{return!1}});s&&s.notes&&(J(a=>({...a,notes:s.notes||""})),xe(a=>({...a,[t]:s.notes||""})))},[x,b,d]);const M=async()=>{if(d)try{const e=await S.getProjectLogs(d);B(e.map(t=>({...t,id:t._id||t.id,date:t.date?new Date(t.date):new Date,createdAt:t.created_at?new Date(t.created_at):new Date})))}catch(e){console.error("Failed to load site logs:",e),B([])}},$e=(e,t=1920,s=1080,a=.8)=>new Promise((i,l)=>{const c=new FileReader;c.onload=D=>{var g;const u=new Image;u.onload=()=>{const k=document.createElement("canvas");let A=u.width,j=u.height;if(A>t||j>s){const O=Math.min(t/A,s/j);A*=O,j*=O}k.width=A,k.height=j;const we=k.getContext("2d");if(!we){l(new Error("Canvas context not available"));return}we.drawImage(u,0,0,A,j),k.toBlob(O=>{if(!O){l(new Error("Failed to compress image"));return}const de=new FileReader;de.onload=()=>i(de.result),de.readAsDataURL(O)},e.type,a)},u.src=(g=D.target)==null?void 0:g.result},c.readAsDataURL(e)}),T=m.useCallback(async e=>{const s=Array.from(e).filter(i=>i.type.startsWith("image/"));if(s.length===0){h.error("이미지 파일만 업로드 가능합니다");return}if(s.length>100){h.error("한번에 최대 100장까지 업로드 가능합니다");return}if(!d){h.error("프로젝트를 선택하세요");return}fe(!0),h.loading(`${s.length}개의 이미지를 처리중...`);const a=s.map(i=>$e(i));try{const i=await Promise.all(a),l=p(b,"yyyy-MM-dd"),c=x.find(g=>{try{const k=g.date?new Date(g.date):null;return k&&!isNaN(k.getTime())&&p(k,"yyyy-MM-dd")===l&&g.project===d}catch{return!1}}),D=20,u=[];for(let g=0;g<i.length;g+=D)u.push(i.slice(g,g+D));if(h.dismiss(),c){let g=[...c.images];for(let k=0;k<u.length;k++)h.loading(`이미지 업로드 중... (${k+1}/${u.length})`),g=[...g,...u[k]],await S.updateLog(c.id,{project:c.project,date:c.date,images:g,notes:c.notes||""}),h.dismiss();h.success(`${i.length}개의 사진이 추가되었습니다`)}else{h.loading(`이미지 업로드 중... (1/${u.length})`);const g={project:d,date:b,images:u[0],notes:"",createdBy:(r==null?void 0:r.name)||""},k=await S.createLog(g);if(h.dismiss(),u.length>1){let A=[...u[0]];for(let j=1;j<u.length;j++)h.loading(`이미지 업로드 중... (${j+1}/${u.length})`),A=[...A,...u[j]],await S.updateLog(k._id||k.id,{project:d,date:b,images:A,notes:""}),h.dismiss()}h.success(`${i.length}개의 사진이 저장되었습니다`)}await M()}catch(i){console.error("Failed to save images:",i),h.error("사진 저장에 실패했습니다")}finally{fe(!1)}},[d,b,r,x,M]),Re=m.useCallback(e=>{e.preventDefault(),T(e.dataTransfer.files)},[T]);m.useEffect(()=>{const e=t=>{var l;const s=(l=t.clipboardData)==null?void 0:l.items;if(!s)return;const a=Array.from(s).filter(c=>c.type.startsWith("image/"));if(a.length===0)return;t.preventDefault();const i=a.map(c=>c.getAsFile()).filter(Boolean);T(i)};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[T]),m.useCallback(async e=>{if(!(!d||!e))try{const t=p(b,"yyyy-MM-dd"),s=x.find(a=>{try{const i=a.date?new Date(a.date):null;return i&&!isNaN(i.getTime())&&p(i,"yyyy-MM-dd")===t&&a.project===d}catch{return!1}});if(s)await S.updateLog(s.id,{project:s.project,date:s.date,images:s.images,notes:e});else{const a={project:d,date:b,images:z.images,notes:e,createdBy:(r==null?void 0:r.name)||""};await S.createLog(a)}await M()}catch(t){console.error("Failed to auto-save site log:",t)}},[d,b,x,z.images,r,M]);const ke=async e=>{if(window.confirm("이 현장일지를 삭제하시겠습니까?"))try{await S.deleteLog(e),h.success("현장일지가 삭제되었습니다"),await M()}catch(t){console.error("Failed to delete site log:",t),h.error("현장일지 삭제에 실패했습니다")}},Fe=async(e,t)=>{if(!window.confirm("이 사진을 삭제하시겠습니까?"))return;const s=x.find(a=>a.id===e);if(s)try{const a=s.images.filter((i,l)=>l!==t);a.length===0&&!s.notes?await ke(e):(await S.updateLog(e,{project:s.project,date:s.date,images:a,notes:s.notes}),B(i=>i.map(l=>l.id===e?{...l,images:a}:l)),h.success("사진이 삭제되었습니다"))}catch(a){console.error("Failed to delete image:",a),h.error("사진 삭제에 실패했습니다")}},Ye=()=>{const e=R.getFullYear(),t=R.getMonth(),s=new Date(e,t,1),a=new Date(s);a.setDate(a.getDate()-s.getDay());const i=[],l=new Date(a);for(let c=0;c<42;c++){const D=x.filter(u=>{try{const g=u.date?new Date(u.date):null;return g&&!isNaN(g.getTime())&&p(g,"yyyy-MM-dd")===p(l,"yyyy-MM-dd")}catch{return!1}});i.push({date:new Date(l),logs:D,hasImages:D.some(u=>u.images&&u.images.length>0)}),l.setDate(l.getDate()+1)}return i},De=e=>{const t=new Date(R);t.setMonth(t.getMonth()+e),Me(t)},Xe=x.reduce((e,t)=>{try{const s=t.date?new Date(t.date):null;if(s&&!isNaN(s.getTime())){const a=p(s,"yyyy-MM-dd");e[a]||(e[a]=[]),e[a].push(t)}}catch{}return e},{});Object.keys(Xe).sort((e,t)=>t.localeCompare(e));const Le=(e,t)=>{const s=e.clientX-t.clientX,a=e.clientY-t.clientY;return Math.sqrt(s*s+a*a)},ve=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),Ve=(e,t=0)=>{$({show:!0,url:e[t],images:e}),ye(t),w(1),V({x:0,y:0}),F(null),Y(null),X(!1)},Q=e=>{if(!y.images)return;const t=(ae+e+y.images.length)%y.images.length;ye(t),$(s=>({...s,url:y.images[t]}))},ze=async(e,t)=>{const s=x.find(a=>a.id===e);if(s)try{const a={...s,images:[...s.images,...t]};await S.updateLog(e,{project:s.project,date:s.date,images:a.images,notes:s.notes}),B(i=>i.map(l=>l.id===e?a:l)),h.success(`${t.length}개의 사진이 추가되었습니다`),Ie(null)}catch(a){console.error("Failed to add images to log:",a),h.error("사진 추가에 실패했습니다")}};return m.useCallback((e,t)=>{const a=Array.from(t).filter(l=>l.type.startsWith("image/"));if(a.length===0){h.error("이미지 파일만 업로드 가능합니다");return}const i=a.map(l=>new Promise(c=>{const D=new FileReader;D.onload=u=>{var g;c((g=u.target)==null?void 0:g.result)},D.readAsDataURL(l)}));Promise.all(i).then(l=>{ze(e,l)})},[x]),m.useEffect(()=>{const e=t=>{if(y.show)switch(t.key){case"ArrowLeft":t.preventDefault(),y.images&&y.images.length>1&&Q(-1);break;case"ArrowRight":t.preventDefault(),y.images&&y.images.length>1&&Q(1);break;case"Escape":t.preventDefault(),$({show:!1,url:null});break}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y.show,y.images,ae]),n.jsxDEV("div",{className:"site-log-container desktop:grid desktop:grid-cols-12 desktop:gap-4 desktop:h-[calc(100vh-140px)] space-y-3 desktop:space-y-0",children:[n.jsxDEV("div",{className:"desktop:hidden flex justify-end items-center gap-2 mb-2",children:[n.jsxDEV("label",{className:"flex items-center gap-1 text-[10px] text-gray-500",children:[n.jsxDEV("input",{type:"checkbox",checked:N,onChange:e=>f(e.target.checked),className:"w-3 h-3 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:715,columnNumber:11},void 0),"완료포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:714,columnNumber:9},void 0),n.jsxDEV("select",{value:d,onChange:e=>K(e.target.value),className:"px-3 py-1.5 bg-white text-gray-700 rounded-lg text-xs font-medium focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-300",style:{appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 0.5rem center",backgroundSize:"1.25rem",paddingRight:"2.5rem"},children:L.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:737,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:723,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:713,columnNumber:7},void 0),n.jsxDEV("div",{className:"site-log-left desktop:col-span-4 desktop:flex desktop:flex-col desktop:gap-4 desktop:h-full space-y-3 desktop:space-y-0",children:[n.jsxDEV("div",{className:"site-log-calendar desktop:flex-shrink-0",children:n.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[32vh] desktop:max-h-full overflow-y-auto",children:[n.jsxDEV("div",{className:"mb-4 hidden desktop:block",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:n.jsxDEV("select",{value:d,onChange:e=>K(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:L.map(e=>n.jsxDEV("option",{value:e.name,children:e.name},e.id,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:759,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:753,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:752,columnNumber:15},void 0),n.jsxDEV("label",{className:"flex items-center gap-1.5 mt-2 text-xs text-gray-500 cursor-pointer",children:[n.jsxDEV("input",{type:"checkbox",checked:N,onChange:e=>f(e.target.checked),className:"w-3.5 h-3.5 rounded border-gray-300"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:766,columnNumber:17},void 0),"공사완료 현장 포함"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:765,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:751,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[n.jsxDEV("button",{onClick:()=>De(-1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:n.jsxDEV(Ae,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:782,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:778,columnNumber:15},void 0),n.jsxDEV("h3",{className:"text-sm font-semibold",children:p(R,"yyyy년 M월")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:784,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>De(1),className:"p-1.5 hover:bg-gray-100 rounded transition-colors",children:n.jsxDEV(Ee,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:791,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:787,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:777,columnNumber:13},void 0),n.jsxDEV("div",{className:"grid grid-cols-7 gap-0.5",children:[["일","월","화","수","목","금","토"].map(e=>n.jsxDEV("div",{className:"text-center text-xs font-medium text-gray-600 py-1",children:e},e,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:798,columnNumber:17},void 0)),Ye().map((e,t)=>{const s=e.date.getMonth()===R.getMonth(),a=p(e.date,"yyyy-MM-dd")===p(new Date,"yyyy-MM-dd"),i=p(e.date,"yyyy-MM-dd")===p(b,"yyyy-MM-dd");return n.jsxDEV("div",{onClick:()=>Ue(e.date),className:`text-center p-1.5 desktop:p-2 text-xs cursor-pointer rounded transition-colors min-h-[36px] desktop:min-h-[48px] flex flex-col items-center justify-center ${s?"text-gray-700":"text-gray-300"} ${a?"bg-blue-100":""} ${i?"bg-gray-900 text-white":"hover:bg-gray-100"} ${e.hasImages?"font-bold":""}`,children:[n.jsxDEV("span",{children:p(e.date,"d")},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:817,columnNumber:21},void 0),e.hasImages&&n.jsxDEV("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-0.5"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:819,columnNumber:23},void 0)]},t,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:808,columnNumber:19},void 0)})]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:796,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:749,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:747,columnNumber:9},void 0),n.jsxDEV("div",{className:"site-log-notes desktop:flex-1 desktop:min-h-0",children:n.jsxDEV("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 max-h-[30vh] desktop:h-full desktop:flex desktop:flex-col overflow-hidden",children:[n.jsxDEV("h2",{className:"text-lg font-semibold mb-4 flex-shrink-0",children:[p(b,"M월 d일")," 일지 작성"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:831,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex-1 min-h-0 flex flex-col",children:n.jsxDEV("textarea",{value:z.notes,onChange:e=>{const t=e.target.value,s=p(b,"yyyy-MM-dd"),a=`${d}_${s}`;J(i=>({...i,notes:t})),xe(i=>({...i,[a]:t})),P.current&&clearTimeout(P.current),P.current=setTimeout(async()=>{if(d)try{const i=be.current.find(l=>{try{const c=l.date?new Date(l.date):null;return c&&!isNaN(c.getTime())&&p(c,"yyyy-MM-dd")===s&&l.project===d}catch{return!1}});if(i)await S.updateLog(i.id,{project:i.project,date:i.date,images:i.images,notes:t});else if(t.trim()){const l=await S.createLog({project:d,date:b,images:z.images,notes:t,createdBy:(r==null?void 0:r.name)||""});l&&B(c=>[...c,{id:l._id||l.id,project:d,date:b,images:z.images,notes:t,createdBy:(r==null?void 0:r.name)||"",createdAt:new Date}])}}catch(i){console.error("서버 저장 실패:",i)}},500)},rows:4,className:"site-log-textarea w-full h-full flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none desktop:min-h-[200px]",placeholder:"오늘 진행한 작업 내용을 입력하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:837,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:835,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:830,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:829,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:745,columnNumber:7},void 0),n.jsxDEV("div",{className:"site-log-photos desktop:col-span-8 desktop:h-full",children:n.jsxDEV("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-3 md:p-4 transition-all desktop:h-full desktop:flex desktop:flex-col ${He?"ring-2 ring-blue-400 bg-blue-50":""}`,onDragOver:e=>{e.preventDefault(),ne(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||ne(!1)},onDrop:e=>{e.preventDefault(),ne(!1),Re(e)},children:[n.jsxDEV("div",{className:"flex items-center justify-between mb-4 desktop:flex-shrink-0",children:[n.jsxDEV("h2",{className:"text-lg font-semibold flex items-center gap-4",children:n.jsxDEV("span",{className:"text-sm font-normal text-gray-600",children:["작성자: ",(r==null?void 0:r.name)||"알 수 없음"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:937,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:936,columnNumber:13},void 0),n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept="image/*",e.onchange=t=>{const s=t.target;s.files&&T(s.files)},e.click()},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"사진 추가",children:n.jsxDEV(Ge,{className:"h-5 w-5 text-gray-600"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:957,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:940,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>{const e=p(b,"yyyy-MM-dd"),t=x.filter(s=>{try{const a=s.date?new Date(s.date):null;return a&&!isNaN(a.getTime())&&p(a,"yyyy-MM-dd")===e}catch{return!1}});t.length>0&&window.confirm(`${p(b,"M월 d일")}의 모든 현장일지를 삭제하시겠습니까?`)&&t.forEach(s=>ke(s.id))},className:"p-1.5 hover:bg-gray-200 rounded transition-colors",title:"일지 삭제",children:n.jsxDEV(Be,{className:"h-5 w-5 text-red-500"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:978,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:959,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:939,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:935,columnNumber:11},void 0),n.jsxDEV("div",{className:"space-y-6 max-h-[990px] desktop:max-h-full desktop:flex-1 desktop:min-h-0 overflow-y-auto",children:(()=>{const e=p(b,"yyyy-MM-dd"),t=x.filter(s=>{try{const a=s.date?new Date(s.date):null;return a&&!isNaN(a.getTime())&&p(a,"yyyy-MM-dd")===e}catch{return!1}});return t.length>0?n.jsxDEV("div",{className:"space-y-4",children:t.map(s=>n.jsxDEV("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[s.notes&&n.jsxDEV("div",{className:"mb-3",children:n.jsxDEV("p",{className:"text-sm text-gray-700",children:s.notes},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1006,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1005,columnNumber:27},void 0),n.jsxDEV("div",{className:"min-h-[600px] desktop:min-h-0",children:s.images&&s.images.length>0?n.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-3 desktop:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3",children:s.images.map((a,i)=>n.jsxDEV("div",{className:"relative group",children:[n.jsxDEV("img",{src:a,alt:`현장사진 ${i+1}`,className:"w-full aspect-[4/3] object-cover rounded-lg cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>Ve(s.images,i)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1016,columnNumber:35},void 0),n.jsxDEV("button",{onClick:()=>Ve(s.images,i),className:"absolute top-2 right-2 p-1.5 bg-black bg-opacity-50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsxDEV(Qe,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1026,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1022,columnNumber:35},void 0),n.jsxDEV("button",{onClick:l=>{l.stopPropagation(),Fe(s.id,i)},className:"absolute top-2 left-2 p-1.5 bg-red-600 bg-opacity-80 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-opacity-100",children:n.jsxDEV(Be,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1035,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1028,columnNumber:35},void 0),n.jsxDEV("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:[i+1," / ",s.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1037,columnNumber:35},void 0)]},i,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1015,columnNumber:33},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1013,columnNumber:29},void 0):n.jsxDEV("div",{className:"flex items-center justify-center h-[600px]",children:n.jsxDEV("div",{className:"text-center",children:[n.jsxDEV(_e,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1046,columnNumber:33},void 0),n.jsxDEV("p",{className:"text-sm text-gray-400",children:"사진을 드래그하거나 + 버튼을 클릭하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1047,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1045,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1044,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1011,columnNumber:25},void 0)]},s.id,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1e3,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:998,columnNumber:19},void 0):n.jsxDEV("div",{children:n.jsxDEV("div",{className:"rounded-lg p-4 pt-2 desktop:p-12 text-center",children:[n.jsxDEV(et,{className:"mx-auto h-12 w-12 desktop:h-16 desktop:w-16 text-gray-400 mb-2 desktop:mb-4"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1063,columnNumber:23},void 0),n.jsxDEV("p",{className:"text-sm desktop:text-lg font-medium text-gray-700 mb-2",children:"현장 사진을 업로드하세요"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1064,columnNumber:23},void 0),n.jsxDEV("p",{className:"hidden desktop:block text-sm text-gray-600 mb-4",children:"이미지를 이곳에 드래그하거나 클릭하여 선택"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1067,columnNumber:23},void 0),n.jsxDEV("p",{className:"hidden desktop:block text-xs text-gray-500 mb-4",children:"Ctrl+V로 클립보드 이미지 붙여넣기도 가능합니다"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1070,columnNumber:23},void 0),n.jsxDEV("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>s.target.files&&T(s.target.files),className:"hidden",id:"main-image-upload"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1073,columnNumber:23},void 0),n.jsxDEV("label",{htmlFor:"main-image-upload",className:"inline-flex items-center px-3 py-1.5 desktop:px-4 desktop:py-2 border border-gray-300 rounded-lg text-xs desktop:text-sm text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[n.jsxDEV(_e,{className:"h-3 w-3 desktop:h-4 desktop:w-4 mr-1.5 desktop:mr-2"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1085,columnNumber:25},void 0),"파일 선택"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1081,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1060,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1058,columnNumber:19},void 0)})()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:983,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:915,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:914,columnNumber:7},void 0),y.show&&y.url&&n.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center overflow-hidden",onClick:()=>{$({show:!1,url:null}),w(1),V({x:0,y:0})},onWheel:e=>{e.preventDefault();const t=e.deltaY>0?-.1:.1;w(s=>Math.max(.5,Math.min(5,s+t)))},children:n.jsxDEV("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),$({show:!1,url:null}),w(1),V({x:0,y:0})},className:"absolute top-4 right-4 p-2 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30 z-10",children:n.jsxDEV(tt,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1123,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1114,columnNumber:13},void 0),v!==1&&n.jsxDEV("div",{className:"absolute top-4 left-4 bg-white bg-opacity-20 text-white px-3 py-2 rounded-lg text-sm backdrop-blur",children:[Math.round(v*100),"%"]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1128,columnNumber:15},void 0),y.images&&y.images.length>1&&n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Q(-1),w(1),V({x:0,y:0})},className:"absolute left-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:n.jsxDEV(Ae,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1144,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1135,columnNumber:15},void 0),n.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",onMouseDown:e=>{v>1&&(ie(!0),oe({x:e.clientX-C.x,y:e.clientY-C.y}))},onMouseMove:e=>{re&&v>1&&V({x:e.clientX-W.x,y:e.clientY-W.y})},onMouseUp:()=>ie(!1),onMouseLeave:()=>ie(!1),onTouchStart:e=>{if(e.touches.length===2){e.preventDefault(),X(!0);const t=Le(e.touches[0],e.touches[1]),s=ve(e.touches[0],e.touches[1]);F(t),Y(s)}else if(e.touches.length===1&&v>1&&!Z){const t=e.touches[0];oe({x:t.clientX-C.x,y:t.clientY-C.y})}},onTouchMove:e=>{if(e.touches.length===2){e.preventDefault(),X(!0);const t=Le(e.touches[0],e.touches[1]),s=ve(e.touches[0],e.touches[1]);if(me&&le){const a=t/me,i=Math.max(.5,Math.min(5,v*a)),l=s.x-le.x,c=s.y-le.y,D=i/v,u=C.x*D+l,g=C.y*D+c;w(i),V({x:u,y:g})}F(t),Y(s)}else if(e.touches.length===1&&v>1&&!Z){e.preventDefault();const t=e.touches[0];V({x:t.clientX-W.x,y:t.clientY-W.y})}},onTouchEnd:e=>{if(e.touches.length===0){const t=Date.now(),s=e.changedTouches[0],a={x:s.clientX,y:s.clientY};if(t-Te<300&&ce&&Math.abs(a.x-ce.x)<30&&Math.abs(a.y-ce.y)<30&&!Z){if(v===1){const c=e.currentTarget.getBoundingClientRect(),D=a.x-c.left-c.width/2,u=a.y-c.top-c.height/2;w(2.5),V({x:-D*1.5,y:-u*1.5})}else w(1),V({x:0,y:0});he(0),Ne(null)}else he(t),Ne(a);F(null),Y(null),X(!1)}else if(e.touches.length===1&&Z){F(null),Y(null),X(!1);const t=e.touches[0];oe({x:t.clientX-C.x,y:t.clientY-C.y})}},onDoubleClick:e=>{e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,a=e.clientY-t.top-t.height/2;v===1?(w(2.5),V({x:-s*1.5,y:-a*1.5})):(w(1),V({x:0,y:0}))},children:n.jsxDEV("img",{src:y.url,alt:"확대 이미지",style:{transform:`scale(${v}) translate(${C.x/v}px, ${C.y/v}px)`,transformOrigin:"center center",transition:re||me!==null?"none":"transform 0.25s cubic-bezier(0.2, 0, 0, 1)",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",cursor:v>1?re?"grabbing":"grab":"pointer",userSelect:"none",touchAction:"none"},draggable:!1,onClick:e=>e.stopPropagation()},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1287,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1149,columnNumber:13},void 0),y.images&&y.images.length>1&&n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Q(1),w(1),V({x:0,y:0})},className:"absolute right-4 p-3 bg-white bg-opacity-20 backdrop-blur rounded-full hover:bg-opacity-30",children:n.jsxDEV(Ee,{className:"h-6 w-6 text-white"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1317,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1308,columnNumber:15},void 0),y.images&&y.images.length>1&&n.jsxDEV("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full",children:[ae+1," / ",y.images.length]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1323,columnNumber:15},void 0),n.jsxDEV("div",{className:"absolute bottom-4 right-4 bg-white bg-opacity-10 text-white px-3 py-2 rounded-lg text-xs text-center backdrop-blur",children:"마우스 휠 또는 두 손가락으로 확대/축소"},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1329,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1112,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:1099,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/kim_s/Desktop/HV LAB app/interior-management-system/frontend/src/pages/SiteLog.tsx",lineNumber:711,columnNumber:5},void 0)};export{gt as default};
