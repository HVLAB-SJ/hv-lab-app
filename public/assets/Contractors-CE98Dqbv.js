import{j as e}from"./vendor-data-DG_4MGb7.js";import{r as o}from"./vendor-react-D-r2Cqeg.js";import{c as h}from"./dataStore-ByVzUXWH.js";import{r as v,e as g}from"./formatters-15aXprTM.js";import{S as T,q as D,T as H,X as $}from"./vendor-ui-DTwhhNuH.js";import"./index-HUdyR-Tx.js";import"./vendor-date-9Cl9d1sr.js";function G(){const[w,M]=o.useState([]),[k,C]=o.useState(!1),[x,S]=o.useState(null),[I,B]=o.useState(!1),[m,y]=o.useState(null),[c,F]=o.useState(""),[a,l]=o.useState({rank:"",companyName:"",name:"",position:"",process:"",contact:"",bankName:"",accountNumber:"",notes:""}),[j,L]=o.useState(!1);o.useEffect(()=>{d()},[]),o.useEffect(()=>{const s=()=>{p()};return window.addEventListener("headerAddButtonClick",s),()=>window.removeEventListener("headerAddButtonClick",s)},[]);const d=async()=>{var s,n;try{w.length===0&&C(!0),S(null);const r=await h.getAllContractors();M(r.map(t=>({id:t._id,rank:t.rank,companyName:t.companyName,name:t.name,position:t.position,process:t.process,contact:t.contact,accountNumber:t.accountNumber,notes:t.notes,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)})))}catch(r){console.error("Failed to load contractors:",r);const t=r instanceof Error&&((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message);S(t||"협력업체 목록을 불러오는데 실패했습니다.")}finally{C(!1)}},p=s=>{if(s){y(s);let n="",r=s.accountNumber||"";if(s.accountNumber){const f=["KB국민은행","신한은행","우리은행","하나은행","NH농협은행","IBK기업은행","KEB하나은행","SC제일은행","한국씨티은행","부산은행","대구은행","경남은행","광주은행","전북은행","제주은행","산업은행","수협은행","우체국","새마을금고","신협","저축은행","카카오뱅크","케이뱅크","토스뱅크","NH투자증권","미래에셋증권","한국투자증권","키움증권","삼성증권","KB증권","신한투자증권","하이투자증권"];for(const b of f)if(s.accountNumber.startsWith(b)){n=b,r=s.accountNumber.substring(b.length).trim();break}}let t=s.name,i=s.position||"";i||(i=g(s.name),t=v(s.name)),l({rank:s.rank||"",companyName:s.companyName||"",name:t,position:i,process:s.process,contact:s.contact||"",bankName:n,accountNumber:r,notes:s.notes||""})}else y(null),l({rank:"",companyName:"",name:"",position:"",process:"",contact:"",bankName:"",accountNumber:"",notes:""});B(!0)},N=()=>{B(!1),y(null),l({rank:"",companyName:"",name:"",position:"",process:"",contact:"",bankName:"",accountNumber:"",notes:""})},P=async s=>{var r,t;if(s.preventDefault(),j)return;L(!0);const n=a.bankName&&a.accountNumber?`${a.bankName} ${a.accountNumber}`:a.accountNumber;try{const i={rank:a.rank,companyName:a.companyName,name:a.name,position:a.position,process:a.process,contact:a.contact,accountNumber:n,notes:a.notes};m?await h.updateContractor(m.id,i):await h.createContractor(i),await d(),N()}catch(i){console.error("Failed to save contractor:",i);const f=i instanceof Error&&((t=(r=i.response)==null?void 0:r.data)==null?void 0:t.message);alert(f||"협력업체 저장에 실패했습니다.")}finally{L(!1)}},E=async s=>{var n,r;if(window.confirm("정말 이 협력업체를 삭제하시겠습니까?"))try{await h.deleteContractor(s),await d()}catch(t){console.error("Failed to delete contractor:",t);const i=t instanceof Error&&((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.message);alert(i||"협력업체 삭제에 실패했습니다.")}},K=()=>"border-gray-200 text-gray-600 bg-gray-50",A=s=>s?s==="1순위"?1:s==="1순위(ㅁㅇ)"?2:s==="2순위"?3:s==="2순위(ㅁㅇ)"?4:s==="3순위"?5:s==="3순위(ㅁㅇ)"?6:s==="신규"?100:s==="불용"?200:999:999,u=w.filter(s=>s.name.toLowerCase().includes(c.toLowerCase())||s.process.toLowerCase().includes(c.toLowerCase())||s.accountNumber.toLowerCase().includes(c.toLowerCase())||s.contact&&s.contact.toLowerCase().includes(c.toLowerCase())||s.rank&&s.rank.toLowerCase().includes(c.toLowerCase())||s.companyName&&s.companyName.toLowerCase().includes(c.toLowerCase())).sort((s,n)=>{const r=A(s.rank)-A(n.rank);if(r!==0)return r;const t=s.process.localeCompare(n.process,"ko");return t!==0?t:s.name.localeCompare(n.name,"ko")});return e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:()=>p(),className:"hidden md:inline-flex btn btn-primary px-3 md:px-4 py-2",children:"+ 새 협력업체"})}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 md:w-5 md:h-5"}),e.jsx("input",{type:"text",placeholder:"업체명, 공정, 계좌번호로 검색...",value:c,onChange:s=>F(s.target.value),className:"w-full pl-9 md:pl-10 pr-4 py-2 text-sm md:text-base border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsx("div",{className:"contractors-table hidden md:block bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"평가"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"공정"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"협력업체 이름"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"이름"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"직책"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"연락처"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"계좌번호"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"비고"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:"로딩 중..."})})}):x?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-red-500",children:x}),e.jsx("button",{onClick:d,className:"inline-block px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors",children:"다시 시도"})]})})}):u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:c?"검색 결과가 없습니다.":"등록된 협력업체가 없습니다."})})}):u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium border rounded ${K(s.rank)}`,children:s.rank||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-xs font-medium text-gray-700",children:s.process})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.companyName||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-gray-900",children:v(s.name)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.position||g(s.name)||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.contact||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.accountNumber})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-500 max-w-xs truncate",children:s.notes||"-"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>p(s),className:"text-gray-600 hover:text-gray-900 mr-3",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(H,{className:"w-4 h-4"})})]})]},s.id))})]})})}),e.jsx("div",{className:"md:hidden space-y-3",children:k?e.jsx("div",{className:"text-center py-12 text-gray-500 text-sm",children:"로딩 중..."}):x?e.jsxs("div",{className:"text-center py-12 space-y-4",children:[e.jsx("p",{className:"text-red-500 text-sm",children:x}),e.jsx("button",{onClick:d,className:"inline-block px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm",children:"다시 시도"})]}):u.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 text-sm",children:c?"검색 결과가 없습니다.":"등록된 협력업체가 없습니다."}):u.map(s=>e.jsxs("div",{className:"card p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.rank&&e.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-medium border rounded ${K(s.rank)}`,children:s.rank}),e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium text-gray-700 bg-gray-100 rounded",children:s.process})]}),s.companyName&&e.jsx("p",{className:"text-xs text-gray-600 mb-0.5",children:s.companyName}),e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:v(s.name)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("button",{onClick:()=>p(s),className:"p-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(s.id),className:"p-1.5 text-red-600 hover:text-red-900 hover:bg-red-50 rounded",children:e.jsx(H,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[(s.position||g(s.name))&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-gray-500 w-14 flex-shrink-0",children:"직책:"}),e.jsx("span",{className:"text-gray-900",children:s.position||g(s.name)})]}),s.contact&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-gray-500 w-14 flex-shrink-0",children:"연락처:"}),e.jsx("span",{className:"text-gray-900",children:s.contact})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-gray-500 w-14 flex-shrink-0",children:"계좌:"}),e.jsx("span",{className:"text-gray-900 break-all",children:s.accountNumber})]}),s.notes&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-gray-500 w-14 flex-shrink-0",children:"비고:"}),e.jsx("span",{className:"text-gray-600",children:s.notes})]})]})]},s.id))}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:m?"협력업체 수정":"새 협력업체 등록"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:e.jsx($,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"평가 순위"}),e.jsxs("select",{value:a.rank,onChange:s=>l({...a,rank:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent",children:[e.jsx("option",{value:"",children:"선택하세요"}),e.jsx("option",{value:"1순위",children:"1순위"}),e.jsx("option",{value:"2순위",children:"2순위"}),e.jsx("option",{value:"3순위",children:"3순위"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"협력업체 이름"}),e.jsx("input",{type:"text",value:a.companyName,onChange:s=>l({...a,companyName:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["이름 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.name,onChange:s=>l({...a,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"직책"}),e.jsx("input",{type:"text",value:a.position,onChange:s=>l({...a,position:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["공정 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:a.process,onChange:s=>l({...a,process:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"연락처"}),e.jsx("input",{type:"text",value:a.contact,onChange:s=>l({...a,contact:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"은행명"}),e.jsxs("select",{value:a.bankName,onChange:s=>l({...a,bankName:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent",children:[e.jsx("option",{value:"",children:"선택하세요"}),e.jsxs("optgroup",{label:"시중은행",children:[e.jsx("option",{value:"KB국민은행",children:"KB국민은행"}),e.jsx("option",{value:"신한은행",children:"신한은행"}),e.jsx("option",{value:"우리은행",children:"우리은행"}),e.jsx("option",{value:"하나은행",children:"하나은행"}),e.jsx("option",{value:"NH농협은행",children:"NH농협은행"}),e.jsx("option",{value:"IBK기업은행",children:"IBK기업은행"}),e.jsx("option",{value:"KEB하나은행",children:"KEB하나은행"}),e.jsx("option",{value:"SC제일은행",children:"SC제일은행"}),e.jsx("option",{value:"한국씨티은행",children:"한국씨티은행"})]}),e.jsxs("optgroup",{label:"지방은행",children:[e.jsx("option",{value:"부산은행",children:"부산은행"}),e.jsx("option",{value:"대구은행",children:"대구은행"}),e.jsx("option",{value:"경남은행",children:"경남은행"}),e.jsx("option",{value:"광주은행",children:"광주은행"}),e.jsx("option",{value:"전북은행",children:"전북은행"}),e.jsx("option",{value:"제주은행",children:"제주은행"})]}),e.jsxs("optgroup",{label:"특수은행",children:[e.jsx("option",{value:"산업은행",children:"산업은행"}),e.jsx("option",{value:"수협은행",children:"수협은행"}),e.jsx("option",{value:"우체국",children:"우체국"}),e.jsx("option",{value:"새마을금고",children:"새마을금고"}),e.jsx("option",{value:"신협",children:"신협"}),e.jsx("option",{value:"저축은행",children:"저축은행"})]}),e.jsxs("optgroup",{label:"인터넷은행",children:[e.jsx("option",{value:"카카오뱅크",children:"카카오뱅크"}),e.jsx("option",{value:"케이뱅크",children:"케이뱅크"}),e.jsx("option",{value:"토스뱅크",children:"토스뱅크"})]}),e.jsxs("optgroup",{label:"증권사",children:[e.jsx("option",{value:"NH투자증권",children:"NH투자증권"}),e.jsx("option",{value:"미래에셋증권",children:"미래에셋증권"}),e.jsx("option",{value:"한국투자증권",children:"한국투자증권"}),e.jsx("option",{value:"키움증권",children:"키움증권"}),e.jsx("option",{value:"삼성증권",children:"삼성증권"}),e.jsx("option",{value:"KB증권",children:"KB증권"}),e.jsx("option",{value:"신한투자증권",children:"신한투자증권"}),e.jsx("option",{value:"하이투자증권",children:"하이투자증권"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"계좌번호"}),e.jsx("input",{type:"text",value:a.accountNumber,onChange:s=>l({...a,accountNumber:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"비고"}),e.jsx("textarea",{value:a.notes,onChange:s=>l({...a,notes:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"취소"}),e.jsx("button",{type:"submit",disabled:j,className:"flex-1 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50",children:j?"저장 중...":m?"수정":"등록"})]})]})]})})})]})}export{G as default};
