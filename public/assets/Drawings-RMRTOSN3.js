import{j as t}from"./vendor-data-DG_4MGb7.js";import{r as o}from"./vendor-react-D-r2Cqeg.js";import{a as he,u as St}from"./index-Dgd7wCS1.js";import{u as kt}from"./useFilteredProjects-BNZe-7y5.js";import{A as rt,i as Ct,T as se,j as nt,F as at,X as Mt}from"./vendor-ui-DTwhhNuH.js";import"./vendor-date-9Cl9d1sr.js";import"./dataStore-D-kob-RA.js";class Dt{async uploadImage(b){var w,l;const a=new FormData;a.append("image",b);try{const d=await he.post("/drawings/upload",a,{headers:{"Content-Type":"multipart/form-data"}});return console.log("âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ:",d.data.imageUrl),d.data.imageUrl}catch(d){console.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:",d);const j=((l=(w=d.response)==null?void 0:w.data)==null?void 0:l.error)||d.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";throw new Error(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ${j}`)}}async setItem(b,a,w){var l,d,j,z,k,u,T;try{console.log("[drawingStorage] ë„ë©´ ì €ì¥ ìš”ì²­:",{projectId:a.projectId,type:a.type,imageUrl:a.imageUrl?"provided":"none",markersCount:((l=a.markers)==null?void 0:l.length)||0,roomsCount:((d=a.rooms)==null?void 0:d.length)||0}),await he.post("/drawings",{projectId:a.projectId,type:a.type,imageUrl:a.imageUrl,markers:a.markers,rooms:a.rooms,naverTypeSqm:a.naverTypeSqm,naverTypePyeong:a.naverTypePyeong,naverArea:a.naverArea}),console.log("âœ… ë„ë©´ ë°ì´í„° ì €ì¥ ì„±ê³µ")}catch(N){console.error("ì„œë²„ ë„ë©´ ì €ì¥ ì‹¤íŒ¨:",N);const D=((z=(j=N.response)==null?void 0:j.data)==null?void 0:z.error)||"ì €ì¥ ì‹¤íŒ¨",Y=((u=(k=N.response)==null?void 0:k.data)==null?void 0:u.details)||N.message||"",S=((T=N.response)==null?void 0:T.status)||"",A=new Error(`${D}${Y?` (${Y})`:""}`);throw A.statusCode=S,A.response=N.response,A}}async getItem(b){var a,w,l;try{const d=b.split("-");if(d.length<4)return console.error("ì˜ëª»ëœ í‚¤ í˜•ì‹:",b),null;const j=d[2],z=d.slice(3).join("-");console.log(`[drawingStorage] ë„ë©´ ì¡°íšŒ ìš”ì²­: projectId=${j}, type=${z}`);const u=(await he.get(`/drawings/${j}/${encodeURIComponent(z)}`)).data;return{type:u.type,projectId:u.projectId,imageUrl:u.imageUrl,markers:u.markers||[],rooms:u.rooms||[],lastModified:new Date(u.updatedAt),naverTypeSqm:u.naverTypeSqm,naverTypePyeong:u.naverTypePyeong,naverArea:u.naverArea}}catch(d){if(((a=d.response)==null?void 0:a.status)===404)return console.log("[drawingStorage] ë„ë©´ ë°ì´í„° ì—†ìŒ (404)"),null;if(((w=d.response)==null?void 0:w.status)===500)return console.warn("[drawingStorage] ì„œë²„ ì—ëŸ¬, ë¹ˆ ë°ì´í„° ë°˜í™˜:",(l=d.response)==null?void 0:l.data),null;throw console.error("ì„œë²„ ë„ë©´ ì¡°íšŒ ì‹¤íŒ¨:",d),d}}async removeItem(b){try{const a=b.split("-");if(a.length<4){console.error("ì˜ëª»ëœ í‚¤ í˜•ì‹:",b);return}const w=a[2],l=a.slice(3).join("-");await he.delete(`/drawings/${w}/${encodeURIComponent(l)}`)}catch(a){throw console.error("ì„œë²„ ë„ë©´ ì‚­ì œ ì‹¤íŒ¨:",a),a}}async clearAll(){return console.warn("ì„œë²„ ê¸°ë°˜ ì €ì¥ì†Œì—ì„œëŠ” clearAllì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."),0}async migrateFromLocalStorage(b){let a=0;const w=[];for(let l=0;l<localStorage.length;l++){const d=localStorage.key(l);d&&d.startsWith("drawing-")&&w.push(d)}return w.forEach(l=>{localStorage.removeItem(l),a++}),a>0&&console.log(`âœ… ${a}ê°œì˜ ë¡œì»¬ ë„ë©´ ë°ì´í„°ë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.`),a}async estimateSize(){return{usage:0,quota:0}}}const xe=new Dt,pe=["ë„¤ì´ë²„ë„ë©´","ê±´ì¶•ë„ë©´","í‰ë©´ë„","3Dë„ë©´","ì² ê±°ë„ë©´","ì „ê¸°ë„ë©´","ì„¤ë¹„ë„ë©´","ëª©ê³µë„ë©´","íƒ€ì¼ë„ë©´","ê¸ˆì†ë„ë©´","ê°€êµ¬ë„ë©´","ì„¸ë¼ë¯¹ë„ë©´","ë””í…Œì¼ë„ë©´","ì²œì¥ë„ë©´"],fe=[{id:"outlet-1",name:"ì½˜ì„¼íŠ¸ 1êµ¬",symbol:"C1",count:1,color:"#ef4444",category:"outlet"},{id:"outlet-2",name:"ì½˜ì„¼íŠ¸ 2êµ¬",symbol:"C2",count:2,color:"#ef4444",category:"outlet"},{id:"outlet-3",name:"ì½˜ì„¼íŠ¸ 3êµ¬",symbol:"C3",count:3,color:"#ef4444",category:"outlet"},{id:"outlet-4",name:"ì½˜ì„¼íŠ¸ 4êµ¬",symbol:"C4",count:4,color:"#ef4444",category:"outlet"},{id:"switch-1",name:"ìŠ¤ìœ„ì¹˜ 1êµ¬",symbol:"S1",count:1,color:"#3b82f6",category:"switch"},{id:"switch-2",name:"ìŠ¤ìœ„ì¹˜ 2êµ¬",symbol:"S2",count:2,color:"#3b82f6",category:"switch"},{id:"switch-3",name:"ìŠ¤ìœ„ì¹˜ 3êµ¬",symbol:"S3",count:3,color:"#3b82f6",category:"switch"},{id:"switch-4",name:"ìŠ¤ìœ„ì¹˜ 4êµ¬",symbol:"S4",count:4,color:"#3b82f6",category:"switch"},{id:"switch-5",name:"ìŠ¤ìœ„ì¹˜ 5êµ¬",symbol:"S5",count:5,color:"#3b82f6",category:"switch"},{id:"switch-6",name:"ìŠ¤ìœ„ì¹˜ 6êµ¬",symbol:"S6",count:6,color:"#3b82f6",category:"switch"},{id:"switch-7",name:"ìŠ¤ìœ„ì¹˜ 7êµ¬",symbol:"S7",count:7,color:"#3b82f6",category:"switch"},{id:"switch-8",name:"ìŠ¤ìœ„ì¹˜ 8êµ¬",symbol:"S8",count:8,color:"#3b82f6",category:"switch"},{id:"light",name:"ì¡°ëª…",symbol:"â—",count:1,color:"#f59e0b",category:"light"}],Et=()=>{const{user:r}=St(),b=kt(),[a,w]=o.useState(()=>{try{const e=localStorage.getItem("user");if(e){const s=JSON.parse(e);return localStorage.getItem(`drawings-selected-project-${s.id}`)||""}}catch(e){console.error("Failed to load saved project:",e)}return""}),[l,d]=o.useState(()=>{try{const e=localStorage.getItem("user");if(e){const s=JSON.parse(e),n=localStorage.getItem(`drawings-selected-type-${s.id}`);if(n&&pe.includes(n))return n}}catch(e){console.error("Failed to load saved drawing type:",e)}return"ë„¤ì´ë²„ë„ë©´"}),[j,z]=o.useState(fe[0].id),[k,u]=o.useState([]),[T,N]=o.useState(0),[D,Y]=o.useState([]),[S,A]=o.useState([]),W=k[T]||"",[re,_]=o.useState(""),[ne,J]=o.useState(""),[ae,G]=o.useState(""),[O,ot]=o.useState("marker"),[L,K]=o.useState("full"),[C,Q]=o.useState(null),[De,Ie]=o.useState(!1),[oe,$e]=o.useState(null),[ye,Re]=o.useState(!1),[P,Te]=o.useState(null),[U,we]=o.useState(null),[lt,be]=o.useState(!1),[le,ve]=o.useState(""),[Ye,je]=o.useState(null),[it,Pe]=o.useState(!1),[H,ie]=o.useState(1),[I,B]=o.useState({x:0,y:0}),[ce,q]=o.useState(!1),[de,Ne]=o.useState({x:0,y:0}),[Z,Se]=o.useState(!1),V=o.useRef(0),Xe=o.useRef({x:0,y:0}),ke=o.useRef(0),ct=o.useRef({x:0,y:0}),ee=o.useRef(null),F=o.useRef(null),Ee=o.useRef(null),me=o.useRef(!1),Ue=o.useRef(!1),te=o.useRef(null),Fe=o.useRef(!1);o.useEffect(()=>{if(r!=null&&r.id&&!Fe.current){if(Fe.current=!0,!a){const s=localStorage.getItem(`drawings-selected-project-${r.id}`);s&&w(s)}const e=localStorage.getItem(`drawings-selected-type-${r.id}`);e&&pe.includes(e)&&e!==l&&d(e)}},[r==null?void 0:r.id]),o.useEffect(()=>{r!=null&&r.id&&!Ue.current&&(Ue.current=!0,xe.migrateFromLocalStorage(r.id).then(e=>{e>0&&console.log(`âœ… ${e}ê°œì˜ ë„ë©´ì„ ì„œë²„ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í–ˆìŠµë‹ˆë‹¤.`)}).catch(e=>{console.error("ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:",e)}))},[r==null?void 0:r.id]),o.useEffect(()=>{if(r!=null&&r.id&&r.name==="ì•ˆíŒ€"&&b.length>0&&!a){const e=b.find(s=>s.status!=="completed");e&&w(e.id)}},[r==null?void 0:r.id,r==null?void 0:r.name,b,a]),o.useEffect(()=>{r!=null&&r.id&&a&&localStorage.setItem(`drawings-selected-project-${r.id}`,a)},[r==null?void 0:r.id,a]),o.useEffect(()=>{r!=null&&r.id&&l&&localStorage.setItem(`drawings-selected-type-${r.id}`,l)},[r==null?void 0:r.id,l]),o.useEffect(()=>{if(r!=null&&r.id&&a&&l){me.current=!0;const e=`drawing-${r.id}-${a}-${l}`;xe.getItem(e).then(s=>{s?(s.imageUrls&&Array.isArray(s.imageUrls)?u(s.imageUrls):s.imageUrl?u([s.imageUrl]):u([]),N(0),Y(s.markers||[]),A(s.rooms||[]),_(s.naverTypeSqm||""),J(s.naverTypePyeong||""),G(s.naverArea||"")):(u([]),N(0),Y([]),A([]),_(""),J(""),G("")),K("full"),Q(null),setTimeout(()=>{me.current=!1},0)}).catch(s=>{console.error("Failed to load drawing data:",s),u([]),N(0),Y([]),A([]),_(""),J(""),G(""),K("full"),Q(null),me.current=!1})}},[r==null?void 0:r.id,a,l]),o.useEffect(()=>{if(!me.current)return r!=null&&r.id&&a&&l&&k.length>0&&(te.current&&clearTimeout(te.current),te.current=setTimeout(async()=>{var n,i,c;const e=`drawing-${r.id}-${a}-${l}`,s={type:l,projectId:a,imageUrl:k[0],imageUrls:k,markers:D,rooms:S,lastModified:new Date,naverTypeSqm:re,naverTypePyeong:ne,naverArea:ae};try{await xe.setItem(e,s,r.id),console.log("âœ… ë„ë©´ ì €ì¥ ì™„ë£Œ")}catch(g){console.error("Failed to save drawing data:",g);const x=((i=(n=g.response)==null?void 0:n.data)==null?void 0:i.error)||g.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",p=((c=g.response)==null?void 0:c.status)||"";alert(`ë„ë©´ ì €ì¥ ì‹¤íŒ¨: ${p?`[${p}] `:""}${x}`)}},500)),()=>{te.current&&clearTimeout(te.current)}},[r==null?void 0:r.id,a,l,k,D,S,re,ne,ae]);const[dt,Ae]=o.useState(!1),ge=async(e,s)=>{if(!e.type.startsWith("image/")){alert("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");return}if(e.size>20*1024*1024){alert("íŒŒì¼ í¬ê¸°ê°€ 20MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.");return}Ae(!0);try{const n=await xe.uploadImage(e);console.log(`ğŸ“¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ: ${n}`),s!==void 0?u(i=>{const c=[...i];return c[s]=n,c}):(u(i=>[...i,n]),N(k.length))}catch(n){console.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:",n),alert(n.message||"ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{Ae(!1)}},We=e=>{confirm("ì´ ë„ë©´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&u(s=>{const n=s.filter((i,c)=>c!==e);return T>=n.length?N(Math.max(0,n.length-1)):T>e&&N(T-1),n})},Le=e=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=n=>{var c;const i=(c=n.target.files)==null?void 0:c[0];i&&ge(i,e)},s.click()},mt=e=>{const s=e.target.files;s&&Array.from(s).forEach(n=>ge(n)),e.target.value=""},ze=e=>{var n;if(!a)return;const s=(n=e.clipboardData)==null?void 0:n.items;if(s){for(let i=0;i<s.length;i++)if(s[i].type.startsWith("image/")){const c=s[i].getAsFile();if(c){ge(c);break}}}},He=e=>{e.preventDefault(),Se(!0)},qe=e=>{e.preventDefault(),Se(!1)},Oe=e=>{var n;e.preventDefault(),Se(!1);const s=(n=e.dataTransfer.files)==null?void 0:n[0];s&&ge(s)};o.useEffect(()=>(document.addEventListener("paste",ze),()=>{document.removeEventListener("paste",ze)}),[a]);const gt=e=>{e.preventDefault();const i=1+(e.deltaY>0?-1:1)*.15,c=Math.min(Math.max(.5,H*i),5),g=e.currentTarget.getBoundingClientRect(),x=e.clientX-g.left-g.width/2,p=e.clientY-g.top-g.height/2,h=c/H,f=x-(x-I.x)*h,y=p-(p-I.y)*h;ie(c),B({x:f,y})},ut=e=>{e.button===0&&(q(!0),Ne({x:e.clientX-I.x,y:e.clientY-I.y}))},ht=e=>{ce&&B({x:e.clientX-de.x,y:e.clientY-de.y})},Be=()=>{q(!1)},Ve=()=>{ie(1),B({x:0,y:0})},_e=e=>{if(e.length<2)return 0;const s=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY;return Math.sqrt(s*s+n*n)},Je=e=>e.length<2?{x:e[0].clientX,y:e[0].clientY}:{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2},xt=e=>{e.preventDefault(),e.stopPropagation();const s=e.touches;if(s.length===1){const n=Date.now(),i=n-ke.current;ct.current={x:s[0].clientX,y:s[0].clientY},i<300?(Ve(),ke.current=0):(ke.current=n,q(!0),Ne({x:s[0].clientX-I.x,y:s[0].clientY-I.y}))}else s.length===2&&(q(!1),V.current=_e(s),Xe.current=Je(s))},pt=e=>{e.preventDefault(),e.stopPropagation();const s=e.touches;if(s.length===1&&ce)B({x:s[0].clientX-de.x,y:s[0].clientY-de.y});else if(s.length===2){const n=_e(s),i=Je(s);if(V.current>0){const c=n/V.current,g=Math.min(Math.max(.5,H*c),5),x=g/H,p=i.x-window.innerWidth/2,h=i.y-window.innerHeight/2,f=p-(p-I.x)*x,y=h-(h-I.y)*x;ie(g),B({x:f,y})}V.current=n,Xe.current=i}},ft=e=>{e.stopPropagation(),e.touches.length===0?(q(!1),V.current=0):e.touches.length===1&&(V.current=0,q(!0),Ne({x:e.touches[0].clientX-I.x,y:e.touches[0].clientY-I.y}))},Ge=()=>{Pe(!1),ie(1),B({x:0,y:0}),q(!1)},yt=e=>{if(!W||!ee.current)return;const s=ee.current.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top;let c,g;if(L==="room"&&C){if(!S.find(M=>M.id===C)||!F.current)return;const p=F.current.naturalWidth,h=F.current.naturalHeight;if(!p||!h)return;const f=p/h,y=s.width/s.height;let m,v,E,$;y>f?(v=s.height,m=s.height*f,E=(s.width-m)/2,$=0):(m=s.width,v=s.width/f,E=0,$=(s.height-v)/2);const R=n-E,ue=i-$;if(R<0||R>m||ue<0||ue>v)return;c=R/m*100,g=ue/v*100}else{if(!F.current)return;const x=F.current.naturalWidth,p=F.current.naturalHeight;if(!x||!p)return;const h=x/p,f=s.width/s.height;let y,m,v,E;f>h?(m=s.height,y=s.height*h,v=(s.width-y)/2,E=0):(y=s.width,m=s.width/h,v=0,E=(s.height-m)/2);const $=n-v,R=i-E;if($<0||$>y||R<0||R>m)return;c=$/y*100,g=R/m*100}if(O==="room")Re(!0),Te({x:c,y:g}),we({x:c,y:g});else if(l==="ì „ê¸°ë„ë©´"){if(De)return;const x=fe.find(m=>m.id===j);let p=null,h,f;if(L==="room"&&C){const m=S.find(v=>v.id===C);m&&(p=C,h=(c-m.x)/m.width*100,f=(g-m.y)/m.height*100)}const y={id:`marker-${Date.now()}`,x:c,y:g,roomId:p,roomX:h,roomY:f,type:j,label:(x==null?void 0:x.name)||"",details:""};Y([...D,y])}},wt=e=>{if(!W||!ee.current||!F.current)return;const s=ee.current.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top,c=F.current.naturalWidth,g=F.current.naturalHeight;if(!c||!g)return;const x=c/g,p=s.width/s.height;let h,f,y,m;p>x?(f=s.height,h=s.height*x,y=(s.width-h)/2,m=0):(h=s.width,f=s.width/x,y=0,m=(s.height-f)/2);const v=n-y,E=i-m;if(v<0||v>h||E<0||E>f)return;const $=v/h*100,R=E/f*100;if(ye&&P)we({x:$,y:R});else if(De&&oe){if(D.find(M=>M.id===oe)&&L==="room"&&C){const M=S.find(Ce=>Ce.id===C);if(M){const Ce=($-M.x)/M.width*100,Nt=(R-M.y)/M.height*100;Y(D.map(Me=>Me.id===oe?{...Me,x:$,y:R,roomX:Ce,roomY:Nt}:Me));return}}Y(D.map(M=>M.id===oe?{...M,x:$,y:R}:M))}},Ke=()=>{if(ye&&P&&U){const e=Math.min(P.x,U.x),s=Math.min(P.y,U.y),n=Math.abs(U.x-P.x),i=Math.abs(U.y-P.y);n>2&&i>2&&(je({x:e,y:s,width:n,height:i}),be(!0)),Re(!1),Te(null),we(null)}Ie(!1),$e(null)},Qe=()=>{if(Ye&&le.trim()){const e={id:`room-${Date.now()}`,name:le.trim(),...Ye};A([...S,e]),be(!1),ve(""),je(null)}},bt=(e,s)=>{e.stopPropagation(),Ie(!0),$e(s)},vt=e=>{Y(D.filter(s=>s.id!==e))},Ze=e=>{A(S.filter(s=>s.id!==e)),Y(D.filter(s=>s.roomId!==e)),C===e&&(Q(null),K("full"))},et=e=>{Q(e),K("room")},tt=()=>{K("full"),Q(null)},jt=()=>{if(L==="room"&&C){const e=S.find(s=>s.id===C);return e?D.filter(s=>s.roomId===C).map(s=>({...s,x:e.x+(s.roomX||0)*e.width/100,y:e.y+(s.roomY||0)*e.height/100})):[]}return D},X=S.find(e=>e.id===C),st=e=>e.replace("ë„ë©´","");return t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsxs("div",{className:"bg-white border-b px-3 md:px-6 py-3 flex-shrink-0",children:[t.jsxs("div",{className:"md:hidden",children:[t.jsx("div",{className:"flex justify-end mb-3",children:t.jsxs("select",{value:a,onChange:e=>w(e.target.value),className:"input max-w-[200px] text-sm",children:[(r==null?void 0:r.name)!=="ì•ˆíŒ€"&&t.jsx("option",{value:"",children:"í”„ë¡œì íŠ¸ ì„ íƒ"}),b.filter(e=>e.status!=="completed").map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})}),t.jsx("div",{className:"grid grid-cols-5 gap-2 mb-3",children:pe.map(e=>t.jsx("button",{onClick:()=>d(e),className:`px-2 py-1.5 rounded text-xs whitespace-nowrap transition-colors ${l===e?"bg-gray-900 text-white font-medium":"text-gray-700 bg-gray-100 hover:bg-gray-200"}`,children:st(e)},e))}),L==="room"&&X&&t.jsxs("div",{className:"flex items-center justify-between mt-3",children:[t.jsxs("button",{onClick:tt,className:"btn btn-outline text-sm",children:[t.jsx(rt,{className:"w-4 h-4 mr-2"}),"ì „ì²´ ë³´ê¸°"]}),t.jsx("span",{className:"text-base font-semibold text-gray-900",children:X.name})]})]}),t.jsxs("div",{className:"hidden md:flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-80",children:t.jsxs("select",{value:a,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-500",children:[(r==null?void 0:r.name)!=="ì•ˆíŒ€"&&t.jsx("option",{value:"",children:"í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”"}),b.filter(e=>e.status!=="completed").map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})}),l==="ë„¤ì´ë²„ë„ë©´"&&a&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"íƒ€ì…"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"text",value:re,onChange:e=>_(e.target.value),placeholder:"ì˜ˆ: 136E",className:"w-28 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ã¡"})]}),t.jsx("span",{className:"text-gray-400",children:"/"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"text",value:ne,onChange:e=>J(e.target.value),placeholder:"ì˜ˆ: 41E",className:"w-24 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"í‰"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"ê³µê¸‰/ì „ìš©"}),t.jsx("input",{type:"text",value:ae,onChange:e=>G(e.target.value),placeholder:"ì˜ˆ: 136.21ã¡/101.97ã¡(ì „ìš©ë¥  75%)",className:"w-80 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-500"})]})]})]}),L==="room"&&X&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:tt,className:"btn btn-outline text-sm",children:[t.jsx(rt,{className:"w-4 h-4 mr-2"}),"ì „ì²´ ë³´ê¸°"]}),t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:X.name})]})]})]}),t.jsxs("div",{className:"drawings-main flex-1 flex flex-col md:flex-row overflow-hidden",children:[t.jsx("div",{className:"drawings-sidebar hidden md:block w-48 bg-white border-r flex-shrink-0 overflow-y-auto",children:t.jsxs("div",{className:"drawings-sidebar-inner p-4",children:[t.jsx("h3",{className:"drawings-sidebar-title text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"ë„ë©´ ì¢…ë¥˜"}),t.jsx("div",{className:"drawings-type-list space-y-1 mb-6",children:pe.map(e=>t.jsx("button",{onClick:()=>d(e),className:`drawings-type-btn w-full text-left px-3 py-2.5 rounded text-sm transition-colors ${l===e?"bg-gray-900 text-white font-medium":"text-gray-700 hover:bg-gray-100"}`,children:st(e)},e))}),a&&l==="ì „ê¸°ë„ë©´"&&W&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:()=>ot(O==="room"?"marker":"room"),className:`w-full text-left px-3 py-2.5 rounded text-sm transition-colors flex items-center font-medium ${O==="room"?"bg-green-700 text-white":"bg-green-600 text-white hover:bg-green-700"}`,children:[t.jsx(Ct,{className:"w-4 h-4 mr-2"}),O==="room"?"ì˜ì—­ ê·¸ë¦¬ê¸° ì¤‘...":"ì˜ì—­ ê·¸ë¦¬ê¸°"]})}),S.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"ì˜ì—­ ëª©ë¡"}),t.jsx("div",{className:"space-y-1",children:S.map(e=>t.jsxs("div",{className:`w-full text-left px-3 py-2.5 rounded text-sm transition-colors flex items-center justify-between group ${C===e.id?"bg-purple-600 text-white font-medium":"text-gray-700 hover:bg-gray-100"}`,children:[t.jsx("button",{onClick:()=>et(e.id),className:"flex-1 text-left",children:e.name}),t.jsx("button",{onClick:s=>{s.stopPropagation(),Ze(e.id)},className:"opacity-0 group-hover:opacity-100 ml-2",children:t.jsx(se,{className:"w-3.5 h-3.5"})})]},e.id))})]})]})]})}),a?t.jsx(t.Fragment,{children:t.jsx("div",{className:"flex-1 bg-gray-50 flex flex-col overflow-hidden",children:t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[l==="ë„¤ì´ë²„ë„ë©´"&&a&&t.jsx("div",{className:"md:hidden bg-white border-b px-3 py-1",children:t.jsxs("div",{className:"flex items-center gap-1.5 overflow-x-auto",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[t.jsx("span",{className:"text-[11px] text-gray-500",children:"íƒ€ì…"}),t.jsx("input",{type:"text",value:re,onChange:e=>_(e.target.value),placeholder:"136E",className:"input w-12 h-5 text-[12px] px-1"}),t.jsx("span",{className:"text-[11px] text-gray-500",children:"ã¡"}),t.jsx("span",{className:"text-gray-300 text-xs",children:"/"}),t.jsx("input",{type:"text",value:ne,onChange:e=>J(e.target.value),placeholder:"41E",className:"input w-10 h-5 text-[12px] px-1"}),t.jsx("span",{className:"text-[11px] text-gray-500",children:"í‰"})]}),t.jsx("div",{className:"w-px h-3 bg-gray-200 flex-shrink-0"}),t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 min-w-0",children:[t.jsx("span",{className:"text-[11px] text-gray-500 flex-shrink-0",children:"ê³µê¸‰/ì „ìš©"}),t.jsx("input",{type:"text",value:ae,onChange:e=>G(e.target.value),placeholder:"136.21ã¡/101.97ã¡",className:"input h-5 text-[12px] px-1 flex-1 min-w-[100px]"})]})]})}),t.jsx("div",{className:"overflow-hidden p-3 md:p-6 flex-1 md:flex-none",children:W?t.jsxs("div",{className:`relative w-full h-full md:h-auto md:max-h-[calc(100vh-280px)] bg-white rounded-lg shadow-lg overflow-hidden md:aspect-[16/10] group/canvas ${Z?"ring-4 ring-blue-500 ring-inset":""}`,onDragOver:He,onDragLeave:qe,onDrop:Oe,children:[Z&&t.jsx("div",{className:"absolute inset-0 bg-blue-500 bg-opacity-20 z-30 flex items-center justify-center pointer-events-none",children:t.jsx("div",{className:"bg-white px-6 py-3 rounded-lg shadow-lg text-blue-600 font-medium",children:"ì´ë¯¸ì§€ë¥¼ ë†“ì•„ì„œ ì¶”ê°€"})}),t.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 z-20 opacity-0 group-hover/canvas:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),Le(T)},className:"w-9 h-9 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-all border border-gray-200",title:"ì´ë¯¸ì§€ ìˆ˜ì •",children:t.jsx(nt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:e=>{e.stopPropagation(),We(T)},className:"w-9 h-9 bg-white rounded-full shadow-lg flex items-center justify-center text-red-500 hover:text-red-600 hover:bg-red-50 transition-all border border-gray-200",title:"ì´ë¯¸ì§€ ì‚­ì œ",children:t.jsx(se,{className:"w-4 h-4"})})]}),t.jsxs("div",{ref:ee,className:`relative w-full h-full ${O==="room"?"cursor-crosshair":"cursor-default"}`,onMouseDown:yt,onMouseMove:wt,onMouseUp:Ke,onMouseLeave:Ke,children:[t.jsx("img",{ref:F,src:W,alt:"í‰ë©´ë„",className:"w-full h-full object-contain select-none",draggable:!1,onClick:()=>Pe(!0),style:L==="room"&&X?(()=>{const e=100/X.width,s=100/X.height,n=Math.max(e,s),i=X.x+X.width/2,c=X.y+X.height/2;return{objectFit:"none",transform:`scale(${n}) translate(${(50-i)/n}%, ${(50-c)/n}%)`,transformOrigin:"0 0",pointerEvents:"auto",cursor:"pointer"}})():{pointerEvents:"auto",cursor:"pointer"}}),L==="full"&&S.map(e=>t.jsxs("div",{className:"absolute border-2 border-purple-500 bg-purple-500 bg-opacity-10 hover:bg-opacity-20 transition-all cursor-pointer group",style:{left:`${e.x}%`,top:`${e.y}%`,width:`${e.width}%`,height:`${e.height}%`},onClick:()=>et(e.id),children:[t.jsx("div",{className:"absolute top-1 left-1 bg-purple-600 text-white px-2 py-0.5 rounded text-xs font-medium",children:e.name}),t.jsx("button",{onClick:s=>{s.stopPropagation(),Ze(e.id)},className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx(se,{className:"w-3 h-3"})})]},e.id)),ye&&P&&U&&t.jsx("div",{className:"absolute border-2 border-dashed border-green-500 bg-green-500 bg-opacity-10",style:{left:`${Math.min(P.x,U.x)}%`,top:`${Math.min(P.y,U.y)}%`,width:`${Math.abs(U.x-P.x)}%`,height:`${Math.abs(U.y-P.y)}%`}}),jt().map(e=>{const s=fe.find(n=>n.id===e.type);return t.jsxs("div",{onMouseDown:n=>bt(n,e.id),className:"absolute transform -translate-x-1/2 -translate-y-1/2 cursor-move group",style:{left:`${e.x}%`,top:`${e.y}%`},children:[(s==null?void 0:s.category)==="light"?t.jsx("div",{className:"rounded-full shadow-md transition-transform group-hover:scale-110",style:{backgroundColor:s.color,width:"16px",height:"16px"}}):t.jsx("div",{className:"flex items-center justify-center bg-white rounded shadow-md transition-transform group-hover:scale-110",style:{borderColor:s==null?void 0:s.color,color:s==null?void 0:s.color,border:"1.5px solid",padding:"2px 4px",fontSize:"10px",fontWeight:"600",minWidth:"20px",minHeight:"20px"},children:s==null?void 0:s.symbol}),t.jsx("button",{onClick:n=>{n.stopPropagation(),vt(e.id)},className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx(se,{className:"w-2.5 h-2.5"})})]},e.id)})]}),k.length>1&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 px-3 py-2 z-20",children:t.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:k.map((e,s)=>t.jsxs("div",{className:`relative flex-shrink-0 cursor-pointer group rounded overflow-hidden transition-all ${T===s?"ring-2 ring-white":"opacity-70 hover:opacity-100"}`,onClick:()=>N(s),children:[t.jsx("img",{src:e,alt:`ë„ë©´ ${s+1}`,className:"w-12 h-12 md:w-14 md:h-14 object-cover"}),t.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100",children:[t.jsx("button",{onClick:n=>{n.stopPropagation(),Le(s)},className:"w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-md hover:bg-gray-100 transition-colors",title:"ìˆ˜ì •",children:t.jsx(nt,{className:"w-3 h-3 text-gray-700"})}),t.jsx("button",{onClick:n=>{n.stopPropagation(),We(s)},className:"w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-md hover:bg-red-50 transition-colors",title:"ì‚­ì œ",children:t.jsx(se,{className:"w-3 h-3 text-red-500"})})]}),T===s&&t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white text-gray-900 text-[9px] text-center py-0.5 font-bold",children:[s+1,"/",k.length]})]},s))})})]}):t.jsxs("div",{className:`flex flex-col items-center justify-center h-full bg-white rounded-lg shadow-lg text-gray-500 transition-all ${Z?"border-4 border-dashed border-blue-500 bg-blue-50":""}`,onDragOver:He,onDragLeave:qe,onDrop:Oe,children:[dt?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-20 h-20 mb-4 flex items-center justify-center",children:t.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),t.jsx("p",{className:"text-base mb-2 font-semibold text-blue-600",children:"ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘..."}),t.jsx("p",{className:"text-sm text-gray-400",children:"ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”"})]}):t.jsxs(t.Fragment,{children:[t.jsx(at,{className:`w-20 h-20 mb-4 transition-colors ${Z?"text-blue-500":"text-gray-400"}`}),t.jsx("p",{className:"text-base mb-2 font-semibold",children:Z?"ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”":"ë„ë©´ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”"}),t.jsx("p",{className:"text-sm mb-4 text-gray-400",children:"íŒŒì¼ ì„ íƒ, ë“œë˜ê·¸ ì•¤ ë“œë¡­, ë˜ëŠ” Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸°"}),t.jsx("button",{onClick:()=>{var e;return(e=Ee.current)==null?void 0:e.click()},className:"px-6 py-2.5 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors",children:"íŒŒì¼ ì„ íƒ"})]}),t.jsx("input",{ref:Ee,type:"file",accept:"image/*",multiple:!0,onChange:mt,className:"hidden"})]})}),l==="ì „ê¸°ë„ë©´"&&W&&O==="marker"&&t.jsx("div",{className:"bg-white border-t px-6 py-3 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700 mr-2",children:"C: ì½˜ì„¼íŠ¸ / S: ìŠ¤ìœ„ì¹˜ / â—: ì¡°ëª…"}),t.jsx("div",{className:"w-px h-4 bg-gray-300 mx-1"}),fe.map(e=>t.jsx("button",{onClick:()=>z(e.id),className:`px-3 py-1.5 rounded text-xs font-medium transition-all ${j===e.id?"bg-gray-900 text-white shadow-md":"bg-white text-gray-700 border border-gray-300 hover:border-gray-900"}`,style:{borderColor:j===e.id?void 0:e.color,borderWidth:j===e.id?void 0:"1.5px"},children:t.jsx("span",{className:"text-sm font-semibold",style:{color:j===e.id?"white":e.color},children:e.symbol})},e.id))]})})]})})}):t.jsx("div",{className:"drawings-empty flex-1 flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"text-center",children:[t.jsx(at,{className:"w-20 h-20 mx-auto mb-4 text-gray-400"}),t.jsx("p",{className:"text-lg text-gray-600 mb-2",children:"í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”"}),t.jsx("p",{className:"text-sm text-gray-500",children:"ë„ë©´ì„ ì—…ë¡œë“œí•˜ê³  ì „ê¸°/ì„¤ë¹„ ìœ„ì¹˜ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"})]})})]}),lt&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-96",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ì˜ì—­ ì´ë¦„ ì…ë ¥"}),t.jsx("input",{type:"text",value:le,onChange:e=>ve(e.target.value),onKeyDown:e=>{e.key==="Enter"&&Qe()},placeholder:"ì˜ˆ: ê±°ì‹¤, ì¹¨ì‹¤1, ì£¼ë°©",className:"input w-full mb-4",autoFocus:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>{be(!1),ve(""),je(null)},className:"btn btn-outline",children:"ì·¨ì†Œ"}),t.jsx("button",{onClick:Qe,className:"btn btn-primary",disabled:!le.trim(),children:"ì €ì¥"})]})]})}),it&&W&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 touch-none",onClick:Ge,onWheel:gt,onMouseMove:ht,onMouseUp:Be,onMouseLeave:Be,onTouchStart:xt,onTouchMove:pt,onTouchEnd:ft,children:t.jsxs("div",{className:"relative w-full h-full p-4 md:p-8 flex items-center justify-center overflow-hidden",children:[t.jsx("button",{onClick:Ge,className:"absolute top-4 right-4 w-10 h-10 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center text-white transition-all z-10",children:t.jsx(Mt,{className:"w-6 h-6"})}),t.jsxs("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white text-xs px-3 py-2 rounded z-10",children:[t.jsx("span",{className:"hidden md:inline",children:"ë§ˆìš°ìŠ¤ íœ : í™•ëŒ€/ì¶•ì†Œ | ë“œë˜ê·¸: ì´ë™ | ë”ë¸”í´ë¦­: ì´ˆê¸°í™”"}),t.jsx("span",{className:"md:hidden",children:"ë‘ ì†ê°€ë½: í™•ëŒ€/ì¶•ì†Œ | ë“œë˜ê·¸: ì´ë™ | ë”ë¸”íƒ­: ì´ˆê¸°í™”"})]}),H!==1&&t.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white text-sm px-3 py-1 rounded z-10",children:[Math.round(H*100),"%"]}),t.jsx("img",{src:W,alt:"ë„ë©´ ì „ì²´í™”ë©´",className:"object-contain select-none touch-none",style:{transform:`translate(${I.x}px, ${I.y}px) scale(${H})`,cursor:ce?"grabbing":"grab",transition:ce?"none":"transform 0.1s ease-out",maxWidth:"100%",maxHeight:"100%"},onClick:e=>e.stopPropagation(),onMouseDown:ut,onDoubleClick:Ve,draggable:!1})]})})]})};export{Et as default};
