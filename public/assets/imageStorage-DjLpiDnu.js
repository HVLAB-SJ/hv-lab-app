const g="HVLabImageDB";const n="paymentRecordImages";let d=null;const i=()=>new Promise((r,e)=>{if(d){r(d);return}const o=indexedDB.open(g,1);o.onerror=()=>{console.error("IndexedDB 열기 실패:",o.error),e(o.error)},o.onsuccess=()=>{d=o.result,r(d)},o.onupgradeneeded=c=>{const t=c.target.result;t.objectStoreNames.contains(n)||t.createObjectStore(n,{keyPath:"id"})}}),u=async()=>{try{const r=await i();return new Promise((e,o)=>{const s=r.transaction(n,"readonly").objectStore(n).getAll();s.onsuccess=()=>{const l={};s.result.forEach(a=>{l[a.id]=a.images}),e(l)},s.onerror=()=>{console.error("이미지 로드 실패:",s.error),o(s.error)}})}catch(r){console.error("IndexedDB 오류, localStorage 폴백:",r);const e=localStorage.getItem("paymentRecordImages");return e?JSON.parse(e):{}}},I=async(r,e)=>{try{const o=await i();return new Promise((c,t)=>{const a=o.transaction(n,"readwrite").objectStore(n).put({id:r,images:e});a.onsuccess=()=>c(),a.onerror=()=>{console.error("이미지 저장 실패:",a.error),t(a.error)}})}catch(o){throw console.error("IndexedDB 저장 오류:",o),o}},m=async r=>{try{const e=await i();return new Promise((o,c)=>{const t=e.transaction(n,"readwrite"),s=t.objectStore(n);s.clear(),Object.entries(r).forEach(([l,a])=>{s.put({id:l,images:a})}),t.oncomplete=()=>o(),t.onerror=()=>{console.error("전체 저장 실패:",t.error),c(t.error)}})}catch(e){throw console.error("IndexedDB 전체 저장 오류:",e),e}},S=async()=>{try{const r=localStorage.getItem("paymentRecordImages");if(r){const e=JSON.parse(r);Object.keys(e).length>0&&(await m(e),localStorage.removeItem("paymentRecordImages"),console.log("localStorage에서 IndexedDB로 마이그레이션 완료"))}}catch(r){console.error("마이그레이션 실패:",r)}};export{u as g,S as m,I as s};
