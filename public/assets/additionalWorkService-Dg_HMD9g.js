import{q as w,o as W,m as A,a,n as D,d as m,g as u,t as I,b,T as n,v as y,x as S,y as f,z as j,p as h,h as c,i as l}from"./index-C3cpvoiK.js";const s="additional_works",p=t=>{const e=t.data();return{_id:t.id,project:e.project||"",description:e.description||"",amount:e.amount||0,date:e.date instanceof n?e.date.toDate().toISOString().split("T")[0]:e.date||e.work_date||"",notes:e.notes||"",images:e.images||[],createdAt:e.createdAt instanceof n?e.createdAt.toDate().toISOString():e.createdAt||"",updatedAt:e.updatedAt instanceof n?e.updatedAt.toDate().toISOString():e.updatedAt||""}},r={getAllAdditionalWorks:async()=>{const t=w(A(a,s),W("createdAt","desc"));return(await h(t)).docs.map(p)},getAdditionalWorkById:async t=>{const e=m(a,s,t),o=await u(e);return o.exists()?p(o):null},createAdditionalWork:async t=>{const e=n.now(),o={project:t.project,description:t.description,amount:t.amount,date:t.date instanceof Date?n.fromDate(t.date):t.date,notes:t.notes||"",images:[],createdAt:e,updatedAt:e},i=await j(A(a,s),o);if(t.images&&t.images.length>0)if(t.images.some(d=>y(d))){const d=await S("additional_works",i.id,t.images);await f(i,{images:d})}else await f(i,{images:t.images});const k=await u(i);return p(k)},updateAdditionalWork:async(t,e)=>{const o=m(a,s,t),i={updatedAt:n.now()};e.project!==void 0&&(i.project=e.project),e.description!==void 0&&(i.description=e.description),e.amount!==void 0&&(i.amount=e.amount),e.date!==void 0&&(i.date=e.date instanceof Date?n.fromDate(e.date):e.date),e.notes!==void 0&&(i.notes=e.notes),e.images!==void 0&&(e.images.some(d=>y(d))?i.images=await S("additional_works",t,e.images):i.images=e.images),await f(o,i);const k=await u(o);return p(k)},deleteAdditionalWork:async t=>{const e=m(a,s,t),o=await u(e);if(o.exists()){const i=o.data();i.images&&i.images.length>0&&await I(i.images)}await b(e)},subscribeToAdditionalWorks:t=>{const e=w(A(a,s),W("createdAt","desc"));return D(e,o=>{const i=o.docs.map(p);t(i)})}},g={getAllAdditionalWorks:async()=>(await l.get("/additional-works")).data,getAdditionalWorkById:async t=>(await l.get(`/additional-works/${t}`)).data,createAdditionalWork:async t=>{const e={project:t.project,description:t.description,amount:t.amount,work_date:t.date instanceof Date?t.date.toISOString().split("T")[0]:t.date,notes:t.notes||"",images:t.images||[]};return console.log("[additionalWorkService.createAdditionalWork] Sending to backend:",e),(await l.post("/additional-works",e)).data},updateAdditionalWork:async(t,e)=>{const o={};return e.project!==void 0&&(o.project=e.project),e.description!==void 0&&(o.description=e.description),e.amount!==void 0&&(o.amount=e.amount),e.date!==void 0&&(o.work_date=e.date instanceof Date?e.date.toISOString().split("T")[0]:e.date),e.notes!==void 0&&(o.notes=e.notes),console.log("[additionalWorkService.updateAdditionalWork] Sending to backend:",o),(await l.put(`/additional-works/${t}`,o)).data},deleteAdditionalWork:async t=>{await l.delete(`/additional-works/${t}`)}},T={getAllAdditionalWorks:async()=>c()?(console.log("[additionalWorkService] Using Firestore"),r.getAllAdditionalWorks()):(console.log("[additionalWorkService] Using Railway API"),g.getAllAdditionalWorks()),getAdditionalWorkById:async t=>{if(c()){const e=await r.getAdditionalWorkById(t);if(!e)throw new Error("Additional work not found");return e}return g.getAdditionalWorkById(t)},createAdditionalWork:async t=>c()?r.createAdditionalWork(t):g.createAdditionalWork(t),updateAdditionalWork:async(t,e)=>c()?r.updateAdditionalWork(t,e):g.updateAdditionalWork(t,e),deleteAdditionalWork:async t=>c()?r.deleteAdditionalWork(t):g.deleteAdditionalWork(t),subscribeToAdditionalWorks:r.subscribeToAdditionalWorks};export{T as a};
