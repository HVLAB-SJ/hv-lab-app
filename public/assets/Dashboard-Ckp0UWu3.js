import{j as e}from"./vendor-data-DG_4MGb7.js";import{u as $}from"./dataStore-ByVzUXWH.js";import{u as A,l as C}from"./index-HUdyR-Tx.js";import{r as k}from"./vendor-react-D-r2Cqeg.js";import{S as E}from"./ScheduleModal-wMA3adyA.js";import{f as y}from"./formatters-15aXprTM.js";import{T as F}from"./index-CSlX1tQB.js";import{P as I,b as P,e as B}from"./vendor-ui-DTwhhNuH.js";import{p as f,q as K,r as j,s as R}from"./vendor-date-9Cl9d1sr.js";import"./index.esm-D9ojv-r8.js";const b=F,J=()=>{const{schedules:N,loadSchedulesFromAPI:h,addScheduleToAPI:S,deleteScheduleFromAPI:w}=$(),{user:d}=A(),[D,p]=k.useState(!1),x=d!=null&&d.name?d.name.slice(-2):null,v=(d==null?void 0:d.name)==="안팀"?["안팀"]:x?[x,...b.filter(t=>t!==x)]:b,M=t=>{const a=N.filter(r=>r.attendees?!!(r.attendees.includes(t)||r.attendees.includes("HV LAB")&&t!=="안팀"||r.attendees.includes("현장팀")&&["재천","민기"].includes(t)||r.attendees.includes("디자인팀")&&["신애","재성","재현"].includes(t)):!1),i=r=>{const s=new Set;return r.filter(l=>{const n=`${f(new Date(l.start),"yyyy-MM-dd")}|${l.project}|${l.title}`;return s.has(n)?!1:(s.add(n),!0)})},u=i(a.filter(r=>j(new Date(r.start)))),m=i(a.filter(r=>R(new Date(r.start))&&!j(new Date(r.start))).sort((r,s)=>new Date(r.start).getTime()-new Date(s.start).getTime())).slice(0,3);return{todaySchedules:u,upcomingSchedules:m,member:t}};return e.jsxs("div",{className:"space-y-3 md:space-y-5 lg:space-y-4",children:[e.jsx("div",{children:e.jsx("div",{className:"dashboard-grid grid grid-cols-1 sm:grid-cols-2 ipad:grid-cols-2 ipad-lg:grid-cols-2 ipad-xl:grid-cols-3 ipad-2xl:grid-cols-3 2xl:grid-cols-4 gap-3 md:gap-4 lg:gap-4",children:v.map(t=>{const{todaySchedules:a,upcomingSchedules:i}=M(t),u=a.length+i.length,m=t===x;return e.jsxs("div",{className:`card p-3 sm:p-4 md:p-5 lg:p-4 ${m?"ring-1 ring-gray-300":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-lg md:text-lg text-gray-900",children:t}),m&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 text-gray-600 rounded font-medium",children:"나"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsx("button",{onClick:()=>p(!0),className:"p-1.5 hover:bg-gray-100 rounded-full transition-colors",title:"일정 추가",children:e.jsx(I,{className:"h-4 w-4 text-gray-700"})}),e.jsxs("span",{className:`text-xs px-2.5 py-1 ${m&&a.length>0?"bg-amber-100 text-gray-900":"bg-gray-100 text-gray-900"} rounded-full font-semibold whitespace-nowrap`,children:[a.length," 오늘"]}),e.jsxs("span",{className:"text-xs px-2.5 py-1 bg-gray-100 text-gray-700 rounded-full font-semibold whitespace-nowrap",children:[i.length," 예정"]})]})]}),a.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(P,{className:"h-4 w-4 text-gray-900"}),e.jsx("p",{className:"text-xs font-semibold text-gray-900 uppercase",children:"오늘"})]}),e.jsx("div",{className:"space-y-2",children:(()=>{const r=a.reduce((s,l)=>{const o=l.project||"-";return s[o]||(s[o]=[]),s[o].push(l),s},{});return Object.entries(r).map(([s,l])=>{const o=t===x;return e.jsxs("div",{className:`border-l-3 ${o?"border-gray-400":"border-gray-900"} ${o?"bg-amber-50":"bg-gray-50"} rounded-r overflow-hidden`,children:[e.jsx("div",{className:`px-3 py-1 ${o?"bg-amber-100":"bg-gray-100"} border-b ${o?"border-amber-200":"border-gray-200"}`,children:e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:s})}),e.jsx("div",{className:"px-3 py-1.5 space-y-0.5",children:l.map(n=>{const c=n.time&&n.time!=="-"?` - ${y(n.time)}`:"";return e.jsxs("p",{className:"font-medium text-gray-900 text-sm leading-snug",children:["• ",n.title,c]},n.id)})})]},s)})})()})]}),i.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(B,{className:"h-4 w-4 text-gray-600"}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase",children:"예정"})]}),e.jsx("div",{className:"space-y-2",children:(()=>{const r=i.reduce((s,l)=>{const o=f(new Date(l.start),"MM.dd",{locale:C}),n=l.project||"-",c=`${o}|${n}`;return s[c]||(s[c]={date:o,project:n,schedules:[]}),s[c].schedules.push(l),s},{});return Object.values(r).map(({date:s,project:l,schedules:o})=>{const c=o.length>0&&K(new Date(o[0].start))?`${s} (내일)`:s;return e.jsxs("div",{className:"border-l-3 border-gray-400 bg-gray-50 rounded-r overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-1 bg-gray-100 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:l}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:c})]}),e.jsx("div",{className:"px-3 py-1.5 space-y-0.5",children:o.map(g=>{const T=g.time&&g.time!=="-"?` - ${y(g.time)}`:"";return e.jsxs("p",{className:"font-medium text-gray-900 text-sm leading-snug",children:["• ",g.title,T]},g.id)})})]},`${s}-${l}`)})})()})]}),u===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"예정된 일정이 없습니다"})]},t)})})}),D&&e.jsx(E,{event:null,slotInfo:{start:new Date,end:new Date},onClose:()=>p(!1),onSave:async t=>{try{console.log("Dashboard: Adding schedule...",t),await S({id:Date.now().toString(),title:t.title||"",start:t.start||new Date,end:t.end||new Date,type:"other",project:t.projectId||t.projectName||"",location:"",attendees:t.assignedTo||[],description:t.description||"",time:t.time}),console.log("Dashboard: Schedule added successfully"),await h(),console.log("Dashboard: Schedules fetched, closing modal"),p(!1)}catch(a){console.error("Failed to add schedule:",a),alert("일정 추가에 실패했습니다: "+(a instanceof Error?a.message:"알 수 없는 오류"))}},onDelete:async t=>{try{await w(t),await h(),p(!1)}catch(a){console.error("Failed to delete schedule:",a),alert("일정 삭제에 실패했습니다: "+(a instanceof Error?a.message:"알 수 없는 오류"))}}})]})};export{J as default};
