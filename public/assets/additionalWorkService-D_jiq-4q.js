import{q as W,o as f,c as k,d as r,e as w,f as A,h as m,T as n,i as y,k as g,l as S,g as D,m as s,a as c}from"./index-BTqTyPvo.js";const d="additional_works",l=o=>{const t=o.data();return{_id:o.id,project:t.project||"",description:t.description||"",amount:t.amount||0,date:t.date instanceof n?t.date.toDate().toISOString().split("T")[0]:t.date||t.work_date||"",notes:t.notes||"",images:t.images||[],createdAt:t.createdAt instanceof n?t.createdAt.toDate().toISOString():t.createdAt||"",updatedAt:t.updatedAt instanceof n?t.updatedAt.toDate().toISOString():t.updatedAt||""}},a={getAllAdditionalWorks:async()=>{const o=W(k(r,d),f("createdAt","desc"));return(await D(o)).docs.map(l)},getAdditionalWorkById:async o=>{const t=A(r,d,o),e=await g(t);return e.exists()?l(e):null},createAdditionalWork:async o=>{const t=n.now(),e={project:o.project,description:o.description,amount:o.amount,date:o.date instanceof Date?n.fromDate(o.date):o.date,notes:o.notes||"",images:o.images||[],createdAt:t,updatedAt:t},i=await S(k(r,d),e),u=await g(i);return l(u)},updateAdditionalWork:async(o,t)=>{const e=A(r,d,o),i={updatedAt:n.now()};t.project!==void 0&&(i.project=t.project),t.description!==void 0&&(i.description=t.description),t.amount!==void 0&&(i.amount=t.amount),t.date!==void 0&&(i.date=t.date instanceof Date?n.fromDate(t.date):t.date),t.notes!==void 0&&(i.notes=t.notes),t.images!==void 0&&(i.images=t.images),await y(e,i);const u=await g(e);return l(u)},deleteAdditionalWork:async o=>{const t=A(r,d,o);await m(t)},subscribeToAdditionalWorks:o=>{const t=W(k(r,d),f("createdAt","desc"));return w(t,e=>{const i=e.docs.map(l);o(i)})}},p={getAllAdditionalWorks:async()=>(await c.get("/additional-works")).data,getAdditionalWorkById:async o=>(await c.get(`/additional-works/${o}`)).data,createAdditionalWork:async o=>{const t={project:o.project,description:o.description,amount:o.amount,work_date:o.date instanceof Date?o.date.toISOString().split("T")[0]:o.date,notes:o.notes||"",images:o.images||[]};return console.log("[additionalWorkService.createAdditionalWork] Sending to backend:",t),(await c.post("/additional-works",t)).data},updateAdditionalWork:async(o,t)=>{const e={};return t.project!==void 0&&(e.project=t.project),t.description!==void 0&&(e.description=t.description),t.amount!==void 0&&(e.amount=t.amount),t.date!==void 0&&(e.work_date=t.date instanceof Date?t.date.toISOString().split("T")[0]:t.date),t.notes!==void 0&&(e.notes=t.notes),console.log("[additionalWorkService.updateAdditionalWork] Sending to backend:",e),(await c.put(`/additional-works/${o}`,e)).data},deleteAdditionalWork:async o=>{await c.delete(`/additional-works/${o}`)}},j={getAllAdditionalWorks:async()=>s()?(console.log("[additionalWorkService] Using Firestore"),a.getAllAdditionalWorks()):(console.log("[additionalWorkService] Using Railway API"),p.getAllAdditionalWorks()),getAdditionalWorkById:async o=>{if(s()){const t=await a.getAdditionalWorkById(o);if(!t)throw new Error("Additional work not found");return t}return p.getAdditionalWorkById(o)},createAdditionalWork:async o=>s()?a.createAdditionalWork(o):p.createAdditionalWork(o),updateAdditionalWork:async(o,t)=>s()?a.updateAdditionalWork(o,t):p.updateAdditionalWork(o,t),deleteAdditionalWork:async o=>s()?a.deleteAdditionalWork(o):p.deleteAdditionalWork(o),subscribeToAdditionalWorks:a.subscribeToAdditionalWorks};export{j as a};
