import{j as e}from"./vendor-data-DG_4MGb7.js";import{N as it,r as x}from"./vendor-react-D-r2Cqeg.js";import{u as ct}from"./dataStore-D-kob-RA.js";import{u as dt,z as h,l as Y,p as mt}from"./index-Dgd7wCS1.js";import{u as gt}from"./useFilteredProjects-BNZe-7y5.js";import{s as ut,m as xt,g as ht}from"./imageStorage-DjLpiDnu.js";import{a as ee}from"./index-CSlX1tQB.js";import{p as S}from"./vendor-date-9Cl9d1sr.js";import{S as Te,q as Re,T as he,w as pt,X as q,U as ft,I as bt}from"./vendor-ui-DTwhhNuH.js";const It=()=>{const{payments:A,executionRecords:N,loadPaymentsFromAPI:pe,loadExecutionRecordsFromAPI:Fe,addExecutionRecordToAPI:qe,deleteExecutionRecordFromAPI:fe,updateExecutionRecordInAPI:M,updatePaymentInAPI:$e,deletePaymentFromAPI:Ve}=ct(),{user:y}=dt(),P=gt();if(!y)return e.jsx(it,{to:"/login",replace:!0});const[$,be]=x.useState(""),[m,I]=x.useState(null),[Oe,te]=x.useState(!1),[v,V]=x.useState(!1),[w,O]=x.useState(!1),[ze,z]=x.useState(!1),[_e,X]=x.useState(!1),[ye,Be]=x.useState(""),[L,_]=x.useState("list"),[se,je]=x.useState(!1),[Q,He]=x.useState(!1),[Ue,D]=x.useState(!1),B=x.useRef(null),[We,Ne]=x.useState(!1),[b,H]=x.useState(null),[C,U]=x.useState({process:"",itemName:"",materialCost:"",laborCost:"",date:""}),[ve,ae]=x.useState(null),[we,le]=x.useState([]),[re,oe]=x.useState(!1),[k,W]=x.useState({}),[Ce,ke]=x.useState(!1),[ne,Je]=x.useState(()=>{const t=localStorage.getItem("hiddenPaymentIds");return t?JSON.parse(t):[]}),Ye=()=>{const t=localStorage.getItem("lastSelectedProject"),s=P.filter(a=>a.status!=="completed");return t==="기타"?"기타":t&&s.some(a=>a.name===t)?t:s.length>0?s[0].name:""},[d,p]=x.useState({project:"",date:S(new Date,"yyyy-MM-dd"),process:"",itemName:"",materialCost:"",laborCost:"",images:[],quickText:"",quickImages:[]}),[ie,Se]=x.useState(!1),[G,Xe]=x.useState(()=>{const t=localStorage.getItem("executionMemos");return t?JSON.parse(t):{}}),[Qe,ce]=x.useState(null),[K,T]=x.useState(""),[Z,R]=x.useState("");x.useEffect(()=>{(async()=>{try{await Promise.all([pe(),Fe()]),console.log("[ExecutionHistory] 데이터 로드 완료")}catch(a){console.error("Failed to load data:",a)}})();const s=()=>{He(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),x.useEffect(()=>{if(P.length>0&&!d.project){const t=Ye();t&&(p(s=>({...s,project:t})),localStorage.setItem("lastSelectedProject",t))}},[P]),x.useEffect(()=>{(async()=>{try{await xt();const s=await ht();W(s),ke(!0)}catch(s){console.error("이미지 로드 실패:",s),ke(!0)}})()},[]);const Ae=x.useRef({});x.useEffect(()=>{Ce&&(Object.entries(k).forEach(([t,s])=>{JSON.stringify(Ae.current[t])!==JSON.stringify(s)&&ut(t,s).catch(a=>{console.error("이미지 저장 실패:",a),h.error("이미지 저장에 실패했습니다")})}),Ae.current={...k})},[k,Ce]),x.useEffect(()=>{localStorage.setItem("hiddenPaymentIds",JSON.stringify(ne))},[ne]),x.useEffect(()=>{localStorage.setItem("executionMemos",JSON.stringify(G))},[G]),x.useEffect(()=>{if(re&&d.itemName&&d.itemName.trim().length>=1){const t=d.itemName.trim().toLowerCase(),s=[...N].sort((l,r)=>new Date(r.date).getTime()-new Date(l.date).getTime()).map(l=>l.itemName).filter(l=>l&&l.toLowerCase().includes(t)),a=Array.from(new Set(s));le(a.slice(0,10))}else le([])},[d.itemName,N,re]),x.useEffect(()=>{const t=()=>{je(s=>!s)};return window.addEventListener("headerAddButtonClick",t),()=>window.removeEventListener("headerAddButtonClick",t)},[]),x.useEffect(()=>{window.dispatchEvent(new CustomEvent("mobileFormStateChange",{detail:{isOpen:se}}))},[se]);const de=x.useCallback(t=>{var l;const s=(l=t.clipboardData)==null?void 0:l.items;if(!s)return;const a=[];for(let r=0;r<s.length;r++)if(s[r].type.indexOf("image")!==-1){t.preventDefault();const o=s[r].getAsFile();o&&a.push(o)}a.length!==0&&Promise.all(a.map(r=>new Promise((o,n)=>{const u=new FileReader;u.onload=c=>{var g;const i=(g=c.target)==null?void 0:g.result;o(i)},u.onerror=n,u.readAsDataURL(r)}))).then(async r=>{if(!m){p(n=>({...n,quickImages:[...n.quickImages,...r]})),h.success(`${r.length}개의 이미지가 청구내역에 추가되었습니다`);return}const o=N.find(n=>n.id===m);if(o){const n=[...o.images||[],...r];try{await M(m,{images:n}),h.success(`${r.length}개의 이미지가 추가되었습니다`)}catch(u){console.error("이미지 저장 실패:",u),h.error("이미지 저장에 실패했습니다")}}else{const n=k[m]||[];W(u=>({...u,[m]:[...n,...r]})),h.success(`${r.length}개의 이미지가 추가되었습니다`)}}).catch(r=>{console.error("이미지 처리 중 오류:",r),h.error("이미지 추가 중 오류가 발생했습니다")})},[m,p,k,N,M]);x.useEffect(()=>(document.addEventListener("paste",de),()=>document.removeEventListener("paste",de)),[de]);const me=P.map(t=>t.name);console.log("[ExecutionHistory] payments 배열:",A.length,"개"),console.log("[ExecutionHistory] 이미지가 있는 payments:",A.filter(t=>t.images&&t.images.length>0).map(t=>{var s;return{id:t.id,imagesCount:(s=t.images)==null?void 0:s.length}})),console.log("[ExecutionHistory] paymentRecordImages 상태:",Object.keys(k).length,"개 레코드",Object.entries(k).slice(0,3).map(([t,s])=>({id:t,count:s==null?void 0:s.length})));const Ie=A.filter(t=>{const s=t.status==="approved"||t.status==="completed",a=!N.some(o=>o.paymentId===t.id),l=!ne.includes(t.id),r=(y==null?void 0:y.name)!=="안팀"||me.includes(t.project);return s&&a&&l&&r}).map(t=>{const s=t.materialAmount||0,a=t.laborAmount||0,l=t.amount||0;let r=s,o=a,n=0;return s===0&&a===0&&l>0?t.includesVAT?(r=Math.round(l/1.1),n=l-r):(r=l,n=0):t.includesVAT?(s>0&&(r=Math.round(s/1.1)),a>0&&(o=Math.round(a/1.1)),n=l-(r+o)):n=0,{id:t.id,type:"payment",project:t.project,author:t.requestedBy||"-",date:t.requestDate,process:t.process||"-",itemName:t.itemName||t.purpose||"-",materialCost:r,laborCost:o,vatAmount:n,totalAmount:l,images:t.images&&t.images.length>0?t.images:k[t.id]||[],notes:t.notes,quickText:t.quickText||""}}),De=Ie.filter(t=>t.images&&t.images.length>0);De.length>0&&console.log("[ExecutionHistory] 이미지가 있는 paymentRecords:",De.map(t=>({id:t.id,imagesCount:t.images.length})));const Ge=N.filter(t=>(y==null?void 0:y.name)!=="안팀"||me.includes(t.project)).map(t=>({...t,type:"manual"})),Ke=[...Ie,...Ge].sort((t,s)=>new Date(s.date).getTime()-new Date(t.date).getTime()),Ee=new Set,F=Ke.filter(t=>Ee.has(t.id)?(console.warn("[ExecutionHistory] 중복 ID 발견:",t.id,t.itemName),!1):(Ee.add(t.id),!0)),J=F.filter(t=>{var r,o;const s=(y==null?void 0:y.name)!=="안팀"||me.includes(t.project)&&t.project!=="기타",a=d.project===""||t.project===d.project,l=$===""||((r=t.itemName)==null?void 0:r.toLowerCase().includes($.toLowerCase()))||((o=t.process)==null?void 0:o.toLowerCase().includes($.toLowerCase()));return s&&a&&l}),j=J.reduce((t,s)=>(t.material+=s.materialCost||0,t.labor+=s.laborCost||0,t.vat+=s.vatAmount||0,t.total+=s.totalAmount||0,t),{material:0,labor:0,vat:0,total:0}),Ze=()=>{const t=d.quickText;if(!t.trim()){h.error("붙여넣기한 내용이 없습니다");return}const s=t.match(/[\d,]+/g),a=s?s.map(c=>parseInt(c.replace(/,/g,""),10)).filter(c=>c>0):[];let l="";for(const c of ee)if(t.includes(c)){l=c;break}const r=t.split(`
`).filter(c=>c.trim());let o="";if(r.length>0)for(const c of r){const i=c.trim();if(i&&!/^[\d,\s원]+$/.test(i)){o=i.substring(0,50);break}}let n="",u="";if(a.length>0){const c=[...a].sort((i,g)=>g-i);n=String(c[0]),c.length>1&&(u=String(c[1]))}p(c=>({...c,process:l||c.process,itemName:o||c.itemName,materialCost:n||c.materialCost,laborCost:u||c.laborCost,images:[...c.images,...c.quickImages],quickText:"",quickImages:[]})),h.success("자동 채우기 완료")},et=async()=>{if(ie)return;if(!d.project){h.error("프로젝트를 선택해주세요");return}Se(!0);const t=new Date;let s=Number(d.materialCost)||0,a=Number(d.laborCost)||0,l=0,r=0;if(v){const n=s+a,u=Math.round(n/1.1);if(l=n-u,n>0){const c=s/n,i=a/n;s=Math.round(u*c),a=Math.round(u*i)}r=n}else l=0,r=s+a;w&&(s=Math.round(s*.967),a=Math.round(a*.967),r=s+a);const o={id:`exec_${Date.now()}`,project:d.project,author:(y==null?void 0:y.name)||"알 수 없음",date:new Date(d.date),process:d.process,itemName:d.itemName,materialCost:s,laborCost:a,vatAmount:l,totalAmount:r,images:d.images,notes:"",includesTaxDeduction:w,includesVat:v,createdAt:t,updatedAt:t};try{const n=await qe(o);h.success("실행내역이 추가되었습니다"),p(u=>({project:u.project,date:S(new Date,"yyyy-MM-dd"),process:"",itemName:"",materialCost:"",laborCost:"",images:[],quickText:"",quickImages:[]})),V(!1),O(!1),Q&&(I(n.id),je(!1),_("list"))}catch(n){console.error("실행내역 저장 실패:",n),h.error("실행내역 저장에 실패했습니다")}finally{Se(!1)}},Me=(t,s)=>{s.stopPropagation(),ae(null);const a=t.type==="payment",l=a?A.find(c=>String(c.id)===String(t.id)):null;console.log("[handleEditClick] Record type:",t.type,"isPaymentType:",a),console.log("[handleEditClick] Original payment:",l),console.log("[handleEditClick] Record vatAmount:",t.vatAmount),console.log("[handleEditClick] record.includesVat:",t.includesVat,"type:",typeof t.includesVat),console.log("[handleEditClick] Full record:",JSON.stringify(t,null,2));let r=!1;a&&l?r=l.includesVAT===!0:!a&&t.includesVat===!0&&(r=!0);let o=t.materialCost||0,n=t.laborCost||0;const u=!a&&t.includesTaxDeduction===!0;if(a&&l){if(o=l.materialAmount||0,n=l.laborAmount||0,r){const c=l.amount||0,i=o+n;if(i>0){const g=o/i;o=Math.round(c*g),n=Math.round(c*(1-g))}}}else if(!a&&(u&&(o=Math.round((t.materialCost||0)/.967),n=Math.round((t.laborCost||0)/.967)),r)){const c=t.totalAmount||0,i=o+n;if(i>0){const g=o/i,f=n/i;o=Math.round(c*g),n=Math.round(c*f)}}console.log("[handleEditClick] VAT/Tax check:",{wasVatIncluded:r,wasTaxDeducted:u,includesVat:t.includesVat,includesTaxDeduction:t.includesTaxDeduction,displayMaterialCost:o,displayLaborCost:n,originalMaterialCost:t.materialCost,originalLaborCost:t.laborCost,totalAmount:t.totalAmount,vatAmount:t.vatAmount}),H(t),p(c=>({...c,project:t.project||c.project,date:S(new Date(t.date),"yyyy-MM-dd"),process:t.process||"",itemName:t.itemName,materialCost:o,laborCost:n,images:t.images||[],quickText:"",quickImages:[]})),V(r),O(u),I(t.id),Q&&_("form")},tt=()=>{H(null),p(t=>({...t,date:S(new Date,"yyyy-MM-dd"),process:"",itemName:"",materialCost:"",laborCost:"",images:[],quickText:"",quickImages:[]}))},Pe=async()=>{var t,s;if(console.log("[handleEditSave] Called, editingRecord:",b),!b){console.log("[handleEditSave] No editingRecord, returning");return}try{let a=Number(d.materialCost)||0,l=Number(d.laborCost)||0,r=0,o=a+l;if(v){const i=a+l,g=Math.round(i/1.1);if(r=i-g,i>0){const f=a/i,E=l/i;a=Math.round(g*f),l=Math.round(g*E)}o=i}w&&(a=Math.round(a*.967),l=Math.round(l*.967),o=a+l);let n=b.notes||"";d.quickText.trim()&&(n=n?`${n}
${d.quickText.trim()}`:d.quickText.trim());const c=[...b.images||[],...d.quickImages];if(console.log("[handleEditSave] editingRecord type:",b.type,"id:",b.id,"typeof id:",typeof b.id),b.type==="payment"){console.log("[handleEditSave] Processing as PAYMENT"),console.log("[handleEditSave] payments array IDs:",A.map(g=>({id:g.id,typeofId:typeof g.id})));const i=A.find(g=>String(g.id)===String(b.id));if(console.log("[handleEditSave] Found existingPayment:",i),!i){console.error("[handleEditSave] Payment not found! id:",b.id,"payments count:",A.length,"all payment ids:",A.map(g=>g.id)),h.error("결제요청을 찾을 수 없습니다. 페이지를 새로고침해주세요.");return}console.log("[handleEditSave] Calling updatePaymentInAPI..."),await $e(b.id,{...i,process:d.process,itemName:d.itemName,materialAmount:a,laborAmount:l,vatAmount:r,amount:o,includesVAT:v,requestDate:d.date}),console.log("[handleEditSave] updatePaymentInAPI completed")}else console.log("[handleEditSave] Updating execution record:",{id:b.id,materialCost:a,laborCost:l,vatAmount:r,totalAmount:o,includeVat:v,includeTaxDeduction:w,date:d.date}),await M(b.id,{project:d.project||b.project,author:b.author,process:d.process,itemName:d.itemName,materialCost:a,laborCost:l,vatAmount:r,totalAmount:o,date:new Date(d.date),notes:n,images:c,paymentId:b.paymentId,includesTaxDeduction:w,includesVat:v});console.log("[handleEditSave] SUCCESS! Showing toast and resetting state..."),h.success("수정되었습니다"),H(null),I(null),V(!1),O(!1),p(i=>({...i,date:S(new Date,"yyyy-MM-dd"),process:"",itemName:"",materialCost:"",laborCost:"",images:[],quickText:"",quickImages:[]}))}catch(a){console.error("수정 실패:",a);const l=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"수정에 실패했습니다";h.error(l)}},Le=async(t,s)=>{s.stopPropagation(),ae(null);const a=F.find(l=>l.id===t);if(confirm("정말 삭제하시겠습니까?"))try{(a==null?void 0:a.type)==="payment"?(await Ve(t),h.success("결제요청이 삭제되었습니다")):(await fe(t),h.success("실행내역이 삭제되었습니다")),m===t&&I(null)}catch(l){console.error("삭제 실패:",l),h.error("삭제에 실패했습니다")}},ge=()=>{const t={};return J.forEach(s=>{const a=s.process||"기타";t[a]||(t[a]={materialCost:0,laborCost:0,vatAmount:0,totalAmount:0}),t[a].materialCost+=s.materialCost||0,t[a].laborCost+=s.laborCost||0,t[a].vatAmount+=s.vatAmount||0,t[a].totalAmount+=s.totalAmount||0}),Object.entries(t).sort((s,a)=>a[1].totalAmount-s[1].totalAmount)},st=t=>{var s;try{if(!m){h.error("먼저 실행내역을 선택해주세요");return}const a=Array.from(((s=t.target)==null?void 0:s.files)||[]);if(a.length===0)return;const l=a.filter(o=>o.type.startsWith("image/"));if(l.length===0){h.error("이미지 파일만 선택해주세요");return}l.filter(o=>o.size>10*1024*1024).length>0&&h.error("10MB 이상의 이미지는 처리가 오래 걸릴 수 있습니다"),Promise.all(l.map(o=>new Promise((n,u)=>{try{const c=new FileReader;c.onload=i=>{var f;const g=(f=i.target)==null?void 0:f.result;g?n(g):u(new Error("이미지 읽기 실패"))},c.onerror=()=>u(new Error("FileReader 오류")),c.readAsDataURL(o)}catch(c){u(c)}}))).then(async o=>{const n=N.find(u=>u.id===m);if(n){const c=[...n.images||[],...o];try{await M(m,{images:c}),h.success(`${o.length}개의 이미지가 추가되었습니다`)}catch(i){console.error("이미지 저장 실패:",i),h.error("이미지 저장에 실패했습니다")}}else{const u=k[m]||[];W(c=>({...c,[m]:[...u,...o]})),h.success(`${o.length}개의 이미지가 추가되었습니다`)}}).catch(o=>{console.error("이미지 처리 중 오류:",o),h.error("이미지 추가 중 오류가 발생했습니다")}),t.target.value=""}catch(a){console.error("파일 선택 처리 중 오류:",a),h.error("파일 선택 중 오류가 발생했습니다")}},at=async t=>{var a;if(!m)return;const s=N.find(l=>l.id===m);if(s){const l=((a=s.images)==null?void 0:a.filter((r,o)=>o!==t))||[];try{await M(m,{images:l})}catch(r){console.error("이미지 삭제 실패:",r)}}else W(l=>{var r;return{...l,[m]:((r=l[m])==null?void 0:r.filter((o,n)=>n!==t))||[]}})},lt=t=>{Be(t),X(!0)},rt=t=>{t.preventDefault(),te(!0)},ot=t=>{t.preventDefault(),te(!1)},nt=t=>{if(t.preventDefault(),te(!1),!m){h.error("먼저 실행내역을 선택해주세요");return}const a=Array.from(t.dataTransfer.files).filter(l=>l.type.startsWith("image/"));a.length!==0&&Promise.all(a.map(l=>new Promise((r,o)=>{const n=new FileReader;n.onload=u=>{var i;const c=(i=u.target)==null?void 0:i.result;r(c)},n.onerror=o,n.readAsDataURL(l)}))).then(async l=>{const r=N.find(o=>o.id===m);if(r){const o=[...r.images||[],...l];try{await M(m,{images:o})}catch(n){console.error("이미지 저장 실패:",n)}}else W(o=>({...o,[m]:[...o[m]||[],...l]}));h.success(`${l.length}개의 이미지가 추가되었습니다`)}).catch(l=>{console.error("이미지 처리 중 오류:",l),h.error("이미지 추가 중 오류가 발생했습니다")})};return e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsx("div",{className:"md:hidden mb-4",children:e.jsxs("select",{value:d.project,onChange:t=>{p({...d,project:t.target.value}),t.target.value&&localStorage.setItem("lastSelectedProject",t.target.value)},className:"w-full px-3 py-2.5 md:py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-10",children:[P.filter(t=>t.status!=="completed").map(t=>e.jsx("option",{value:t.name,children:t.name},t.id)),(y==null?void 0:y.name)!=="안팀"&&e.jsx("option",{value:"기타",children:"기타"})]})}),e.jsx("div",{className:"md:hidden border-b border-gray-200 mb-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("nav",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>_("list"),className:`py-2 px-1 border-b-2 font-medium text-sm ${L==="list"?"border-gray-900 text-gray-900":"border-transparent text-gray-500"}`,children:"내역"}),e.jsx("button",{onClick:()=>_("image"),className:`py-2 px-1 border-b-2 font-medium text-sm ${L==="image"?"border-gray-900 text-gray-900":"border-transparent text-gray-500"}`,children:"이미지"})]})})}),e.jsxs("div",{className:"execution-container grid grid-cols-1 md:grid-cols-6 ipad:grid-cols-6 ipad-lg:grid-cols-6 ipad-xl:grid-cols-12 ipad-2xl:grid-cols-12 gap-3 md:gap-4 md:h-[calc(100vh-120px)]",children:[e.jsx("div",{className:`execution-form md:col-span-2 ipad:col-span-2 ipad-lg:col-span-2 ipad-xl:col-span-2 ipad-2xl:col-span-2 bg-white rounded-lg border p-3 md:p-4 overflow-y-auto ${se?"":"hidden md:block"}`,children:e.jsxs("div",{className:"execution-form-inner space-y-4 w-full",children:[e.jsx("div",{className:"exec-project",children:e.jsxs("select",{value:d.project,onChange:t=>{p({...d,project:t.target.value}),t.target.value&&localStorage.setItem("lastSelectedProject",t.target.value)},className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white cursor-pointer hover:border-gray-400 transition-colors appearance-none bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%236b7280%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22M6%208l4%204%204-4%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.5em_1.5em] bg-[right_0.5rem_center] bg-no-repeat pr-10",children:[P.filter(t=>t.status!=="completed").map(t=>e.jsx("option",{value:t.name,children:t.name},t.id)),(y==null?void 0:y.name)!=="안팀"&&e.jsx("option",{value:"기타",children:"기타"})]})}),e.jsxs("div",{className:"exec-quick-input",children:[e.jsx("textarea",{value:d.quickText,onChange:t=>p({...d,quickText:t.target.value}),onPaste:t=>{var a;const s=(a=t.clipboardData)==null?void 0:a.items;if(s){for(let l=0;l<s.length;l++)if(s[l].type.indexOf("image")!==-1){t.preventDefault();const r=s[l].getAsFile();if(r){const o=new FileReader;o.onload=n=>{var c;const u=(c=n.target)==null?void 0:c.result;p(i=>({...i,quickImages:[...i.quickImages,u]}))},o.readAsDataURL(r)}break}}},onDragOver:t=>{t.preventDefault(),t.stopPropagation()},onDrop:t=>{t.preventDefault(),t.stopPropagation(),Array.from(t.dataTransfer.files).filter(l=>l.type.startsWith("image/")).forEach(l=>{const r=new FileReader;r.onload=o=>{var u;const n=(u=o.target)==null?void 0:u.result;p(c=>({...c,quickImages:[...c.quickImages,n]}))},r.readAsDataURL(l)})},rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:Q?"청구 내역 붙여넣기":"청구 내역 붙여넣기 (이미지 드래그 또는 Ctrl+V)"}),d.quickImages.length>0&&e.jsx("div",{className:"mt-2 mb-2 grid grid-cols-3 gap-2",children:d.quickImages.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`이미지 ${s+1}`,className:"w-full h-20 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>{p(a=>({...a,quickImages:a.quickImages.filter((l,r)=>r!==s)}))},className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:"×"})]},s))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{Array.from(t.target.files||[]).forEach(a=>{const l=new FileReader;l.onload=r=>{var n;const o=(n=r.target)==null?void 0:n.result;p(u=>({...u,quickImages:[...u.quickImages,o]}))},l.readAsDataURL(a)}),t.target.value=""}}),e.jsx("div",{className:"w-full h-10 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium border border-gray-300",children:"이미지 첨부"})]}),e.jsx("button",{type:"button",onClick:Ze,className:"h-10 flex items-center justify-center bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors text-sm font-medium",children:"자동 채우기"})]})]}),e.jsxs("div",{className:"exec-date-process grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["날짜 ",d.date&&`(${S(new Date(d.date),"E",{locale:Y})})`]}),e.jsx("input",{type:"date",value:d.date,onChange:t=>p({...d,date:t.target.value}),className:"w-full px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 cursor-pointer text-gray-900",style:{WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundColor:"white",backgroundImage:"none"}})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"공정"}),e.jsx("button",{ref:B,type:"button",onClick:()=>D(!0),className:"w-full px-3 py-2 border rounded-lg text-left bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",children:d.process||e.jsx("span",{className:"text-gray-400",children:"선택하세요"})})]})]}),e.jsxs("div",{className:"exec-item-name relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"항목명"}),e.jsx("input",{type:"text",value:d.itemName,onChange:t=>p({...d,itemName:t.target.value}),onFocus:()=>oe(!0),onBlur:()=>{setTimeout(()=>oe(!1),200)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"}),re&&we.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:we.map((t,s)=>e.jsx("button",{type:"button",onClick:()=>{p({...d,itemName:t}),le([]),oe(!1)},className:"w-full px-3 py-2 text-left hover:bg-gray-50 text-sm",children:e.jsx("div",{className:"font-medium text-gray-900",children:t})},s))})]}),e.jsxs("div",{className:"exec-amounts space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"자재비"}),e.jsx("input",{type:"number",value:d.materialCost,onChange:t=>p({...d,materialCost:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인건비"}),e.jsx("input",{type:"number",value:d.laborCost,onChange:t=>p({...d,laborCost:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{type:"button",className:"flex items-center cursor-pointer",onMouseDown:t=>t.preventDefault(),onClick:()=>{v||O(!1),V(!v)},children:[e.jsx("div",{className:`h-4 w-4 border rounded flex items-center justify-center ${v?"bg-gray-600 border-gray-600":"border-gray-300"}`,children:v&&e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"부가세 포함 (10%)"})]}),e.jsxs("button",{type:"button",className:"flex items-center cursor-pointer",onMouseDown:t=>t.preventDefault(),onClick:()=>{w||V(!1),O(!w)},children:[e.jsx("div",{className:`h-4 w-4 border rounded flex items-center justify-center ${w?"bg-gray-600 border-gray-600":"border-gray-300"}`,children:w&&e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"3.3% 세금공제"})]})]})]}),e.jsxs("div",{className:"exec-total-submit",children:[e.jsx("div",{className:"exec-total pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("span",{className:"font-medium",children:"총액"}),e.jsxs("div",{className:"text-right",children:[(v||w)&&e.jsxs("span",{className:"text-xs text-gray-500 mr-2",children:["(",v&&"부가세 포함",w&&"3.3% 세금공제",")"]}),e.jsxs("span",{className:"font-semibold",children:[(()=>{const t=(Number(d.materialCost)||0)+(Number(d.laborCost)||0);return(w?Math.round(t*.967):t).toLocaleString()})(),"원"]})]})]})}),b&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 mb-3",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium",children:["수정 중: ",b.itemName]})}),e.jsx("div",{className:"exec-submit my-6",style:{marginTop:"20px"},children:b?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:tt,className:"flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"취소"}),e.jsx("button",{onClick:Pe,className:"flex-1 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800",children:"수정 완료"})]}):e.jsx("button",{onClick:et,disabled:ie,className:"w-full py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50",children:ie?"저장 중...":"내역추가"})})]}),e.jsxs("div",{className:"exec-summary hidden md:block bg-gray-50 rounded-lg p-3 md:p-4 space-y-2 md:mt-8 lg:mt-[114.67px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"자재비 총합:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[j.material.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"인건비 총합:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[j.labor.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"부가세 총합:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[j.vat.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",style:{marginTop:"10px"},children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:"총 합계:"}),e.jsxs("span",{className:"text-base font-bold text-gray-900",children:[j.total.toLocaleString(),"원"]})]})]}),e.jsxs("div",{className:"exec-search hidden ipad-xl:block mt-4 space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"검색...",value:$,onChange:t=>be(t.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm"}),e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsx("button",{onClick:()=>z(!0),className:"w-full px-3 py-2 text-sm border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 font-medium",children:"공정별 합계"})]})]})}),e.jsxs("div",{className:`execution-list md:col-span-4 ipad:col-span-4 ipad-lg:col-span-4 ipad-xl:col-span-6 ipad-2xl:col-span-6 bg-white rounded-lg border overflow-hidden flex flex-col ${L!=="list"?"hidden md:flex":""}`,children:[L==="list"&&e.jsxs("div",{className:"md:hidden border-b bg-gray-50 p-2 space-y-2",children:[e.jsxs("div",{className:"bg-white rounded-lg px-3 py-2 border text-xs",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsxs("span",{className:"text-gray-500",children:["자재비 ",e.jsx("span",{className:"font-medium text-gray-900",children:j.material.toLocaleString()})]}),e.jsxs("span",{className:"text-gray-500",children:["인건비 ",e.jsx("span",{className:"font-medium text-gray-900",children:j.labor.toLocaleString()})]}),e.jsxs("span",{className:"text-gray-500",children:["부가세 ",e.jsx("span",{className:"font-medium text-gray-900",children:j.vat.toLocaleString()})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1 pt-1 border-t border-gray-100",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"총 합계"}),e.jsxs("span",{className:"font-bold text-gray-900",children:[j.total.toLocaleString(),"원"]})]})]}),e.jsx("button",{onClick:()=>z(!0),className:"w-full py-1.5 text-sm border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:"공정별 합계"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:J.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"hidden md:table w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 exec-table-header",children:e.jsxs("tr",{className:"text-left text-sm text-gray-700 border-b",children:[e.jsx("th",{className:"px-3 py-3 font-medium exec-th-author",children:"작성자"}),e.jsx("th",{className:"px-3 py-3 font-medium exec-th-date",children:"날짜"}),e.jsx("th",{className:"px-3 py-3 font-medium exec-th-process",children:"공정"}),e.jsx("th",{className:"px-3 py-3 font-medium exec-th-item",children:"항목명"}),e.jsx("th",{className:"px-3 py-3 font-medium text-right exec-th-material",children:"자재비"}),e.jsx("th",{className:"px-3 py-3 font-medium text-right exec-th-labor",children:"인건비"}),e.jsx("th",{className:"px-3 py-3 font-medium text-right exec-th-vat",children:"부가세"}),e.jsx("th",{className:"px-3 py-3 font-medium text-right exec-th-total",children:"총액"}),e.jsx("th",{className:"px-2 py-3 w-20"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:J.map(t=>e.jsxs("tr",{className:`group hover:bg-gray-50 cursor-pointer text-sm ${m===t.id?"bg-blue-50":""}`,onClick:()=>I(t.id),children:[e.jsx("td",{className:"px-3 py-3 text-gray-600 whitespace-nowrap exec-author-col",children:t.author||"-"}),e.jsxs("td",{className:"px-3 py-3 text-gray-600 exec-date-col",children:[e.jsx("span",{className:"exec-date-full",children:S(new Date(t.date),"yyyy-MM-dd (EEE)",{locale:Y})}),e.jsx("span",{className:"exec-date-short whitespace-nowrap",children:S(new Date(t.date),"MM-dd (EEE)",{locale:Y})})]}),e.jsx("td",{className:"px-3 py-3 text-gray-600 exec-process-col",children:t.process||"-"}),e.jsx("td",{className:"px-3 py-3 font-medium exec-item-col",children:t.itemName}),e.jsx("td",{className:"px-3 py-3 text-right exec-material-col",children:(t.materialCost||0).toLocaleString()}),e.jsx("td",{className:"px-3 py-3 text-right exec-labor-col",children:(t.laborCost||0).toLocaleString()}),e.jsx("td",{className:"px-3 py-3 text-right exec-vat-col",children:(t.vatAmount||0).toLocaleString()}),e.jsxs("td",{className:"px-3 py-3 text-right font-semibold exec-total-col",children:[e.jsxs("span",{className:"exec-total-full",children:[(t.totalAmount||0).toLocaleString(),"원"]}),e.jsx("span",{className:"exec-total-short",children:(t.totalAmount||0).toLocaleString()})]}),e.jsx("td",{className:"px-2 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s=>Me(t,s),className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",title:"수정",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:s=>Le(t.id,s),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",title:"삭제",children:e.jsx(he,{className:"w-4 h-4"})})]})})]},t.id))})]}),e.jsx("div",{className:"md:hidden space-y-1.5 p-2",children:J.map(t=>e.jsxs("div",{className:`border rounded-lg px-3 py-2 relative ${m===t.id?"bg-blue-50 border-blue-300":"bg-white"}`,onClick:()=>{I(t.id),_("image")},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate flex-1 mr-2",children:t.itemName}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-900 shrink-0",children:[(t.totalAmount||0).toLocaleString(),"원"]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),ae(ve===t.id?null:t.id)},className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(pt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1 text-xs text-gray-500",children:[e.jsxs("span",{children:[t.process||"-"," · ",t.author||"-"," · ",S(new Date(t.date),"MM.dd",{locale:Y})]}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["자재비 ",(t.materialCost||0).toLocaleString()," · 인건비 ",(t.laborCost||0).toLocaleString()," · 부가세 ",(t.vatAmount||0).toLocaleString()]})]}),ve===t.id&&e.jsxs("div",{className:"absolute right-2 top-8 bg-white border rounded-lg shadow-lg z-10 py-1",children:[e.jsxs("button",{onClick:s=>Me(t,s),className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"수정"]}),e.jsxs("button",{onClick:s=>Le(t.id,s),className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"삭제"]})]})]},t.id))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"실행내역이 없습니다"})}),e.jsx("div",{className:"hidden md:block ipad-xl:hidden border-t bg-gray-50 p-3",children:e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[e.jsx("div",{className:"flex-1 max-w-sm",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"검색...",value:$,onChange:t=>be(t.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm md:text-sm lg:text-base"}),e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[m&&e.jsx("button",{onClick:async()=>{const t=N.find(a=>a.id===m),s=F.find(a=>a.id===m);if(t){if(confirm("선택한 실행내역을 삭제하시겠습니까?"))try{await fe(m),I(null),h.success("실행내역이 삭제되었습니다")}catch(a){console.error("실행내역 삭제 실패:",a),h.error("실행내역 삭제에 실패했습니다")}}else(s==null?void 0:s.type)==="payment"?confirm(`이 결제요청을 실행내역에서 숨기시겠습니까?
(결제요청 자체는 삭제되지 않습니다)`)&&(Je(a=>[...a,m]),I(null),h.success("결제요청이 실행내역에서 숨겨졌습니다")):h.error("삭제할 수 없는 항목입니다")},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"삭제",children:e.jsx(he,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>z(!0),className:"px-3 py-2 text-sm md:px-3 lg:px-4 lg:text-base border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 font-medium whitespace-nowrap",children:"공정별 합계"})]})]})})]}),e.jsxs("div",{className:`execution-images md:col-span-6 ipad:col-span-6 ipad-lg:col-span-6 ipad-xl:col-span-4 ipad-2xl:col-span-4 bg-white rounded-lg border flex flex-col overflow-hidden ${L!=="image"?"hidden md:flex":""}`,onDragOver:rt,onDragLeave:ot,onDrop:nt,children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:st,className:"hidden",id:"image-file-input"}),Q&&m&&L==="image"&&(()=>{const t=F.find(s=>s.id===m);return t?e.jsx("div",{className:"border-b bg-gray-50 p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:t.itemName}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[t.process||"-"," • ",S(new Date(t.date),"yyyy.MM.dd",{locale:Y})]})]}),e.jsxs("p",{className:"text-sm font-bold text-gray-900",children:["₩",(t.totalAmount||0).toLocaleString()]})]})}):null})(),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 relative",onClick:t=>{var a;const s=t.target;!s.closest("img")&&!s.closest("button")&&!s.closest("textarea")&&!s.closest("input")&&!s.closest("label")&&m&&(()=>{const r=N.find(n=>n.id===m),o=F.find(n=>n.id===m);return(o==null?void 0:o.images)||(r==null?void 0:r.images)||[]})().length>0&&((a=document.getElementById("image-file-input"))==null||a.click())},children:m?(()=>{var r,o,n,u,c;const t=N.find(i=>i.id===m),s=F.find(i=>i.id===m),a=(s==null?void 0:s.images)||(t==null?void 0:t.images)||[],l=A.find(i=>i.id===m);return console.log("[ExecutionHistory] 선택된 레코드:",{selectedRecord:m,fullRecordExists:!!s,fullRecordType:s==null?void 0:s.type,fullRecordImages:((r=s==null?void 0:s.images)==null?void 0:r.length)||0,recordExists:!!t,recordImages:((o=t==null?void 0:t.images)==null?void 0:o.length)||0,originalPaymentExists:!!l,originalPaymentImages:((n=l==null?void 0:l.images)==null?void 0:n.length)||0,paymentRecordImagesForId:((u=k[m])==null?void 0:u.length)||0,finalImagesCount:a.length}),e.jsxs("div",{className:"h-full flex flex-col",children:[(s==null?void 0:s.type)==="payment"&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:"결제요청 금액:"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["총 ",(c=s.totalAmount)==null?void 0:c.toLocaleString(),"원",s.itemName&&` (${s.itemName})`]}),Qe===m?e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-900 mb-1",children:"자재비"}),e.jsx("input",{type:"text",inputMode:"numeric",value:K===""?"":K.toLocaleString(),onChange:i=>{const g=i.target.value.replace(/,/g,"").replace(/[^0-9]/g,""),f=g===""?"":parseInt(g,10);T(f);const E=s.totalAmount||0;R(f!==""?Math.max(0,E-f):"")},placeholder:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-900 mb-1",children:"인건비"}),e.jsx("input",{type:"text",inputMode:"numeric",value:Z===""?"":Z.toLocaleString(),onChange:i=>{const g=i.target.value.replace(/,/g,"").replace(/[^0-9]/g,""),f=g===""?"":parseInt(g,10);R(f);const E=s.totalAmount||0;T(f!==""?Math.max(0,E-f):"")},placeholder:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-400 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{const i=K===""?0:K,g=Z===""?0:Z;try{await mt.updatePaymentAmounts(s.id,i,g),await pe(),ce(null),T(""),R(""),h.success("금액이 적용되었습니다.")}catch(f){console.error("금액 적용 실패:",f),h.error("금액 적용에 실패했습니다.")}},className:"flex-1 px-3 py-2 text-sm font-medium text-white bg-gray-700 rounded-lg hover:bg-gray-800 transition-colors",children:"입력 적용"}),e.jsx("button",{onClick:()=>{ce(null),T(""),R("")},className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"취소"})]})]}):e.jsx("button",{onClick:()=>{const i=s.totalAmount||0,g=s.quickText||s.itemName||"",f=g.includes("자재")||g.includes("재료"),E=g.includes("인건")||g.includes("노무")||g.includes("인건비");let ue=.7,xe=.3;f&&!E?(ue=1,xe=0):!f&&E&&(ue=0,xe=1),T(Math.round(i*ue)),R(Math.round(i*xe)),ce(m)},className:"w-full px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"금액 분할"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"메모"}),e.jsx("textarea",{value:G[m]!==void 0?G[m]:(s==null?void 0:s.quickText)||(s==null?void 0:s.notes)||"",onChange:i=>{Xe(g=>({...g,[m]:i.target.value}))},placeholder:"메모를 입력하세요...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-gray-500 focus:border-transparent resize-none",rows:12})]}),a.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mb-3",children:a.map((i,g)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:i,alt:`증빙 ${g+1}`,className:"w-full aspect-square object-contain rounded-lg cursor-pointer hover:opacity-90 transition-opacity border bg-gray-100",onClick:f=>{f.stopPropagation(),lt(i)}}),e.jsx("button",{onClick:f=>{f.stopPropagation(),at(g)},className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity",children:e.jsx(q,{className:"h-3 w-3"})}),e.jsxs("div",{className:"absolute bottom-1 left-1 bg-black bg-opacity-50 text-white text-xs px-1.5 py-0.5 rounded",children:[g+1,"/",a.length]})]},g))}),e.jsx("label",{htmlFor:"image-file-input",className:`block cursor-pointer ${a.length>0?"":"flex-1"}`,onClick:i=>i.stopPropagation(),children:e.jsxs("div",{className:`w-full border-2 border-dashed rounded-lg p-4 text-center transition-colors flex flex-col items-center justify-center ${Oe?"border-gray-500 bg-gray-50":"border-gray-300 hover:border-gray-400"} ${a.length>0?"min-h-[80px]":"min-h-[200px]"}`,children:[e.jsx(ft,{className:`mx-auto text-gray-400 mb-1 ${a.length>0?"h-6 w-6":"h-10 w-10 mb-2"}`}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:a.length>0?"이미지 첨부":"클릭하여 선택"}),a.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"또는 이미지를 드래그하거나 Ctrl+V로 붙여넣기"})]})})]})})():e.jsx("div",{className:"h-full flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(bt,{className:"h-12 w-12 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"실행내역을 선택하세요"})]})})})]})]}),ze&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center bg-black bg-opacity-50",onClick:t=>{window.innerWidth>=768&&t.target===t.currentTarget&&z(!1)},children:e.jsxs("div",{className:"bg-white rounded-t-2xl md:rounded-lg w-full md:max-w-4xl max-h-[85vh] md:max-h-[80vh] overflow-hidden md:m-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-5 lg:p-6 border-b",children:[e.jsx("h2",{className:"text-lg md:text-lg lg:text-xl font-bold text-gray-900",children:"공정별 합계"}),e.jsx("button",{onClick:()=>z(!1),className:"p-1.5 md:p-2 hover:bg-gray-100 rounded-full",children:e.jsx(q,{className:"h-5 w-5 text-gray-500"})})]}),e.jsx("div",{className:"p-4 md:p-5 lg:p-6 overflow-y-auto max-h-[calc(85vh-120px)] md:max-h-[calc(80vh-120px)]",children:ge().length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"hidden md:table w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{className:"text-left text-sm text-gray-700",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"공정"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"자재비"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"인건비"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"부가세"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"총액"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:ge().map(([t,s])=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-700",children:t}),e.jsx("td",{className:"px-4 py-3 text-right",children:s.materialCost.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:s.laborCost.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:s.vatAmount.toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:[s.totalAmount.toLocaleString(),"원"]})]},t))}),e.jsx("tfoot",{className:"bg-gray-100 border-t-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-bold text-gray-700",children:"총합계"}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:j.material.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:j.labor.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:j.vat.toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-gray-900",children:[j.total.toLocaleString(),"원"]})]})})]}),e.jsxs("div",{className:"md:hidden space-y-3",children:[ge().map(([t,s])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["₩",s.totalAmount.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"자재비"}),e.jsxs("p",{className:"font-medium",children:["₩",s.materialCost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"인건비"}),e.jsxs("p",{className:"font-medium",children:["₩",s.laborCost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-xs",children:"부가세"}),e.jsxs("p",{className:"font-medium",children:["₩",s.vatAmount.toLocaleString()]})]})]})]},t)),e.jsxs("div",{className:"bg-gray-900 text-white rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-bold text-white",children:"총합계"}),e.jsxs("span",{className:"text-xl font-bold",children:["₩",j.total.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-xs",children:"자재비"}),e.jsxs("p",{className:"font-semibold",children:["₩",j.material.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-xs",children:"인건비"}),e.jsxs("p",{className:"font-semibold",children:["₩",j.labor.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-xs",children:"부가세"}),e.jsxs("p",{className:"font-semibold",children:["₩",j.vat.toLocaleString()]})]})]})]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"표시할 데이터가 없습니다."})})]})}),Ue&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900",children:"공정 선택"}),e.jsx("button",{onClick:()=>D(!1),className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(q,{className:"h-4 w-4 text-gray-500"})})]}),e.jsxs("div",{className:"p-3 overflow-y-auto max-h-[calc(80vh-100px)]",children:[e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:ee.map(t=>e.jsx("button",{onClick:()=>{p({...d,process:t}),D(!1)},className:`p-2 text-sm text-center border rounded-lg transition-all ${d.process===t?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,children:t},t))}),e.jsx("button",{onClick:()=>{p({...d,process:""}),D(!1)},className:"w-full p-2 text-sm text-center border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 text-gray-500",children:"선택 안함"})]})]})}),e.jsx("div",{className:"hidden md:block fixed inset-0 z-40",onClick:()=>D(!1),children:e.jsxs("div",{onClick:t=>t.stopPropagation(),className:"absolute bg-white rounded-lg shadow-xl border border-gray-200",style:{top:B.current?`${B.current.getBoundingClientRect().bottom+window.scrollY+4}px`:"50%",left:B.current?`${B.current.getBoundingClientRect().left+window.scrollX}px`:"50%"},children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-900",children:"공정 선택"}),e.jsx("button",{onClick:()=>D(!1),className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(q,{className:"h-3 w-3 text-gray-500"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-4 gap-1.5 mb-2",children:ee.map(t=>e.jsx("button",{onClick:()=>{p({...d,process:t}),D(!1)},className:`p-1.5 text-xs text-center border rounded-lg transition-all whitespace-nowrap ${d.process===t?"bg-gray-900 text-white border-gray-900":"bg-white text-gray-700 border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,children:t},t))}),e.jsx("button",{onClick:()=>{p({...d,process:""}),D(!1)},className:"w-full p-1.5 text-xs text-center border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 text-gray-500",children:"선택 안함"})]})]})})]}),_e&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",onClick:()=>X(!1),children:e.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh]",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),X(!1)},className:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors",children:e.jsx(q,{className:"h-8 w-8"})}),ye?e.jsx("img",{src:ye,alt:"원본 이미지",className:"max-w-full max-h-[90vh] object-contain",onClick:t=>t.stopPropagation(),onError:()=>{h.error("이미지를 불러올 수 없습니다"),X(!1)}}):e.jsx("div",{className:"text-white text-center p-4",children:e.jsx("p",{children:"이미지를 불러올 수 없습니다"})})]})}),We&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"실행내역 수정"}),e.jsx("button",{onClick:()=>{Ne(!1),H(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"날짜"}),e.jsx("input",{type:"date",value:C.date,onChange:t=>U({...C,date:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"공정"}),e.jsxs("select",{value:C.process,onChange:t=>U({...C,process:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"선택"}),ee.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"항목명"}),e.jsx("input",{type:"text",value:C.itemName,onChange:t=>U({...C,itemName:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"자재비"}),e.jsx("input",{type:"number",value:C.materialCost,onChange:t=>U({...C,materialCost:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인건비"}),e.jsx("input",{type:"number",value:C.laborCost,onChange:t=>U({...C,laborCost:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t",children:[e.jsx("button",{onClick:()=>{Ne(!1),H(null)},className:"flex-1 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"취소"}),e.jsx("button",{onClick:Pe,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"저장"})]})]})})]})};export{It as default};
