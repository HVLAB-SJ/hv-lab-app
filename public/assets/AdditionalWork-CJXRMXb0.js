import{j as e}from"./vendor-data-DG_4MGb7.js";import{r}from"./vendor-react-D-r2Cqeg.js";import{u as ve}from"./index.esm-D9ojv-r8.js";import{u as he}from"./useFilteredProjects-4XYld7On.js";import{u as fe,z as f,l as we}from"./index-HUdyR-Tx.js";import{X as Q,I as Y,U as ee,T as te,o as ge,p as ue,n as pe}from"./vendor-ui-DTwhhNuH.js";import{a as X}from"./additionalWorkService-Z579z7GD.js";import{u as Se}from"./dataStore-ByVzUXWH.js";import{p as K}from"./vendor-date-9Cl9d1sr.js";const Ce=({work:d,onClose:b,onSave:z,initialProject:P})=>{const{register:D,handleSubmit:V,setValue:j,formState:{errors:N}}=ve(),{user:v}=fe(),x=he(),[q,S]=r.useState(!1),[O,E]=r.useState([]),[H,I]=r.useState([]),[L,$]=r.useState(!1);r.useEffect(()=>{if(d)j("project",d.project),j("description",d.description),j("amount",d.amount),j("date",d.date.toISOString().split("T")[0]),j("notes",d.notes||""),I(d.images||[]),E(d.images||[]);else{const o=new Date().toISOString().split("T")[0];j("date",o),I([]),E([]),(v==null?void 0:v.name)==="안팀"&&x.length>0?j("project",x[0].name):P&&j("project",P)}},[d,j,P,v,x]);const U=r.useCallback(o=>{var g;const i=(g=o.clipboardData)==null?void 0:g.items;if(i){for(let m=0;m<i.length;m++)if(i[m].type.indexOf("image")!==-1){o.preventDefault();const w=i[m].getAsFile();if(w){const k=new FileReader;k.onload=F=>{var c;const u=(c=F.target)==null?void 0:c.result;E(p=>[...p,u]),I(p=>[...p,u]),f.success("이미지가 추가되었습니다")},k.readAsDataURL(w)}}}},[]);r.useEffect(()=>(document.addEventListener("paste",U),()=>document.removeEventListener("paste",U)),[U]);const C=o=>{o.preventDefault(),S(!0)},W=o=>{o.preventDefault(),S(!1)},M=o=>{o.preventDefault(),S(!1);const i=Array.from(o.dataTransfer.files);i.forEach(g=>{if(g.type.startsWith("image/")){const m=new FileReader;m.onload=w=>{var F;const k=(F=w.target)==null?void 0:F.result;E(u=>[...u,k]),I(u=>[...u,k])},m.readAsDataURL(g)}}),i.length>0&&f.success(`${i.length}개의 이미지가 추가되었습니다`)},T=o=>{var g;const i=Array.from(((g=o.target)==null?void 0:g.files)||[]);i.forEach(m=>{if(m.type.startsWith("image/")){const w=new FileReader;w.onload=k=>{var u;const F=(u=k.target)==null?void 0:u.result;E(c=>[...c,F]),I(c=>[...c,F])},w.readAsDataURL(m)}}),i.length>0&&f.success(`${i.length}개의 이미지가 추가되었습니다`)},B=o=>{E(i=>i.filter((g,m)=>m!==o)),I(i=>i.filter((g,m)=>m!==o)),f.success("이미지가 삭제되었습니다")},_=async o=>{if(L)return;$(!0);const i={...o,amount:Number(o.amount),date:new Date(o.date),images:H};try{await z(i)}catch(g){throw $(!1),g}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-xl font-semibold",children:d?"추가내역 수정":"추가내역 등록"}),e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:V(_),className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"프로젝트명 *"}),e.jsxs("select",{...D("project",{required:"프로젝트를 선택하세요"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",children:[(v==null?void 0:v.name)!=="안팀"&&e.jsx("option",{value:"",children:"선택하세요"}),x.map(o=>e.jsx("option",{value:o.name,children:o.name},o.id))]}),N.project&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:String(N.project.message)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"내용 *"}),e.jsx("textarea",{...D("description",{required:"추가내역 내용을 입력하세요"}),rows:3,className:"input",placeholder:"추가 공사 내용을 입력하세요 (예: 거실 조명 추가 설치)"}),N.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:String(N.description.message)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"금액 (원) *"}),e.jsx("input",{...D("amount",{required:"금액을 입력하세요",min:{value:0,message:"금액은 0 이상이어야 합니다"}}),type:"number",className:"input",placeholder:"예: 500000"}),N.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:String(N.amount.message)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"일자 *"}),e.jsx("input",{...D("date",{required:"일자를 선택하세요"}),type:"date",className:"input"}),N.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:String(N.date.message)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"비고"}),e.jsx("textarea",{...D("notes"),rows:2,className:"input",placeholder:"추가 메모 (선택사항)"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"증빙 이미지 (Ctrl+V로 붙여넣기 가능)"}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 transition-colors ${q?"border-gray-500 bg-gray-50":"border-gray-300"}`,onDragOver:C,onDragLeave:W,onDrop:M,children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"이미지를 드래그하여 놓거나 클릭하여 선택하세요"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"또는 Ctrl+V로 클립보드 이미지 붙여넣기"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:T,className:"hidden",id:"file-upload-additional"}),e.jsxs("label",{htmlFor:"file-upload-additional",className:"mt-4 inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"파일 선택"]})]})}),O.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:O.map((o,i)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:o,alt:`증빙 ${i+1}`,className:"w-full h-32 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>B(i),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(te,{className:"h-3 w-3"})})]},i))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:b,className:"btn btn-outline",children:"취소"}),e.jsx("button",{type:"submit",disabled:L,className:"btn btn-primary disabled:opacity-50",children:L?"저장 중...":d?"수정":"등록"})]})]})]})})},Re=()=>{var ce;const{user:d}=fe(),b=he(),{constructionPayments:z}=Se(),[P,D]=r.useState([]),[V,j]=r.useState(!1),[N,v]=r.useState(null),[x,q]=r.useState(null),[S,O]=r.useState(new Set),[E,H]=r.useState(void 0),[I,L]=r.useState(!1),[$,U]=r.useState(null),[C,W]=r.useState({}),[M,T]=r.useState([]);r.useRef(null);const B=r.useRef(null),[_,o]=r.useState(!1),[i,g]=r.useState(!1),[m,w]=r.useState(!1),k=t=>P.filter(s=>s.project===t).reduce((s,a)=>s+a.amount,0),u=((d==null?void 0:d.name)==="안팀"?z.filter(t=>b.some(s=>s.name===t.project)):z).filter(t=>{var h;const s=k(t.project);let a;if(t.vatType==="amount")a=(t.totalAmount||0)+(t.vatAmount||0);else{const y=(t.totalAmount||0)*((t.vatPercentage??100)/100)*.1;a=(t.totalAmount||0)+y}const l=a+s,n=((h=t.payments)==null?void 0:h.reduce((y,A)=>y+A.amount,0))||0;return l>0&&n>=l}).map(t=>t.project),[c,p]=r.useState({project:"",description:"",amount:"",date:K(new Date,"yyyy-MM-dd"),notes:""});r.useEffect(()=>{var t;if(b.length>0&&!c.project){const s=localStorage.getItem("lastSelectedProject"),a=((t=b.find(l=>l.name===s))==null?void 0:t.name)||b[0].name;p(l=>({...l,project:a}))}},[b]);const Z=r.useCallback(t=>{var n;const s=document.activeElement;if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement)return;const l=(n=t.clipboardData)==null?void 0:n.items;if(l){for(let h=0;h<l.length;h++)if(l[h].type.indexOf("image")!==-1){t.preventDefault();const y=l[h].getAsFile();if(y){const A=new FileReader;A.onload=Ne=>{var me;const de=(me=Ne.target)==null?void 0:me.result;x?W(J=>{const xe=[...J[x]||[],de];return se(x,xe),{...J,[x]:xe}}):T(J=>[...J,de]),f.success("이미지가 첨부되었습니다")},A.readAsDataURL(y)}}}},[x]);r.useEffect(()=>(document.addEventListener("paste",Z),()=>document.removeEventListener("paste",Z)),[Z]),r.useEffect(()=>{const t=localStorage.getItem("additionalWorkImages");t&&W(JSON.parse(t))},[]),r.useEffect(()=>{localStorage.setItem("additionalWorkImages",JSON.stringify(C))},[C]),r.useEffect(()=>{const t=()=>{o(s=>{const a=!s;return window.dispatchEvent(new CustomEvent("mobileFormStateChange",{detail:{isOpen:a}})),a})};return window.addEventListener("headerAddButtonClick",t),()=>window.removeEventListener("headerAddButtonClick",t)},[]),r.useEffect(()=>{window.dispatchEvent(new CustomEvent("mobileFormStateChange",{detail:{isOpen:_}}))},[_]);const se=async(t,s)=>{try{await X.updateAdditionalWork(t,{images:s})}catch(a){console.error("Failed to save images:",a)}},be=t=>{const s=Array.from(t.target.files||[]);if(!x){f.error("먼저 추가내역을 선택해주세요");return}s.forEach(a=>{if(a.type.startsWith("image/")){const l=new FileReader;l.onload=n=>{var y;const h=(y=n.target)==null?void 0:y.result;W(A=>({...A,[x]:[...A[x]||[],h]}))},l.readAsDataURL(a)}}),s.length>0&&f.success("이미지가 첨부되었습니다")},je=(t,s)=>{W(l=>({...l,[t]:(l[t]||[]).filter((n,h)=>h!==s)})),f.success("이미지가 삭제되었습니다");const a=(C[t]||[]).filter((l,n)=>n!==s);se(t,a)},ae=t=>{U(t),L(!0)},G=async()=>{try{const t=await X.getAllAdditionalWorks(),s=b.map(n=>n.name),a=(d==null?void 0:d.name)==="안팀"?t.filter(n=>s.includes(n.project)):t;D(a.map(n=>({id:n._id,project:n.project,description:n.description,amount:n.amount,date:new Date(n.date),notes:n.notes,images:n.images||[]})));const l={};a.forEach(n=>{n.images&&n.images.length>0&&(l[n._id]=n.images)}),W(l)}catch(t){console.error("Failed to load additional works:",t),D([])}};r.useEffect(()=>{G()},[]);const re=t=>{v(t),H(t.project),j(!0)},le=async t=>{if(window.confirm("이 추가내역을 삭제하시겠습니까?"))try{await X.deleteAdditionalWork(t),await G(),f.success("추가내역이 삭제되었습니다"),x===t&&q(null)}catch(s){console.error("Failed to delete additional work:",s),f.error("추가내역 삭제에 실패했습니다")}},ye=async t=>{j(!1),v(null),H(void 0),t&&await G()},ne=async t=>{if(t.preventDefault(),!m){if(!c.project||!c.description||!c.amount||!c.date){f.error("모든 필수 항목을 입력해주세요");return}w(!0);try{const s=await X.createAdditionalWork({project:c.project,description:c.description,amount:parseFloat(c.amount),date:new Date(c.date),images:M});f.success("추가내역이 등록되었습니다"),p(a=>({...a,description:"",amount:"",date:K(new Date,"yyyy-MM-dd"),notes:""})),T([]),await G(),M.length>0&&s._id&&W(a=>({...a,[s._id]:M})),localStorage.setItem("lastSelectedProject",c.project)}catch(s){console.error("Failed to create additional work:",s),f.error("추가내역 등록에 실패했습니다")}finally{w(!1)}}},oe=P.filter(t=>{const s=u.includes(t.project);return i?s:!s}),R=oe.reduce((t,s)=>{const a=t.find(l=>l.projectName===s.project);return a?(a.works.push(s),a.totalAmount+=s.amount):t.push({projectName:s.project,works:[s],totalAmount:s.amount}),t},[]);R.sort((t,s)=>t.projectName.localeCompare(s.projectName)),R.forEach(t=>{t.works.sort((s,a)=>a.date.getTime()-s.date.getTime())}),r.useEffect(()=>{const t=new Set(R.map(s=>s.projectName));O(t)},[oe.length]);const ie=t=>{const s=new Set(S);s.has(t)?s.delete(t):s.add(t),O(s)};return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"additional-work-container hidden desktop:grid desktop:gap-4 2xl:gap-6 desktop:grid-cols-12",children:[e.jsx("div",{className:"additional-work-form md:col-span-4 lg:col-span-4 bg-white border border-gray-200 rounded-lg p-4 md:p-5 lg:p-6 h-fit sticky top-4",children:e.jsxs("div",{className:"aw-form-inner space-y-4",children:[e.jsxs("div",{className:"aw-project",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"프로젝트 *"}),e.jsxs("select",{value:c.project,onChange:t=>p(s=>({...s,project:t.target.value})),className:"w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white",children:[(d==null?void 0:d.name)!=="안팀"&&e.jsx("option",{value:"",children:"선택하세요"}),b.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})]}),e.jsxs("div",{className:"aw-date",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"일자 *"}),e.jsx("input",{type:"date",value:c.date,onChange:t=>p(s=>({...s,date:t.target.value})),className:"w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"})]}),e.jsxs("div",{className:"aw-description",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"내용 *"}),e.jsx("textarea",{value:c.description,onChange:t=>p(s=>({...s,description:t.target.value})),rows:5,className:"w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none",placeholder:"추가내역 내용을 입력하세요"})]}),e.jsxs("div",{className:"aw-amount",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"금액 *"}),e.jsx("input",{type:"number",value:c.amount,onChange:t=>p(s=>({...s,amount:t.target.value})),className:"w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:"0"})]}),e.jsxs("div",{className:"aw-images",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["이미지 첨부",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Ctrl+V로 붙여넣기 가능)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{ref:B,type:"file",accept:"image/*",multiple:!0,onChange:t=>{Array.from(t.target.files||[]).forEach(a=>{if(a.type.startsWith("image/")){const l=new FileReader;l.onload=n=>{var y;const h=(y=n.target)==null?void 0:y.result;T(A=>[...A,h])},l.readAsDataURL(a)}}),t.target.value=""},className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=B.current)==null?void 0:t.click()},className:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"이미지 첨부"]}),M.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:M.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`첨부 ${s+1}`,className:"w-full h-20 object-cover rounded cursor-pointer",onClick:()=>ae(t)}),e.jsx("button",{type:"button",onClick:()=>T(a=>a.filter((l,n)=>n!==s)),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Q,{className:"h-3 w-3"})})]},s))})]})]}),e.jsx("button",{onClick:ne,disabled:m,className:"aw-submit w-full py-3.5 bg-gray-900 text-white text-base font-semibold rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"등록 중...":"추가내역 등록"})]})}),e.jsxs("div",{className:"additional-work-list md:col-span-4 lg:col-span-5 flex flex-col h-[calc(100vh-120px)]",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex-shrink-0",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>g(!1),className:`flex-1 py-2 text-sm font-medium border-b-2 transition-colors ${i?"border-transparent text-gray-500 hover:text-gray-700":"border-gray-900 text-gray-900"}`,children:["미납 (",R.filter(t=>!u.includes(t.projectName)).length,")"]}),e.jsxs("button",{onClick:()=>g(!0),className:`flex-1 py-2 text-sm font-medium border-b-2 transition-colors ${i?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["완납 (",u.length,")"]})]})})}),e.jsx("div",{className:"space-y-4 flex-1 overflow-y-auto mt-3 pr-1",children:R.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3.5 border-b border-gray-200 flex items-center justify-between cursor-pointer bg-gray-100 hover:bg-gray-200",onClick:()=>ie(t.projectName),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[S.has(t.projectName)?e.jsx(ge,{className:"h-5 w-5 text-gray-500"}):e.jsx(ue,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.projectName}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.works.length,")"]})]}),e.jsxs("span",{className:"text-base font-bold text-gray-900",children:[t.totalAmount.toLocaleString(),"원"]})]}),S.has(t.projectName)&&e.jsx("div",{className:"divide-y divide-gray-100",children:t.works.map(s=>{var a;return e.jsx("div",{className:`px-4 py-3.5 hover:bg-gray-50 cursor-pointer transition-colors ${x===s.id?"bg-blue-50 border-l-4 border-blue-500":""}`,onClick:()=>q(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-base text-gray-900 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:K(s.date,"yyyy.MM.dd")}),((a=C[s.id])==null?void 0:a.length)>0&&e.jsxs("span",{className:"text-sm text-blue-600 flex items-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4"}),C[s.id].length]})]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:s.notes})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-base font-semibold text-gray-900",children:[s.amount.toLocaleString(),"원"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),re(s)},className:"p-1.5 text-gray-500 hover:text-gray-700",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),le(s.id)},className:"p-1.5 text-red-500 hover:text-red-700",children:e.jsx(te,{className:"h-4 w-4"})})]})]})]})},s.id)})})]},t.projectName))})]}),e.jsx("div",{className:"additional-work-images md:col-span-4 lg:col-span-3 bg-white rounded-lg shadow-sm border border-gray-200 p-4 md:p-5 lg:p-6 h-[calc(100vh-120px)] overflow-y-auto",children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-5 sticky top-0 bg-white pb-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"이미지 관리"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Ctrl+V로 이미지 붙여넣기"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:be,className:"hidden",id:"work-image-upload"}),e.jsxs("label",{htmlFor:"work-image-upload",className:"px-4 py-2 text-sm border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 cursor-pointer flex items-center gap-2 font-medium",children:[e.jsx(ee,{className:"h-4 w-4"}),"이미지 첨부"]})]})]}),((ce=C[x])==null?void 0:ce.length)>0?e.jsx("div",{className:"grid grid-cols-2 xl:grid-cols-3 gap-4",children:C[x].map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`이미지 ${s+1}`,className:"w-full h-40 object-cover rounded-lg cursor-pointer",onClick:()=>ae(t)}),e.jsx("button",{onClick:()=>je(x,s),className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Q,{className:"h-4 w-4"})})]},s))}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx(Y,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-base",children:"이미지가 없습니다"}),e.jsx("p",{className:"text-sm mt-2",children:"이미지를 업로드하거나 Ctrl+V로 붙여넣기"})]})]}):e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx(Y,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-base",children:"추가내역을 선택하세요"}),e.jsx("p",{className:"text-sm mt-2",children:"선택한 항목의 이미지를 관리할 수 있습니다"})]})})]}),e.jsxs("div",{className:"desktop:hidden space-y-3",children:[_&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"프로젝트 *"}),e.jsxs("select",{value:c.project,onChange:t=>p(s=>({...s,project:t.target.value})),className:"w-full px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white",children:[(d==null?void 0:d.name)!=="안팀"&&e.jsx("option",{value:"",children:"선택하세요"}),b.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"일자 *"}),e.jsx("input",{type:"date",value:c.date,onChange:t=>p(s=>({...s,date:t.target.value})),className:"w-full px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"내용 *"}),e.jsx("textarea",{value:c.description,onChange:t=>p(s=>({...s,description:t.target.value})),rows:4,className:"w-full px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none",placeholder:"추가내역 내용을 입력하세요"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"금액 *"}),e.jsx("input",{type:"number",value:c.amount,onChange:t=>p(s=>({...s,amount:t.target.value})),className:"w-full px-3 py-2.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white",placeholder:"0"})]}),e.jsx("button",{onClick:ne,disabled:m,className:"w-full py-3 bg-gray-900 text-white text-sm font-semibold rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"등록 중...":"추가내역 등록"})]})}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>g(!1),className:`flex-1 py-2 text-xs font-medium border-b-2 transition-colors ${i?"border-transparent text-gray-500":"border-gray-900 text-gray-900"}`,children:["미납 (",P.filter(t=>!u.includes(t.project)).length>0?R.filter(t=>!u.includes(t.projectName)).length:0,")"]}),e.jsxs("button",{onClick:()=>g(!0),className:`flex-1 py-2 text-xs font-medium border-b-2 transition-colors ${i?"border-gray-900 text-gray-900":"border-transparent text-gray-500"}`,children:["완납 (",u.length,")"]})]}),R.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between bg-gray-100",onClick:()=>ie(t.projectName),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S.has(t.projectName)?e.jsx(ge,{className:"h-5 w-5 text-gray-500"}):e.jsx(ue,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.projectName}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.works.length,")"]})]}),e.jsxs("span",{className:"font-bold text-gray-900",children:[t.totalAmount.toLocaleString(),"원"]})]}),S.has(t.projectName)&&e.jsx("div",{className:"divide-y divide-gray-100",children:t.works.map(s=>e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.description}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:K(s.date,"yyyy.MM.dd",{locale:we})}),s.notes&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.notes})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[s.amount.toLocaleString(),"원"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>re(s),className:"p-1 text-gray-500 hover:text-gray-700",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>le(s.id),className:"p-1 text-red-500 hover:text-red-700",children:e.jsx(te,{className:"h-4 w-4"})})]})]})]})},s.id))})]},t.projectName))]}),V&&e.jsx(Ce,{isOpen:V,onClose:ye,work:N,projects:b,initialProject:E}),I&&$&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center p-4",onClick:()=>L(!1),children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>L(!1),className:"absolute top-4 right-4 p-2 bg-white rounded-full hover:bg-gray-100 z-10",children:e.jsx(Q,{className:"h-6 w-6"})}),e.jsx("img",{src:$,alt:"확대 이미지",className:"max-w-full max-h-[90vh] object-contain",onClick:t=>t.stopPropagation()})]})})]})};export{Re as default};
