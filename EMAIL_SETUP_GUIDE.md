# 네이버 메일 연동 설정 가이드

HV LAB 견적문의 이메일 자동 수집 기능을 사용하기 위한 설정 가이드입니다.

## 1. 네이버 앱 비밀번호 생성

네이버는 IMAP 접속 시 일반 비밀번호가 아닌 **앱 비밀번호**를 사용해야 합니다.

### 단계:

1. **네이버에 로그인** (hv_lab@naver.com)

2. **네이버 메일 > 환경설정 접속**
   - https://mail.naver.com/v2/settings

3. **왼쪽 메뉴에서 "IMAP/POP3 설정" 선택**

4. **IMAP/POP3 사용 설정**
   - IMAP 사용 : **사용함**으로 변경
   - POP3 사용 : 선택 사항

5. **앱 비밀번호 생성**
   - "앱 비밀번호 관리" 클릭
   - "앱 비밀번호 생성" 버튼 클릭
   - 앱 이름: "HV LAB Management System" (원하는 이름)
   - 생성된 16자리 비밀번호를 복사 (예: `abcd1234efgh5678`)

6. **중요**: 생성된 앱 비밀번호는 한 번만 표시되므로 안전한 곳에 저장하세요!

## 2. Railway 환경 변수 설정

1. **Railway 대시보드 접속**
   - https://railway.app
   - HV LAB 프로젝트 선택

2. **Variables 탭 클릭**

3. **다음 환경 변수 추가**
   ```
   NAVER_EMAIL=hv_lab@naver.com
   NAVER_EMAIL_PASSWORD=여기에_앱_비밀번호_입력
   ```

4. **저장 및 재배포**
   - 환경 변수를 추가하면 자동으로 재배포됩니다

## 3. 작동 방식

### 자동 메일 확인
- **주기**: 5분마다 자동으로 확인
- **서버 시작 시**: 시작 5초 후 한 번 확인
- **대상 메일**: 제목이 "[HV LAB] 견적상담문의에 새 응답이 접수되었습니다." 인 읽지 않은 메일

### 데이터 추출
이메일 본문에서 다음 정보를 자동으로 추출합니다:
- 이름
- 전화번호
- 이메일
- 주소 (선택)
- 프로젝트 종류 (선택)
- 예산 (선택)
- 문의 내용

### 중복 방지
- 같은 이름, 전화번호, 이메일의 문의가 24시간 이내에 있으면 중복으로 처리하여 저장하지 않습니다.

### 확인 방법
1. 관리자 계정으로 로그인
2. 왼쪽 메뉴에서 "견적문의" 클릭
3. 자동으로 수집된 견적문의 확인

## 4. 로그 확인

서버 로그에서 다음과 같은 메시지를 확인할 수 있습니다:

```
✅ 이메일 서비스가 초기화되었습니다.
📧 이메일: hv_lab@naver.com
📧 이메일 체크 스케줄러를 시작합니다 (5분마다 실행)
⏰ [스케줄러] 견적문의 메일 확인 중...
📨 2개의 새로운 견적문의 메일을 발견했습니다.
✅ 견적문의 저장 완료: 홍길동
✅ [스케줄러] 2개의 새로운 견적문의가 등록되었습니다.
```

## 5. 문제 해결

### 메일이 수집되지 않는 경우

1. **앱 비밀번호 확인**
   - Railway Variables에 `NAVER_EMAIL_PASSWORD`가 올바르게 설정되었는지 확인
   - 16자리 앱 비밀번호 (일반 비밀번호가 아님)

2. **IMAP 설정 확인**
   - 네이버 메일 설정에서 IMAP이 활성화되어 있는지 확인

3. **이메일 제목 확인**
   - 아입웹에서 보내는 이메일 제목이 정확히 "[HV LAB] 견적상담문의에 새 응답이 접수되었습니다."인지 확인

4. **로그 확인**
   - Railway 대시보드의 Deployments > Logs에서 오류 메시지 확인

### 일반적인 오류

**"❌ IMAP 연결 오류: Invalid credentials"**
- 앱 비밀번호가 잘못되었습니다. 새로운 앱 비밀번호를 생성하세요.

**"⚠️ 네이버 이메일 비밀번호가 설정되지 않았습니다"**
- Railway에 `NAVER_EMAIL_PASSWORD` 환경 변수를 추가하세요.

## 6. 보안 주의사항

- ⚠️ 앱 비밀번호를 Git에 커밋하지 마세요!
- ⚠️ 앱 비밀번호는 Railway 환경 변수로만 관리하세요.
- ⚠️ 정기적으로 앱 비밀번호를 변경하세요.
- ⚠️ 사용하지 않는 앱 비밀번호는 삭제하세요.

## 7. 테스트

1. 아입웹 홈페이지에서 견적문의 테스트 제출
2. hv_lab@naver.com으로 이메일 전송 확인
3. 5분 이내에 시스템에서 자동 수집 확인
4. 관리 시스템의 "견적문의" 메뉴에서 확인

---

문제가 있으면 서버 로그를 확인하거나 개발자에게 문의하세요.
